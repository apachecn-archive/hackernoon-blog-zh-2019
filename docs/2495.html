<html>
<head>
<title>Send Images and Files via WhatsApp Using Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Ruby 通过 WhatsApp 发送图像和文件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/send-images-and-files-via-whatsapp-using-ruby-773f900764f0#2019-04-18">https://medium.com/hackernoon/send-images-and-files-via-whatsapp-using-ruby-773f900764f0#2019-04-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/6c084a4e859f6652bc50ca0059b19e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ycz60LeU-_rFwvr1EkH8qA.png"/></div></div></figure><p id="64ab" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有了 WhatsApp 的 Twilio API，我们可以向 WhatsApp 号码发送消息。这些消息可以是纯文本，也可以包含图像、音频甚至是最大 5MB 的 pdf 文件。让我们看看如何使用 Ruby 实现这一点。</p><h1 id="465b" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">你需要的东西</h1><p id="4259" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">如果你想和这篇文章一起写代码，你需要一些东西:</p><ul class=""><li id="167d" class="le lf hu je b jf jg jj jk jn lg jr lh jv li jz lj lk ll lm dt translated">Twilio 帐户(<a class="ae ka" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">现在就注册一个免费帐户</a>)</li><li id="8398" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated"><a class="ae ka" href="https://www.ruby-lang.org/en/downloads/" rel="noopener ugc nofollow" target="_blank">安装红宝石</a>和<a class="ae ka" href="https://bundler.io/" rel="noopener ugc nofollow" target="_blank">捆扎机</a></li><li id="6242" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">WhatsApp 沙盒频道已安装(<a class="ae ka" href="https://www.twilio.com/docs/sms/whatsapp/api" rel="noopener ugc nofollow" target="_blank">了解如何激活您的 WhatsApp 沙盒</a>)</li></ul><p id="11e6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">明白了吗？让我们开始编码吧！</p><p id="5d51" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为您的项目创建一个新目录，并使用 Bundler 初始化一个新的<code class="eh ls lt lu lv b">Gemfile</code>:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="f991" class="me kc hu lv b fv mf mg l mh mi">mkdir whatsapp-messages<br/>cd whatsapp-messages<br/>bundle init</span></pre><p id="6b4a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">打开新的<code class="eh ls lt lu lv b">Gemfile</code>并添加<code class="eh ls lt lu lv b">twilio-ruby</code>宝石:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="e163" class="me kc hu lv b fv mf mg l mh mi"># frozen_string_literal: true<br/><br/>source "https://rubygems.org"<br/><br/>gem "twilio-ruby"</span></pre><p id="d13b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过在命令行运行<code class="eh ls lt lu lv b">bundle install</code>来安装 gem。</p><h1 id="5d97" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">发送您的第一条 WhatsApp 消息</h1><p id="01dd" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">在你的项目目录中创建一个名为<code class="eh ls lt lu lv b">app.rb</code>的文件并打开它。我们将需要<code class="eh ls lt lu lv b">twilio-ruby</code> gem 并用我们的账户 Sid 和认证令牌(你可以在你的<a class="ae ka" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank"> Twilio 控制台</a>上找到)初始化一个 API 客户端。我们将使用 API 客户端从 WhatsApp 沙盒号向我们自己的 WhatsApp 帐户发送一条消息。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="b370" class="me kc hu lv b fv mf mg l mh mi"># app.rb<br/>require 'twilio-ruby'<br/><br/>client = Twilio::REST::Client.new('YOUR_ACCOUNT_SID', 'YOUR_AUTH_TOKEN')<br/>message = client.messages.create(<br/>  to: 'whatsapp:YOUR_WHATSAPP_NUMBER',<br/>  from: 'whatsapp:WHATSAPP_SANDBOX_NUMBER',<br/>  body: 'Ahoy from Twilio!'<br/>)<br/>puts "Message sent.\nMessage SID: #{message.sid}."</span></pre><p id="e13f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保用您自己的详细信息替换所有占位符。WhatsApp 号码采用“WhatsApp:e . 164-电话号码”的格式。一个<a class="ae ka" href="https://en.wikipedia.org/wiki/E.164" rel="noopener ugc nofollow" target="_blank"> E.164 格式的电话号码</a>以国家代码开始，后面是号码的其余部分，没有其他标点符号，例如“+15551231234”。</p><p id="31c5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用以下命令运行代码:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="f4ec" class="me kc hu lv b fv mf mg l mh mi">bundle exec ruby app.rb</span></pre><p id="71e2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你应该会在 WhatsApp 应用程序中收到你的消息。</p><blockquote class="mj mk ml"><p id="7881" class="jc jd mm je b jf jg jh ji jj jk jl jm mn jo jp jq mo js jt ju mp jw jx jy jz hn dt translated">注意:WhatsApp 和通过 Twilio API 的普通短信有一些区别。如果您与用户建立了活动会话，则只能发送自由格式的邮件。当用户回复<a class="ae ka" href="https://www.twilio.com/docs/sms/whatsapp/api#sending-notifications" rel="noopener ugc nofollow" target="_blank">模板消息</a>或<a class="ae ka" href="https://www.twilio.com/docs/sms/whatsapp/api#conversational-messaging-on-whatsapp" rel="noopener ugc nofollow" target="_blank">用户通过向你的 WhatsApp 号码发送消息来发起对话</a>时，会话就创建了。从用户向您发送的最后一条消息开始，会话将持续 24 小时。如果您没有收到消息，请尝试先向 WhatsApp 沙盒发送消息，然后再次运行脚本。</p></blockquote><h1 id="51eb" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">发送媒体消息</h1><p id="0da3" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们可以做得比短信更好。这次我们发个图。WhatsApp 的 Twilio API 支持发送 JPG、JPEG 或 PNG 图像。</p><p id="e54d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要发送媒体消息，我们需要在创建消息的调用中再添加一个东西，一个<code class="eh ls lt lu lv b">media_url</code>。<code class="eh ls lt lu lv b">media_url</code>需要指向在线可用的图像文件，并且内容类型头应该与扩展名匹配。</p><p id="2120" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将<code class="eh ls lt lu lv b">media_url</code>添加到您现有的代码中。您可以使用下面的 URL 或选择您自己的图像。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="477b" class="me kc hu lv b fv mf mg l mh mi"># app.rb<br/>require 'twilio-ruby'<br/><br/>client = Twilio::REST::Client.new('YOUR_ACCOUNT_SID', 'YOUR_AUTH_TOKEN')<br/>message = client.messages.create(<br/>  to: 'whatsapp:+447719532208',<br/>  from: 'whatsapp:+14155238886',<br/>  body: 'Ahoy from Twilio!',<br/>  media_url: 'https://tinyurl.com/ahoy-whatsapp'<br/>)<br/>puts "Message sent. Message SID: #{message.sid}."</span></pre><p id="8d92" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再次运行代码，你会收到一条短信和旁边的图片。</p><h1 id="5bf1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">下一步是什么？</h1><p id="45f2" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">现在，您已经使用 Ruby 发送了带有文本和图像的 WhatsApp 消息。接下来，您可以尝试发送音频文件(MP3、OGG 和 AMR 格式)或 PDF 文件，只要它们的大小不超过 5MB。</p><p id="9667" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">想更多地参与 WhatsApp messages 和 Ruby 吗？了解如何<a class="ae ka" href="https://www.twilio.com/blog/collaborative-playlist-whatsapp-rails-twilio-spotify" rel="noopener ugc nofollow" target="_blank">将 WhatsApp、Spotify 和 Rails 结合起来创建一个协作播放列表</a>或者如何<a class="ae ka" href="https://www.twilio.com/blog/celebrity-spotting-twilio-api-whatsapp-aws-rekognition-ruby" rel="noopener ugc nofollow" target="_blank">从 WhatsApp 获取图像并使用 AWS Rekognition 来检查您照片中的名人</a>。</p><p id="ff7b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我很想看看你能用 Twilio API 在 WhatsApp 上建立发送和接收媒体的功能。请在评论中联系我，通过电子邮件联系 philnash@twilio.com，或者通过推特联系菲尔纳什，告诉我你的项目或问题。</p></div><div class="ab cl mq mr hc ms" role="separator"><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv mw"/><span class="mt bw bk mu mv"/></div><div class="hn ho hp hq hr"><p id="db5d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mm">原载于</em><a class="ae ka" href="https://www.twilio.com/blog/send-images-files-whatsapp-ruby" rel="noopener ugc nofollow" target="_blank"><em class="mm">https://www.twilio.com</em></a><em class="mm">。</em></p></div></div>    
</body>
</html>