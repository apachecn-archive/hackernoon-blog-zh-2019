<html>
<head>
<title>Ditch your SSH keys and enable AWS SSM!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">丢掉你的SSH密钥，启用AWS SSM！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ditch-your-ssh-keys-and-enable-aws-ssm-ec1c2b27350c?source=collection_archive---------7-----------------------#2019-04-14">https://medium.com/hackernoon/ditch-your-ssh-keys-and-enable-aws-ssm-ec1c2b27350c?source=collection_archive---------7-----------------------#2019-04-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/d28a0d54a5721f09b17ecf18ef345984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fN8Ho-PT_2sxP70EFcYatA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/8_NI1WTqCGY?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">marcos mayer</a> on <a class="ae jg" href="https://unsplash.com/search/photos/lock?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="24ea" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您为一个组织(无论大小)管理AWS，那么您很可能有几个很少使用的安全外壳(SSH)密钥，或者更糟的是，您不记得该密钥是为哪个帐户创建的。SSH密钥管理本身就是一个兔子洞，大多数人都理解不恰当的SSH密钥管理带来的安全问题。幸运的是，有一种方法可以告别使用SSH远程访问EC2实例的繁琐做法。请允许我向您介绍AWS服务，系统经理(SSM)。</p><p id="f297" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在本指南中，我将教您以下内容:</p><ul class=""><li id="cb51" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated">确定SSM远程会话管理器的要求，包括对企业的要求</li><li id="b91b" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">为所有EC2实例启用远程会话管理器</li><li id="df1c" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">启用远程会话管理器日志记录</li><li id="7751" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">通过IAM用户权限锁定远程会话管理器🔐</li><li id="bd2e" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">调试远程会话管理器</li></ul><h1 id="c438" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">启用SSM远程会话管理器</h1><p id="c57a" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">AWS托管服务SSM提供了一个简洁的特性，叫做会话管理器。会话管理器允许我们通过使用HTTPS TLS1.2/端口443连接到一个实例并获得一个shell会话，而不必使用SSH密钥。重要的是要理解这不是一个SSH连接，而是一个HTTPS连接。会话管理器允许我们直接从web浏览器或通过AWS CLI使用终端会话。真的那么简单…..<em class="lw">假设你已经正确配置好了一切</em>。</p><p id="181c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以下是让SSM的远程会话管理器工作的核心要求:</p><ul class=""><li id="9c7a" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated"><strong class="jj hv">SSM代理安装在实例</strong>上。默认情况下，SSM代理安装在Amazon Linux、Amazon Linux2、Ubuntu Server 16.04、Ubuntu Server 18.04和所有Windows Server AMIs上。<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html" rel="noopener ugc nofollow" target="_blank">代理也可以安装在你的实例</a>(如果没有的话)或者通过使用<a class="ae jg" href="https://www.packer.io/intro/" rel="noopener ugc nofollow" target="_blank"> Packer </a>预存在你的AMI中。</li><li id="c56d" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated"><strong class="jj hv">EC2实例需要一个IAM实例配置文件</strong>—EC2类型的实例配置文件角色。要为SSM创建IAM实例概要文件，请遵循此<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/getting-started-create-iam-instance-profile.html" rel="noopener ugc nofollow" target="_blank">链接</a>。</li><li id="dd90" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated"><strong class="jj hv">IAM实例配置文件需要适当的SSM权限。</strong>这是一个经常引起混淆或被遗漏的步骤。为了让SSM代理与AWS SSM API端点通信，它需要适当的IAM权限。为了方便起见，AWS提供了一个名为<code class="eh lx ly lz ma b">amazonEC2RoleforSSM</code>的默认SSM策略。也就是说，我建议您根据默认提供的策略制定自己的策略，该策略不包括以下权限<code class="eh lx ly lz ma b">s3:*</code>(稍后将详细介绍)。</li></ul><p id="f41d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当您为您的实例检查了这三个需求后，您就可以开始使用SSM的远程会话了。哒哒！</p><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mb"><img src="../Images/8aed7f09ded42d10a540dab04a6b1dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQ7QbRdG8QCFZFVBnr2WLg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">What you should see if all requirements have been met!</figcaption></figure><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mg"><img src="../Images/0367d2792f98774091c75d3472f51b7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9uUhA3xyemDAxMA1Zme1A.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">What a session looks like in the browser</figcaption></figure><p id="96c3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然而，正如生活中的其他事情一样，还有比我上面提到的三个要求更不明显的要求。此外，如果你是直接连接的企业用户，事情<em class="lw">可能</em>会变得有点棘手。让我们深入探讨一下“不太常见”的需求。</p><ul class=""><li id="b2eb" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated">VPC可以访问互联网。这不是每个人都有的奢侈品。如果您所在的组织将<a class="ae jg" href="https://aws.amazon.com/directconnect/" rel="noopener ugc nofollow" target="_blank"> Direct Connect </a>与您的AWS基础架构结合使用，那么您可能会有一些专门创建的没有互联网网关(IGW)和NAT网关的VPC，因此您只能通过公司数据中心访问互联网。这让事情变得更加困难，但幸运的是，我们有一个解决方案——我稍后会详细讨论这个问题。</li><li id="1c0b" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated"><strong class="jj hv">AWS CLI需要SSM插件</strong>。没错，如果您想从您的工作站使用远程会话功能，那么您需要为AWS CLI安装一个额外的插件。这是一个简单的安装，所有方向都可以找到<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html" rel="noopener ugc nofollow" target="_blank">这里</a>。</li></ul><h2 id="888c" class="mh ku hu bd kv mi mj mk kz ml mm mn ld js mo mp lh jw mq mr ll ka ms mt lp mu dt translated">应对VPC互联网挑战</h2><p id="4c78" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">如果您发现自己处于我上面描述的情况——一个没有互联网连接的VPC，您需要启用六个<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/sysman-setting-up-vpc.html" rel="noopener ugc nofollow" target="_blank"> VPC端点</a>。简单。</p><p id="10b7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您不熟悉VPC端点，这是一种通过AWS内部网络基础设施将指定的互联网流量路由到AWS公共API端点的方式。传统上，如果您需要调用EC2服务API，其余的调用将通过NAT或IGW路由，并通过互联网服务提供商(ISP)提供的公共互联网，然后到达面向公众的EC2 API。然而，对于VPC端点，REST调用到达API端点，但是通过AWS网络主干从VPC直接路由到面向公众的API，因此永远不会到达公共互联网，而是始终留在AWS基础设施内部。很酷吧？这使得没有互联网接入的VPC能够利用SSM的远程会话管理器。</p><p id="4e81" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意:当创建端点- <strong class="jj hv">时，确保您启用了私有DNS名称！</strong></p><ul class=""><li id="fd94" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated">com.amazonaws. <code class="eh lx ly lz ma b"><em class="lw">region</em></code>。地对地导弹</li><li id="1a2e" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">亚马逊网站消息</li><li id="590e" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">com.amazonaws. <code class="eh lx ly lz ma b"><em class="lw">region.</em></code> ec2</li><li id="d9e4" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">com . Amazon AWS .<code class="eh lx ly lz ma b"><em class="lw">region.</em></code>ec2消息</li><li id="b6a4" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">com.amazonaws. <code class="eh lx ly lz ma b"><em class="lw">region.</em></code>日志</li><li id="54bc" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated">com.amazonaws. <code class="eh lx ly lz ma b"><em class="lw">region.</em></code> <em class="lw"> s3 </em></li></ul><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mv"><img src="../Images/fb1003ca12ea524246f2d78d6bbb06b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IdkOsMFwiuWAbFmkzwl4Yw.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">These endpoints will allow you to leverage SSM’s Remote Session Manager and all it’s functionality</figcaption></figure><p id="5e82" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您想知道为什么日志和s3是端点列表的一部分，只需知道如果启用了日志功能，它们是必需的。logs端点用于CloudWatch日志。我要再次强调这一点，确保在创建端点时启用私有DNS名称。这是因为我们缺乏互联网接入，我们需要我们的VPC端点拥有可以在没有互联网接入的情况下解析的DNS名称。</p><h1 id="d92b" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">启用日志记录</h1><p id="b43d" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">在SSM的远程会话管理器中启用日志记录非常简单。只需导航到SSM远程会话屏幕，单击首选项选项卡，然后单击“编辑”。这将带您进入一个面板，其中包含启用KMS、S3日志记录和CloudWatch日志记录的选项。让我们同时启用S3和CloudWatch。</p><p id="5c71" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意:<em class="lw"/><a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-preferences-enable-encryption.html" rel="noopener ugc nofollow" target="_blank"><em class="lw">KMS选项</em> </a> <em class="lw">是除了默认的TLS 1.2加密之外，如果您想要加密SSM连接数据。连接加密将包括利用您的自定义KMS密钥或AWS管理的SSM KMS密钥的加密。启动会话管理器会话的用户和会话连接到的实例都必须拥有使用指定KMS密钥的权限。请注意，自定义KMS键将产生额外的费用。</em></p><h2 id="2a16" class="mh ku hu bd kv mi mj mk kz ml mm mn ld js mo mp lh jw mq mr ll ka ms mt lp mu dt translated">S3</h2><p id="0407" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">我创建了一个名为karls-ssm-log的私有S3桶。然后，我简单地在选择选项中选择了bucket(见下面)，然后指定了一个名为logs的文件夹/前缀。我还选择了要加密的日志。</p><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mw"><img src="../Images/06b838a1cda644932d8b834033fce9ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fANuw8Mqx3hqT1wY_CXMDA.png"/></div></div></figure><p id="2b18" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我想在这里强调一下，允许您的IAM实例角色(附加到实例)正确访问S3存储桶是很重要的。AWS提供的默认SSM策略<code class="eh lx ly lz ma b">amazonEC2RoleforSSM</code>具有<code class="eh lx ly lz ma b">s3:*</code>，因此可以覆盖所有场景，但是我不建议提供这么多的访问权限，而是将策略限制为只能访问您创建的SSM指定的日志桶。</p><p id="7d93" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">此外，如果选择加密日志，请确保IAM实例角色具有适当的KMS访问权限。如果您的存储桶在全局级别配置为使用自定义KMS密钥加密所有内容，IAM实例角色将需要访问权限以使用指定的自定义KMS密钥。</p><h2 id="d78b" class="mh ku hu bd kv mi mj mk kz ml mm mn ld js mo mp lh jw mq mr ll ka ms mt lp mu dt translated">云观察</h2><p id="b2bd" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">我创建了一个名为<code class="eh lx ly lz ma b">ssm-log.</code>的未加密的Cloudwatch日志组，我只需导航到SSM，并按照上面提到的相同步骤进入会话管理器的首选项选项卡。下面的截图说明了如何启用Cloudwatch日志。</p><p id="4dd0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意:如果您希望加密Cloudwatch日志，请确保创建Cloudwatch日志组时启用了加密，否则将日志写入日志组会失败。</p><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mx"><img src="../Images/65d776181e4f2893a782a41162223794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrwwXISrqHY1P87w9LwF2A.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Simply check the CloudWatch checkbox and select the desired log-group</figcaption></figure><h2 id="65bc" class="mh ku hu bd kv mi mj mk kz ml mm mn ld js mo mp lh jw mq mr ll ka ms mt lp mu dt translated">访问日志</h2><p id="48cd" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">为了访问SSM远程会话管理器日志，您可以直接转到S3存储桶和/或指定的Cloudwatch日志组。然而，有一个更简单的选择。在会话管理器选择屏幕中，中间的选项卡用于查看历史。启用日志记录后，会话历史屏幕将包含相应会话日志的快捷方式(见下文)。</p><figure class="mc md me mf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/a319100c54e892377e82b5ea15801685.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPzCz_rad5DkO_NCF-20gA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Logs are easily consolidated for your convenience</figcaption></figure><p id="0124" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">注意:从<code class="eh lx ly lz ma b">aws cli</code>启动的日志将没有用户/角色的名称，而是包含前缀botocore-session-#######。但是，使用CloudTrail，您可以使用botocore会话id来查找通过STS授予的临时访问密钥，并从那里开始反向工作，确定为哪些用户/角色提供了临时访问密钥。这不是一个容易也不有趣的过程，但它肯定有可能确定最终用户🔎。</p><h1 id="9fc6" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">用户权限</h1><p id="e147" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">管理员对启用SSM远程系统管理器最常见的担忧之一是，每个人都能够远程访问满足SSM要求的任何实例。毕竟现在准入门槛大大降低简化了。幸运的是，我们可以利用<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started-restrict-access.html" rel="noopener ugc nofollow" target="_blank"> IAM用户权限</a>来控制谁可以使用SSM的远程会话管理器远程访问实例。我们有能力通过利用<code class="eh lx ly lz ma b">tags</code>或像<code class="eh lx ly lz ma b">instanceID</code>一样细化来锁定访问。</p><p id="bf70" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看一下下面的IAM策略示例。这个示例策略通过使用带有键值对<code class="eh lx ly lz ma b">ssm:enabled</code>的<code class="eh lx ly lz ma b">tag</code>来限制用户使用远程会话管理器的能力。如果实例的标签具有正确的值，则用户可以启动远程会话，否则，访问将被拒绝。该策略还确保只允许用户终止他们自己的会话，从而避免了诱骗其他用户的能力。请访问此<a class="ae jg" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/getting-started-restrict-access-examples.html" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多政策示例。</p><pre class="mc md me mf fq mz ma na nb aw nc dt"><span id="0c64" class="mh ku hu ma b fv nd ne l nf ng">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "ssm:StartSession"<br/>            ],<br/>            "Resource": [<br/>                "arn:aws:ec2:*:*:instance/*"<br/>            ],<br/>            "Condition": {<br/>                "StringLike": {<br/>                    "ssm:resourceTag/ssm": [<br/>                        "enabled"<br/>                    ]<br/>                }<br/>            }<br/>        },<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "ssm:TerminateSession"<br/>            ],<br/>            "Resource": [<br/>                "arn:aws:ssm:*:*:session/${aws:username}-*"<br/>            ]<br/>        }<br/>    ]<br/>}</span></pre><h1 id="3fb0" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">调试SSM</h1><p id="7d27" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">有时，您可能会遇到远程会话管理器不工作的情况。调试SSM可能是一项挑战，尤其是当您无法远程访问实例时。我建议采用以下调试步骤:</p><ol class=""><li id="71cd" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke nh kl km kn dt translated">确保AMI安装了代理</li><li id="c6e4" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke nh kl km kn dt translated">验证是否附加了EC2实例角色</li><li id="a945" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke nh kl km kn dt translated">验证EC2实例角色是否具有适当的SSM权限</li><li id="ef90" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke nh kl km kn dt translated">重新启动实例</li></ol><p id="fa5c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以上四个步骤将解决大部分与SSM相关的问题。然而，还有更棘手的情况。</p><p id="4e3c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">问:<strong class="jj hv">我启用了日志记录，但是我不能再连接到我的实例了？</strong></p><p id="adc9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">答:这可能是网络问题或缺乏权限。确保您的VPC可以访问互联网，如果它没有启用SSM所需的VPC端点，并且启用了专用DNS。如果S3日志记录启用了加密，则确保bucket和IAM实例角色都可以访问KMS密钥(如果S3 bucket中使用了自定义KMS密钥)。</p><p id="066e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">问:<strong class="jj hv">我没有启用日志记录，仍然无法连接到我的实例？</strong></p><p id="6ad4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">答:假设你已经覆盖了基础知识；已安装代理，实例角色，IAM权限。查看您的网络安全组和网络ACL。确保您允许VPC内的入站和出站<code class="eh lx ly lz ma b">tcp 443</code>流量。换句话说，您信任来自VPC CIDR的流量，不要与VPC外部的流量混淆。</p><p id="a093" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">问:<strong class="jj hv">在哪里可以查看代理生成的日志？</strong></p><p id="06dd" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">答:您可以在以下位置查看Linux实例上的SSM代理日志</p><ul class=""><li id="8fb8" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">/var/log/amazon/ssm/amazon-ssm-agent.log</code></li><li id="276d" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">/var/log/amazon/ssm/errors.log</code></li></ul><p id="f741" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在窗口中</p><ul class=""><li id="ded3" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">%PROGRAMFILES%\Amazon\SSM\Logs\amazon-ssm-agent.log</code></li><li id="e3a5" class="kf kg hu jj b jk ko jo kp js kq jw kr ka ks ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">%PROGRAMFILES%\Amazon\SSM\Logs\errors.log</code></li></ul><p id="02f2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">问:<strong class="jj hv">是否可以进行更多的调试？</strong></p><p id="2677" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">答:没错——只需修改<code class="eh lx ly lz ma b">seelog.xml.template</code>(我建议你复制一份)。</p><p id="b5e0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在Linux中，可以找到该文件</p><ul class=""><li id="fb05" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">/etc/amazon/ssm/seelog.xml.template</code></li></ul><p id="4140" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在窗口中</p><ul class=""><li id="bb28" class="kf kg hu jj b jk jl jo jp js kh jw ki ka kj ke kk kl km kn dt translated"><code class="eh lx ly lz ma b">%PROGRAMFILES%\Amazon\SSM\seelog.xml.template</code></li></ul><p id="e536" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">将<code class="eh lx ly lz ma b">minlevel=info</code>的值更改为<code class="eh lx ly lz ma b">minlevel=debug</code></p><pre class="mc md me mf fq mz ma na nb aw nc dt"><span id="8285" class="mh ku hu ma b fv nd ne l nf ng">&lt;seelog type="adaptive" mininterval="2000000" maxinterval="100000000" critmsgcount="500" minlevel="debug"&gt;</span></pre><p id="f27b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">问:<strong class="jj hv">我还应该了解哪些有用的链接？</strong></p><p id="4e72" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">答:可以，在<a class="ae jg" href="https://forums.aws.amazon.com/forum.jspa?forumID=185" rel="noopener ugc nofollow" target="_blank">亚妇会SSM论坛</a>上提问！</p><h1 id="4a4f" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">准备好扔掉你的SSH密钥了吗？</h1><p id="b97a" class="pw-post-body-paragraph jh ji hu jj b jk lr jm jn jo ls jq jr js lt ju jv jw lu jy jz ka lv kc kd ke hn dt translated">我希望您会发现本指南有助于您开始使用SSM的远程会话管理器。AWS在为SSM提供文档方面做得很好，但是在如何设置这个功能方面确实没有一个整体的工作帮助，更不用说几个“陷阱”了，这就是本文的原因。现在您已经掌握了所有这些知识，现在就开始使用SSM，让SSH密钥成为过去。</p></div></div>    
</body>
</html>