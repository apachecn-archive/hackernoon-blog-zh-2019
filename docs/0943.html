<html>
<head>
<title>How to Use Git Hooks in Your Development Workflow</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在开发工作流程中使用Git挂钩</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-use-git-hooks-in-your-development-workflow-a94e66a0f3eb?source=collection_archive---------4-----------------------#2019-02-07">https://medium.com/hackernoon/how-to-use-git-hooks-in-your-development-workflow-a94e66a0f3eb?source=collection_archive---------4-----------------------#2019-02-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/></div><div class="ab cl ir is hc it" role="separator"><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw ix"/><span class="iu bw bk iv iw"/></div><div class="hn ho hp hq hr"><blockquote class="iy iz ja"><p id="889d" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">迷上了！！</p></blockquote><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff ka"><img src="../Images/4f410acba189eef1479b53178573bd4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WhUkymHMzeMTlzDm1tEiEQ.jpeg"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Photo by <a class="ae kq" href="https://unsplash.com/photos/fSWOVc3e06w?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Alvaro Reyes</a> on <a class="ae kq" href="https://unsplash.com/search/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="05ca" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">概观</h1><p id="e227" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">如果您曾经从事过开源项目，或者您正在一个团队中工作，那么您很可能正在使用某种版本控制。版本控制系统(<em class="jd"> VCS </em>)已经成为任何项目的主要需求之一，Git是最流行的一个。然而，随着团队人数的增长，处理不同的代码风格和在所有贡献者之间强制执行某些规则变得很困难。这些问题不会被贡献者注意到，直到他提交了他的变更，这导致了核心维护团队的开销。为了执行这些规则并验证被推送的代码，Git有一个很棒的特性，叫做Git Hooks。</p><h1 id="34ac" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">什么是Git挂钩？</h1><p id="d80d" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">这些是定制脚本，在某些特定的git事件上触发。钩子允许定义的脚本在某些Git事件发生之前或之后运行。有两种类型的挂钩:</p><ul class=""><li id="f31d" class="lx ly hu je b jf jg jj jk lr lz lt ma lv mb jz mc md me mf dt translated">客户端挂钩</li><li id="21ee" class="lx ly hu je b jf mg jj mh lr mi lt mj lv mk jz mc md me mf dt translated">服务器端挂钩</li></ul><p id="8501" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">服务器端钩子，顾名思义，安装在服务器上，只有在网络运行的情况下才会触发。例如- Post-Receive是一种在成功推送后触发的服务器端挂钩。这使它成为向所有其他贡献者发送通知的绝佳位置。</p><p id="33d5" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">客户端钩子驻留在本地存储库中，当git事件被触发时执行。这里，git事件可以是<em class="jd">提交</em>、<em class="jd">推送</em>、<em class="jd">重置</em>等。当我们运行某些git命令时，git会在git存储库中查找挂钩，以查看是否有相关的脚本要运行。例如，可以使用一个<em class="jd">预推送</em>钩子来验证代码在被推送到远程存储库之前是否执行了某些规则。由于在服务器端钩子的情况下我们不能做太多，所以在本文的剩余部分我们将只讨论客户端钩子。</p><h1 id="301d" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">执行你的钩子！！😎</h1><p id="f6e6" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">在这一节中，我们将更深入地了解钩子，看看其中一个钩子是如何工作的。我们将执行一个简单的钩子来验证被推送的代码在提交消息中没有任何带有' WIP '的提交。(WIP —正在进行的工作)。我们开始吧！！</p><p id="6ea3" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">首先，让我们创建一个新目录。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff ml"><img src="../Images/e996abf0c6d55a295a9b623683d3d654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*clzFOKT-ZzsYg2_4a72HTg.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Create a new folder — ‘hooks’</figcaption></figure><p id="c705" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">现在，用<code class="eh mm mn mo mp b">git init</code>初始化同一个文件夹中的git存储库。我们可以看到，初始化一个repo创建了一个隐藏文件夹<code class="eh mm mn mo mp b">.git</code>。使用<code class="eh mm mn mo mp b">-a</code>标志可以查看隐藏的文件和文件夹。<code class="eh mm mn mo mp b">-l</code>标志显示了文件的基本细节。因此，结合这两个标志，我们可以让<code class="eh mm mn mo mp b">ls -la</code>查看目录中所有文件的详细信息。因为我们将大量使用隐藏文件，所以我们将在整篇文章中使用<code class="eh mm mn mo mp b">ls -la</code>。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mq"><img src="../Images/e1e9bbb71135547cc6f8482cfcb88957.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMPJ-MlrGFoTFDZq5iFqwg.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">git init</figcaption></figure><p id="dad0" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">但是，神秘的<code class="eh mm mn mo mp b">.git folder</code>里面有什么？让我们看一看。简而言之，它包含了与git存储库相关的所有元数据，包括提交、远程存储库地址等。它还包含所有提交的日志。仔细看可以看到一个<code class="eh mm mn mo mp b">hooks</code>文件夹。这是所有奇迹发生的地方！</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mr"><img src="../Images/b540320fd6c427ce6b32ee02754dc35a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tEoK8M611OPoMrkLp39rfQ.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Content of .git folder</figcaption></figure><p id="1892" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">那么，让我们看看<code class="eh mm mn mo mp b">hooks</code>文件夹。它有一个各种钩子的样本脚本。因为这些文件以<code class="eh mm mn mo mp b">.sample</code>扩展名结尾，所以它们不会在指定的git事件上执行。例如，<code class="eh mm mn mo mp b">pre-commit.sample</code>文件将在任何提交之前执行，如果我们将其重命名为<code class="eh mm mn mo mp b">pre-commit</code>。这正是我们要做的😂！</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff ms"><img src="../Images/51ec32fcfeab310176c272b1b117ccdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X2TQxQqBbaMa5vJT3XDCSg.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Hooks folder</figcaption></figure><p id="2dad" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">首先，我们来了解一下现有的钩子之一，<code class="eh mm mn mo mp b">pre-push.sample</code>。</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="8b24" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">如果看起来太多了，你可以看看文件顶部的注释。基本上，它会在本地repo中查找所有最新的提交，并检查新的提交消息中是否包含字符串“WIP”。为了查找提交，它考虑了远程存储库散列和当前本地存储库散列，并查找两者之间的所有提交。如果找到了字符串，它打印出<code class="eh mm mn mo mp b">Found WIP commit in...</code>并中止推送。注意，如果脚本以非零退出代码结束，它不会推送到远程repo。</p><p id="a80a" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">让我们快速测试一下。到目前为止，我们已经在本地初始化了我们的git repo，但是它需要一个远程repo来推送。因此，在GitHub(或BitBucket)上创建一个新的存储库，并复制远程git url。我创建了一个名为<code class="eh mm mn mo mp b">hooks-demo</code>的。</p><p id="bfb4" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">现在，我们需要使用<code class="eh mm mn mo mp b">git remote add origin "url"</code>将这个远程引用添加到我们的本地git存储库中。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mv"><img src="../Images/bcf5518af8b3cf0eae55a7210d1afa05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JeapIuhnRy4rod7nYzRaHA.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Adding reference</figcaption></figure><p id="27f4" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">现在，让我们用一些文本创建一个新文件<code class="eh mm mn mo mp b">index.html</code>。提交文件，然后推它，它应该没有问题。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mw"><img src="../Images/cd68c60b171171b173bb7684f053e997.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KGsGq71spZK6hjkYRYUFUA.png"/></div></div></figure><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mx"><img src="../Images/2d2ca368ee236e7798da893fa3a2eb28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*baHptCT4SV2AkNFzG_rCqw.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Push successful</figcaption></figure><p id="639a" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">现在，让我们施展魔法，让钩子变得可执行。重命名pre-push.sample文件:<code class="eh mm mn mo mp b">mv .git/hooks/pre-push.sample .git/hooks/pre-push</code>。只要确保文件是可执行的。万一不是，<code class="eh mm mn mo mp b">chmod +x filename</code>会有帮助。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff my"><img src="../Images/2379aed5943a93f83b9af58d0c390b05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b3aGf39xSZrCEcEIfn650w.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">Renamed the file</figcaption></figure><p id="358f" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">完成所有这些后，更改文件的内容，并使用“WIP”单词进行一次新的提交。</p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff mz"><img src="../Images/041366a55eed63fbbe91aae7d524a539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g_Z2PEr0DSzH0VMoFBbv_w.png"/></div></div><figcaption class="km kn fg fe ff ko kp bd b be z ek">pre-push hook in action</figcaption></figure><p id="278a" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated"><strong class="je hv">哒哒！！😍</strong>推送失败。因为我们删除了文件的扩展名，所以文件被执行了，因此推送没有通过。</p><p id="2ea3" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">类似地，基于您的需求，您可以编写自己的钩子来执行某些规则。在上面的例子中，我们检查了提交消息中的特定字符串，但是如果，我们想要确保提交的代码中不存在特定的字符串。好吧，我们可以使用预提交钩子来实现。</p><figure class="kb kc kd ke fq kf"><div class="bz el l di"><div class="mt mu l"/></div></figure><p id="f72a" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">上面的预提交挂钩将在您的提交中查找“TODO”字符串。如果找到一个，提交将被拒绝。</p><h2 id="b7c2" class="na ks hu bd kt nb nc nd kx ne nf ng lb lr nh ni lf lt nj nk lj lv nl nm ln nn dt translated">如果你想用' TODO '提交呢？</h2><p id="49f2" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">因为这些钩子安装在本地机器上，所以总是可以绕过它们。</p><pre class="kb kc kd ke fq no mp np nq aw nr dt"><span id="1489" class="na ks hu mp b fv ns nt l nu nv">git commit --no-verify</span></pre><blockquote class="iy iz ja"><p id="4f8c" class="jb jc jd je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用标志<code class="eh mm mn mo mp b"><em class="hu">--no-verify</em></code>不会触发钩子。</p></blockquote><p id="68a8" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">我们在上面的例子中使用了bash脚本。但是，它支持您的系统可以执行的任何脚本语言。</p><h1 id="2896" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">如何让团队步调一致？</h1><p id="e555" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">比方说，你写了一个“预推送”钩子，如果代码中有<em class="jd">“TODO”</em>单词，它就不允许任何人推送代码。这很酷，而且对你很有帮助。现在，你将如何把这个脚本分发给从事同一项目的其他人呢？正如我提到的，钩子出现在<strong class="je hv"> <em class="jd">。git </em> </strong>文件夹以及所有其他git元数据。由于数据可以是用户特定的，<strong class="je hv">，<em class="jd">。git </em> </strong>文件夹没有版本控制，这意味着该文件夹的内容不会被推送到远程存储库。</p><p id="7c3a" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">最简单的方法是将钩子存储在repo中的一个普通文件夹中，并将它们复制到<strong class="je hv"> <em class="jd">。每个用户机器上的git/hooks </em> </strong>。然而，我们不能依赖用户手动将脚本复制到hooks文件夹。我们需要一些脚本或工具，可以在没有任何用户干预的情况下安装挂钩。让我们假设钩子出现在<strong class="je hv"> <em class="jd"> git-hooks中。</em> </strong></p><figure class="kb kc kd ke fq kf fe ff paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="fe ff nw"><img src="../Images/7f498f491db662bc4f7b5dc97d48769b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-YPm2d20HPG3eYYE_9LIw.png"/></div></div></figure><p id="c6f2" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">如果您使用的是Git 2.9或更高版本，您可以简单地运行下面的命令，将hooks文件夹更改为<strong class="je hv"> <em class="jd"> git-hooks </em> </strong>而不是<strong class="je hv"> <em class="jd">。git/hooks。</em> </strong></p><pre class="kb kc kd ke fq no mp np nq aw nr dt"><span id="84a2" class="na ks hu mp b fv ns nt l nu nv">git config core.hooksPath <em class="jd">git-hooks</em></span></pre><p id="ee60" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">你也可以把上面的命令放在一个设置文件中自动执行，比如Makefile，pom.xml，package.json等等。<em class="jd"> Husky </em>是在node项目中安装git钩子的最佳选择之一。但是，如果您使用的是git的早期版本，您需要通过执行以下命令来创建一个符号链接</p><pre class="kb kc kd ke fq no mp np nq aw nr dt"><span id="1613" class="na ks hu mp b fv ns nt l nu nv">ln -s -f ../../git-hooks/pre-push .git/hooks/pre-push</span></pre><h1 id="9433" class="kr ks hu bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo dt translated">结论</h1><p id="3692" class="pw-post-body-paragraph jb jc hu je b jf lp jh ji jj lq jl jm lr ls jp jq lt lu jt ju lv lw jx jy jz hn dt translated">Git挂钩非常酷，是改进团队开发工作流程的好方法。这些例子只是为了展示钩子的能力。您可以使用这些来检查lint问题，或者在推送代码之前运行单元测试，或者您能想到的任何事情。我确信你们可以找到大量的用例来利用git钩子的能力，如果还没有使用的话。</p><p id="65b2" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">希望你学到了新的东西！！</p><p id="1e31" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">请鼓掌👏 👏如果你觉得这有用！！</p><p id="d099" class="pw-post-body-paragraph jb jc hu je b jf jg jh ji jj jk jl jm lr jo jp jq lt js jt ju lv jw jx jy jz hn dt translated">感谢阅读。</p></div></div>    
</body>
</html>