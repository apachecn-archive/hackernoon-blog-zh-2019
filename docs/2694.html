<html>
<head>
<title>Reverse Proxy using Express Server</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Express服务器的反向代理</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/reverse-proxy-using-express-server-1f1b0b5a6e67?source=collection_archive---------7-----------------------#2019-04-26">https://medium.com/hackernoon/reverse-proxy-using-express-server-1f1b0b5a6e67?source=collection_archive---------7-----------------------#2019-04-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b2e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我经常在我的服务器上运行多个应用程序，并且经常从同一个域名提供后端和前端服务。因此，让我们深入探讨如何服务后端和前端应用程序，基本上是两个不同的应用程序通过一个域在不同的端口上列出。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/fc3799c9446b5aad5a0511d9e9669a04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5wnsHKH6rbXM-Y2NwG6DoQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Made with <a class="ae kf" href="https://www.draw.io/" rel="noopener ugc nofollow" target="_blank">https://www.draw.io/</a></figcaption></figure><p id="a0f2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如上图所示，后端运行在3000端口上，前端运行在5000端口上。如果客户端在端口4000(反向代理服务器)上运行的应用程序上发送请求，它将查找URL是否以/api/*结尾的目标。它会将请求转发到后端(3000)，如果URL以/client/*结尾。它会将其转发到前端(5000)。</p><p id="66c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用Express服务器来构建我们的代理服务器。为了运行express服务器，您将最新版本的node安装在您的机器上。从这里下载并安装它。现在转到您想要创建这个反向代理服务器的项目目录，并运行以下命令。</p><pre class="jq jr js jt fq kg kh ki kj aw kk dt"><span id="3e91" class="kl km hu kh b fv kn ko l kp kq">npm init<br/>npm install express<br/>npm install express-http-proxy<br/>npm install request</span></pre><p id="f165" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将看到package.json创建在您的项目目录中。现在创建server.js文件，并将下面的代码粘贴到其中。</p><pre class="jq jr js jt fq kg kh ki kj aw kk dt"><span id="a6fd" class="kl km hu kh b fv kn ko l kp kq">const proxy = require('express-http-proxy');</span><span id="a916" class="kl km hu kh b fv kr ko l kp kq">const app = require('express')();</span><span id="0ff2" class="kl km hu kh b fv kr ko l kp kq">const express = require('express')</span><span id="ed2d" class="kl km hu kh b fv kr ko l kp kq">const request = require('request');</span><span id="2c60" class="kl km hu kh b fv kr ko l kp kq">app.use('/api', proxy('http://localhost:3000')); // this will proxy all incoming requests to /api route to back end</span><span id="3a6e" class="kl km hu kh b fv kr ko l kp kq">app.use('/client', proxy('http://localhost:5000')); // this will proxy all incoming requests to /client route to front end</span><span id="1020" class="kl km hu kh b fv kr ko l kp kq">app.listen(4000, () =&gt; {</span><span id="e447" class="kl km hu kh b fv kr ko l kp kq">  request('http://localhost:5000', function (err, res, body) {</span><span id="e10a" class="kl km hu kh b fv kr ko l kp kq">    if(err === null){</span><span id="8987" class="kl km hu kh b fv kr ko l kp kq">        console.log('backend is reachable from proxy server')</span><span id="fb57" class="kl km hu kh b fv kr ko l kp kq">    }<br/>    else{</span><span id="a60c" class="kl km hu kh b fv kr ko l kp kq">        console.log('backend is not reachable from proxy server')</span><span id="c275" class="kl km hu kh b fv kr ko l kp kq">    }</span><span id="0773" class="kl km hu kh b fv kr ko l kp kq">  });</span><span id="31d7" class="kl km hu kh b fv kr ko l kp kq">  request('http://localhost:3000', function (err, res, body) {</span><span id="5ab8" class="kl km hu kh b fv kr ko l kp kq">   if(err === null){</span><span id="7c82" class="kl km hu kh b fv kr ko l kp kq">        console.log('frontend is reachable from proxy server')</span><span id="da53" class="kl km hu kh b fv kr ko l kp kq">   }<br/>   else{</span><span id="3e2f" class="kl km hu kh b fv kr ko l kp kq">    console.log('frontend is not reachable from proxy server')</span><span id="01d5" class="kl km hu kh b fv kr ko l kp kq">   }</span><span id="7e0e" class="kl km hu kh b fv kr ko l kp kq">  });</span><span id="be13" class="kl km hu kh b fv kr ko l kp kq">});</span></pre><p id="2136" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在是最简单的部分，只需运行下面的命令来运行代理服务器，并确保您的后端和前端在那个时候是活的。</p><pre class="jq jr js jt fq kg kh ki kj aw kk dt"><span id="bf19" class="kl km hu kh b fv kn ko l kp kq">node server.js // you can user forever or pm2 to run it in infinite loop</span></pre><p id="dba7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您现在从一个端口提供两个不同的应用程序，那就好了。</p><p id="99e2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一如既往，这里有一些编程幽默给你</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff ks"><img src="../Images/24a4ae159cc8aaf84aeb99e741e36c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*b-v-xoVzNcWJTZG4q_5LyQ.jpeg"/></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Stop it Patrick, you’re scaring him 😄</figcaption></figure><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="kt ku l"/></div></figure></div></div>    
</body>
</html>