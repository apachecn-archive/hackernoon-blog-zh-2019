<html>
<head>
<title>The Strangest Smart Contract Bug You Haven’t Heard About</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你没听说过的最奇怪的智能合约错误</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/the-strangest-smart-contract-bug-you-havent-heard-about-a6ebc8dbc0a5#2019-01-14">https://medium.com/hackernoon/the-strangest-smart-contract-bug-you-havent-heard-about-a6ebc8dbc0a5#2019-01-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7193fc501da863d7a48874cc8c0aef32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dlB86IWXQxy435nGmzdSgg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">A bug.</figcaption></figure><p id="838f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">注意:我没有<a class="ae ke" href="https://hackernoon.com/tagged/intention" rel="noopener ugc nofollow" target="_blank">意图</a>诋毁这个项目或任何参与其中的人。加密和智能合约开发的美妙之处在于所有的代码都在展示中。我只是在评论一个<em class="kf">重大的</em>失误和一个非常有趣的情况。</p><p id="a5e6" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">勒苟拉斯交易所(LGO) <a class="ae ke" href="https://www.reddit.com/r/LegolasExchange/comments/7um3jc/hard_cap_reached_3500_bitcoin_raised_in_total/" rel="noopener ugc nofollow" target="_blank">在 2018 年初筹集了大约 3000 万美元</a>，并在<a class="ae ke" href="https://hackernoon.com/tagged/ethereum" rel="noopener ugc nofollow" target="_blank">以太坊</a>上部署了一个 ERC-20 代币。这个代币有一个特殊的功能，内置在代码中，用来奖励霍德勒。在前 2 年的每 6 个月，所有尚未转移资金的账户都应该额外获得 5%的代币，作为对他们忠诚度的奖励。回报有可能高于 5%——随着其他人放弃他们的回报而增加。</p><p id="282c" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">听起来很棒，对吧？</p><p id="95fb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">不幸的是，不可变契约的编码使得原本应该用于支付奖金的额外 20%的代币实际上肯定会丢失。</p><p id="36df" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我说“几乎有保证”是因为有办法找回它们——只是需要不虔诚的合作程度。很快会有更多的报道。</p><p id="091d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">Bug</strong></p><p id="38f5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我认为合同中有几个部分不应该通过任何严肃的审核，例如不正当地使用百分比来分配象征性的金额。</p><p id="227f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，导致这篇文章的有问题的 bug 可以在<a class="ae ke" href="https://etherscan.io/address/0x123ab195dd38b1b40510d467a6a359b201af056f#code" rel="noopener ugc nofollow" target="_blank">契约源</a>的第 326 行找到:</p><pre class="kg kh ki kj fq kk kl km kn aw ko dt"><span id="498c" class="kp kq hu kl b fv kr ks l kt ku">// calculate the bonus for one holded LGO<br/>uint256 bonusByLgo = (BONUS_AMOUNT / 4)/unspentAmounts[_bonusDate];</span></pre><p id="4acb" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我不打算深入探讨这个问题——你可以很容易地为自己检查我所说的话。你只需要知道这个变量，<code class="eh kv kw kx kl b">bonusByLgo</code>期望被分配一个百分比。大约 0.05。如果您是一名开发人员(来自任何背景，不仅仅是智能合约开发！)你知道这有多荒谬。一个<code class="eh kv kw kx kl b">uint256</code>只能被赋值为 0、1 或任何其他整数。</p><p id="2cab" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">因此，当计算要分发的奖金百分比时，由于自然舍入，申请的用户总是会收到 0%的奖励。</p><p id="66c5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">除了这个错误——更大的错误是:<em class="kf">任何对<code class="eh kv kw kx kl b">claimBonus </code>方法的</em>测试都会发现这个问题。一份合同投入了 3000 万美元，但其核心功能完全未经测试。</p><p id="dea9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">他们如何“解决”它</strong></p><p id="67a4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">值得称赞的是，LGO 团队开始从他们自己的储备金中手动支付奖金，这也是代币的 20%。你可以看到这些交易在很长一段时间内发生——如果你想做深入的链分析，你可以找到一个 LGO 拥有的地址分发一轮奖金<a class="ae ke" href="https://etherscan.io/token/0x123ab195dd38b1b40510d467a6a359b201af056f?a=0x1035a5dd4859a87cf25ed31b0df7436099f7d1c3" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="1276" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">LGO 的潜在持有者会读到这里，但不知道哪里出了问题，但如果我们以 LGO 的历史最高市值对代币进行估值，这个错误给公司造成了大约 700 万美元的损失。</p><p id="abc9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">一条真正怪异的出路</strong></p><p id="6bba" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">所以正如我在讨论 bug 的时候提到的，变量<code class="eh kv kw kx kl b">bonusByLgo</code>将<em class="kf">几乎</em>总是求值为 0。除了一种情况。当<code class="eh kv kw kx kl b">(BONUS_AMOUNT/4)</code>大于<code class="eh kv kw kx kl b">unspentAmounts[_bonusDate]</code>时。当这种情况发生时，其余的持有人将获得一个 LGO 代币的奖励代币-100%的奖金！！</p><p id="17cf" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">什么会引发这种情况？除非 95%的持有者移动他们的代币。只有当 5%的代币仍有资格获得奖金时，他们才会在剩余的每个奖金日获得 100%的奖金。</p><p id="b503" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">真正疯狂的是这个！如果社区走到一起，所有人都决定移动他们的代币——这与合同的意图完全相反——他们可能会至少归还 LGO 一些代币，并为 LGO 省下一笔钱。你甚至可以想象这样一种情况，LGO 团队或另一个流氓开发者建立了一个聪明的合同，允许剩余的持有者领取和分配奖金——尽管祝你好运获得所需的 95%的参与。</p><p id="54f5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji hv">课文</strong></p><p id="d77f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">对任何功能过于复杂的象征性契约持怀疑态度。“聪明的”智能合同开发人员应该远离任何这样的花招，当绝对需要时，应该对其进行极端的测试和审计。</p><p id="b4a9" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">更多关于智能合约的有趣方面，请在 Twitter 上找到我:<a class="ae ke" href="https://twitter.com/codingupastorm" rel="noopener ugc nofollow" target="_blank">https://twitter.com/codingupastorm</a></p><figure class="kg kh ki kj fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure></div></div>    
</body>
</html>