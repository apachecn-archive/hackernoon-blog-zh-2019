<html>
<head>
<title>Docker Swarm, Kubernetes’s clever little brother</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker Swarm，Kubernetes 聪明的小兄弟</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/docker-swarm-kubernetess-clever-little-borther-49ac3d0a853#2019-04-04">https://medium.com/hackernoon/docker-swarm-kubernetess-clever-little-borther-49ac3d0a853#2019-04-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="cd7f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">kubernetes 适合任何基于容器的项目吗？</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/1f5383440cdf8bc517db7deb232c6ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gHsp0cFusQXfqe1k"/></div></div></figure><p id="0c9e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">毫无疑问，kubernetes 是云和容器领域中最受关注的技术之一。Kubernetes 为管理容器提供了一个完整的解决方案，但是有些情况下它不是最好的解决方案。</p><p id="ca07" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">kubernetes 的主要缺点是它的复杂性和学习曲线。这种复杂性是由几个原因造成的:</p><ul class=""><li id="f1a3" class="kb kc hu it b iu iv iy iz jc kd jg ke jk kf jo kg kh ki kj dt translated">我们既要知道 Docker 的“语言”，也要知道 kubernetes 的“语言”。</li><li id="3454" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">基础设施中有许多“移动部件”( kube-apiserver、etcd、kube-scheduler、kube-controller、kubelet、kube-proxy 等..)</li><li id="7f96" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">有许多类型的对象(服务、Pod、部署、复制集)</li><li id="4a18" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">大量我们不一定需要的功能。</li></ul><p id="db3a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">简而言之，时间紧迫的项目，或仅由几个集装箱组成的小项目，都不能证明在 kubernetes 上的投资是合理的。这样的项目应该放弃使用容器编排框架吗？当然，答案是否定的。</p><p id="5d2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我将首先谈论管弦乐队的好处。然后我会演示 Docker Swarm，Docker 的原生 orchestrator。</p><p id="7733" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker Swarm 可能不像他的哥哥 kubernetes 那样功能丰富，但它非常容易使用，在本文结束时，你将知道如何在 orchestrator 中运行和管理容器。</p></div><div class="ab cl kp kq hc kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hn ho hp hq hr"><p id="b956" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">那么，你为什么需要一个管弦乐队呢？</strong></p><p id="490b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在接下来的(略显陈旧的)讲座中，可以看到许多不同类型的管弦乐队。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff kw"><img src="../Images/37be4fb8bddaee02ae3d32cd1f3cb576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rg8KepwBwPRdkNGd"/></div></div><figcaption class="kx ky fg fe ff kz la bd b be z ek"><a class="ae lb" href="https://www.youtube.com/watch?v=NRZ6N4e-Mko" rel="noopener ugc nofollow" target="_blank">Container Orchestration Wars</a></figcaption></figure><p id="697f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Orchestrators 是容器管理系统，通常具有以下优势:</p><ul class=""><li id="4a21" class="kb kc hu it b iu iv iy iz jc kd jg ke jk kf jo kg kh ki kj dt translated">调度<br/>以最优的资源利用率将容器自动提供给服务器。</li><li id="2ac8" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">与云无关的<br/>在任何云或内部环境中都以同样的方式工作</li><li id="7f16" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">高可用性</li><li id="aa1c" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">重启故障容器</li><li id="7917" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">滚动更新</li><li id="455b" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">集装箱监控</li></ul><p id="f2d2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">还有更多…</p></div><div class="ab cl kp kq hc kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hn ho hp hq hr"><p id="2816" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">码头工人群</strong></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lc"><img src="../Images/a329a48bc6100d06539e0c433edeaf5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PG1SF6ahOdIwLMjF"/></div></div></figure><p id="b902" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker Swarm 是官方的 Docker orchestrator，因此是 Docker 内置的。</p><p id="bded" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它还使用与 docker 相同的“语言”(相同的命令行语法/ docker compose)，因此任何使用 docker 的人都可以利用 Docker swarm，而无需安装第三方和学习新系统。</p><p id="2af9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Docker swarm 的架构非常容易理解。虽然 kubernetes 有几十种对象类型，但 Swarm 只有几种:</p><ul class=""><li id="03e7" class="kb kc hu it b iu iv iy iz jc kd jg ke jk kf jo kg kh ki kj dt translated">Manager —管理群集，可以拥有副本以实现冗余。</li><li id="2306" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">Worker 节点—群集中运行容器的机器。</li><li id="c15d" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">服务—一组相同类型的容器。</li><li id="ae88" class="kb kc hu it b iu kk iy kl jc km jg kn jk ko jo kg kh ki kj dt translated">容器—基本构建块是一个简单的 Docker 容器(不是 pod)。</li></ul><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ld"><img src="../Images/50178e1809aed29097cc97b5de7ae1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cIya_5Kf1IUF0v1Y"/></div></div></figure></div><div class="ab cl kp kq hc kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hn ho hp hq hr"><p id="4209" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">运行 Docker swarm 集群</strong></p><p id="3571" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们知道了什么是 orchestrator，什么是 Docker swarm，让我们看看如何通过几个简单的步骤建立一个 swarm 集群。</p><p id="5cdd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">1.要准备一些服务器，(一台服务器也可以)，以下端口要开放:2377，7946，4789。服务器可以在任何云上，在几个不同的云上，或者在本地</p><p id="c927" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.SSH 到将成为管理器的服务器之一(使用外部 ip，例如 x.x.x.x ),并运行:</p><p id="0ad9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">$ docker swarm init—advertise-addr x . x . x . x</strong></p><p id="d0fa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.前面的命令将生成 swarm manager，并返回关于如何向管理器将要管理的集群添加额外服务器的指令。输出将如下所示:</p><p id="07f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">docker swarm join—token swm tkn-1–49 NJ 1 cmql 0 jkz 5s x . x . x . x:2377</strong></p><p id="bae2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在在所有其他服务器上运行上面的输出。这将把它们连接到集群。</p><p id="5a2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.要查看参与集群的服务器，请返回管理器并运行:</p><p id="68a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">$ docker 节点 ls</p><p id="82f5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> ID 主机名状态可用性管理器状态</strong></p><p id="a227" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> e32e23r3 worker2 就绪激活</strong></p><p id="775f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> Erg56y7j8 worker1 就绪激活</strong></p><p id="ba84" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">t43t 54y * manager 1 Ready Active Leader</strong></p><p id="dc0e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.剩下的工作就是使用以下命令运行集群中的一些容器:</p><p id="8923" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> docker 服务创建—副本 2 —名称 helloworld nginx </strong></p><p id="f809" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> docker 服务创建—副本 1 — myredis redis </strong></p><p id="10ed" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">“服务”是一组相同类型的容器。</p><p id="98cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.要查看群集运行中运行的服务，请执行以下操作:</p><p id="c5af" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> $码头服务 ls </strong></p><p id="b530" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> ID 名称缩放图像命令</strong></p><p id="9264" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">f 54 fg 55 G5 g5g hello world 2/2 nginx</p><p id="d971" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> E32e2323r44r 米雷迪斯 1/1 redis </strong></p><p id="4699" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">7.一些更有用的命令:</p><p id="3a8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">改变服务的规模</p><p id="2eb1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> $ docker 服务等级 helloworld = 5 </strong></p><p id="4feb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看容器中的所有元数据</p><p id="7cdf" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">$ docker service inspect hello world</strong></p><p id="8eca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">删除一组容器</p><p id="274b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> $ docker 服务室 helloworld </strong></p><p id="2ad3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<a class="ae lb" href="https://gist.github.com/DovAmir/410e97f35f3b78530fe92d2793c859e3" rel="noopener ugc nofollow" target="_blank">这个脚本中，</a>有一个在三台服务器上运行 docker swarm 集群的完整示例，一台在 AWS 中，一台在 AZURE 中，还有一台在本地。</p></div><div class="ab cl kp kq hc kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="hn ho hp hq hr"><p id="2b6c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">总结</strong></p><p id="944e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">仅此而已！</p><p id="1e4a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们看到了如何使用 orchestrator 快速建立一个云无关的 docker 集群。</p><p id="20e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">下图显示了 Docker swarm 使用我在 2017 年帮助创建的简单 web UI 工具的示例:</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/259da13ba06f44675f5e8299cda78212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EmN5weFbwafx0vA8"/></div></div><figcaption class="kx ky fg fe ff kz la bd b be z ek"><a class="ae lb" href="https://github.com/dockersamples/docker-swarm-visualizer" rel="noopener ugc nofollow" target="_blank">Docker swarm visualizer</a></figcaption></figure><p id="6e24" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一些其他的工具来监控和管理 docker swarm。</p><p id="faab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它们允许运行容器，ssh 进入容器，并从 web 用户界面查看日志:</p><div class="le lf fm fo lg lh"><a href="https://swarmpit.io" rel="noopener  ugc nofollow" target="_blank"><div class="li ab ej"><div class="lj ab lk cl cj ll"><h2 class="bd hv fv z el lm eo ep ln er et ht dt translated">群体坑</h2><div class="lo l"><h3 class="bd b fv z el lm eo ep ln er et ek translated">轻量级 Docker 群管理 UI</h3></div><div class="lp l"><p class="bd b gc z el lm eo ep ln er et ek translated">swarmpit.io</p></div></div><div class="lq l"><div class="lr l ls lt lu lq lv jz lh"/></div></div></a></div><div class="le lf fm fo lg lh"><a href="https://portainer.io" rel="noopener  ugc nofollow" target="_blank"><div class="li ab ej"><div class="lj ab lk cl cj ll"><h2 class="bd hv fv z el lm eo ep ln er et ht dt translated">集装箱管理，Docker 用户界面，集装箱软件-奥克兰，新加坡，San…</h2><div class="lo l"><h3 class="bd b fv z el lm eo ep ln er et ek translated">现在就轻松构建和管理您的 Docker 环境。在 LINUX、WINDOWS 和 OSX Portainer 社区上可用…</h3></div><div class="lp l"><p class="bd b gc z el lm eo ep ln er et ek translated">portainer.io</p></div></div><div class="lq l"><div class="lw l ls lt lu lq lv jz lh"/></div></div></a></div></div></div>    
</body>
</html>