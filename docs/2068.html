<html>
<head>
<title>Understanding Blockchain Private Data. A Hands-on Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解区块链私有数据。实际操作的例子</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/understanding-blockchain-private-data-a-hands-on-example-eacc3efe4ad6#2019-03-29">https://medium.com/hackernoon/understanding-blockchain-private-data-a-hands-on-example-eacc3efe4ad6#2019-03-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="5b29" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">Hyperledger Fabric 1.2+支持一项名为私有数据的新功能。在这个对流器的例子中，我想展示它是如何工作的。</h2></div><p id="dda9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">企业对区块链技术的主要担忧之一是大多数框架和网络的默认“公共”状态。</p><p id="0cd8" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">私有数据是一种功能，它允许网络中的组织在同一通道中共享“公共”数据(所有参与者都可以访问)和私有数据。</p><blockquote class="kf kg kh"><p id="3d98" class="jj jk ki jl b jm jn iv jo jp jq iy jr kj jt ju jv kk jx jy jz kl kb kc kd ke hn dt translated">Hyperledger 结构中的渠道是实际的分类帐。它有自己的策略和设置，通常是多个组织连接在一起的结果。</p></blockquote><p id="6413" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">例如，商业网络中的 10 个组织可能希望看到他们之间的每一笔交易，但是更愿意对不涉及的组织隐藏一些特定的数据，即价格。</p><p id="c8fb" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在这种情况下，数据可以存储在不同的<strong class="jl hv"> <em class="ki">集合中。</em> </strong>通过集合，数据可以根据策略进行分离，因此一些对等点可能有更多的数据，而所有相关的对等点将只存储相关数据的散列。</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff km"><img src="../Images/4d56053f06f7a4f98914694a269604b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_Nw8bHhVqZnOjOxW.png"/></div></div><figcaption class="ky kz fg fe ff la lb bd b be z ek">Official Hyperledger diagram — <a class="ae lc" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/private-data/private-data.html" rel="noopener ugc nofollow" target="_blank">https://hyperledger-fabric.readthedocs.io/en/release-1.4/private-data/private-data.html</a></figcaption></figure><p id="4238" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">需要多少集合就有多少集合，这些集合可能包含智能协定中定义的不同数据。</p><p id="c27e" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">例如，<em class="ki">价格</em>可能存储在一个名为<em class="ki">完全私有数据</em>的集合中(只对直接相关的组织开放)，然后交付细节可能存储在一个名为<em class="ki">半私有细节</em>的集合中(对相关各方和政府开放)，最后在常规分类帐中存储其余的细节。</p><blockquote class="ld"><p id="f028" class="le lf hu bd lg lh li lj lk ll lm ke ek translated">想了解更多关于私人数据的信息吗？<a class="ae lc" href="https://hyperledger-fabric.readthedocs.io/en/release-1.4/private-data/private-data.html" rel="noopener ugc nofollow" target="_blank">https://hyperledger-fabric . readthedocs . io/en/release-1.4/private-data/private-data . html</a></p></blockquote><p id="36d7" class="pw-post-body-paragraph jj jk hu jl b jm ln iv jo jp lo iy jr js lp ju jv jw lq jy jz ka lr kc kd ke hn dt translated">数据从<em class="ki">应用</em>通过名为<strong class="jl hv"> <em class="ki">瞬态数据</em> </strong> <em class="ki">的对象发送到<em class="ki">对等体</em>。</em>此外，存储中的数据可能有“清除”策略，从而可以根据监管策略删除数据(如果需要)。不变性和证明与散列一起保存。</p><h1 id="4d5d" class="ls lt hu bd lu lv lw lx ly lz ma mb mc ja md jb me jd mf je mg jg mh jh mi mj dt translated">这个例子</h1><p id="d315" class="pw-post-body-paragraph jj jk hu jl b jm mk iv jo jp ml iy jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated">这个例子以官方的弹珠例子为基础，并用<a class="ae lc" href="https://worldsibu.tech/convector/convector-smart-contracts/" rel="noopener ugc nofollow" target="_blank">换流器</a>对其进行了增强。</p><p id="96a5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">集合是以 JSON 格式定义的。</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff mp"><img src="../Images/1425d4308462c62c9c47ffc8de6e0989.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oTx6QbJ377RREUyHBtZuPQ.png"/></div></div></figure><p id="37ad" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">正如您在之前的 JSON 中所注意到的，策略包括有权访问数据的组织以及唯一名称和一些其他设置，如定义何时(以及是否)应该清除数据的<em class="ki"> blockToLive </em>。</p><p id="f448" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">完整示例位于此处:</p><div class="mq mr fm fo ms mt"><a href="https://github.com/worldsibu/convector-example-private-data" rel="noopener  ugc nofollow" target="_blank"><div class="mu ab ej"><div class="mv ab mw cl cj mx"><h2 class="bd hv fv z el my eo ep mz er et ht dt translated">worldsibu/convector-示例-私有-数据</h2><div class="na l"><h3 class="bd b fv z el my eo ep mz er et ek translated">对流器-测试-私人数据。通过创建帐户为 world sibu/convector-example-private-data 开发做出贡献…</h3></div><div class="nb l"><p class="bd b gc z el my eo ep mz er et ek translated">github.com</p></div></div><div class="nc l"><div class="nd l ne nf ng nc nh kw mt"/></div></div></a></div><p id="6201" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在安装或升级代码时，该 JSON 文件在智能合约的实例化过程中传递。</p><p id="2b34" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里的一个好的实践是接收<em class="ki">瞬态</em>数据作为一个唯一的<em class="ki">模型</em>，然后分割它以存储在多个集合中(如果需要的话)。例如:</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff ni"><img src="../Images/606ffa672d5317a71c1f00519b5395c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KAojm7-4xlWDF0CR7bhGmg.png"/></div></div><figcaption class="ky kz fg fe ff la lb bd b be z ek"><a class="ae lc" href="https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/src/product.controller.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/src/product.controller.ts</a></figcaption></figure><p id="2cd5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">数据作为键<em class="ki">弹球</em>上的<em class="ki">瞬态数据</em>被接收，当它通过<code class="eh nj nk nl nm b">getTransientValue</code>时，它将返回准备好被处理的数据的 JSON 版本。Convector 会自动解析为通过 getTransientValue&lt;…&gt;(' key '，…)传递的<em class="ki">模型类型</em>。</p><blockquote class="kf kg kh"><p id="bddc" class="jj jk ki jl b jm jn iv jo jp jq iy jr kj jt ju jv kk jx jy jz kl kb kc kd ke hn dt translated">请注意，函数中没有参数，因为函数中的参数是公共值，所有对等体都可以访问，与策略无关。</p></blockquote><p id="abf5" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">然后在这里创建了两个新模型<code class="eh nj nk nl nm b">col1Data</code>和<code class="eh nj nk nl nm b">col2Data</code>，它们中的每一个都接收了它们应该存储的数据，当我们继续保存它时，我们需要向<code class="eh nj nk nl nm b">.save()</code>函数传递一个参数，指定使用哪个集合<code class="eh nj nk nl nm b">{ privateCollection: '...' }</code>。</p><p id="b6d2" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以看到，模型不需要任何特殊的东西就可以用于私有数据。</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff nn"><img src="../Images/8962e9016cc2df289184c68825677fcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GmUaAB6qs4UBRdvzfczP6Q.png"/></div></div><figcaption class="ky kz fg fe ff la lb bd b be z ek"><a class="ae lc" href="https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/src/product.model.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/src/product.model.ts</a></figcaption></figure><p id="e887" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当你需要从一个函数中检索数据时，你可以调用常规的<code class="eh nj nk nl nm b">.getOne</code>函数，传递一个属性<code class="eh nj nk nl nm b">privateCollection</code>来告诉控制器在哪里寻找数据。在这种情况下，<code class="eh nj nk nl nm b">id</code>参数是公共的，因为每个参与者都可以看到这些数据。</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff no"><img src="../Images/33c30343127e6b94192899fd4879a0da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7i3e24cbyot-GPtAt9UgBA.png"/></div></div></figure><p id="111a" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">引用的 repo 有一个单元测试来模拟一个<strong class="jl hv"> NodeJS </strong>后端调用来创建私有数据。</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff np"><img src="../Images/afaa73a9a21c3271003687bf5eeb39eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7026p_Kxh2ItBAJHMIV6nA.png"/></div></div><figcaption class="ky kz fg fe ff la lb bd b be z ek"><a class="ae lc" href="https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/tests/product.e2e.ts" rel="noopener ugc nofollow" target="_blank">https://github.com/worldsibu/convector-example-private-data/blob/master/packages/product-cc/tests/product.e2e.ts</a></figcaption></figure><p id="7561" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">该单元测试文件通过<em class="ki">瞬态数据</em>到<em class="ki"> </em> <code class="eh nj nk nl nm b">.$config(...)</code>。该示例还从 WorldState (CouchDB)中查询数据，以演示集合是如何基于策略分开存储的。</p><p id="700f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是您也可以像这样查询我们之前看到的函数:</p><figure class="kn ko kp kq fq kr fe ff paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="fe ff nq"><img src="../Images/4a4f1a977f88f55845aa0ee4bc3cb145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUbKGkJwFWav7n7lopkFBQ.png"/></div></div></figure><h2 id="5c00" class="nr lt hu bd lu ns nt nu ly nv nw nx mc js ny nz me jw oa ob mg ka oc od mi oe dt translated">测试代码示例</h2><p id="2a3b" class="pw-post-body-paragraph jj jk hu jl b jm mk iv jo jp ml iy jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated">确保安装了 Node 8.x(如果需要，可以使用 NVM 来管理 Node 的多个版本)和 Docker。</p><pre class="kn ko kp kq fq of nm og oh aw oi dt"><span id="0e6f" class="nr lt hu nm b fv oj ok l ol om">$ git clone <a class="ae lc" href="https://github.com/worldsibu/convector-example-private-data.git" rel="noopener ugc nofollow" target="_blank">https://github.com/worldsibu/convector-example-private-data.git</a><br/>$ cd convector-example-private-data<br/>$ npm i</span><span id="13b0" class="nr lt hu nm b fv on ok l ol om"># Start a development blockchain on your computer<br/>$ npm run env:restart</span><span id="f8f5" class="nr lt hu nm b fv on ok l ol om"># Install the smart contract<br/>$ npm run cc:start -- product</span><span id="baa6" class="nr lt hu nm b fv on ok l ol om"># Run a test<br/>$ npm run test:e2e</span></pre><p id="9559" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这就对了。您已经在您的计算机上正式创建并查询了真实区块链中的私人数据。</p></div><div class="ab cl oo op hc oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="hn ho hp hq hr"><ul class=""><li id="4e52" class="ov ow hu jl b jm jn jp jq js ox jw oy ka oz ke pa pb pc pd dt translated">点击加入我们的 Discord 聊天应用<a class="ae lc" href="http://discord.gg/twRwpWt" rel="noopener ugc nofollow" target="_blank"> Convector 社区。</a></li><li id="1aac" class="ov ow hu jl b jm pe jp pf js pg jw ph ka pi ke pa pb pc pd dt translated">点击此处了解更多关于 WorldSibu 的信息。</li></ul><figure class="kn ko kp kq fq kr"><div class="bz el l di"><div class="pj pk l"/></div></figure></div><div class="ab cl oo op hc oq" role="separator"><span class="or bw bk os ot ou"/><span class="or bw bk os ot ou"/><span class="or bw bk os ot"/></div><div class="hn ho hp hq hr"><blockquote class="kf kg kh"><p id="fb7d" class="jj jk ki jl b jm jn iv jo jp jq iy jr kj jt ju jv kk jx jy jz kl kb kc kd ke hn dt translated">Hyperledger Fabric 是最成熟的区块链框架之一。Convector 智能合同是获得许可的区块链项目的主要智能合同框架之一。</p></blockquote></div></div>    
</body>
</html>