<html>
<head>
<title>I Hacked My Action Camera Application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我黑了我的动作相机应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/i-hacked-my-action-camera-application-fa948d827cf1#2019-04-05">https://medium.com/hackernoon/i-hacked-my-action-camera-application-fa948d827cf1#2019-04-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/0bec8477d77a391b2dd71ebde4b53a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Abj4SrfqtY_h9EVt"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@jakobowens1?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jakob Owens</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="aafb" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated"><strong class="ak">背景故事</strong></h1><p id="64d7" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">我最近买了一个动作相机来拍摄一些很酷的水下东西。你可以通过 WIFI 连接到它，浏览 SD 卡的内容，或将当前视频传输到你的手机。相当酷的功能，应用程序不是最好的，但在我的手机上运行良好。我想在我的平板电脑上试试，这就是问题所在。该应用程序需要定位来连接相机，但我的平板电脑没有 GPS，所以它无法做到这一点。</p><p id="4c4b" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">为什么位置对连接如此重要，为什么它还需要 GPS？我打赌没有它也能工作，让我们弄清楚。</p><h1 id="f94a" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">黑客时间</h1><p id="1fcc" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">目前我没有任何安卓设备，所以我决定从<a class="ae jg" href="https://apkpure.com" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> APKpure </strong> </a>下载。现在我有了 apk，该怎么办呢？让我们反编译它！</p><p id="f25a" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">为了简单起见，我使用了一个在线 apk 反编译器。它像一个魔咒一样工作，但是现在我有一堆混乱的代码要处理。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff li"><img src="../Images/033efdc9459f43b609389601a81d3e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*ELNXGx-QK2Jw0bOP6PImEQ.gif"/></div></figure><p id="f738" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">我搜索了错误消息，发现了<em class="ln"> open_wifi_Permission </em>字符串资源名称，它引导我找到了下面的代码片段。</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="f8c6" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如你所见，如果设备的 android api 版本大于或等于 23 (Android 6.0)，它将请求使用 GPS 的许可。如果我把数字<strong class="kh hv"> 23 </strong>改成更大的整数<strong class="kh hv">就好了。MAX_VALUE，</strong>暂时就够了。该程序将跳过位置权限请求，但正如你可以在官方的<a class="ae jg" href="https://developer.android.com/reference/android/net/wifi/WifiManager#getConfiguredNetworks()" rel="noopener ugc nofollow" target="_blank"> Android 文档</a>中看到的，WifiManager 需要<strong class="kh hv">manifest . permission . access _ FINE _ LOCATION</strong><em class="ln"/>权限，否则它将返回一个空列表。在逻辑的更深处，有</p><pre class="lj lk ll lm fq lq lr ls lt aw lu dt"><span id="acff" class="lv ji hu lr b fv lw lx l ly lz">if(GlobalApp.m5984d(this.f5603e)) {<br/>   //Checking permissions logic code<br/>}</span></pre><p id="d605" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">哪个实现看起来像这样？</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="a92f" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">它将总是返回 false，因为正如我所说的，我的平板电脑上没有 GPS。只需编辑它以返回常量 true，工作就完成了。</p><p id="4344" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">几周前，我读了一篇非常酷的关于 android 应用程序逆向工程的文章，作者描述了他如何反编译和重建一个应用程序，所以我从我的书签中找到了它</p><div class="ma mb fm fo mc md"><a href="https://hackernoon.com/how-i-hacked-modern-vending-machines-43f4ae8decec" rel="noopener  ugc nofollow" target="_blank"><div class="me ab ej"><div class="mf ab mg cl cj mh"><h2 class="bd hv fv z el mi eo ep mj er et ht dt translated">我是如何入侵现代自动售货机的</h2><div class="mk l"><h3 class="bd b fv z el mi eo ep mj er et ek translated">“拳打脚踢”他们最广泛的欧洲发行公司的捆绑应用程序。</h3></div><div class="ml l"><p class="bd b gc z el mi eo ep mj er et ek translated">hackernoon.com</p></div></div><div class="mm l"><div class="mn l mo mp mq mm mr ja md"/></div></div></a></div><p id="c2cb" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">我使用相同的步骤再次生成签名的 apk，但是设备无法安装该应用程序。</p><p id="1e12" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">在几次失败的尝试后，我决定用<a class="ae jg" href="https://ibotpeaches.github.io/Apktool/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv"> apktool </strong> </a> <strong class="kh hv"> </strong>本地反编译 apk，而不是在线反编译。输出是没有 Java 源文件的小源代码。</p><blockquote class="ms mt mu"><p id="c612" class="kf kg ln kh b ki ld kk kl km le ko kp mv lf ks kt mw lg kw kx mx lh la lb lc hn dt translated">smali/baksmali 是 Android 的 Java VM 实现 dalvik 使用的 dex 格式的汇编器/反汇编器</p></blockquote><p id="c8a7" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">如果我编辑这些 smali 源文件会怎么样？重建后可以让 app 运行吗？让我们试一试！我重建了 apk，签署并执行了 zipalign，它成功了！现在我必须在 smali 文件中找到"<em class="ln">m 5984d "</em><strong class="kh hv">Java</strong><em class="ln"/>方法。正如代码片段中的注释所说，该方法是由"<em class="ln"> d " </em> <strong class="kh hv"> smali </strong> <em class="ln">方法重命名的。有了这些信息，我可以在 GlobalApp.smali 文件中找到这段代码</em></p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="4952" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">看起来对开发者不太友好。在谷歌搜索了一下 smali 是如何工作的之后，我想出了这个解决方案，只是在 java 文件中返回 true。</p><figure class="lj lk ll lm fq iv"><div class="bz el l di"><div class="lo lp l"/></div></figure><p id="2a29" class="pw-post-body-paragraph kf kg hu kh b ki ld kk kl km le ko kp kq lf ks kt ku lg kw kx ky lh la lb lc hn dt translated">我重复了<strong class="kh hv"> apktool </strong> rebuild、<strong class="kh hv"> jarsign </strong>和<strong class="kh hv"> zipalign </strong>命令，它终于生成了一个可运行的应用程序，可以在我的平板电脑上使用了。从现在起，我的平板电脑可以毫无问题地连接到摄像机了。</p></div></div>    
</body>
</html>