<html>
<head>
<title>Introducing Uno WebAssembly Projects and Debugging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍 Uno WebAssembly 项目和调试</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/introducing-uno-webassembly-projects-and-debugging-f360d4776df3#2019-01-18">https://medium.com/hackernoon/introducing-uno-webassembly-projects-and-debugging-f360d4776df3#2019-01-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/daaf1457b571d4f92f0ea524e92432fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i384H_6SMsFYMMH4aPrZfw.jpeg"/></div></div></figure><p id="d7bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Uno 平台对 WebAssembly 的支持进展稳定，mono 运行时对调试体验的支持也有很大改进。</p><p id="da39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们增加了对更好的 Visual Studio 项目集成的支持，以及实验性的调试体验。</p><p id="9659" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下一个版本的<a class="ae ka" href="https://marketplace.visualstudio.com/items?itemName=nventivecorp.uno-platform-addin" rel="noopener ugc nofollow" target="_blank"> Uno Visual Studio 插件</a>将包含新的项目格式和调试器，但是您可以今天使用 Uno 平台的<a class="ae ka" href="https://github.com/nventive/Uno/releases" rel="noopener ugc nofollow" target="_blank">最新实验版本</a>来尝试它。</p><h1 id="9d9d" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Visual Studio 的 WebAssembly 项目支持</h1><p id="2ef0" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">最初，对 WebAssembly 的支持是由 Uno 通过创建. NET Standard 2.0 项目完成的，依赖于 mono 提供的 python 服务器的使用。这个服务器的唯一目的是提供带有<code class="eh le lf lg lh b">application/wasm</code> mime 类型的文件，这可以通过一个普通的 WebApp 项目来完成。</p><p id="2a58" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">由于 mono-wasm 调试器已经取得了很大进展，我们决定研究改进 Visual Studio 对 Uno WebAssembly 项目的支持的第一步。就集成而言，更新的体验是开发人员所期望的。它类似于普通的 Web 项目:现在按 Ctrl+F5 在您的首选浏览器中启动 WebAssembly 项目。</p><p id="37e8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于大多数 web 项目，刷新网页就足以让应用程序获得新的更改。</p><p id="833f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在项目定义中使用标准<code class="eh le lf lg lh b">Microsoft.NET.Sdk.Web</code>提供了所有的集成特性，比如发布到 Azure 或其他支持的目标:</p><pre class="li lj lk ll fq lm lh ln lo aw lp dt"><span id="4e1f" class="lq kc hu lh b fv lr ls l lt lu">&lt;Project Sdk="Microsoft.NET.Sdk.Web"&gt;<br/>  &lt;PropertyGroup&gt;<br/>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;<br/>    &lt;TargetFramework&gt;netstandard2.0&lt;/TargetFramework&gt;<br/>    &lt;WasmHead&gt;true&lt;/WasmHead&gt;<br/>    &lt;DefineConstants&gt;__WASM__&lt;/DefineConstants&gt;<br/>  &lt;/PropertyGroup&gt;</span><span id="3420" class="lq kc hu lh b fv lv ls l lt lu">  &lt;ItemGroup&gt;<br/>    &lt;PackageReference Include="Uno.UI" Version="1.42.0-dev.395" /&gt;<br/>    &lt;DotNetCliToolReference Include="Uno.Wasm.Bootstrap.Cli" Version="1.0.0-dev.112" /&gt;<br/>  &lt;/ItemGroup&gt;</span></pre><p id="c355" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于那些已经在运行 WebAssembly Uno 项目的人来说，除了在顶部添加<code class="eh le lf lg lh b">Microsoft.NET.Sdk.Web</code>和将新的<code class="eh le lf lg lh b">DotNetCliToolReference</code>添加到<code class="eh le lf lg lh b">Uno.Wasm.Bootstrap.Cli</code>之外，没有太多需要做的更改，这使得 Visual Studio 集成成为可能。</p><h1 id="924b" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">在 WebAssembly 中调试 C#</h1><p id="777b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Mono 团队在调试体验方面已经工作了一段时间，最近的改进使它更容易使用。它仍然是试验性的，但仍然对调试 WebAssembly 项目有很大的帮助。</p><p id="5995" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">只有一个重要的限制:调试只适用于 Chrome。它使用的是 Chrome DevTools 协议。</p><p id="de72" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">调试器提供对所有本地源代码的访问，以及<a class="ae ka" href="https://docs.microsoft.com/en-us/dotnet/standard/library-guidance/sourcelink" rel="noopener ugc nofollow" target="_blank">支持源代码链接的程序集</a>当可用时，提供单步执行、断点、堆栈跟踪遍历、本地变量和监视。目前，局部变量监视仅限于原语和字符串。</p><p id="cc89" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了给你一个调试体验的例子，这是一个从普通用户程序进入单声道源代码树中的<code class="eh le lf lg lh b">DateTime.Now</code>属性的步骤:</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lw"><img src="../Images/23bba281890a4b320f2bd4ad4baf22d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*QTf0jNUgFoP5fkty.png"/></div></div></figure><p id="2f84" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Mono 团队最近增加了从 Mono 二进制文件的调试信息中获取源文件的能力，这使得调试器很容易获取已发布二进制文件的准确源文件。</p><p id="77cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一点警告，调试体验非常粗糙的边缘。调试器可能会频繁崩溃(Chrome 称 WebSocket 断开连接),因为还有许多非阳光路径场景尚未测试。这意味着您可能无法设置断点、进入或跳出某些特定的代码段(例如分部方法)。</p><h1 id="11e2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">使用 WebAssembly C#调试器</h1><ul class=""><li id="c52d" class="lx ly hu je b jf kz jj la jn lz jr ma jv mb jz mc md me mf dt translated">从 Uno 解决方案模板创建一个 Uno 平台跨目标应用程序(详见本文末尾)</li><li id="d686" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">将 Wasm 项目设置为启动项目</li></ul><p id="a600" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保</p><ul class=""><li id="d9bb" class="lx ly hu je b jf jg jj jk jn ml jr mm jv mn jz mc md me mf dt translated">在调试工具栏中启用了 IIS Express</li><li id="1939" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">Chrome 是活跃的网络浏览器</li></ul><figure class="li lj lk ll fq iv fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/0cef2c66ac5b0942631b31f1924a9ebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/format:webp/0*UO4KchjAtosect4d.png"/></div></figure><ul class=""><li id="b6e4" class="lx ly hu je b jf jg jj jk jn ml jr mm jv mn jz mc md me mf dt translated">按下<em class="mp"> Ctrl+F5 </em></li><li id="5857" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">一旦你的应用程序被加载，按 Alt+Shift+D，一个新的标签将会打开</li><li id="a35f" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">你会得到一个错误信息，告诉你 Chrome 还没有打开</li></ul><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mq"><img src="../Images/ef286461f6f6514458166d9f7c30ffea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*vqVXcqNmqhxrkt_N.png"/></div></div></figure><ul class=""><li id="f03e" class="lx ly hu je b jf jg jj jk jn ml jr mm jv mn jz mc md me mf dt translated">关闭所有 chrome 实例，使用提供的命令行再次运行 Chrome</li><li id="a84b" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">同样，一旦你的应用程序被加载，按 Alt+Shift+D，一个新的标签将会打开。</li><li id="eecf" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">现在你将打开 Chrome DevTools，列出所有。“源”选项卡上的净加载程序集:</li></ul><figure class="li lj lk ll fq iv fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/f4c936911d3fe4008eddf7f10da9e7b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/0*lAv_ov_16-H_qnDM.png"/></div></figure><ul class=""><li id="f009" class="lx ly hu je b jf jg jj jk jn ml jr mm jv mn jz mc md me mf dt translated">现在，您可以在可用的源文件中设置断点</li><li id="5f2b" class="lx ly hu je b jf mg jj mh jn mi jr mj jv mk jz mc md me mf dt translated">由于应用程序的初始化已经开始，你可以刷新原来的网站标签，或者使用 Chrome DevTools 的预览部分中较小的刷新按钮:</li></ul><figure class="li lj lk ll fq iv fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/59c2755a3b6175b2cd8f403072a739af.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/0*1nOqt--vYfQC6zqw.png"/></div></figure></div><div class="ab cl mt mu hc mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hn ho hp hq hr"><h1 id="eb5a" class="kb kc hu bd kd ke na kg kh ki nb kk kl km nc ko kp kq nd ks kt ku ne kw kx ky dt translated">它是如何工作的？</h1><p id="387b" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">应用程序的结构有点复杂，一幅图比千言万语更能说明问题:</p><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nf"><img src="../Images/2f1ec45adb44ce72dca75095255aea95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ol-mnHRPvq7UkcSc.png"/></div></div></figure><p id="1ecd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">调试器代理是 Mono 的 ASP.NET 核心组件，嵌入在开发过程中使用的 ASP.NET 核心静态文件服务器中。它的作用主要是提供对 PDB 文件的访问，解释 Chrome DevTools 调试器命令，并将其翻译回来供 mono-wasm 运行时理解。这包括设置断点、获取观察值、获取源文件等…</p><p id="90e4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">目前，Uno 平台正在使用一个定制的调试代理，它增加了对单声道源和源链接以及其他修复的支持。这些将很快进入主 Mono 库。</p><p id="6e28" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你熟悉 Blazor，你会注意到调试器体验非常相似，事实上，ASP.NET 核心集成层直接受到 Blazor 0 . 7 . 0 调试器支持实现的启发。</p><h1 id="dbb7" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">下一步是什么？</h1><p id="5ead" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们已经使用调试器几天了，它让我们提高了故障排除的速度。拥有适当的堆栈跟踪和变量监视总是很有帮助的。写作可能会失败。</p><p id="54f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将继续与 mono 团队合作，改善 mono-wasm 应用程序的部署和调试体验。</p><p id="50f1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们知道你的想法！</p></div><div class="ab cl mt mu hc mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hn ho hp hq hr"><figure class="li lj lk ll fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ng"><img src="../Images/329b8a3927009df234efaf210a19a1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UeYulj197DUiNl7YlK1kzQ.png"/></div></div></figure></div></div>    
</body>
</html>