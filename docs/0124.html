<html>
<head>
<title>Express JS Important NPM Packages Related to Security</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快递JS与安全相关的重要NPM包裹</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/express-js-important-npm-packages-related-to-security-2393466e18d5?source=collection_archive---------7-----------------------#2019-01-06">https://medium.com/hackernoon/express-js-important-npm-packages-related-to-security-2393466e18d5?source=collection_archive---------7-----------------------#2019-01-06</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/644daf4e29c14defec5697f0e8701caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*26BcOdrwfRkbGk9OsREyLA.png"/></div></div></figure><h1 id="aef1" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">开始前说几句话</h1><p id="2028" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">当你创建了一个网站或应用程序，这意味着你准备在互联网上向成千上万的人展示它。你的客户/观众可能是合法的，但他们中的一些人会试图篡改你的应用程序。所以你需要遵循以下黄金法则</p><ol class=""><li id="7543" class="ky kz hu kc b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">"<strong class="kc hv">当涉及到应用程序的安全性时，千万不要相信你的观众</strong>"</li><li id="d096" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">在将用户输入放入服务器之前，一定要对其进行验证。</li><li id="9af2" class="ky kz hu kc b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">在将用户输入打印到屏幕上之前，一定要对其进行编码。</li></ol><h2 id="6a87" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://helmetjs.github.io/" rel="noopener ugc nofollow" target="_blank">头盔</a></h2><p id="9e3c" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">头盔真的很像你的应用头盔。它通过设置各种<a class="ae mc" href="https://en.wikipedia.org/wiki/List_of_HTTP_header_fields" rel="noopener ugc nofollow" target="_blank"> HTTP头</a>来保护你的应用程序。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/c9a15e523854c4f37c5072934cb68d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*0yt7yPq3BS20Bv_LfwIgyg.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="87e1" class="lo jd hu mj b fv mn mo l mp mq">const express <strong class="mj hv">=</strong> require('express')<br/>const helmet <strong class="mj hv">=</strong> require('helmet')<br/>const app <strong class="mj hv">=</strong> express()<br/>app.use(helmet())</span></pre><h2 id="4b13" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank">快速会话</a></h2><p id="8277" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><a class="ae mc" href="https://www.npmjs.com/package/express-session" rel="noopener ugc nofollow" target="_blank">快速会话</a>中间件在服务器上存储会话数据；它只在cookie本身中保存会话ID，而不保存会话数据。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/18493ed75560d4abdba9dd6af0abb7c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*zX3E-3cIfqHoIeInvJ9BLA.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="9125" class="lo jd hu mj b fv mn mo l mp mq">var app = express()<br/>app.set('trust proxy', 1) // trust first proxy<br/>app.use(session({<br/>    secret: 'keyboard cat',<br/>    resave: false,<br/>    saveUninitialized: true,<br/>    cookie: {<br/>        secure: true<br/>    }<br/>}))</span></pre><h2 id="6e62" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/cookie-session" rel="noopener ugc nofollow" target="_blank"> cookie会话</a></h2><p id="931a" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">一个简单的基于cookie的会话中间件，允许存储cookie。它不需要服务器端的任何数据库/资源，尽管总会话数据不能超过浏览器的最大cookie大小。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/5541b926892d6d3ae2b6fac3e1fc889a.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*VcSiROHzN5jGJ0xtN42pIw.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="f37c" class="lo jd hu mj b fv mn mo l mp mq">var cookieSession = require('cookie-session')<br/>var express = require('express')<br/>var app = express()<br/>app.use(cookieSession({<br/>    name: 'session',<br/>    keys: [ /* secret keys */ ],<br/>    // Cookie Options<br/>    maxAge: 24 * 60 * 60 * 1000 // 24 hours<br/>}))</span></pre><h2 id="debb" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/joi" rel="noopener ugc nofollow" target="_blank"> JOI </a></h2><p id="1e11" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">hapi 的JavaScript对象的对象模式描述语言和验证器。验证用户输入非常有用。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/a32ffeef069ebe1d484619c98e00d86f.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*SdlonI00NCwJ2Ew0hJ963A.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="0298" class="lo jd hu mj b fv mn mo l mp mq">const Joi = require('joi');<br/>const schema = Joi.object().keys({<br/>    username: Joi.string().alphanum().min(3).max(30).required(),<br/>    password: Joi.string().regex(/^[a-zA-Z0-9]{3,30}$/),<br/>    access_token: [Joi.string(), Joi.number()],<br/>    birthyear: Joi.number().integer().min(1900).max(2013),<br/>    email: Joi.string().email({<br/>        minDomainAtoms: 2<br/>    })<br/>}).with('username', 'birthyear').without('password', 'access_token');<br/>// Return result.<br/>const result = Joi.validate({<br/>    username: 'abc',<br/>    birthyear: 1994<br/>}, schema);<br/>// result.error === null -&gt; valid<br/>// You can also pass a callback which will be called synchronously with the validation result.<br/>Joi.validate({<br/>    username: 'abc',<br/>    birthyear: 1994<br/>}, schema, function(err, value) {}); // err === null -&gt; valid</span></pre><h2 id="4059" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/express-rate-limit" rel="noopener ugc nofollow" target="_blank">快速限速</a></h2><p id="afbc" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">你可能知道<a class="ae mc" href="https://en.wikipedia.org/wiki/Brute-force_attack" rel="noopener ugc nofollow" target="_blank">暴力攻击</a>。express-rate-limit是一个用于express routes的中间件，它对传入的请求进行速率限制，以类似斐波那契数列的方式增加每个请求的延迟。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/ee6abce420a79a3b5b5bc7f21d0ba3b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*E-LtgEmz9X3o3zQkKjl7tA.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="4c44" class="lo jd hu mj b fv mn mo l mp mq">const rateLimit = require("express-rate-limit");</span><span id="1079" class="lo jd hu mj b fv ms mo l mp mq">app.enable("trust proxy");<br/> <br/>const limiter = rateLimit({<br/>    windowMs: 15 * 60 * 1000, <br/>    max: 100 <br/>});</span><span id="c64c" class="lo jd hu mj b fv ms mo l mp mq">//  apply to all requests<br/>app.use(limiter);</span></pre><h2 id="92f1" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/express-jwt-permissions" rel="noopener ugc nofollow" target="_blank">express-jwt-permissions</a></h2><p id="7169" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">检查JWT令牌权限的中间件。建立一个用户访问控制系统是非常有用的。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff md"><img src="../Images/ff21a5a435136ac5211acd45a6c92654.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/1*q6NskNenzW72in_wpGeN1Q.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="0a08" class="lo jd hu mj b fv mn mo l mp mq">var guard <strong class="mj hv">=</strong> require('express-jwt-permissions')()</span><span id="c29d" class="lo jd hu mj b fv ms mo l mp mq">app.use(guard.check('admin'))</span></pre><h2 id="ecb4" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/express-mongo-sanitize" rel="noopener ugc nofollow" target="_blank">快递-蒙哥-消毒</a></h2><p id="b366" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">清理用户提供的数据以防止MongoDB操作员注入的Express中间件。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/848a386b9b8933f2017ad2a9a404c86a.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*LBajChlueliPuc9YOPBMFg.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="7a0d" class="lo jd hu mj b fv mn mo l mp mq">var express = require('express'),<br/>    bodyParser = require('body-parser'),<br/>    mongoSanitize = require('express-mongo-sanitize');<br/>var app = express();<br/>app.use(bodyParser.urlencoded({<br/>    extended: true<br/>}));<br/>app.use(bodyParser.json());<br/>// To remove data, use:<br/>app.use(mongoSanitize());<br/>// Or, to replace prohibited characters with _, use:<br/>app.use(mongoSanitize({<br/>    replaceWith: '_'<br/>}))</span></pre><h2 id="20da" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/hpp" rel="noopener ugc nofollow" target="_blank"> hpp </a></h2><p id="df4f" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated"><a class="ae mc" href="http://expressjs.com/" rel="noopener ugc nofollow" target="_blank">快递</a>中间件<strong class="kc hv">防范HTTP参数污染攻击。</strong>阅读<a class="ae mc" href="https://speakerdeck.com/ckarande/top-overlooked-security-threats-to-node-dot-js-web-applications?slide=48" rel="noopener ugc nofollow" target="_blank">切坦·卡兰德的幻灯片</a></p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/4743d319ee5e1df2cd9271e273f9cdf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*SDmBZFnIk-4f5lYm8BRDxw.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="edac" class="lo jd hu mj b fv mn mo l mp mq">var express = require('express'),<br/>    bodyParser = require('body-parser');<br/>var app = express();<br/>// ...<br/>var hpp = require('hpp');<br/>// ...<br/>// Make sure the body is parsed beforehand.<br/>app.use(bodyParser.urlencoded());</span><span id="f36a" class="lo jd hu mj b fv ms mo l mp mq">app.use(hpp()); // &lt;- THIS IS THE NEW LINE</span><span id="1f36" class="lo jd hu mj b fv ms mo l mp mq">// Add your own middlewares afterwards, e.g.:<br/>app.get('/search', function(req, res, next) { /* ... */ });<br/>// They are safe from HTTP Parameter Pollution now.</span></pre><h2 id="ce67" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated"><a class="ae mc" href="https://www.npmjs.com/package/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a></h2><p id="9c31" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">Dotenv是一个零依赖模块，它将环境变量从一个<code class="eh mu mv mw mj b">.env</code>文件加载到<code class="eh mu mv mw mj b">process.env.</code>中。在独立于代码的环境中存储配置基于<a class="ae mc" href="http://12factor.net/config" rel="noopener ugc nofollow" target="_blank">十二因素应用</a>方法。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/87fb0c16dfe43112335c7383aafc996f.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*eqR7xEMui6K9N_vvwGhDEg.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="54ad" class="lo jd hu mj b fv mn mo l mp mq">var express = require('express'),<br/>    bodyParser = require('body-parser'),<br/>    dotenv = require('dotenv');<br/>var app = express();</span><span id="ea3c" class="lo jd hu mj b fv ms mo l mp mq">dotenv.config();<br/>dotenv.config({<br/>    path: "../.env"<br/>});</span></pre><h1 id="986e" class="jc jd hu bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated"><a class="ae mc" href="https://www.npmjs.com/package/csurf" rel="noopener ugc nofollow" target="_blank"> csurf </a></h1><p id="095d" class="pw-post-body-paragraph ka kb hu kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">csurf是一个<a class="ae mc" href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="noopener ugc nofollow" target="_blank"> CSRF </a>保护中间件。</p><figure class="me mf mg mh fq iv fe ff paragraph-image"><div class="fe ff mt"><img src="../Images/347b4218b300ce91908dedca3043e6a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*aaxzBAbUp4u-nXeX19l9lA.png"/></div></figure><pre class="me mf mg mh fq mi mj mk ml aw mm dt"><span id="37c6" class="lo jd hu mj b fv mn mo l mp mq">var cookieParser = require('cookie-parser')<br/>var csrf = require('csurf')<br/>var bodyParser = require('body-parser')<br/>var express = require('express')<br/>// setup route middlewares<br/>var csrfProtection = csrf({<br/>    cookie: true<br/>})<br/>var parseForm = bodyParser.urlencoded({<br/>    extended: false<br/>})<br/>// create express app<br/>var app = express()<br/>// parse cookies<br/>// we need this because "cookie" is true in csrfProtection<br/>app.use(cookieParser())<br/>app.get('/form', csrfProtection, function(req, res) {<br/>    // pass the csrfToken to the view<br/>    res.render('send', {<br/>        csrfToken: req.csrfToken()<br/>    })<br/>})<br/>app.post('/process', parseForm, csrfProtection, function(req, res) {<br/>    res.send('data is being processed')<br/>})</span></pre><p id="8e32" class="pw-post-body-paragraph ka kb hu kc b kd la kf kg kh lb kj kk kl mx kn ko kp my kr ks kt mz kv kw kx hn dt translated">祝你编码愉快。</p><h2 id="16ff" class="lo jd hu bd je lp lq lr ji ls lt lu jm kl lv lw jq kp lx ly ju kt lz ma jy mb dt translated">如果你喜欢这篇文章，请把它拍下来分享给别人，让别人也能找到它！</h2></div></div>    
</body>
</html>