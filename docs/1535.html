<html>
<head>
<title>Building a Serverless Data Pipeline with AWS S3 Lamba and DynamoDB</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 AWS S3 兰巴和 DynamoDB 构建无服务器数据管道</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-serverless-data-pipeline-with-aws-s3-lamba-and-dynamodb-5ecb8c3ed23e#2019-03-05">https://medium.com/hackernoon/build-a-serverless-data-pipeline-with-aws-s3-lamba-and-dynamodb-5ecb8c3ed23e#2019-03-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/90bd99dc671002aec65a39cb06029e18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9L-plk6g5uDmDVdzYt1_g.jpeg"/></div></div></figure><p id="a9ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">AWS Lambda plus Layers 是管理数据管道和实现无服务器架构的最佳解决方案之一。这篇文章展示了如何使用 AWS Lambda 函数、S3 和 DynamoDB 构建一个简单的数据管道。</p><h2 id="4e52" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">这条管道能实现什么？</h2><p id="c73d" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">每天，外部数据源将数据导出到 S3，并导入到 AWS DynamoDB 表中。</p><h2 id="81fa" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">先决条件</h2><ul class=""><li id="23b9" class="la lb hu je b jf kv jj kw jn lc jr ld jv le jz lf lg lh li dt translated"><a class="ae lj" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器架构</a></li><li id="6029" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated">Python3.6</li><li id="bc07" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated"><a class="ae lj" href="https://pandas.pydata.org/" rel="noopener ugc nofollow" target="_blank">熊猫</a></li><li id="44e4" class="la lb hu je b jf lk jj ll jn lm jr ln jv lo jz lf lg lh li dt translated">码头工人</li></ul><h2 id="3ca3" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">这条管道是如何工作的</h2><p id="3349" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">每天，外部数据源将前一天的数据以<strong class="je hv"> csv </strong>格式导出到 S3 存储桶。S3 事件触发一个 AWS Lambda 函数，该函数执行<strong class="je hv"> ETL </strong>过程并将数据保存到<strong class="je hv"> DynamoDB </strong>。</p><figure class="lq lr ls lt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lp"><img src="../Images/62c98e95fdc51c7bcfb16efd05460db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AR8uwgFC7WKK-QrVKRlr8g.png"/></div></div></figure><h2 id="e3a7" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">安装无服务器框架</h2><p id="bbfe" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">在开始之前，安装<a class="ae lj" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv">无服务器框架</strong> </a>。打开一个终端，输入<code class="eh lu lv lw lx b">npm install -g serverless</code>来安装无服务器框架。</p><h2 id="69e5" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">创建新服务</h2><p id="e12b" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">使用 AWS Python 模板创建新服务，指定唯一的名称和可选路径。</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="2bfd" class="ka kb hu lx b fv mc md l me mf">$ serverless create --template aws-python --path data-pipline</span></pre><h2 id="5c66" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">安装无服务器插件</h2><p id="1ba2" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">然后可以运行下面的命令项目根目录来安装<strong class="je hv">server less-python-requirements</strong>插件，</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="8a38" class="ka kb hu lx b fv mc md l me mf">$ serverless<!-- --> plugin install -n serverless-python-requirements</span></pre><p id="1ab3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">编辑<code class="eh lu lv lw lx b">serverless.yml</code>文件，如下所示:</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="109d" class="ka kb hu lx b fv mc md l me mf"><strong class="lx hv">plugins</strong>:<br/>  - serverless-python-requirements<br/><strong class="lx hv">custom</strong>:<br/>  <strong class="lx hv">pythonRequirements</strong>:<br/>    <strong class="lx hv">dockerizePip</strong>: non-linux<br/>    <strong class="lx hv">layer</strong>: true  #Put dependencies into a Lambda Layer.</span></pre><p id="1b6f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mg">需要安装</em><strong class="je hv"><em class="mg">Docker</em></strong><em class="mg">才能设置</em><strong class="je hv"><em class="mg">dockerizePip</em></strong><em class="mg">:</em><strong class="je hv"><em class="mg">true</em></strong><em class="mg">或</em><strong class="je hv"><em class="mg">dockerizePip</em></strong><em class="mg">:</em><strong class="je hv"><em class="mg">非 linux </em> </strong></p><h2 id="e954" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">添加 S3 事件定义</h2><p id="ec28" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">这将创建一个<strong class="je hv">dev . document . files</strong>bucket，当一个 csv 文件被添加到 bucket 中时，它将触发<strong class="je hv"> importCSVToDB </strong>函数。</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="5f37" class="ka kb hu lx b fv mc md l me mf"><strong class="lx hv">functions</strong>:<br/>  <strong class="lx hv">importCSVToDB</strong>:<br/>    <strong class="lx hv">handler</strong>: handler.importCSVToDB<br/>    <strong class="lx hv">layers</strong>:<br/>      - {<strong class="lx hv">Ref</strong>: PythonRequirementsLambdaLayer}<br/>    <strong class="lx hv">environment</strong>:<br/>      <strong class="lx hv">documentsTable</strong>: ${self:custom.documentsTableName}<br/>      <strong class="lx hv">bucketName</strong>: ${self:custom.s3bucketName}<br/>    <strong class="lx hv">events</strong>:<br/>      - <strong class="lx hv">s3</strong>:<br/>          <strong class="lx hv">bucket</strong>: ${self:custom.s3bucketName}<br/>          <strong class="lx hv">event</strong>: s3:ObjectCreated:Put<br/>          <strong class="lx hv">rules</strong>:<br/>            - <strong class="lx hv">suffix</strong>: .csv</span></pre><p id="1c43" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完整示例 serverless.yml 如下:</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="mh mi l"/></div></figure><h2 id="8d96" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">添加 Lambda 函数</h2><p id="2aac" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">现在，让我们更新我们的<strong class="je hv"> handler.py </strong>以从 S3 桶中的源 csv 创建 pandas 数据帧，将数据帧转换为字典列表，并使用<strong class="je hv"> update_item </strong>方法将 dict 对象加载到 DynamoDB 表:</p><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="mh mi l"/></div></figure><p id="fa96" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mg">从上面 lambda 函数可以看出，我们使用 Pandas 来读取 csv 文件，</em><strong class="je hv"><em class="mg">Pandas</em></strong><em class="mg">是 Python 中最流行的数据操作包，DataFrames 是 Pandas 数据类型，用于存储表格形式的 2D 数据。</em></p><p id="065c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们部署服务并进行测试！</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="9893" class="ka kb hu lx b fv mc md l me mf">$ sls deploy --stage dev</span></pre><p id="2b40" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了测试数据导入，我们可以手动将 csv 文件上传到 s3 bucket，或者使用 AWS cli 将本地文件复制到 s3 bucket:</p><pre class="lq lr ls lt fq ly lx lz ma aw mb dt"><span id="f347" class="ka kb hu lx b fv mc md l me mf">$ aws s3 cp sample.csv s3://dev.document.files</span></pre><p id="6f89" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是了。您将获得导入 DynamoDB <strong class="je hv"> DocumentsTable </strong>表的数据。</p><p id="1870" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在我的<strong class="je hv"> GitHub repo </strong>中找到完整的项目:</p><div class="mj mk fm fo ml mm"><a href="https://github.com/yai333/pythonserverlesssample" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">yai333/pythonserverlesssample</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">使用 AWS S3、Lamba 和 dynamo db-yai 333/python server less sample 构建无服务器数据管道</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">github.com</p></div></div><div class="mv l"><div class="mw l mx my mz mv na ja mm"/></div></div></a></div><h2 id="1b63" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">AWS 数据管道</h2><p id="b697" class="pw-post-body-paragraph jc jd hu je b jf kv jh ji jj kw jl jm jn kx jp jq jr ky jt ju jv kz jx jy jz hn dt translated">或者，您可以使用 AWS 数据管道将 csv 文件导入 dynamoDB 表</p><blockquote class="nb nc nd"><p id="5acb" class="jc jd mg je b jf jg jh ji jj jk jl jm ne jo jp jq nf js jt ju ng jw jx jy jz hn dt translated">AWS 数据管道是一个 web 服务，您可以使用它来自动移动和转换数据。使用 AWS 数据管道，您可以定义数据驱动的工作流，以便任务可以依赖于先前任务的成功完成。您定义数据转换的参数，AWS 数据管道执行您设置的逻辑。</p></blockquote><div class="mj mk fm fo ml mm"><a href="https://docs.aws.amazon.com/datapipeline/latest/DeveloperGuide/what-is-datapipeline.html" rel="noopener  ugc nofollow" target="_blank"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">什么是 AWS 数据管道？- AWS 数据管道</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">通过 AWS 数据管道 web 服务中的数据驱动工作流，自动化数据的移动和转换。</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">docs.aws.amazon.com</p></div></div><div class="mv l"><div class="nh l mx my mz mv na ja mm"/></div></div></a></div></div><div class="ab cl ni nj hc nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="hn ho hp hq hr"><h2 id="2529" class="ka kb hu bd kc kd ke kf kg kh ki kj kk jn kl km kn jr ko kp kq jv kr ks kt ku dt translated">了解更多信息</h2><div class="mj mk fm fo ml mm"><a rel="noopener follow" target="_blank" href="/@yia333/building-a-fully-serverless-realtime-cms-using-aws-appsync-and-aurora-serverless-7258fe1925f7"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">使用 AWS Appsync 和 Aurora Serverless 构建一个完全无服务器的实时 CMS</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">AWS 使 AWS RDS Aurora 的无服务器选项普遍可用，这将意味着在构建完全…</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">medium.com</p></div></div><div class="mv l"><div class="np l mx my mz mv na ja mm"/></div></div></a></div><div class="mj mk fm fo ml mm"><a rel="noopener follow" target="_blank" href="/the-apps-team/how-to-add-nodejs-library-dependencies-in-a-aws-lambda-layer-with-serverless-framework-d774cb867197"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">如何使用无服务器框架在 AWS Lambda 层中添加 NodeJs 库依赖项</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">无服务器计算在 re:Invent 2018 上得到推动。AWS 宣布了简洁的 Lambda 层，它给了开发者多达五个…</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">medium.com</p></div></div><div class="mv l"><div class="nq l mx my mz mv na ja mm"/></div></div></a></div><div class="mj mk fm fo ml mm"><a rel="noopener follow" target="_blank" href="/@yia333/in-order-to-create-automated-testing-in-a-continuous-integration-environment-you-will-need-to-35d9952ccca4"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">使用 Selenium Python web driver Chrome PyTest 和 CircleCI 进行端到端测试 React 应用</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">为了在持续集成环境中创建自动化测试</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">medium.com</p></div></div><div class="mv l"><div class="nr l mx my mz mv na ja mm"/></div></div></a></div><div class="mj mk fm fo ml mm"><a rel="noopener follow" target="_blank" href="/@yia333/running-selenium-and-headless-chrome-on-aws-lambda-layers-python-3-6-bd810503c6c3"><div class="mn ab ej"><div class="mo ab mp cl cj mq"><h2 class="bd hv fv z el mr eo ep ms er et ht dt translated">在 AWS Lambda 层上运行 Selenium 和 Headless Chrome</h2><div class="mt l"><h3 class="bd b fv z el mr eo ep ms er et ek translated">AWS 已经将 Lambda 函数的超时限制从 5 分钟延长到 15 分钟，并且有了新的 Lambda 层功能，它…</h3></div><div class="mu l"><p class="bd b gc z el mr eo ep ms er et ek translated">medium.com</p></div></div><div class="mv l"><div class="ns l mx my mz mv na ja mm"/></div></div></a></div><figure class="lq lr ls lt fq iv"><div class="bz el l di"><div class="nt mi l"/></div></figure></div></div>    
</body>
</html>