<html>
<head>
<title>Databases for Windows Desktop Development: Welcome to the Jungle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于Windows桌面开发的数据库:欢迎来到丛林</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/databases-for-windows-desktop-development-welcome-to-the-jungle-c67b4c98c817?source=collection_archive---------4-----------------------#2019-01-12">https://medium.com/hackernoon/databases-for-windows-desktop-development-welcome-to-the-jungle-c67b4c98c817?source=collection_archive---------4-----------------------#2019-01-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="2fd7" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">微软忘记了一个细节——或者故意告诉我们一些事情。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/0428b950e73524088821b0c4692d2e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jtz3v9U6Sm5IEsiLYVZMuA.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek"><a class="ae jz" href="https://www.pexels.com/photo/green-leafed-trees-1089302/" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><p id="a1b3" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我是一个微软爱好者。我是一名Windows桌面开发人员。你可以判断，到此为止。或者你可能也有同样的想法，想知道为什么微软决定放弃Windows的开发。</p><p id="be9e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我即将推出一款桌面应用。我离开swdev已经有几年了，但是我已经写了30年的代码了。使用. NET十几年。</p><p id="e667" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">因此，对于我的新应用程序，我决定使用优秀的Windows演示基础。WinForms消失了，UWP看起来像孤儿，被限制在Windows 10中。我认识购买Windows桌面应用的人(当然我也是其中之一)。但我知道没有人在微软商店购买它们，甚至偶尔检查一下，我担心这种情况不会很快好转。作为警告，我仍然把我的旧Windows Phone放在架子上。</p><p id="61ef" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">不用说，WPF用实体框架。当然不一定，但是最好。</p><p id="adda" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">作为本地数据库，我从mdf(也就是SQL Server)开始。我告诉自己:“我们会看到什么是最好的，可能是SQL Compact或其他什么。这不是问题所在。”作为一个个人应用程序，它必须有一个单一的设置，所有包括在内，但这在我的生活中从未成为问题。</p><p id="4dfe" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">最后接触的时刻到了，看似“最后接触”的事情变成了令人头疼的事情。我离开swdev有一段时间了。也许太多了。</p><h1 id="92be" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">微软忘记了一个细节</h1><p id="4629" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">或者故意告诉我们一些事情。记住<a class="ae jz" href="https://en.wikipedia.org/wiki/Satya_Nadella" rel="noopener ugc nofollow" target="_blank">纳德拉</a>是一个云人。</p><p id="a262" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">如今一切都是云——我明白了——但许多业务和生产力仍然离线运行。微软对此相当擅长。</p><p id="4b99" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">惊喜—我的错—<a class="ae jz" href="https://www.microsoft.com/it-it/sql-server/sql-server-editions-express" rel="noopener ugc nofollow" target="_blank"><strong class="kc hv">SQL Server Express</strong></a>无论如何都需要单独设置。我应该想到的。</p><p id="41c3" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我是在赌<a class="ae jz" href="https://docs.microsoft.com/it-it/sql/database-engine/configure-windows/sql-server-2016-express-localdb?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hv"> LocalDb </strong> </a>，SQL Server Express的简化版。<a class="ae jz" href="https://docs.microsoft.com/it-it/sql/sql-server/editions-and-components-of-sql-server-2017?view=sql-server-2017" rel="noopener ugc nofollow" target="_blank">来自微软</a>:</p><p id="1128" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><em class="lt">“SQL Server Express local db是Express的一个轻量级版本，具有其所有的可编程功能，在用户模式下运行，具有快速的零配置安装和一个简短的先决条件列表。”</em></p><p id="4ee2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">用户实例。非常好。我希望提供给没有管理员权限的用户。</p><p id="92ed" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但是……你可以得到一个LocalDb的msi文件(所以你可以<em class="lt">或多或少</em>进行静默安装)，但是在任何情况下安装都需要管理员权限(用户<em class="lt">模式</em>，而不是用户<em class="lt">权限</em>……)。此外，它不能密码保护，也不能加密。它是为开发人员使用的，而不是为开发人员使用的。用于<em class="lt">设计时间</em>。</p><p id="d696" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">简而言之，在微软推出Access 26年后，LocalDb并不完全是一个基于文件的数据库。</p><p id="7600" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但故事并没有到此结束。SQL Server Express 2017不支持Windows 7和x86。微软认为，我的一半潜在客户使用过时的操作系统(Windows 7仍然服务于全球三分之一的台式机/笔记本电脑用户),因此无法解决这个问题。</p><p id="9455" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">此外，尝试安装以前的SQL Server Express(用于Windows 7支持),它无法打开您的mdf，因为您是用Visual Studio 2017或最新的SQL Server创建的。对于这种常见问题，没有降级工具可用，也没有创建“旧”mdf的选项。为了在Windows 7中读取您的mdf，您必须手动将mdf迁移到以前的版本——使用“较旧”的SQL Server工具——并放弃使用Visual Studio来管理它。哇哦。在设计这个陷阱的时候，他们真的应该考虑到开发者。</p><p id="3ff0" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">好吧，我们倒回去。<strong class="kc hv"> SQL压缩</strong>。<a class="ae jz" href="https://www.codeproject.com/Articles/33661/%2FArticles%2F33661%2FCreating-a-Private-Installation-for-SQL-Compact" rel="noopener ugc nofollow" target="_blank">私人安装</a>，不需要管理员权限，密码保护。完美。</p><p id="3c0c" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">嗯，<em class="lt">没有</em>。SQL Compact仍然存在于微软服务器的黑暗角落，但是，从2013年2月起，它已经被弃用了。你可以自担风险，但Windows 8和10不在规格范围内，而且取消外部设置需要一些变通办法。此外，Visual Studio和SQL Server Management Studio清楚地表明，SQL Compact已经寿终正寝，被人遗忘了。你只能靠自己了。</p><p id="5694" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">更多回滚。<strong class="kc hv">访问</strong>？(哦，我的……)</p><p id="9fca" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">实体框架不支持访问。是的，你没看错。微软不支持它自己推荐的ORM的流行数据库。</p><p id="c3ac" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">实现是有的，例如<a class="ae jz" href="https://github.com/bubibubi/JetEntityFrameworkProvider" rel="noopener ugc nofollow" target="_blank">jetintityframework provider</a>，但是它只支持代码优先。而且是来自<a class="ae jz" href="https://github.com/bubibubi" rel="noopener ugc nofollow" target="_blank">布比布比</a>。我确信Bubi是一个伟大的开发者，但是我希望有更多的…官方的东西。</p><p id="9388" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我曾经为Access和。但是我的新应用已经完全基于EF了。</p><p id="accb" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">使用<a class="ae jz" href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/linq-to-dataset-overview" rel="noopener ugc nofollow" target="_blank"> Linq to DataSet </a>，带Access？从未使用过，但我确信它对性能有很大的影响——除了其他问题，您必须完全填充数据集——在这方面我已经很小心了。似乎不是主流解决方案。我还没准备好为获得其他惊喜而投入大量工作。</p><p id="8f45" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">你可以猜到我开始出汗了。</p><p id="46f7" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">好吧，让我们走出微软的领地。EF支持的最著名的自包含SQL数据库引擎是什么？<a class="ae jz" href="https://www.sqlite.org/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="kc hv">当然是SQLite </strong> </a>。</p><p id="592e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但是SQLite有一些限制。<a class="ae jz" href="https://www.sqlite.org/faq.html#q11" rel="noopener ugc nofollow" target="_blank">例如，您不能删除列</a>，也不能添加约束。想象一下在每次模式更改时都支持完整的数据库拷贝。</p><p id="31ef" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">和密码/加密本身不受SQLite支持。当然，有人会告诉你插件是万能的。有一些限制。但是还有另一个插件，工作方式不同，或者几年后就消失了…</p><p id="c81c" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><a class="ae jz" href="https://www.mysql.com/it/" rel="noopener ugc nofollow" target="_blank">T13】MySQLT15】？甲骨文，微软最激烈的竞争对手。我相信他们会尽最大努力，争取</a><a class="ae jz" href="https://dev.mysql.com/downloads/connector/net/" rel="noopener ugc nofollow" target="_blank">的支持。NET </a>对抗Java——我不会有更多的惊喜——但是让我担心。然后，你必须找到一个静默安装的方法，交叉手指。</p><p id="712c" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">你可以继续，继续，继续…航行在许多海洋中，梦想着无尽的发现和重构。</p><h1 id="63e4" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">那又怎样？</h1><p id="3037" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">所以，我们有很多选择，没有解决方案。</p><p id="74a6" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">微软有两个明确的答案:桌面上的SQL Express(有一个单独而庞大的安装程序，没有密码，没有加密)，或者Azure(这意味着云，它不适合太多的桌面应用)。</p><p id="30a1" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">微软忘记了——或者说想要忘记——桌面应用程序及其对基于文件的集成数据库的需求。您可以找到许多选项，但没有直接完整的解决方案，无论是现在还是将来，都没有得到微软的明确而全面的支持。</p><h1 id="ae45" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">我该怎么办？</h1><p id="7f8e" class="pw-post-body-paragraph ka kb hu kc b kd lo iv kf kg lp iy ki kj lq kl km kn lr kp kq kr ls kt ku kv hn dt translated">首先，我必须接受我不属于这个混乱的时代。我下半辈子可能都要为此而奋斗。</p><p id="63ac" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在呢，用我的桌面应用程序？</p><p id="8a3a" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">嗯，我计划把我的产品扩展到团队。因此，SQL Server是我的必经之路，因为如果可能的话，我更愿意呆在微软的地盘上。最好从一开始就使用这项技术。</p><p id="0574" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我将继续使用mdf文件，将它迁移到旧版本(因此，使用旧的SQL Server)并放弃从Visual Studio管理它。</p><p id="9d82" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">然后，我想使用msiexec命令行静默部署LocalDb，该命令行嵌入在我的设置中(假设提供了msi):</p><p id="a38e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><em class="lt">msiexec/I c:\ temp \ sqllocaldb 2017 . MSI</em></p><p id="ce44" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">但是… Msi不能在另一个Msi中运行(我使用的是Visual Studio Installer项目，出于许多原因，我更喜欢它)。因此，我决定在应用程序第一次运行时运行它(否则，我可以编写一个安装包装器，或者使用不同的安装构建器)。当然，我必须这么做</p><ul class=""><li id="bded" class="lu lv hu kc b kd ke kg kh kj lw kn lx kr ly kv lz ma mb mc dt translated">检测可能以前安装的SQL Server(通过检查注册表，然后检查文件)，</li><li id="adc5" class="lu lv hu kc b kd md kg me kj mf kn mg kr mh kv lz ma mb mc dt translated">决定安装哪个引擎(Windows 7上的local db 2014—x86或x64 —否则LocalDb 2017 — x64 —)，</li><li id="ce01" class="lu lv hu kc b kd md kg me kj mf kn mg kr mh kv lz ma mb mc dt translated">提示用户(他肯定会对额外的设置感到高兴，尤其是作为消费者)，</li><li id="8436" class="lu lv hu kc b kd md kg me kj mf kn mg kr mh kv lz ma mb mc dt translated">并且可能将SQL安装程序与应用程序一起分发，或者作为可选的fat安装程序分发(否则，将需要单独的LocalDb下载)。</li></ul><p id="733e" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated"><strong class="kc hv"> <em class="lt">无可奉告，微软。</em> </strong></p><p id="a384" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">没有加密，只能通过应用程序逻辑或在SQL Server级别添加用户。</p><p id="4173" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">有用，但是我不开心。此外，我花了几天时间来做决定、实施和测试。</p><p id="d572" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在，如果你不介意的话，我有一些积压的工作要做，因为我没想到在第一个Visual Studio 22年后会在本地数据库上浪费这么多时间。</p></div></div>    
</body>
</html>