<html>
<head>
<title>Hacker News Scraping Challenge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">黑客新闻抓取挑战</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/hacker-news-scraping-challenge-e0655479f85b?source=collection_archive---------29-----------------------#2019-01-17">https://medium.com/hackernoon/hacker-news-scraping-challenge-e0655479f85b?source=collection_archive---------29-----------------------#2019-01-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/ed63ba7967ca3543134ed4bf70ab861b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qHomlOyi9GomdLQsfrLqIg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Scrape Hacker News with Dataflow kit</figcaption></figure><p id="eb1b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">互联网上几乎所有的网页都包含一些<em class="ke">噪音块</em>，如导航、侧栏、版权信息、隐私声明和广告，这些都与网页的主题没有直接关系。</p><p id="cd5f" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">区分主要内容块和噪声块是很重要的。姑且称之为<em class="ke">信息块</em>。从信息块中提取信息是Web爬虫最重要的任务。</p><p id="0303" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">每个信息块中的所有子HTML元素通常被分组到相似的结构中。</p><h2 id="277f" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">1.挑战。从<a class="ae la" href="https://news.ycombinator.com" rel="noopener ugc nofollow" target="_blank">黑客新闻</a> (HN)网站提取信息块。</h2><p id="6ee2" class="pw-post-body-paragraph jg jh hu ji b jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd hn dt translated">我们将使用<a class="ae la" href="https://dataflowkit.com/dfk" rel="noopener ugc nofollow" target="_blank"> Dataflow kit </a>服务从HN网站执行<a class="ae la" href="https://hackernoon.com/tagged/scraping" rel="noopener ugc nofollow" target="_blank">数据抓取</a>。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lg"><img src="../Images/f8baeb2393e3c4c36e98d71294f6e36a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WQYkkPFOa60ubTWrjpguCg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Open Hacker News main page</figcaption></figure><ol class=""><li id="cf41" class="ll lm hu ji b jj jk jn jo jr ln jv lo jz lp kd lq lr ls lt dt translated">在左侧面板顶部的地址栏中输入<a class="ae la" href="https://news.ycombinator.com/" rel="noopener ugc nofollow" target="_blank">https://news.ycombinator.com/</a>网址，点击旁边的按钮加载网页。</li><li id="3f93" class="ll lm hu ji b jj lu jn lv jr lw jv lx jz ly kd lq lr ls lt dt translated">抓取过程基于您选择的数据模式。点击“<strong class="ji hv">添加选择器”</strong>按钮，开始选择网页上的元素，以定义数据提取的模式。现在，从页面上的块中只选择两个CSS选择器就足够了。当选择一个元素时，所有其他与同级信息块中具有相同类别的被点击元素相似的元素被自动添加到适当的选择器中。结果30个“故事链接”与<strong class="ji hv">。故事链接</strong>类<strong class="ji hv">类</strong>和29个带<strong class="ji hv">的分数点。分数</strong>类相应地被突出显示。</li><li id="762b" class="ll lm hu ji b jj lu jn lv jr lw jv lx jz ly kd lq lr ls lt dt translated">按下预览按钮发送生成数据流工具包后端返回的输出样本的请求。</li></ol><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/b3a654b6d018939c13f1acdb379e5a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Us7QSGVC2mwDtQWHw6-kwA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Parsed results returned by Datafalow Kit in CSV and JSON formats.</figcaption></figure><p id="83f5" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">不幸的是，我们有两个独立的“分数”和“故事链接”列表。结果字段似乎没有像预测的那样分组！</p><p id="9aee" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">实际上，我们期望“故事链接”与它们对应的“分数”配对在一起。</p><blockquote class="ma"><p id="80d5" class="mb mc hu bd md me mf mg mh mi mj kd ek translated">那有什么问题呢？</p></blockquote><p id="9230" class="pw-post-body-paragraph jg jh hu ji b jj mk jl jm jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd hn dt translated">让我们看看下面的<a class="ae la" href="https://hackernoon.com/tagged/html" rel="noopener ugc nofollow" target="_blank"> HTML </a>代码，它描述了一个包含上述字段的块。为了简洁起见，我从实际代码中省略了一些HTML元素。</p><pre class="lh li lj lk fq mp mq mr ms aw mt dt"><span id="6ba0" class="kf kg hu mq b fv mu mv l mw mx">&lt;tbody&gt;<br/>    &lt;tr&gt; ... <br/>        &lt;td&gt;<br/>            &lt;a href="http://example.com" class="storylink"&gt; Recreating the Death Star Trench Run Scene with Lego<br/>            &lt;/a&gt;<br/>        &lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt;...<br/>        &lt;td&gt;<br/>            &lt;span class="score"&gt;10 points&lt;/span&gt;<br/>        &lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    <br/>    &lt;tr&gt; ... <br/>        &lt;td&gt;<br/>            &lt;a href="http://example2.com" class="storylink"&gt; Show HN: JournalBook – Privacy centric, offline first, personal journal app<br/>            &lt;/a&gt;<br/>        &lt;/td&gt;<br/>    &lt;/tr&gt;<br/>    &lt;tr&gt;...<br/>        &lt;td&gt;<br/>            &lt;span class="score"&gt;36 points&lt;/span&gt;<br/>        &lt;/td&gt;<br/>    &lt;/tr&gt;<br/>&lt;/tbody&gt;</span></pre><p id="7889" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这种特殊情况下，所有兄弟元素的公共父元素是<code class="eh my mz na mq b">&lt;tbody&gt;</code>，并且没有父元素将信息块内的元素连接在一起。</p><p id="fee4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">问题是，我们的抓取算法将块中的所有字段组合在一起，并考虑到它们在DOM树中的共同父节点。所有这些“故事链接”和“分数”HTML元素实际上都是<em class="ke">的兄弟节点</em>。但是尽管从视觉上看，它们似乎被组合在这些相似的块中。</p><p id="6a58" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">类似的竞争抓取服务提供的黑客新闻主页的输出看起来大致相同。几乎所有这些元素都使用相同的方法来确定元素的公共父元素，从而将它们组合在一起。</p><blockquote class="ma"><p id="703b" class="mb mc hu bd md me mf mg mh mi mj kd ek translated">用另一种方法可以很容易地解决这个问题。</p></blockquote><p id="18c1" class="pw-post-body-paragraph jg jh hu ji b jj mk jl jm jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd hn dt translated">在数据流工具包中，有一个特殊的<strong class="ji hv">`路径`</strong>链接提取器类型的选项，仅用于导航目的。当指定了<strong class="ji hv"> `Path` </strong>选项时，将不会返回当前页面的任何结果。但取而代之的是，将访问<strong class="ji hv"> `Path` links </strong>下的所有网页以提取详细信息。</p><p id="2926" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在我们的例子中，我们可以选择“Comments”字段作为<strong class="ji hv"> `Path` </strong>选择器，如下图所示。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/27a328609965346bfc643b9e460c65ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_HTsCgBaaTgqRUnOL0JJQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Select “Path” Selectors on the main page</figcaption></figure><ol class=""><li id="05c2" class="ll lm hu ji b jj jk jn jo jr ln jv lo jz lp kd lq lr ls lt dt translated">用相应的CSS选择器<strong class="ji hv"> `.subtext a+ a` </strong>,为<strong class="ji hv">“comments”</strong>字段添加新的选择器</li><li id="4e3b" class="ll lm hu ji b jj lu jn lv jr lw jv lx jz ly kd lq lr ls lt dt translated">点击右侧的<strong class="ji hv">“+”</strong>显示附加控制元素。</li><li id="6162" class="ll lm hu ji b jj lu jn lv jr lw jv lx jz ly kd lq lr ls lt dt translated">勾选<strong class="ji hv">“路径”</strong>选项，点击<strong class="ji hv">“详细信息”</strong></li></ol><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/a0837977613a4755772a01d9bfd99d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dUfOWI5K2jt4fz722_dvrA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Add selectors on detailed page</figcaption></figure><p id="e151" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">4.显示了一个详细的页面，您可以在其中指定所有需要的CSS选择器来提取数据。正如您所注意到的，在这里可以找到与主页上相同的信息，如<strong class="ji hv">【故事链接】</strong><strong class="ji hv">【分数】</strong><strong class="ji hv">【用户】</strong>和额外的<strong class="ji hv">【评论】</strong>字段。</p><p id="3cf7" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">5.按<strong class="ji hv">“左上箭头”</strong>返回主页面，点击<strong class="ji hv">“预览”</strong>按钮。</p><p id="4052" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">6.您可以在这里看到包含提取数据的<strong class="ji hv">表格视图</strong>中的一些行。如果数据有详细的字段，就像在这种情况下，它甚至可以更好地用一个<strong class="ji hv">树形视图</strong> JSON结构来表示。</p><p id="e795" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">因此，我们已经在信息块中收到了适当的绑定元素结构，不再混乱。</p><h2 id="8e05" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">2.挑战。从<a class="ae la" href="https://news.ycombinator.com" rel="noopener ugc nofollow" target="_blank">黑客新闻</a>网站提取信息块。</h2><p id="4a41" class="pw-post-body-paragraph jg jh hu ji b jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd hn dt translated">如上所述，我们必须通过主页面上找到的所有30个<strong class="ji hv"> `Path` </strong>链接爬行，并从链接的页面中提取一些信息。</p><p id="67f4" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">不幸的是，我们在第一次尝试中未能获得预期的全部30行，尽管所有的获取请求都返回了200 OK成功响应。</p><blockquote class="ma"><p id="f230" class="mb mc hu bd md me mf mg mh mi mj kd ek translated">发生了什么事？</p></blockquote><p id="9e9a" class="pw-post-body-paragraph jg jh hu ji b jj mk jl jm jn ml jp jq jr mm jt ju jv mn jx jy jz mo kb kc kd hn dt translated">经过调查，我们发现<em class="ke">黑客新闻网站总是返回200个状态码，</em>即使中途发生了错误。</p><p id="9d3b" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在我们的例子中，一些页面带有类似的内容。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nd"><img src="../Images/a15786b4206fef3954914118d5092ff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8yRbZsmL55uNkvzP5ULtiA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Message returned by HN</figcaption></figure><p id="4b0d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">通常Web APIs会返回<strong class="ji hv">状态代码429，</strong>，这意味着发送给服务器的请求太多了。但是黑客新闻用状态码200通知限制请求的速率。</p><p id="fefa" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">通过实验，我们已经确定<em class="ke"> 3是从一个IP </em>向HN web服务器并发请求的最佳数量。</p><p id="380d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">因此，在减少并发抓取器的数量后，我们成功地抓取了所有30个详细页面，并从中提取了所有需要的信息。</p><p id="b513" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">选择JSON格式，点击<strong class="ji hv">“启动”按钮</strong>开始数据抓取。完成数据提取工作后，按<strong class="ji hv"> `Download` </strong>以所选格式提取结果。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/9cabe4853d640b2152f6e823b2326bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sMA4-WOTZbzfwxUPbDckcg.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Launch data extraction and Download results.</figcaption></figure><blockquote class="nf ng nh"><p id="4ac6" class="jg jh ke ji b jj jk jl jm jn jo jp jq ni js jt ju nj jw jx jy nk ka kb kc kd hn dt translated">正如你所看到的，黑客新闻网站有31个请求(1个主页+ 30个路径链接)被执行，耗时约33秒。</p></blockquote><h2 id="4317" class="kf kg hu bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz dt translated">3.每日挑战:)</h2><p id="d9e1" class="pw-post-body-paragraph jg jh hu ji b jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd hn dt translated">这是我们准备给你的最终黑客新闻集锦的链接。</p><div class="nl nm fm fo nn no"><a href="https://github.com/slotix/dataflowkit/blob/master/examples/news.ycombinator.collection.json" rel="noopener  ugc nofollow" target="_blank"><div class="np ab ej"><div class="nq ab nr cl cj ns"><h2 class="bd hv fv z el nt eo ep nu er et ht dt translated">slot IX/数据流套件</h2><div class="nv l"><h3 class="bd b fv z el nt eo ep nu er et ek translated">从网站提取结构化数据。网站抓取。-slot IX/数据流套件</h3></div><div class="nw l"><p class="bd b gc z el nt eo ep nu er et ek translated">github.com</p></div></div><div class="nx l"><div class="ny l nz oa ob nx oc ja no"/></div></div></a></div><p id="baed" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">只需下载这个<a class="ae la" href="https://github.com/slotix/dataflowkit/blob/master/examples/news.ycombinator.collection.json" rel="noopener ugc nofollow" target="_blank">news . y combinator . collection . JSON</a>集合并导入即可。查看<a class="ae la" href="https://dataflowkit.com/collections" rel="noopener ugc nofollow" target="_blank">https://dataflowkit.com/collections</a>了解更多关于导出/导入功能的详细信息。</p><p id="9d6d" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">您可以自定义所有设置，如分页或添加/更改数据字段选择器，以便轻松抓取。</p><h1 id="1abb" class="od kg hu bd kh oe of og kl oh oi oj kp ok ol om ks on oo op kv oq or os ky ot dt translated">总结。</h1><p id="487c" class="pw-post-body-paragraph jg jh hu ji b jj lb jl jm jn lc jp jq jr ld jt ju jv le jx jy jz lf kb kc kd hn dt translated">每个网站都有自己独特的结构。所有资源的抓取方法都是相同的，尽管有些资源需要单独的数据提取方法。</p><p id="a8e8" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们感谢您的反馈和意见。</p><p id="f664" class="pw-post-body-paragraph jg jh hu ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">刮的开心！</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ou ov l"/></div></figure></div></div>    
</body>
</html>