<html>
<head>
<title>I built an app to rig the chances of me getting a date.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我开发了一个应用程序来操纵我约会的机会。</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-geographically-aware-location-based-android-dating-app-c1aaa26f2f60#2019-04-17">https://medium.com/hackernoon/how-to-build-a-geographically-aware-location-based-android-dating-app-c1aaa26f2f60#2019-04-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4606" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着超过三分之一的人选择在网上建立有意义的关系，像 Tinder 和 Bumble 这样以即时满足为导向的约会应用蓬勃发展也是理所当然的。这让我开始思考——从头开始开发一个<a class="ae jp" href="https://www.pubnub.com/solutions/chat/dating-apps/" rel="noopener ugc nofollow" target="_blank">地理感知移动约会应用</a>有多难？事实证明，有了微服务和无服务器设计模式，在实时网络的支持下，这并不困难。</p><p id="f54a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在本教程中，我们将涵盖构建一个移动的、地理感知的约会应用程序的两个非常重要的部分——地理定位和滑动。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff jq"><img src="../Images/dba28ec67766b2ce9aec0745973f6017.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*x8kFRAky5pxuobTH.gif"/></div></figure><p id="4f86" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为制作这个向<a class="ae jp" href="http://danmeth.tumblr.com/post/119457060107/the-sexy-new-social-app-for-bearded-guys" rel="noopener ugc nofollow" target="_blank">丹</a>大喊！</p><h1 id="b421" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">约会应用的微服务架构</h1><p id="ecb8" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">让我们来看看我们的应用程序的流程，并对我们将要构建的内容做一个快速的概述。直截了当地说，当我说<strong class="it hv">用户</strong>时，我指的是打开<a class="ae jp" href="https://hackernoon.com/tagged/android" rel="noopener ugc nofollow" target="_blank"> Android </a>应用程序的人，当我说<strong class="it hv">合作伙伴</strong>时，我指的是打开应用程序的所有其他用户。</p><p id="ec74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们知道我们需要找到除用户之外的每一个合作伙伴，我们还需要知道他们的<a class="ae jp" href="https://hackernoon.com/tagged/location" rel="noopener ugc nofollow" target="_blank">位置</a>。这意味着每个设备都需要共享一个唯一的 ID 和它们的位置。接下来，我们需要每个设备能够检查彼此的设备，同时还可以将它们自己添加到列表中或更新它们的当前位置。一旦用户将自己添加到伙伴列表中，我们可以从列表中选择其他用户，并检查他们与当前用户的距离。</p><p id="3ed3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着我们可以将整个系统分成三个部分:</p><h1 id="ec06" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">Android 应用程序</h1><p id="562a" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">实际的 Android 应用程序发送自己的唯一 id 和位置，并接收其他用户的 ID 和位置。</p><h1 id="aaed" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">保存并过滤</h1><p id="303b" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">这个部分从 Android 应用程序获取数据，并返回每个用户的位置和唯一 id，而不是调用该服务的用户。</p><h1 id="161a" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">计算距离</h1><p id="64ba" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">这将一个用户的位置和另一个用户的位置结合起来，并返回距离。这涉及到一些数学问题，因为我们将计算两个纬度和经度距离之间的距离。该服务将返回唯一用户和距离。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lb"><img src="../Images/9c3e1e797a6c66169c1d7092ca61b9f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BCdOSwQ0XEdoOYxp.png"/></div></div></figure><h1 id="cfd0" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">创建微服务</h1><p id="5c57" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">为了让事情变得简单高效，我们需要找到一个提供商来运行我们的微服务。为此，我们将使用 PubNub 函数。</p><p id="1c11" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您首先必须使用下面的嵌入表单注册一个帐户。之后，前往<a class="ae jp" href="https://admin.pubnub.com/" rel="noopener ugc nofollow" target="_blank">管理仪表板</a>并启用功能特性。</p><p id="7847" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将让我们在 PubNub 上构建出<strong class="it hv">保存和过滤</strong>功能，以及<strong class="it hv">计算距离</strong>微服务，并为我们提供我们想要的实时、可扩展的体验。</p><h1 id="5387" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">实时保存和过滤用户</h1><p id="545c" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">我们的客户端应用程序会将当前用户的 ID 和位置发布到一个无服务器的 PubNub 函数，该函数会将位置保存到一个名为<a class="ae jp" href="https://www.pubnub.com/docs/blocks/tutorials/kv-store" rel="noopener ugc nofollow" target="_blank"> PubNub KV Store </a>的键集范围的持久性存储中。</p><p id="2357" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从那里，我们的第一个函数将对照 KV Store 中的每一项检查当前 ID，并将其添加到用户列表中。一旦我们有了完整的列表，我们将使用 ID 将该消息发布回设备独有的通道。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="5de8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="li">注意:PubNub 函数允许每个函数</em>  <em class="li">调用最多 3 个请求。</em></p><h1 id="01c1" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">实时计算距离</h1><p id="80a2" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">我们将以数组的形式获取数据。数组的前两个元素是用户的 id，最后两个元素是发起请求的用户的位置。第一个元素是发起者的 ID，第二个元素是可能的刷卡候选项。一旦我们完成计算，我们将发送唯一用户的 ID 和他们离启动器的距离。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="dcee" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该函数的结果如下所示:</p><pre class="jr js jt ju fq lj lk ll lm aw ln dt"><span id="118e" class="lo jz hu lk b fv lp lq l lr ls">{ "ID": "Unique User ID", "distance": 5 }</span></pre><h1 id="f6c4" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">如何在安卓应用上刷用户</h1><p id="1714" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">首先，创建一个空的 Android Studio 项目，并选中 Kotlin 支持。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="fe ff lt"><img src="../Images/501cafe540b3ff5bc776969b2eefcd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hoYMJxzRTsR2fvdZ.png"/></div></div></figure><p id="32ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，看看我们要添加到应用程序级 Gradle 文件中的依赖项，以确保我们的应用程序运行顺畅。</p><p id="8781" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">第一个依赖项是<strong class="it hv"> PubNub SDK </strong>，它将帮助我们发布和订阅我们刚刚创建的逻辑。与 PubNub SDK 相关，我们还需要发布键和订阅键。您可以通过下面的快速设置获得发布和订阅密钥。</p><p id="d951" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">其他需要依赖的是我们应用程序的视觉组件——滑动功能。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><h1 id="88e1" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">创建用户界面</h1><p id="245b" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">首先，我们将调整我们的 activity_main.xml 以适应我们的滑动特性，该特性将在我们的<code class="eh lu lv lw lk b">MainActivity.kt</code>文件中初始化。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="a2cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将创建每个个人资料卡的 UI，以及每个卡片上的覆盖图，同时考虑用户是向左还是向右滑动。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="1874" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这就是 UI，现在让我们来看看后端。</p><h1 id="1dd9" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">集成应用程序逻辑</h1><p id="3b0f" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">为了完成我们的应用程序，我们将创建四个单独的文件。我们需要的第一个文件是一个类，它将作为每个概要文件的对象，并包含相关的信息。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="76cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们将创建一个文件，其中包含一些帮助函数来更新我们的配置文件集合。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="2f6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，我们可以将每个概要文件加载到前端。我们将在一个名为<code class="eh lu lv lw lk b">CardStackAdapter</code>的类中做这件事。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><h1 id="6b82" class="jy jz hu bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv dt translated">将一切缝合在一起</h1><p id="0942" class="pw-post-body-paragraph ir is hu it b iu kw iw ix iy kx ja jb jc ky je jf jg kz ji jj jk la jm jn jo hn dt translated">我们可以去查看<code class="eh lu lv lw lk b">MainActivity.kt</code>文件，看看所有的东西是如何组合在一起的。</p><p id="4557" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们快速看一下 onCreate 和 onStart 方法。</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="23f3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们可以把所有发生的事情分解成三件事。</p><p id="836d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们将利用<a class="ae jp" href="https://developers.google.com/location-context/fused-location-provider/" rel="noopener ugc nofollow" target="_blank">得到设备的位置<strong class="it hv">融合到</strong>的位置</a>。接下来，我们将订阅与我们的设备 ID 同名的频道，因为我们可以滑动的所有可能的人都发布到该频道。最后，在<strong class="it hv"> onStart </strong>中，我们将发布与设备相关的日期，就像 ID 和位置一样。我们在 onStart 和<strong class="it hv">而不是</strong>onCreate 中发布的原因是，在活动开始之前，我们无法获得所有需要发布的信息。</p><p id="d775" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这样，让我们在 MainActivity 中添加所有功能并使用您的 pub/sub 键(它们在您的<a class="ae jp" href="https://admin.pubnub.com/" rel="noopener ugc nofollow" target="_blank">管理仪表板</a>中)。最后，我们的文件将如下所示:</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="lg lh l"/></div></figure><p id="bef0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们运行应用程序吧！在模拟器或设备上，你可以看到滑动功能，以及用户与你的距离。</p><p id="7fae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">干得好！想探索更多关于移动约会应用的功能和想法吗？查看我们的<a class="ae jp" href="https://www.pubnub.com/solutions/chat/dating-apps/" rel="noopener ugc nofollow" target="_blank">实时约会应用概述</a>，了解如何利用 PubNub 的聊天 API 和消息基础设施在全球范围内支持跨平台、快速、安全的约会应用。</p></div><div class="ab cl lx ly hc lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hn ho hp hq hr"><p id="f5a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="li">原载于</em><a class="ae jp" href="https://www.pubnub.com/blog/how-to-build-a-location-based-dating-app-in-android/" rel="noopener ugc nofollow" target="_blank"><em class="li">www.pubnub.com</em></a><em class="li">。</em></p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="me lh l"/></div></figure></div></div>    
</body>
</html>