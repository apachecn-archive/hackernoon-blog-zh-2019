<html>
<head>
<title>Lazy keyword in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的懒惰关键字</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/lazy-keyword-in-swift-the-very-basic-d51400f36fa4?source=collection_archive---------5-----------------------#2019-03-22">https://medium.com/hackernoon/lazy-keyword-in-swift-the-very-basic-d51400f36fa4?source=collection_archive---------5-----------------------#2019-03-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/53e13db06274dceea2e080e3f37e9ac2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*zZOYTP1rcDSNiN0UK2-2-w.jpeg"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Pic Credits : <a class="ae jc" href="http://www.infoworld.com" rel="noopener ugc nofollow" target="_blank">www.infoworld.com</a></figcaption></figure><p id="02ae" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">从我在iOS开发生涯中第一次遇到<em class="kb"> lazy关键字和lazy初始化开始，我就对这个概念有点兴趣。我从一开始就不明白为什么我们要首先使用lazy关键字，因为它所做的只是，某种程度上，推迟你的对象/变量或者你声明的任何lazy的初始化，直到它被第一次调用。</em></p><p id="73d0" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated"><em class="kb">出自</em> <a class="ae jc" href="https://swift.org/documentation/" rel="noopener ugc nofollow" target="_blank"> <em class="kb">雨燕文档</em> </a> <em class="kb"> : </em></p><blockquote class="kc kd ke"><p id="0fdf" class="jd je kb jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hn dt translated"><em class="hu">惰性存储属性</em>是直到第一次使用时才计算初始值的属性</p></blockquote><p id="00fc" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">好吧好吧。你一定在过去读过<em class="kb">这句话很多次，并且仍然在疑惑“是的，我明白了。但是对于懒惰关键字"</em>来说，什么是理想的情况呢</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="df1b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">让我从一个例子开始:</p><p id="2e38" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">考虑这样一个场景，我们有一辆车，我们可以开着它到处跑。) .无论是在度假、日常工作、杂货店，还是我无意中听到有人谈论的新俱乐部！还有，让我们假设随着技术的快速提升，每辆车都有内置GPS(虽然，不是每辆车都有，只是假设)。</p><figure class="kp kq kr ks fq iv"><div class="bz el l di"><div class="kt ku l"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Without lazy keyword</figcaption></figure><p id="e658" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们的模型非常简单，GPS和Car都有两个类。因为我们已经假设每辆车都有内置GPS，所以类<strong class="jf hv"> Car </strong>有一个属性<strong class="jf hv"> gps </strong>。</p><p id="abf6" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">现在，我们一到达那条线:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="438c" class="la lb hu kw b fv lc ld l le lf">let myVeryExpensiveCar = Car()</span></pre><p id="f2bf" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们将在控制台上看到以下输出:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="d1ed" class="la lb hu kw b fv lc ld l le lf"><strong class="kw hv">GPS Initialized</strong></span><span id="602e" class="la lb hu kw b fv lg ld l le lf"><strong class="kw hv">Car Initalized</strong></span></pre><p id="c3c0" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">…老实说，这不是火箭科学！</p><p id="6923" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">它描述的是，即使我们只创建了汽车对象，GPS也用它初始化。</p><p id="04a3" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">比方说，我们每天都要去上班，每周都要去当地的杂货店，经常去祖父母家。在所有这些情况下，我们<strong class="jf hv"> <em class="kb">不需要GPS </em> </strong>因为我们记住了路线，甚至是到达那里的备用路线，但是使用上面的代码，即使我们不需要它，我们仍然会将内存分配给GPS变量。作为程序员，我们知道内存的价值</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff lh"><img src="../Images/5f060d92b694a46b3d8cb7bcb76ead64.png" data-original-src="https://miro.medium.com/v2/resize:fit:670/format:webp/1*qXJkD-3MG8ZyAR3s4JNswg.jpeg"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Pic Credits: memegenerator.net</figcaption></figure><p id="b881" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这就是<strong class="jf hv"> <em class="kb">懒</em> </strong>的由来。它所做的是，直到它第一次被调用时才会被分配内存。要使一个属性懒惰，只需将lazy关键字放在该属性的var声明之前(是的，你没看错，var，<strong class="jf hv">没有让</strong>因为它的初始值可能直到实例初始化完成后才能被检索)</p><figure class="kp kq kr ks fq iv"><div class="bz el l di"><div class="kt ku l"/></div></figure><p id="b0d7" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">现在，输出将是:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="c48b" class="la lb hu kw b fv lc ld l le lf"><strong class="kw hv">Car Initalized</strong></span></pre><p id="1832" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">看，GPS没有初始化，即使我们的车已经启动并运行。现在，只要我们尝试访问myVeryExpensiveCar实例的<strong class="jf hv"> <em class="kb"> gps </em> </strong>属性:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="9853" class="la lb hu kw b fv lc ld l le lf">myVeryExpensiveCar.gps</span></pre><p id="f901" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">并再次在操场上点击run，我们会看到控制台中添加了以下内容:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="c314" class="la lb hu kw b fv lc ld l le lf"><strong class="kw hv">GPS Initialized</strong></span></pre><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff li"><img src="../Images/3ef490895816b480bcc0bd9d66a2d8aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*S_OZ_qFUzFB2KxkZXJK6xQ.jpeg"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Pic Credits: makeameme.org</figcaption></figure><p id="93c2" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">编译器一看到<strong class="jf hv"> <em class="kb"> lazy </em> </strong>关键字，就跳过初始化，不给那个变量分配内存。但是，当我们第一次尝试访问同一个变量的时候，它就被分配了内存，之后，它就可以作为普通变量使用了。</p></div><div class="ab cl ki kj hc kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="hn ho hp hq hr"><p id="8d10" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">现在你可能会想，如果<code class="eh lj lk ll kw b">lazy</code>很好，为什么我们不把所有的变量都默认为<code class="eh lj lk ll kw b">lazy</code>？我现在能想到的原因有两个</p><ol class=""><li id="31a1" class="lm ln hu jf b jg jh jk jl jo lo js lp jw lq ka lr ls lt lu dt translated"><code class="eh lj lk ll kw b">lazy</code>变量总是被声明为<code class="eh lj lk ll kw b">var</code>，所以<strong class="jf hv">永远不能创建不可变的变量</strong>。</li><li id="1677" class="lm ln hu jf b jg lv jk lw jo lx js ly jw lz ka lr ls lt lu dt translated"><code class="eh lj lk ll kw b">lazy</code>T14的内部需要一个分支，来检查<em class="kb">是否已经有值</em>，或者第一次<em class="kb">时</em>是否需要计算一个，这增加了开销，从而超过了<code class="eh lj lk ll kw b">lazy</code>的好处。让我解释一下这个</li></ol><p id="37c1" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">一个简单惰性变量声明如下所示:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="92cb" class="la lb hu kw b fv lc ld l le lf">lazy var someValue = 10</span></pre><p id="fc2c" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">然而，它的工作原理是这样的:</p><pre class="kp kq kr ks fq kv kw kx ky aw kz dt"><span id="ff6a" class="la lb hu kw b fv lc ld l le lf">var _someValue: Int? = nil</span><span id="d895" class="la lb hu kw b fv lg ld l le lf">var someValue: Int {</span><span id="79c0" class="la lb hu kw b fv lg ld l le lf">mutating get {</span><span id="4b78" class="la lb hu kw b fv lg ld l le lf">// When we are NOT accessing the value for fist time<br/>if let someValueUnwrapped = _someValue { <br/>      return someValueUnwrapped<br/>}</span><span id="6d46" class="la lb hu kw b fv lg ld l le lf">// When we are accessing the value for first time<br/>else { <br/>    let newValue = 10<br/>    _someValue = newValue<br/>    return newValue<br/>  }<br/> }</span><span id="e9c9" class="la lb hu kw b fv lg ld l le lf">}</span></pre><p id="6832" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这个<code class="eh lj lk ll kw b">if-else</code>就是我说的分支，增加了开销。</p><figure class="kp kq kr ks fq iv fe ff paragraph-image"><div class="fe ff ma"><img src="../Images/b289e201401e287aa2170b052e605caf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*pLXCwUyIgWVmcFDGIeRwOQ.gif"/></div></figure><p id="760e" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">最后，百万美元的问题，什么时候真正的编程世界需要<code class="eh lj lk ll kw b">lazy</code>变量？</p><blockquote class="kc kd ke"><p id="b511" class="jd je kb jf b jg jh ji jj jk jl jm jn kf jp jq jr kg jt ju jv kh jx jy jz ka hn dt translated">当属性的初始值需要复杂的计算时，它们很有用，除非真正需要，否则不应该执行复杂的计算。(就像我们的GPS一样，你知道GPS需要多复杂的计算，我也不知道😅)</p></blockquote><p id="6281" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">你可以在LinkedIn上和我联系👱🏻或者可以通过<a class="ae jc" href="https://about.me/shubhambakshi" rel="noopener ugc nofollow" target="_blank">其他渠道</a>与我联系📬</p></div></div>    
</body>
</html>