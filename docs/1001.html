<html>
<head>
<title>Django Authentication — Login, Logout and Password Change/Reset</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 认证—登录、注销和密码更改/重置</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/django-authentication-login-logout-and-password-change-reset-a5f3d9313cd5#2019-02-10">https://medium.com/hackernoon/django-authentication-login-logout-and-password-change-reset-a5f3d9313cd5#2019-02-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/580fc3aba149db07533bd942c7de4c4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bNqHgR4j_iFK-inLkoC9wg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@casparrubin?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Caspar Camille Rubin</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0b4e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在本教程中，您将学习如何轻松地为 Django 应用程序添加一个完整的身份验证系统，包括登录、注销、密码更改和重置功能。</p><p id="f534" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还将使用<code class="eh kf kg kh ki b">django-crispy-forms</code>和 Bootstrap 4 来设计应用程序 UI。</p><h1 id="21d8" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">先决条件</h1><p id="97ec" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">让我们从本教程的先决条件开始。为了一步一步地遵循教程，您需要一些要求，例如:</p><ul class=""><li id="6813" class="lm ln hu jj b jk jl jo jp js lo jw lp ka lq ke lr ls lt lu dt translated">Python 的基础知识，</li><li id="3811" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">姜戈(<code class="eh kf kg kh ki b">django-admin.py</code>和<code class="eh kf kg kh ki b">manage.py</code>)的工作知识，</li><li id="197a" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">安装在您系统上的 Python 3 的最新版本(最新版本是<strong class="jj hv"> 3.7 </strong></li></ul><p id="534a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将使用<code class="eh kf kg kh ki b">pip</code>和<code class="eh kf kg kh ki b">venv</code>，它们在 Python 的最新版本中被打包成模块，所以你实际上不需要安装它们，除非你使用的是旧版本。</p><p id="fc80" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你准备好了，让我们开始吧！</p><h1 id="09bf" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">创建虚拟环境</h1><p id="9b4f" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">虚拟环境允许您将当前的项目依赖项与全局安装在您的系统或其他虚拟环境中的其余包隔离开来。您可以使用需要安装在您的系统上的<code class="eh kf kg kh ki b">virtualenv</code>,也可以使用在 Python 3 的最新版本中作为模块提供的<code class="eh kf kg kh ki b">venv</code>模块。</p><p id="85dc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">转到您的命令终端并运行:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="3148" class="mi kk hu ki b fv mj mk l ml mm">$ python -m venv env</span></pre><p id="6de3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，使用以下方法激活虚拟环境:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="8ef1" class="mi kk hu ki b fv mj mk l ml mm">$ source env/bin/activate</span></pre><blockquote class="mn mo mp"><p id="86f9" class="jh ji mq jj b jk jl jm jn jo jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd ke hn dt translated"><strong class="jj hv"> <em class="hu">注意</em> </strong> <em class="hu">:请注意，在 Windows 上，您需要使用</em> <code class="eh kf kg kh ki b"><em class="hu">source env/Scripts/activate</em></code> <em class="hu">才能激活您的虚拟环境。</em></p></blockquote><p id="d6e1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">激活环境后，您需要使用<code class="eh kf kg kh ki b">pip</code>安装 Django:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="3e85" class="mi kk hu ki b fv mj mk l ml mm">$ pip install django</span></pre><p id="3c4d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果框架安装成功，您现在可以使用 Django 管理命令来创建和使用您的项目。</p><h1 id="6240" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">创建 Django 项目</h1><p id="d7c5" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">现在让我们使用<code class="eh kf kg kh ki b">django-admin.py</code>创建项目。在您的终端中，运行以下命令:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="33e4" class="mi kk hu ki b fv mj mk l ml mm">$ django-admin.py startproject demoproject</span></pre><p id="f994" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Django 有一个 ORM，它抽象了 dircet 数据库操作并支持 SQLite，这是在项目中默认配置的，所以我们将在本教程中使用 SQLite 数据库。</p><p id="0e53" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您需要使用 PostgreSQL、MySQL 或任何其他数据库管理系统，您必须首先安装它，然后打开项目的<code class="eh kf kg kh ki b">settings.py</code>，并在<code class="eh kf kg kh ki b">DATABASES</code>对象中添加数据库地址和凭证。</p><p id="cb2d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">以下是<code class="eh kf kg kh ki b">sqlite</code>的默认配置:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="afca" class="mi kk hu ki b fv mj mk l ml mm">DATABASES = {<br/>    'default': {<br/>    'ENGINE': 'django.db.backends.sqlite3',<br/>    'NAME': os.path.join(BASE_DIR, 'db.sqlite3'),<br/>    }<br/>}</span></pre><h1 id="61f9" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">添加<code class="eh kf kg kh ki b">django-crispy-forms</code></h1><p id="b714" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">我们将使用 Bootstrap 4 来设计认证表单，所以您需要使用<code class="eh kf kg kh ki b">pip</code>来安装它:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="e505" class="mi kk hu ki b fv mj mk l ml mm">$ pip install django-crispy-forms</span></pre><p id="c3f2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，打开<code class="eh kf kg kh ki b">settings.py</code>文件，将应用程序添加到已安装的应用程序中:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="2182" class="mi kk hu ki b fv mj mk l ml mm">INSTALLED_APPS = [<br/>    # [...]<br/>    'crispy_forms'<br/>]</span></pre><p id="2996" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，添加以下设置，将 Bootstrap 4 设置为<code class="eh kf kg kh ki b">django-crispy-forms</code>的默认样式框架:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="aa53" class="mi kk hu ki b fv mj mk l ml mm">CRISPY_TEMPLATE_PACK = 'bootstrap4'</span></pre><h1 id="ce34" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">创建<code class="eh kf kg kh ki b">accounts</code>应用程序</h1><p id="15ce" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">应用程序是 Django 组织项目的方式。把它们想象成模块。</p><p id="6d9e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">让我们将项目中所需的认证逻辑封装到一个<code class="eh kf kg kh ki b">accounts</code>应用程序中。很明显，您可以使用任何您认为合适的有效名称。</p><p id="8600" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">转到您的终端，在您的项目文件夹中导航(如果您尚未这样做):</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="1835" class="mi kk hu ki b fv mj mk l ml mm">$ cd demoproject</span></pre><p id="aa48" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，使用<code class="eh kf kg kh ki b">manage.py</code>创建应用程序:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="e105" class="mi kk hu ki b fv mj mk l ml mm">$ python manage.py startapp accounts</span></pre><p id="6844" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh kf kg kh ki b">manage.py</code>是 Django 的另一个管理脚本，存在于根项目的文件夹中。它为最常用的 Django 管理命令提供了一个很好的包装。</p><p id="286d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">前面的命令将创建一个具有默认文件结构的 Django 应用程序。要使这个应用程序成为您项目的一部分，您需要打开<code class="eh kf kg kh ki b">settings.py</code>文件并将其添加到<code class="eh kf kg kh ki b">INSTALLED_APPS</code>数组:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="f9e3" class="mi kk hu ki b fv mj mk l ml mm">INSTALLED_APPS = [<br/># [...]<br/>'accounts'<br/>]</span></pre><p id="5dbc" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">就这样，现在您可以使用以下命令创建您的数据库并运行您的 Django 开发服务器了:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="23b6" class="mi kk hu ki b fv mj mk l ml mm">$ python manage.py migrate <br/>$ python manage.py runserver</span></pre><p id="f259" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您可以使用浏览器导航到<code class="eh kf kg kh ki b">localhost:8000</code>地址，查看您的 web 应用程序是否启动并运行。</p><h1 id="79cf" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated"><code class="eh kf kg kh ki b">auth</code>内置应用程序</h1><p id="74ab" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated"><code class="eh kf kg kh ki b">auth</code>应用程序是 Django 中的一个内置认证系统，允许开发人员将认证添加到他们的应用程序中，而无需从头开始重新发明轮子来实现基本功能。</p><p id="24e6" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Django 认证应用程序提供了以下现成的功能:</p><ul class=""><li id="7b29" class="lm ln hu jj b jk jl jo jp js lo jw lp ka lq ke lr ls lt lu dt translated">通过<code class="eh kf kg kh ki b">LoginView</code>类视图登录，</li><li id="f89d" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">通过<code class="eh kf kg kh ki b">LogoutView</code>类视图注销，</li><li id="5c66" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">通过<code class="eh kf kg kh ki b">PasswordResetView</code>类视图重置密码，</li><li id="9fce" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated">通过<code class="eh kf kg kh ki b">PasswordChangeView</code>类视图修改密码，</li></ul><p id="2577" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您只需要提供模板来在您的应用程序中实现这些功能。</p><p id="1a5c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于注册用户，您需要创建您的视图和模板。</p><p id="c611" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你需要在<code class="eh kf kg kh ki b">settings.py</code>文件的<code class="eh kf kg kh ki b">INSTALLED_APPS</code>中有<code class="eh kf kg kh ki b">django.contrib.auth</code> app，这是默认情况。</p><p id="6c83" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来在您的<code class="eh kf kg kh ki b">accounts</code>应用程序中创建<code class="eh kf kg kh ki b">urls.py</code>文件，并添加以下代码:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="b8a7" class="mi kk hu ki b fv mj mk l ml mm">from django.contrib.auth import views<br/>from django.urls import path</span><span id="05df" class="mi kk hu ki b fv mu mk l ml mm">urlpatterns = [<br/>]</span></pre><h1 id="143f" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">使用<code class="eh kf kg kh ki b">LoginView</code>登录用户</h1><p id="6b11" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您可以使用<code class="eh kf kg kh ki b">LoginView</code>基于类的视图在 Django 应用程序中登录用户。在您的<code class="eh kf kg kh ki b">accounts/urls.py</code>文件中添加以下路径:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="fd3b" class="mi kk hu ki b fv mj mk l ml mm">urlpatterns = [<br/>    path('login/', views.LoginView.as_view(), name='login'),</span></pre><p id="2ad3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您只需使用<code class="eh kf kg kh ki b">LoginView</code>的<code class="eh kf kg kh ki b">as_view()</code>方法返回一个回调对象，该对象可以作为视图函数分配给<code class="eh kf kg kh ki b">path()</code>函数。</p><p id="6082" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，您需要为您的登录视图提供一个模板。在您的<code class="eh kf kg kh ki b">accounts</code>应用程序的根目录下创建一个<code class="eh kf kg kh ki b">templates</code>文件夹，并使用以下代码添加一个<code class="eh kf kg kh ki b">base.html</code>文件:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="3cc4" class="mi kk hu ki b fv mj mk l ml mm">&lt;!doctype  html&gt;<br/>&lt;html  lang="en"&gt;<br/>&lt;head&gt;<br/>&lt;link  rel="stylesheet"  href="<a class="ae jg" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="noopener ugc nofollow" target="_blank">https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css</a>"  integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"  crossorigin="anonymous"&gt;<br/>&lt;title&gt;Django Authentication Example&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>  &lt;div  class="container"&gt;<br/>    &lt;div  class="row justify-content-center"&gt;<br/>      &lt;div  class="col-4"&gt;<br/>      &lt;h1  class="text-center"&gt;Django Authentication Example&lt;/h1&gt;<br/>      {% block main %}<br/>      {% endblock %}<br/>      &lt;/div&gt;<br/>    &lt;/div&gt;<br/>  &lt;/div&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="c94f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们首先在基本 HTML 模板中导入 Bootstrap 4。然后我们创建一个容器<code class="eh kf kg kh ki b">&lt;div&gt;</code>一个标题和一个<code class="eh kf kg kh ki b">main</code>块，Django 在其中呈现模板的其他部分。</p><p id="e976" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，用下面的代码创建一个<code class="eh kf kg kh ki b">templates/registration</code>文件夹和<code class="eh kf kg kh ki b">login.html</code>模板:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="0b16" class="mi kk hu ki b fv mj mk l ml mm">{% extends  'base.html' %}<br/>{% load crispy_forms_tags %}</span><span id="4d57" class="mi kk hu ki b fv mu mk l ml mm">{% block main %}<br/>&lt;div class="card"&gt;<br/>&lt;div class="card-body"&gt;<br/>&lt;h4 class="card-title"&gt;Log in to your account&lt;/h4&gt;</span><span id="06a1" class="mi kk hu ki b fv mu mk l ml mm">&lt;form method="post"&gt;<br/>{% csrf_token %}<br/>&lt;input type="hidden" name="next" value="{{ next }}"&gt;</span><span id="dc88" class="mi kk hu ki b fv mu mk l ml mm">{{ form|crispy }}</span><span id="fcb1" class="mi kk hu ki b fv mu mk l ml mm">&lt;button type="submit" class="btn btn-primary btn-block"&gt;Log in&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="5e57" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们扩展前面的基本模板，加载<code class="eh kf kg kh ki b">crispy_forms_tags</code>，然后覆盖<code class="eh kf kg kh ki b">main</code>块来添加我们的登录表单。</p><p id="a521" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，我们用 POST 方法创建一个 HTML 表单，并使用“<code class="eh kf kg kh ki b">. The</code>crisp”过滤器呈现表单字段，将引导样式应用于各个字段。</p><p id="67b2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh kf kg kh ki b">csrf_token</code>将 CSRF 保护字段添加到我们的登录表单。</p><p id="5de3" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还添加了一个隐藏的表单字段，用于保存 Django 在用户成功登录后将用户重定向到下一个页面的下一个 URL。默认情况下，它会重定向<code class="eh kf kg kh ki b">accounts/profile</code> URL。</p><h1 id="79e1" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">设置登录重定向 URL</h1><p id="d273" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您可以通过<code class="eh kf kg kh ki b">LOGIN_REDIRECT_URL</code>设置来设置下一个 URL 或登录重定向 URL。打开<code class="eh kf kg kh ki b">settings.py</code>文件并添加:</p><p id="cd5b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了测试登录视图，您可以从终端使用<code class="eh kf kg kh ki b">manage.py createsuperuser</code>命令创建一个用户。</p><blockquote class="mn mo mp"><p id="061b" class="jh ji mq jj b jk jl jm jn jo jp jq jr mr jt ju jv ms jx jy jz mt kb kc kd ke hn dt translated"><strong class="jj hv"> <em class="hu">注意</em> </strong> <em class="hu">:登录后会被重定向到</em> <code class="eh kf kg kh ki b"><em class="hu">/accounts/profile</em></code> <em class="hu">网址。</em></p></blockquote><p id="3567" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是用 Bootstrap 4 设计的登录表单的屏幕截图:</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/335407c48a42f5c3ffadd415c7d8c9e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1318/format:webp/0*Iw7rT1Hk-1HV3BIm.png"/></div></figure><h1 id="3890" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">使用<code class="eh kf kg kh ki b">LogoutView</code>注销用户</h1><p id="582a" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您可以使用<code class="eh kf kg kh ki b">LogoutView</code>基于类的视图注销应用程序中的用户。在您的<code class="eh kf kg kh ki b">accounts.py</code>文件中，添加<code class="eh kf kg kh ki b">/logout</code>路径，并将其与<code class="eh kf kg kh ki b">LogoutView</code>的可调用视图链接起来:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="3e11" class="mi kk hu ki b fv mj mk l ml mm">path('logout/', views.LogoutView.as_view(), name='logout'),</span></pre><p id="1eae" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们再次使用<code class="eh kf kg kh ki b">as_view()</code>方法从<code class="eh kf kg kh ki b">LogoutView</code>类返回一个可调用的对象。</p><p id="a17e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，您需要用下面的代码创建一个<code class="eh kf kg kh ki b">registration/logged_out.html</code>:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="d0b5" class="mi kk hu ki b fv mj mk l ml mm">{% extends 'base.html' %}<br/>{% block main %}</span><span id="93f5" class="mi kk hu ki b fv mu mk l ml mm">&lt;p&gt;You are logged out!&lt;/p&gt;<br/>&lt;a  href="{% url 'login' %}"&gt;Log in again&lt;/a&gt;</span><span id="18ff" class="mi kk hu ki b fv mu mk l ml mm">{% endblock %}</span></pre><p id="e6d5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是注销完成视图的屏幕截图:</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/9fcba4231e5fd8032bd3b679c2d96fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/0*riARWjCpv3AHNc2k.png"/></div></figure><h1 id="f7b6" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">使用<code class="eh kf kg kh ki b">PasswordResetView</code>、<code class="eh kf kg kh ki b">PasswordResetDoneView</code>、<code class="eh kf kg kh ki b">PasswordResetConfirmView</code>和<code class="eh kf kg kh ki b">PasswordResetCompleteView</code>重置密码</h1><p id="ccc9" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您可以让用户使用多种视图重置密码:</p><ul class=""><li id="bf72" class="lm ln hu jj b jk jl jo jp js lo jw lp ka lq ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">PasswordResetView</code>，</li><li id="72ab" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">PasswordResetDoneView</code>，</li><li id="0e78" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">PasswordResetConfirmView</code></li><li id="1663" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">PasswordResetCompleteView</code></li></ul><p id="670f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在您的<code class="eh kf kg kh ki b">accounts/urls.py</code>文件中，添加以下路径:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="d3f7" class="mi kk hu ki b fv mj mk l ml mm">path('password-reset/', views.PasswordResetView.as_view(), name='password_reset'),<br/>path('password-reset/done/', views.PasswordResetDoneView.as_view(), name='password_reset_done'),<br/>path('reset/&lt;uidb64&gt;/&lt;token&gt;/', views.PasswordResetConfirmView.as_view(), name='password_reset_confirm'),<br/>path('reset/done/', views.PasswordResetCompleteView.as_view(), name='password_reset_complete'),</span></pre><p id="37a0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，您需要用下面的代码添加一个<code class="eh kf kg kh ki b">registration/password_reset_form.html</code>模板:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="5f98" class="mi kk hu ki b fv mj mk l ml mm">{% extends 'base.html' %}<br/>{% load crispy_forms_tags %}</span><span id="796a" class="mi kk hu ki b fv mu mk l ml mm">{% block main %}<br/>&lt;div  class="card"&gt;<br/>&lt;div  class="card-body"&gt;<br/>&lt;h4  class="card-title"&gt;Reset your password&lt;/h4&gt;<br/>&lt;form  method="post"&gt;<br/>{% csrf_token %}<br/>&lt;input  type="hidden"  name="next"  value="{{ next }}"&gt;<br/>{{ form|crispy }}</span><span id="b0af" class="mi kk hu ki b fv mu mk l ml mm">&lt;button  type="submit"  class="btn btn-primary btn-block"&gt;Reset&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="a101" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">同样的，你需要添加<code class="eh kf kg kh ki b">password_reset_confirm.html</code>、<code class="eh kf kg kh ki b">password_reset_done.html</code>、<code class="eh kf kg kh ki b">password_reset_email.html</code>和<code class="eh kf kg kh ki b">password_reset_complete.html</code>模板。</p><p id="395c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是使用 Bootstrap 4 设计的密码重置表单的屏幕截图:</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff mx"><img src="../Images/fe796c352f73eccaf07538a650b31f4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/0*O9podPXC4RA2pgck.png"/></div></figure><h1 id="3a1f" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">使用<code class="eh kf kg kh ki b">PasswordChangeView</code>和<code class="eh kf kg kh ki b">PasswordChangeDoneView</code>更改密码</h1><p id="3107" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您可以让您的用户通过<code class="eh kf kg kh ki b">PasswordChangeView</code>和<code class="eh kf kg kh ki b">PasswordChangeDoneView</code>基于类的视图更改他们的密码。</p><p id="1ad4" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在您的<code class="eh kf kg kh ki b">accounts/urls.py</code>文件中，添加以下路径:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="614f" class="mi kk hu ki b fv mj mk l ml mm">path('password-change/', views.PasswordChangeView.as_view(), name='password_change'),<br/>path('password-change/done/', views.PasswordChangeDoneView.as_view(), name='password_change_done'),</span></pre><p id="c6ad" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来创建一个<code class="eh kf kg kh ki b">registration/password_change_form.html</code>模板并添加以下代码:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="b320" class="mi kk hu ki b fv mj mk l ml mm">{% extends 'base.html' %}<br/>{% load crispy_forms_tags %}</span><span id="068e" class="mi kk hu ki b fv mu mk l ml mm">{% block main %}<br/>&lt;div  class="card"&gt;<br/>&lt;div  class="card-body"&gt;<br/>&lt;h4  class="card-title"&gt; Change your password&lt;/h4&gt;</span><span id="4e53" class="mi kk hu ki b fv mu mk l ml mm">&lt;form  method="post"&gt;<br/>{% csrf_token %}<br/>{{ form|crispy }}</span><span id="1959" class="mi kk hu ki b fv mu mk l ml mm">&lt;button  type="submit"  class="btn btn-success"&gt;Change password &lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;/div&gt;<br/>&lt;/div&gt;<br/>{% endblock %}</span></pre><p id="0ed1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">还需要添加<code class="eh kf kg kh ki b">password_change_done.html</code>模板。</p><p id="1baa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是密码更改表单的屏幕截图:</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div class="fe ff my"><img src="../Images/b19357d44d62afd2506079bc82698be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1160/format:webp/0*1ZWiH7zlCVWpQZrs.png"/></div></figure><h1 id="a309" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">注册用户</h1><p id="8d82" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">对于注册用户，Django 内置的 auth 应用程序不提供 ready view 函数或基于类的视图，因此您需要提供自己的自定义实现。</p><h1 id="6b5d" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">导入项目中的 URL<code class="eh kf kg kh ki b">urls.py</code></h1><p id="20de" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">您已经在 accounts 应用程序中添加了用于在您的 web 应用程序中实现身份验证的各种 URL，但是在您将它们添加到项目的 level <code class="eh kf kg kh ki b">urls.py</code>文件之前，它们无法使用。</p><p id="d571" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先，这是<code class="eh kf kg kh ki b">accounts/urls.py</code>文件的完整源代码:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="17cc" class="mi kk hu ki b fv mj mk l ml mm">from django.contrib.auth import views<br/>from django.urls import path</span><span id="132f" class="mi kk hu ki b fv mu mk l ml mm">urlpatterns = [<br/>    path('login/', views.LoginView.as_view(), name='login'),<br/>    path('logout/', views.LogoutView.as_view(), name='logout'),<br/>    path('password-change/', views.PasswordChangeView.as_view(), name='password_change'),<br/>    path('password-change/done/', views.PasswordChangeDoneView.as_view(), name='password_change_done'),<br/>    path('password-reset/', views.PasswordResetView.as_view(), name='password_reset'),<br/>    path('password-reset/done/', views.PasswordResetDoneView.as_view(), name='password_reset_done'),<br/>    path('reset/&lt;uidb64&gt;/&lt;token&gt;/', views.PasswordResetConfirmView.as_view(), name='password_reset_confirm'),<br/>    path('reset/done/', views.PasswordResetCompleteView.as_view(), name='password_reset_complete'),<br/>]</span></pre><p id="8d25" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">接下来，打开项目根目录下的<code class="eh kf kg kh ki b">urls.py</code>,使用<code class="eh kf kg kh ki b">include()</code>函数导入账户 URL:</p><pre class="ma mb mc md fq me ki mf mg aw mh dt"><span id="f9f7" class="mi kk hu ki b fv mj mk l ml mm">from django.urls import path, include</span><span id="83a2" class="mi kk hu ki b fv mu mk l ml mm">urlpatterns = [<br/>    path('accounts/', include('accounts.urls'))<br/>]</span></pre><p id="1f2c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，开始启动您的开发服务器。您可以在<code class="eh kf kg kh ki b">/accounts</code>路径下使用您的认证 URL:</p><ul class=""><li id="ed57" class="lm ln hu jj b jk jl jo jp js lo jw lp ka lq ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">http://127.0.0.1:8000/accounts/login/</code>对于登录用户来说，</li><li id="075c" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">http://127.0.0.1:8000/accounts/logout/</code>对于注销用户，</li><li id="d021" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">http://127.0.0.1:8000/accounts/password-change/</code>用于更改密码、</li><li id="905c" class="lm ln hu jj b jk lv jo lw js lx jw ly ka lz ke lr ls lt lu dt translated"><code class="eh kf kg kh ki b">http://127.0.0.1:8000/accounts/password-reset/</code>用于重设密码。</li></ul><h1 id="75a0" class="kj kk hu bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dt translated">结论</h1><p id="c148" class="pw-post-body-paragraph jh ji hu jj b jk lh jm jn jo li jq jr js lj ju jv jw lk jy jz ka ll kc kd ke hn dt translated">在本教程中，我们看到了如何使用<code class="eh kf kg kh ki b">auth</code>应用程序在 Django 应用程序中轻松添加登录、注销、密码重置和更改功能，而无需重新发明轮子。</p><p id="a7c0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们还使用了 Bootstrap 4 和<code class="eh kf kg kh ki b">django-crispy-forms</code>来设计登录、密码更改和重置的各种表单。</p></div></div>    
</body>
</html>