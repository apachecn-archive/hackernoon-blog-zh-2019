<html>
<head>
<title>WTF is Docker?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">WTF 是 Docker？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/wtf-is-docker-7e69e9f1a139#2019-03-20">https://medium.com/hackernoon/wtf-is-docker-7e69e9f1a139#2019-03-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="6bc0" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">简述英语中的 Docker 和 Docker compose</h2></div><h1 id="196b" class="jj jk hu bd jl jm jn jo jp jq jr js jt ja ju jb jv jd jw je jx jg jy jh jz ka dt translated">内容:</h1><ul class=""><li id="de5a" class="kb kc hu kd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks dt translated">docker 是什么？</li><li id="889c" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko kp kq kr ks dt translated">在 Docker 中部署 Node.js 应用程序</li><li id="3459" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko kp kq kr ks dt translated">docker compose 是什么，如何使用？</li></ul></div><div class="ab cl ky kz hc la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="hn ho hp hq hr"><figure class="lg lh li lj fq lk fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff lf"><img src="../Images/76450a55caee895510cfdc781a33ef70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XvJ0GDWOAEHNApZvw-dOVQ.png"/></div></div></figure><h1 id="5a02" class="jj jk hu bd jl jm jn jo jp jq jr js jt ja ju jb jv jd jw je jx jg jy jh jz ka dt translated">Docker 是什么？</h1><p id="f507" class="pw-post-body-paragraph lr ls hu kd b ke kf iv lt kg kh iy lu ki lv lw lx kk ly lz ma km mb mc md ko hn dt translated">Docker 是一个让你在<em class="me">容器</em>中部署应用的工具。容器是轻量级的虚拟机。</p><figure class="lg lh li lj fq lk fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff mf"><img src="../Images/30826ba0468145765af7ab0b2a24f437.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kyt6ZkVP8D2TUcK_Sc_ROw.png"/></div></div></figure><p id="9ffb" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">你可以创建一个 linux 容器，在里面设置你的应用程序，并和其他人分享这个容器。</p><blockquote class="ml"><p id="03aa" class="mm mn hu bd mo mp mq mr ms mt mu ko ek translated">这就像共享一台已经安装并运行项目的笔记本电脑。</p></blockquote><p id="b6df" class="pw-post-body-paragraph lr ls hu kd b ke mv iv lt kg mw iy lu ki mx lw lx kk my lz ma km mz mc md ko hn dt translated">便携性是 Docker 的一个巨大优势。使用 Docker 还有其他几个好处。现在，让我们继续学习如何使用它。</p><h1 id="2ad1" class="jj jk hu bd jl jm jn jo jp jq jr js jt ja ju jb jv jd jw je jx jg jy jh jz ka dt translated">在 Docker 中部署 Node.js 应用程序</h1><p id="a225" class="pw-post-body-paragraph lr ls hu kd b ke kf iv lt kg kh iy lu ki lv lw lx kk ly lz ma km mb mc md ko hn dt translated">让我们创建一个简单的 Node.js 应用程序，并将其部署在 Docker 中。</p><figure class="lg lh li lj fq lk fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff na"><img src="../Images/28f9b7f366ac8035001dee056d8e282a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W4DwYGZCe2tMlcUIdDF0Sg.jpeg"/></div></div></figure><p id="489c" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">nodejs 站点有一个出色的<a class="ae nb" href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/" rel="noopener ugc nofollow" target="_blank">示例</a>，我将在这里遵循相同的步骤:</p><h2 id="034d" class="nc jk hu bd jl nd ne nf jp ng nh ni jt ki nj nk jv kk nl nm jx km nn no jz np dt translated">创建 Node.js 应用程序</h2><ol class=""><li id="3b08" class="kb kc hu kd b ke kf kg kh ki kj kk kl km kn ko nq kq kr ks dt translated">在新目录中，创建一个描述您的应用程序及其依赖项的<code class="eh nr ns nt nu b">package.json</code>文件:</li></ol><figure class="lg lh li lj fq lk"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="2676" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">运行命令<code class="eh nr ns nt nu b">npm install</code>来安装上面列出的依赖项。</p><p id="f6ac" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">2.使用<a class="ae nb" href="https://expressjs.com" rel="noopener ugc nofollow" target="_blank"> Express.js </a>框架创建一个定义 web 应用的<code class="eh nr ns nt nu b">server.js</code>文件。</p><figure class="lg lh li lj fq lk"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="e55c" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">app 准备好了，运行命令<code class="eh nr ns nt nu b">npm start</code>运行。在浏览器中打开<code class="eh nr ns nt nu b"><a class="ae nb" href="http://0.0.0.0:8080" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8080</a></code>查看你的应用。</p><h2 id="7aa3" class="nc jk hu bd jl nd ne nf jp ng nh ni jt ki nj nk jv kk nl nm jx km nn no jz np dt translated">将应用程序归档</h2><ol class=""><li id="fde4" class="kb kc hu kd b ke kf kg kh ki kj kk kl km kn ko nq kq kr ks dt translated"><a class="ae nb" href="https://docs.docker.com/install/" rel="noopener ugc nofollow" target="_blank">安装码头工人</a>🐳</li><li id="0a59" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko nq kq kr ks dt translated"><strong class="kd hv">创建一个名为</strong>T5 的文件。这定义了您的容器。</li></ol><figure class="lg lh li lj fq lk"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="5f42" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">这个文件里是怎么回事？</p><p id="a154" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated"><code class="eh nr ns nt nu b">FROM node:8</code> —这是基本图像。<strong class="kd hv">图片</strong>是一个容器的快照/蓝图。<strong class="kd hv"> <em class="me">一个正在运行的 docker 图像是一个容器。</em> </strong> <code class="eh nr ns nt nu b">node</code>镜像是安装了 node.js 和 npm 的<code class="eh nr ns nt nu b">linux</code>镜像。</p><p id="af75" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">在这个 docker 文件中，我们使用了<code class="eh nr ns nt nu b">node</code>图像，并对其进行了一些添加，以创建一个新的图像。</p><p id="f844" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">让我们来看看我们对节点图像所做的添加:</p><ul class=""><li id="2ff4" class="kb kc hu kd b ke mg kg mh ki nx kk ny km nz ko kp kq kr ks dt translated"><code class="eh nr ns nt nu b">WORKDIR /usr/src/app</code>:在镜像中创建一个名为 app 的文件夹，并设置为当前工作目录。</li><li id="1dfe" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko kp kq kr ks dt translated"><code class="eh nr ns nt nu b">COPY package*.json ./</code>:将您电脑(名为<strong class="kd hv"> Docker host </strong>)中的 package.json 和 package-lock.json 文件复制到镜像中的<code class="eh nr ns nt nu b">./</code>文件夹中(在步骤 1 中设置为<code class="eh nr ns nt nu b">/usr/src/app</code>)。</li><li id="a935" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko kp kq kr ks dt translated"><code class="eh nr ns nt nu b">RUN npm install</code>:这将运行图像中给定的命令。</li><li id="54f5" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko kp kq kr ks dt translated"><code class="eh nr ns nt nu b">CMD npm start</code> : CMD 定义了从这个映像启动容器时运行的 entrypoint 命令。一个图像可以有多个<code class="eh nr ns nt nu b">RUN</code>命令，但只有一个<code class="eh nr ns nt nu b">CMD</code>。</li></ul><p id="2040" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">现在你的形象已经定义好了，让我们来建立它。</p><p id="ed24" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated"><strong class="kd hv"> 3。建立形象</strong> 🛠 : <code class="eh nr ns nt nu b">$ docker build -t node-app-image .</code></p><p id="24fb" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">该命令将从<a class="ae nb" href="https://hub.docker.com" rel="noopener ugc nofollow" target="_blank"> Docker Hub </a>下载(拉取)图像，Docker Hub 是 Docker 图像的公共库(<strong class="kd hv"> <em class="me">注册表</em> </strong>)。</p><blockquote class="oa ob oc"><p id="4dfe" class="lr ls me kd b ke mg iv lt kg mh iy lu od mi lw lx oe mj lz ma of mk mc md ko hn dt translated">对于<code class="eh nr ns nt nu b">Dockerfile</code>中的每一行，构建一个中间图像。在运行整个 docker 文件后，就创建了最终的映像。</p></blockquote><p id="cb5e" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">您现在可以查看系统上的所有图像:</p><pre class="lg lh li lj fq og nu oh oi aw oj dt"><span id="10e9" class="nc jk hu nu b fv ok ol l om on">$ docker images</span><span id="2933" class="nc jk hu nu b fv oo ol l om on">REPOSITORY               TAG       IMAGE ID            CREATED<br/>node                     8         2a3ba2f43d22        2 minutes ago<br/>node-app-image           latest    53eeb30b855e        1 minute ago</span></pre><p id="65cc" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">4.<strong class="kd hv">部署！！</strong>🚀</p><p id="c0ce" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">运行镜像:<code class="eh nr ns nt nu b">$ docker run -p 41122:8080 -d node-app-image</code></p><p id="981f" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">容器的端口 8080 映射到系统的端口 41122，在浏览器中打开<code class="eh nr ns nt nu b">http://localhost:41122</code>查看应用程序。</p><p id="f811" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">尝试这些命令:</p><pre class="lg lh li lj fq og nu oh oi aw oj dt"><span id="d9d4" class="nc jk hu nu b fv ok ol l om on"># <strong class="nu hv">List the running containers</strong><br/>$ docker ps</span><span id="1924" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Print logs of a container</strong> (use container id from above command)<br/>$ docker logs 8473137bc8e1</span><span id="e85d" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Go inside the running container</strong><br/>$ docker exec -it &lt;container_id&gt; /bin/bash</span><span id="6190" class="nc jk hu nu b fv oo ol l om on"># Command to return outside: exit</span><span id="deeb" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Stop a container</strong><br/>$ docker stop &lt;container_id&gt;</span><span id="b251" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">List all containers</strong> (including stopped ones)<br/>$ docker ps -a</span><span id="146b" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Remove stopped container</strong><br/>$ docker rm &lt;container_id&gt;</span><span id="8932" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Remove an image</strong><br/>$ docker rmi node-app-image</span></pre><p id="482b" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">恭喜你！🎉 🎉 🎉</p><p id="de82" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">喘口气。以下是迄今为止你学到的东西:</p><ol class=""><li id="a005" class="kb kc hu kd b ke mg kg mh ki nx kk ny km nz ko nq kq kr ks dt translated">酷短语——容器、图像、注册表、docker hub、Dockerfile</li><li id="862b" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko nq kq kr ks dt translated">神秘艺术——如何写文档和创建图像。</li><li id="2a5c" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko nq kq kr ks dt translated">巫术——控制容器的咒语</li></ol><p id="82be" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">现在你知道 WTF 是 Docker，让我们进行下一步:</p><h1 id="44e2" class="jj jk hu bd jl jm jn jo jp jq jr js jt ja ju jb jv jd jw je jx jg jy jh jz ka dt translated">Docker 作曲 WTF？</h1><p id="cb4e" class="pw-post-body-paragraph lr ls hu kd b ke kf iv lt kg kh iy lu ki lv lw lx kk ly lz ma km mb mc md ko hn dt translated">Docker compose 用于处理许多容器。</p><figure class="lg lh li lj fq lk fe ff paragraph-image"><div class="fe ff op"><img src="../Images/1c7b51ead307fd18e5e3bd2d4e8e3446.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/1*uSZS8AXWFeJec8s_cKGXng.gif"/></div></figure><p id="4d2e" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">假设你需要一个<code class="eh nr ns nt nu b">mysql db</code>和<code class="eh nr ns nt nu b">redis</code>以及<code class="eh nr ns nt nu b">node.js</code>应用，你会怎么做？</p><p id="2f07" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated"><em class="me">创建 3 个 docker 文件，构建 3 个映像并运行 3 个映像。— </em>人类已经进化到超越这一点。</p><p id="ee3b" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">相反，创建一个文件<code class="eh nr ns nt nu b">docker-compose.yml</code>:</p><figure class="lg lh li lj fq lk"><div class="bz el l di"><div class="nv nw l"/></div></figure><p id="58ad" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">现在运行<code class="eh nr ns nt nu b">docker-compose up -d</code>并观察奇迹的发生。</p><p id="d569" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated"><code class="eh nr ns nt nu b">docker ps</code>将显示 3 个容器正在运行。</p><p id="4ca9" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">尝试这些命令:</p><pre class="lg lh li lj fq og nu oh oi aw oj dt"><span id="8183" class="nc jk hu nu b fv ok ol l om on"># <strong class="nu hv">Stop the entire stack<br/></strong>$ docker-compose stop</span><span id="a904" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Stop and remove all containers<br/></strong>$ docker-compose down</span><span id="c3fd" class="nc jk hu nu b fv oo ol l om on"># <strong class="nu hv">Start a specific service</strong><br/>$ docker-compose up -d redis</span></pre><p id="6a5c" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">如果你的项目有多个容器，Docker compose 会让你的项目变得非常容易管理。</p><h1 id="b6aa" class="jj jk hu bd jl jm jn jo jp jq jr js jt ja ju jb jv jd jw je jx jg jy jh jz ka dt translated">你成功了！！</h1><figure class="lg lh li lj fq lk fe ff paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="fe ff oq"><img src="../Images/31f53030b2c65682838759bfe7e0089e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1YPDI039StX23-pE"/></div></div><figcaption class="or os fg fe ff ot ou bd b be z ek">Photo by <a class="ae nb" href="https://unsplash.com/@_davidgavi?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">David Beatz</a> on <a class="ae nb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="516c" class="pw-post-body-paragraph lr ls hu kd b ke mg iv lt kg mh iy lu ki mi lw lx kk mj lz ma km mk mc md ko hn dt translated">欢迎来到码头工人的世界。</p><h2 id="7338" class="nc jk hu bd jl nd ne nf jp ng nh ni jt ki nj nk jv kk nl nm jx km nn no jz np dt translated">进一步阅读:</h2><ol class=""><li id="03e5" class="kb kc hu kd b ke kf kg kh ki kj kk kl km kn ko nq kq kr ks dt translated">编写 Docker 文件的最佳实践——这是一本很好的读物，它会告诉你更多关于 Docker 是如何工作的。</li><li id="c0d9" class="kb kc hu kd b ke kt kg ku ki kv kk kw km kx ko nq kq kr ks dt translated">官方 Docker 文档——一旦你了解了基本概念，它们会非常有用。</li></ol></div></div>    
</body>
</html>