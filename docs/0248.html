<html>
<head>
<title>Make an Eye tracking and Face detection app as a beginner</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为初学者制作一个眼球追踪和人脸检测应用程序</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/make-an-eye-tracking-and-face-detection-app-as-a-beginner-d72e0139546b#2019-01-10">https://medium.com/hackernoon/make-an-eye-tracking-and-face-detection-app-as-a-beginner-d72e0139546b#2019-01-10</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="acfc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们都知道，当 android 应用程序可以检测我们的面部或跟踪我们的眼睛是闭着还是睁开时，它看起来有多酷。当应用程序甚至可以检测我们是否在微笑、在手机上阅读或不看手机时，这变得更酷了。</p><p id="efea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">嗯…</p><blockquote class="jp jq jr"><p id="4671" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hn dt translated">我相信..任何吸引我的东西，都会让我建造它！</p></blockquote><p id="26bc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">抱歉，尝试了一个“黑暗骑士”双关语:)</p><p id="e460" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，让我们使用谷歌视觉 API 制作一个 android 眼球跟踪和人脸检测应用程序。</p><p id="f8ca" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">来自谷歌:</p><blockquote class="jp jq jr"><p id="47f0" class="ir is js it b iu iv iw ix iy iz ja jb jt jd je jf ju jh ji jj jv jl jm jn jo hn dt translated"><strong class="it hv">云视觉 API </strong>通过将强大的机器学习模型封装在一个易于使用的 REST API 中，使开发者能够理解图像的内容。它可以快速地将图像分为数千种类别(例如，“帆船”)，检测图像中的单个对象和人脸，并读取图像中包含的印刷文字。您可以在您的图像目录上构建元数据，缓和攻击性内容，或者通过图像情感分析实现新的营销场景。</p></blockquote><p id="0a41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这里，我们将制作一个 android 应用程序，可以跟踪我们的面部，并检测我们的眼睛是闭着还是睁着。</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="fe ff jw"><img src="../Images/3c0cdb4f3d60dcba5add3e0f906f8d56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tJPP3eRByPdZSNsDftreMw.jpeg"/></div></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">track eye</figcaption></figure><p id="37ac" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">听起来很酷？这并不难。</p><p id="96e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，让我们深入了解这在一个简单的流程图中是如何工作的。</p><p id="223f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的 android 应用程序→使用相机→检测面部→开始一些操作→检查查看者的眼睛是否睁开→继续操作→如果眼睛闭上→停止操作。</p><p id="4bad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这是我们 android 应用的基本理念。出于学习目的，我们将只在我们的应用程序中做这么多，但更多的高级功能可以使用谷歌视觉 API 添加。</p><p id="75ae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将在应用程序中执行的操作是播放一个简单的视频。嗯，我选了一段来自<a class="ae km" href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=1&amp;cad=rja&amp;uact=8&amp;ved=2ahUKEwjQwPGqvuLfAhUSqaQKHbjmAtMQFjAAegQIAhAB&amp;url=https%3A%2F%2Fwww.pixar.com%2F&amp;usg=AOvVaw3ljkKg1b3PA_wsLJzsSPYO" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">皮克斯动画</strong> </a> <strong class="it hv">的视频。</strong></p><p id="e577" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到该应用的完整源代码。T13】</p><p id="d706" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在你的 IDE 中启动一个新的 Android 项目,就像 Android Studio 或任何其他项目一样。</p><p id="359a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">转到<strong class="it hv">清单文件</strong>并添加以下权限，对于此应用程序，我们需要使用设备前置摄像头的权限。</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="3d3f" class="ks kt hu ko b fv ku kv l kw kx">&lt;uses-permission android:name="android.permission.CAMERA" /&gt;</span></pre><p id="a429" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还必须在我们的 android 应用程序中导入<strong class="it hv"> Google Vision API </strong>，所以直接进入 app 的 Build Gradle，大部分写为<strong class="it hv">Build . Gradle(Module:app)</strong>。</p><p id="19b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您将看到一个文本如下的文件:</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="3913" class="ks kt hu ko b fv ku kv l kw kx">apply plugin: 'com.android.application'<br/><br/>android {<br/>    compileSdkVersion 28<br/>    defaultConfig {<br/>        applicationId "com.pd.trackeye"<br/>        minSdkVersion 15<br/>        targetSdkVersion 28<br/>        versionCode 1<br/>        versionName "1.0"<br/>        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"<br/>    }<br/>    buildTypes {<br/>        release {<br/>            minifyEnabled false<br/>            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'<br/>        }<br/>    }<br/>}<br/><br/>dependencies {<br/>    implementation fileTree(dir: 'libs', include: ['*.jar'])<br/>    implementation 'com.android.support:appcompat-v7:28.0.0'<br/>    implementation 'com.android.support.constraint:constraint-layout:1.1.3'<br/>    testImplementation 'junit:junit:4.12'<br/>    androidTestImplementation 'com.android.support.test:runner:1.0.2'<br/>    androidTestImplementation 'com.android.support.test.espresso:espresso-core:3.0.2'<br/>    implementation 'com.google.android.gms:play-services:12.0.1'<br/>}</span></pre><p id="73c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果它看起来像这样，那么你在正确的文件目的地。复制上面的全部代码并粘贴在上面。</p><p id="1a1d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你会看到一个弹出的顶栏，说明要同步文件。点击<strong class="it hv">立即同步</strong>并等待项目构建。</p><p id="86b4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当你在你的建造日志中获得所有绿色 OK 标志后，你就可以继续前进了。</p><p id="c352" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们来写一些 android 代码来实现这个神奇的功能。转到文件的<strong class="it hv"> MainActivity </strong>，声明如下变量，如下所示:</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="3ef6" class="ks kt hu ko b fv ku kv l kw kx">private static final String <em class="js">TAG </em>= "MainActivity";<br/>VideoView videoView;<br/>EditText textView;<br/><br/>//For looking logs<br/>ArrayAdapter adapter;<br/>ArrayList&lt;String&gt; list = new ArrayList&lt;&gt;();<br/><br/>CameraSource cameraSource;</span></pre><p id="18be" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这几行代码应该位于如下代码行的下方:</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="ee22" class="ks kt hu ko b fv ku kv l kw kx">public class MainActivity extends AppCompatActivity {</span></pre><p id="d680" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们在同一个文件中执行<strong class="it hv"> onCreate()方法</strong>中的神奇代码。</p><p id="92a2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们首先在我们的代码中添加一些东西，<strong class="it hv">允许用户授予添加 android 应用程序的权限，否则我们的应用程序将会崩溃并且无法工作。</strong></p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="2917" class="ks kt hu ko b fv ku kv l kw kx">if (ActivityCompat.<em class="js">checkSelfPermission</em>(this, android.Manifest.permission.<em class="js">CAMERA</em>) != PackageManager.<em class="js">PERMISSION_GRANTED</em>) {<br/>    ActivityCompat.<em class="js">requestPermissions</em>(this, new String[]{Manifest.permission.<em class="js">CAMERA</em>}, 1);<br/>    Toast.<em class="js">makeText</em>(this, "Grant Permission and restart app", Toast.<em class="js">LENGTH_SHORT</em>).show();<br/>}<br/>else {<br/>    videoView = findViewById(R.id.<em class="js">videoView</em>);<br/>    textView = findViewById(R.id.<em class="js">textView</em>);<br/>    adapter = new ArrayAdapter&lt;&gt;(this,   android.R.layout.<em class="js">simple_list_item_1</em>, list);<br/>    videoView.setVideoURI(Uri.<em class="js">parse</em>("android.resource://" + getPackageName() + "/" + R.raw.<em class="js">videoplayback</em>));<br/>    videoView.start();<br/>    createCameraSource();<br/>}</span></pre><p id="1872" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将上面的代码添加到我们前面谈到的<code class="eh ky kz la ko b"><strong class="it hv">onCreate()</strong></code>方法中。</p><p id="19f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们应该添加使用 Google vision API 跟踪眼睛的代码。我们将为此创建一个新的<code class="eh ky kz la ko b">private</code>类，命名为<code class="eh ky kz la ko b"><strong class="it hv">EyesTracker</strong></code> <strong class="it hv">。该类的代码如下所示:</strong></p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="24ae" class="ks kt hu ko b fv ku kv l kw kx">private class EyesTracker extends Tracker&lt;Face&gt; {<br/><br/>    private final float THRESHOLD = 0.75f;<br/><br/>    private EyesTracker() {<br/><br/>    }<br/><br/>    @Override<br/>    public void onUpdate(Detector.Detections&lt;Face&gt; detections, Face face) {<br/>        if (face.getIsLeftEyeOpenProbability() &gt; THRESHOLD || face.getIsRightEyeOpenProbability() &gt; THRESHOLD) {<br/>            Log.<em class="js">i</em>(<em class="js">TAG</em>, "onUpdate: Eyes Detected");<br/>            showStatus("Eyes Detected and open, so video continues");<br/>            if (!videoView.isPlaying())<br/>                videoView.start();<br/><br/>        }<br/>        else {<br/>            if (videoView.isPlaying())<br/>                videoView.pause();<br/><br/>            showStatus("Eyes Detected and closed, so video paused");<br/>        }<br/>    }<br/><br/>    @Override<br/>    public void onMissing(Detector.Detections&lt;Face&gt; detections) {<br/>        super.onMissing(detections);<br/>        showStatus("Face Not Detected yet!");<br/>    }<br/><br/>    @Override<br/>    public void onDone() {<br/>        super.onDone();<br/>    }<br/>}</span></pre><p id="ed08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里的<code class="eh ky kz la ko b">videoView</code>是对应用 UI 的<code class="eh ky kz la ko b">activity_main.xml</code>中<strong class="it hv"> VideoView </strong>属性设置的视频的引用。</p><p id="19b6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以在名为<code class="eh ky kz la ko b"><strong class="it hv">FaceTrackerFactory</strong></code>的新<code class="eh ky kz la ko b">private</code>类中添加检测用户面部的代码。代码看起来会像这样:</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="a791" class="ks kt hu ko b fv ku kv l kw kx">private class FaceTrackerFactory implements MultiProcessor.Factory&lt;Face&gt; {<br/><br/>    private FaceTrackerFactory() {<br/><br/>    }<br/><br/>    @Override<br/>    public Tracker&lt;Face&gt; create(Face face) {<br/>        return new EyesTracker();<br/>    }<br/>}<br/><br/>public void createCameraSource() {<br/>    FaceDetector detector = new FaceDetector.Builder(this)<br/>            .setTrackingEnabled(true)<br/>            .setClassificationType(FaceDetector.<em class="js">ALL_CLASSIFICATIONS</em>)<br/>            .setMode(FaceDetector.<em class="js">FAST_MODE</em>)<br/>            .build();<br/>    detector.setProcessor(new MultiProcessor.Builder(new FaceTrackerFactory()).build());<br/><br/>    cameraSource = new CameraSource.Builder(this, detector)<br/>            .setRequestedPreviewSize(1024, 768)<br/>            .setFacing(CameraSource.<em class="js">CAMERA_FACING_FRONT</em>)<br/>            .setRequestedFps(30.0f)<br/>            .build();<br/><br/>    try {<br/>        if (ActivityCompat.<em class="js">checkSelfPermission</em>(this, Manifest.permission.<em class="js">CAMERA</em>) != PackageManager.<em class="js">PERMISSION_GRANTED</em>) {<br/>            // <em class="js">TODO: Consider calling<br/>            </em>//    ActivityCompat#requestPermissions<br/>            // here to request the missing permissions, and then overriding<br/>            //   public void onRequestPermissionsResult(int requestCode, String[] permissions,<br/>            //                                          int[] grantResults)<br/>            // to handle the case where the user grants the permission. See the documentation<br/>            // for ActivityCompat#requestPermissions for more details.<br/>            return;<br/>        }<br/>        cameraSource.start();<br/>    }<br/>    catch (IOException e) {<br/>        e.printStackTrace();<br/>    }<br/>}</span></pre><p id="5cf0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们还需要暂停视频和结束视频，我们将在<code class="eh ky kz la ko b">MainActivity</code>的<code class="eh ky kz la ko b">onDestory()</code>和<code class="eh ky kz la ko b">onPause()</code>方法中处理。</p><p id="b4e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们<strong class="it hv">为应用的基本 UI </strong>添加一些 XML 代码。</p><p id="4415" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">转到名为类似于<code class="eh ky kz la ko b">activity_main.xml</code>的文件。现在只需用下面的代码替换其中的代码。</p><pre class="jx jy jz ka fq kn ko kp kq aw kr dt"><span id="a9ad" class="ks kt hu ko b fv ku kv l kw kx">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="match_parent"<br/>    tools:context=".MainActivity"<br/>    android:orientation="vertical"&gt;<br/><br/>    &lt;VideoView<br/>        android:layout_width="match_parent"<br/>        android:layout_height="wrap_content"<br/>        android:id="@+id/videoView"/&gt;<br/><br/>    &lt;EditText<br/>        android:layout_width="match_parent"<br/>        android:layout_height="match_parent"<br/>        android:id="@+id/textView"<br/>        android:text="@string/face_not_found"<br/>        android:textSize="20sp"/&gt;<br/><br/>&lt;/LinearLayout&gt;</span></pre><p id="e06b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这段代码所做的就是添加一个<code class="eh ky kz la ko b">EditText</code>来显示文本，说明什么被检测到，什么不被用户检测到。以及为用户播放视频的<code class="eh ky kz la ko b">VideoView</code>。</p><p id="7a8b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到这个应用的完整源代码。 </p><p id="4b48" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">差不多就是这样。你已经开发了自己的眼球追踪和面部检测 android 应用程序。</p><p id="8f57" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一切完成后，看起来是这样的:</p><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div class="fe ff lb"><img src="../Images/bd056001981c19f7e127bd0adbd7b7d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/1*Mvn4NQ98EVipHBE3lncL6Q.jpeg"/></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">Eyes open</figcaption></figure><figure class="jx jy jz ka fq kb fe ff paragraph-image"><div class="fe ff lc"><img src="../Images/792dea15c2a6845e691041870b9b2fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*dL5w_WWYNyZ_1PpynxxKcQ.jpeg"/></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">Eyes closed</figcaption></figure><p id="726c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在去炫耀吧！！</p><p id="be95" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">阅读我之前的一篇关于 android 库的文章，它可以用很少几行代码轻松地帮助你定制 Snackbar。巧克力棒。T3】</p></div></div>    
</body>
</html>