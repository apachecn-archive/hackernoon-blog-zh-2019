<html>
<head>
<title>Set-up SSL in NodeJS and Express using OpenSSL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OpenSSL在NodeJS和Express中设置SSL</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/set-up-ssl-in-nodejs-and-express-using-openssl-f2529eab5bb?source=collection_archive---------3-----------------------#2019-01-15">https://medium.com/hackernoon/set-up-ssl-in-nodejs-and-express-using-openssl-f2529eab5bb?source=collection_archive---------3-----------------------#2019-01-15</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk it iu iv iw fe ff paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="fe ff is"><img src="../Images/63ad38a732d3de85519a98a016f9e141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*49glYe-285UPvYW9xp7JFw.jpeg"/></div></div></figure><p id="1fd5" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">这是一个简单、易于理解的教程，介绍如何使用<em class="kb"> Express </em>框架在<em class="kb"> NodeJS </em>中通过<em class="kb"> https </em>提供页面服务。</p></div><div class="ab cl kc kd hc ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hn ho hp hq hr"><p id="611b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们将在本教程中使用的工具/框架有:</p><ul class=""><li id="7e66" class="kj kk hu jf b jg jh jk jl jo kl js km jw kn ka ko kp kq kr dt translated">NodeJS:你应该对如何在<a class="ae ks" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>中编程有基本的了解。</li><li id="d023" class="kj kk hu jf b jg kt jk ku jo kv js kw jw kx ka ko kp kq kr dt translated">OpenSSL:生成密钥和证书的工具。</li><li id="b946" class="kj kk hu jf b jg kt jk ku jo kv js kw jw kx ka ko kp kq kr dt translated">ExpressJS ( <code class="eh ky kz la lb b">npm i express</code>):在NodeJS中编写web服务器的后端框架。更多关于<a class="ae ks" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank">快递</a>。</li><li id="7311" class="kj kk hu jf b jg kt jk ku jo kv js kw jw kx ka ko kp kq kr dt translated"><code class="eh ky kz la lb b">https</code>:自带NodeJS。</li></ul></div><div class="ab cl kc kd hc ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="hn ho hp hq hr"><p id="7a9f" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">让我们建立我们的项目目录。它不是一个有很多文件的目录。相反，它只包含4个文件，分别是<code class="eh ky kz la lb b">package.json</code>、<code class="eh ky kz la lb b">key.pem</code>、<code class="eh ky kz la lb b">cert.pem</code>和<code class="eh ky kz la lb b">server.js</code>。所以，创建一个新的目录<em class="kb">节点——https</em>、<code class="eh ky kz la lb b">cd node-https</code>并运行<code class="eh ky kz la lb b">npm init -y</code>来创建<code class="eh ky kz la lb b">package.json</code>文件。</p><p id="c102" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">现在使用<code class="eh ky kz la lb b">npm i --save express</code>安装<em class="kb"> express </em>。创建一个<code class="eh ky kz la lb b">server.js</code>文件，并在其中键入以下代码。</p><p id="06a5" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">我们的<code class="eh ky kz la lb b">server.js</code>应该是这样的:</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="1d4d" class="lk ll hu lb b fv lm ln l lo lp">const app = require('express')();<br/>const https = require('https');<br/>const fs = require('fs');<br/><br/>//GET home route<br/>app.get('/', (req, res) =&gt; {<br/>     res.send('Hello World');<br/>});<br/><br/>// we will pass our 'app' to 'https' server<br/>https.createServer(app).listen(3000);</span></pre><p id="f1c3" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">就是这样。现在，如果您运行<code class="eh ky kz la lb b">node server.js</code>并访问<code class="eh ky kz la lb b">localhost:3000</code>，除了一个错误，您什么也看不到！是时候纠正这个错误了。</p><h1 id="075c" class="lq ll hu bd lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm dt translated">生成cert.pem和key.pem</h1><p id="384a" class="pw-post-body-paragraph jd je hu jf b jg mn ji jj jk mo jm jn jo mp jq jr js mq ju jv jw mr jy jz ka hn dt translated">使用OpenSSL( <a class="ae ks" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank">？</a>)，我们会生成我们的<code class="eh ky kz la lb b">key</code>和<code class="eh ky kz la lb b">cert</code>。所以，你可以这样做:</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="0cec" class="lk ll hu lb b fv lm ln l lo lp">openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365</span></pre><ul class=""><li id="fc17" class="kj kk hu jf b jg jh jk jl jo kl js km jw kn ka ko kp kq kr dt translated"><code class="eh ky kz la lb b">-keyout</code>:该标志让<code class="eh ky kz la lb b">openssl</code>知道在哪里保存<em class="kb"> key.pem </em>文件。我可以是一个绝对的文件位置。</li><li id="86b5" class="kj kk hu jf b jg kt jk ku jo kv js kw jw kx ka ko kp kq kr dt translated"><code class="eh ky kz la lb b">-out</code>:这个标志让<code class="eh ky kz la lb b">openssl</code>知道在哪里保存<em class="kb"> cert.pem </em>文件。我也可以是一个绝对文件位置。</li><li id="7a4b" class="kj kk hu jf b jg kt jk ku jo kv js kw jw kx ka ko kp kq kr dt translated"><code class="eh ky kz la lb b">-days</code>:该标志指定SSL有效的天数。</li></ul><p id="a00b" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">确保在<code class="eh ky kz la lb b">server.js</code>所在的目录下运行上述命令。回答所有问题。如果一切顺利，您应该在项目根中看到两个新文件，即<code class="eh ky kz la lb b">cert.pem</code>和<code class="eh ky kz la lb b">key.pem</code>。</p><p id="5812" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">打开<code class="eh ky kz la lb b">server.js</code>并将证书和密钥文件包含在您的<code class="eh ky kz la lb b">https.createServer()</code>函数中。就像下面的例子。</p><pre class="lc ld le lf fq lg lb lh li aw lj dt"><span id="77a1" class="lk ll hu lb b fv lm ln l lo lp">const app = require('express')();<br/>const https = require('https');<br/>const fs = require('fs');<br/><br/>//GET home route<br/>app.get('/', (req, res) =&gt; {<br/>    res.send('Hello World');<br/>});<br/><br/>// we will pass our 'app' to 'https' server<br/>https.createServer({<br/>    key: fs.readFileSync('./key.pem'),<br/>    cert: fs.readFileSync('./cert.pem'),<br/>    passphrase: 'YOUR PASSPHRASE HERE'<br/>}, app)<br/>.listen(3000);</span></pre><p id="1c92" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">打开一个终端窗口，运行<code class="eh ky kz la lb b">node server.js</code>。它应该运行没有任何错误。打开你最喜欢的浏览器并访问<code class="eh ky kz la lb b">https://localhost:3000</code>，你应该会看到<strong class="jf hv"> Hello World </strong>。</p><p id="1e6a" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">您可能会看到一些SSL警告。那是因为你的证书不是由任何认证机构签发的。您需要做的是，将证书作为例外添加到浏览器中。</p><p id="8478" class="pw-post-body-paragraph jd je hu jf b jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka hn dt translated">日安！！</p></div></div>    
</body>
</html>