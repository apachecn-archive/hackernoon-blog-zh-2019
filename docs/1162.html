<html>
<head>
<title>Developing Python application: Virtual environment</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开发Python应用程序:虚拟环境</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/developing-python-application-virtual-environment-95fa8ae5b098?source=collection_archive---------4-----------------------#2019-02-18">https://medium.com/hackernoon/developing-python-application-virtual-environment-95fa8ae5b098?source=collection_archive---------4-----------------------#2019-02-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/c4d00ffeb11d490303deab061e361c36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gDpv8LudQBkkKeWN"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Photo by <a class="ae ih" href="https://unsplash.com/@nitram509?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Martin W. Kirst</a> on <a class="ae ih" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><div class=""/><p id="5bd1" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt kf translated">Python无处不在——学术、数据科学、机器学习、企业应用、web应用、脚本等等。无论您做什么，python要么帮助您，要么让您头疼。让我们说，你已经学会了python编程，并准备用它来开发应用程序，让你未来的雇主惊叹不已，让你的未来辉煌无比。当然，这听起来很棒，您开始编写python脚本，并最终开始安装python包。从那里开始，人们沿着一条危险的道路走进了开发者的噩梦。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><p id="9e7d" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">软件包安装可能会导致不兼容问题或使其他应用程序无法运行。您可能会发现您的代码在某些机器上无法运行，而在您的本地机器上却可以完美运行。为什么？Python环境。</p><p id="6138" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">因此，为了避免每天都有不兼容问题的噩梦，需要为一个项目创建单独的python环境。虚拟环境是一堆可以独立运行python的脚本和目录。通过使用虚拟环境，每个python项目都可以拥有自己的依赖项，而与其他项目和系统python环境无关。在这里，我将讲述如何在python2和python3中创建和使用虚拟环境。对于python2我会用virtualenv，对于python3我会用venv，virtualenvwrapper，用conda。</p><p id="3335" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从python2开始，需要安装virtualenv包。</p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff kv"><img src="../Images/57665e1810850fddb50cd0e4344ffd90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LS-kW8DqPDC0w_eD5cpOiA.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">python2 and pip version with virtualenv installation command</figcaption></figure><p id="6389" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">看，我已经安装好了。安装后，您可以通过以下方式查看其命令:</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="b056" class="lf lg ik lb b fv lh li l lj lk">virtualenv -h</span></pre><p id="897f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们不需要使用这些命令中的大部分。为了创建一个虚拟环境，我们使用<strong class="jj il"> <em class="ll"> virtualenv【选项】目的地</em> </strong>。具体来说，打电话</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="78e7" class="lf lg ik lb b fv lh li l lj lk">virtualenv –python=python2 path/to/virtual/environment/dir</span></pre><p id="7d05" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">显然，我们可以通过<em class="ll">–python = python3</em>创建python3虚拟环境，假设您的机器上安装了python 3。该命令创建一个与给定python路径相同的隔离虚拟环境。如果愿意，我们可以给出一个直接的python路径，而不是使用python2和python3。</p><p id="1817" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">创建虚拟环境后，我们可以通过调用以下命令来使用它:</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="ff41" class="lf lg ik lb b fv lh li l lj lk">source path/to/virtual/environment/bin/activate</span></pre><p id="ce4c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">并且当虚拟环境被激活时调用<strong class="jj il"> <em class="ll">去激活</em> </strong>，离开虚拟环境。在python3上，它将venv包作为虚拟环境的默认包。要使用它，我们只需要打电话</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="ae86" class="lf lg ik lb b fv lh li l lj lk">python3 -m venv path/to/virtual/environment</span></pre><p id="0848" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">其他都一样。</p><p id="174a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们所做的是创建了一个全新的python环境，并将依赖项复制到一个指定的目录中。因此，通过激活环境，我们可以安装任何包，而不会影响其他环境和本地python。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><h2 id="74a5" class="lf lg ik bd lm ln lo lp lq lr ls lt lu js lv lw lx jw ly lz ma ka mb mc md me dt translated">绝对轻而易举。不是吗？</h2><p id="5365" class="pw-post-body-paragraph jh ji ik jj b jk mf jm jn jo mg jq jr js mh ju jv jw mi jy jz ka mj kc kd ke hn dt translated">然而，我们不想把它推到git仓库，但是我们确实需要知道所需的依赖关系，因为我们大多数人在不同的机器上工作。就我而言，我在三台不同的机器上运行windows和linux系统。</p><p id="840e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">解决这个问题的一个方法是为虚拟环境创建一个文件夹，并为git忽略它。这样，我们可以在不同的机器和不同的操作系统上处理一个项目。我们只需要跟踪所需的依赖关系。使用pip，我们可以将已安装依赖项的信息保存到一个文件中，并在需要时将这些依赖项安装到不同的环境中。<strong class="jj il"> <em class="ll"> Pip冻结</em> </strong>命令显示安装在python环境中的包。我们需要将它保存到一个文件中。保存为'<strong class="jj il"> <em class="ll"> requirement.txt </em> </strong>'是个不错的做法。稍后，在另一台机器上，我们通过使用</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="1c23" class="lf lg ik lb b fv lh li l lj lk">pip install -r requirement.txt</span></pre><p id="b478" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们处于一个非常方便的位置，我们可以在任何安装了所需操作系统的机器上进行python项目。</p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mk"><img src="../Images/9597ecad2a56ff52afe2d0a8785425f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*vo0SNc74rX7ykTSuWlmhxw.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Here I created .env folder and initialised a virtual environment there.</figcaption></figure><p id="c91e" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是什么是？env在我的终端上，那么虚拟环境所占用的磁盘空间呢？显然，那些虚拟环境文件是必要的。然而，当您有许多已完成的python项目，并且出于某种原因想要释放一些空间时，您会检查每个项目并手动删除那些文件吗？或者，如果所有虚拟环境文件都在一个目录中，不是更容易吗？还有。env是创建虚拟环境的目录名。好吧，酷。但是，在使用虚拟环境时，看到实际的python项目名称不是更方便吗？</p><p id="b802" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了解决这些小的不便，我们可以使用virtualenvwrapper包。用以下内容安装此软件包:</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="0fa4" class="lf lg ik lb b fv lh li l lj lk">pip install virtualenvwrapper</span></pre><p id="c4ea" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">安装之后，我们需要激活它的shell函数，并创建一个环境变量来指示虚拟环境的位置。通过运行which virtualenvwrapper.sh，我们得到了它的shell函数的路径。我们需要将它添加到shell启动中。因为我使用的是ubuntu，所以我把它添加到~/.bashrc中。我还为保存虚拟环境的位置创建了一个环境变量。到目前为止，我已经将这些行添加到。bashrc:</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="2474" class="lf lg ik lb b fv lh li l lj lk">export WORKON=$HOME/.virtualenvs</span><span id="ff2c" class="lf lg ik lb b fv ml li l lj lk">source /usr/local/bin/virtualenvwrapper.sh</span></pre><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mm"><img src="../Images/413f65b8920599f371457653e790a7c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tGdRaJFw286DzKtWbmWwpw.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Creating python environment with p3venv name</figcaption></figure><p id="fb50" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，您可以创建一个虚拟环境，包括:</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="ffb7" class="lf lg ik lb b fv lh li l lj lk">mkvirtualenv -p python3 name/of/virtual/env</span></pre><p id="99b8" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">激活并使用它。此外，virtualenvwrapper提供了一些有用的shell函数。其中之一是<strong class="jj il"> <em class="ll">工作于</em> </strong>。看，这让生活变得更容易。要查看完整指南，请访问此<a class="ae ih" href="https://virtualenvwrapper.readthedocs.io/en/latest/command_ref.html" rel="noopener ugc nofollow" target="_blank">页面</a>。因为它保存了创建的每个虚拟环境的所有文件，所以如果需要，可以很容易地删除这些文件。实际上，在终端中看到项目名称非常酷。这就是使用pip创建和管理虚拟环境的目的。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><h2 id="2fd7" class="lf lg ik bd lm ln lo lp lq lr ls lt lu js lv lw lx jw ly lz ma ka mb mc md me dt translated">现在我们来看看用康达怎么做。</h2><p id="2a95" class="pw-post-body-paragraph jh ji ik jj b jk mf jm jn jo mg jq jr js mh ju jv jw mi jy jz ka mj kc kd ke hn dt translated"><a class="ae ih" href="https://conda.io/docs/" rel="noopener ugc nofollow" target="_blank"> Conda </a>是一个针对Python、R、Lua、Scala、Java、JavaScript、Fortran的包管理系统。广泛应用于学术领域，我们可以通过Anaconda来了解它。人们声称conda是数据科学项目的一个更好的工具(在这里阅读<a class="ae ih" href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/" rel="noopener ugc nofollow" target="_blank"/>)。Anaconda发行版被大学使用，它有自己的GUI环境管理工具和导航器。然而，并不是每个开发人员都喜欢使用基于gui的工具，对吗？</p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/80c2a4b22f4ebdfc2f1e9cce72929a5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*OMP0ytOjeQsYUvAUvkg_3A.png"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Creating conda environment</figcaption></figure><p id="47a8" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">假设安装了conda(如果没有从<a class="ae ih" href="https://conda.io/projects/conda/en/latest/user-guide/install/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>安装)，创建一个conda环境</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="8e90" class="lf lg ik lb b fv lh li l lj lk">conda create --name name/of/env python=3.x </span></pre><p id="e39c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">并激活创建的环境</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="2dea" class="lf lg ik lb b fv lh li l lj lk">conda activate name/of/env</span></pre><p id="3038" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Conda创建虚拟环境并将所有相关文件存储到其安装位置。这使得它易于管理。要查看所有康达环境，我们可以拨打:康达信息–envs。为了消除特定的环境，我们称之为conda</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="d65e" class="lf lg ik lb b fv lh li l lj lk">conda remove --name name/of/env — — all</span></pre><p id="d51a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">Conda将所有环境名称存储在<em class="ll">主目录/中的<em class="ll"> environment.txt </em>中。康达</em>文件夹。其内容与<strong class="jj il"><em class="ll">conda info–envs</em></strong>命令相同。另一方面，所有可执行文件和包都存储在anaconda installation <em class="ll">目录/envs </em>文件夹中。了解这一点非常有用，因为anaconda存储了数GB的文件。</p><figure class="kw kx ky kz fq hw fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/356682062cb7553b98e524a32f82f8b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*TaZlms-E4ajzkj-PUrW74Q.png"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Peek into my environment.yml</figcaption></figure><p id="6802" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这不是创建conda虚拟环境的唯一方法。我们可以在yml文件中保存所需的信息，并使用它来创建conda环境。通常，人们会创建environment.yml并将python信息、环境名称和依赖项放在那里。有了这个yml文件，我们可以通过调用</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="4bdc" class="lf lg ik lb b fv lh li l lj lk">conda env create -f environment.yml</span></pre><p id="d2cf" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">更新environment.yml很容易，只需要写下需要放在那里并调用的内容</p><pre class="kw kx ky kz fq la lb lc ld aw le dt"><span id="9daf" class="lf lg ik lb b fv lh li l lj lk">conda env update -f environment.yml </span></pre><p id="a25a" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">可以通过conda list命令来确认。我知道它打印了大量的包裹。看在上帝的份上，我希望康达能有效地利用它们。为了分发我们的项目，我们需要保存依赖信息。调用conda env export向您显示所有需要保存的信息。我们需要将其复制粘贴到requirement.yml中(对于ubuntu，只需运行<em class="ll">conda env export&gt;environment . yml</em>)。</p><p id="0a0c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">原来如此。现在我希望管理python虚拟环境变得更容易。从这里，我们可以轻松地编写我们的应用程序，并最终打包和分发它。那是另一个故事，改天再说。</p></div><div class="ab cl ko kp hc kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="hn ho hp hq hr"><p id="0fcf" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你喜欢它，请鼓掌或评论让我知道！我正在研究一些有趣的东西，包括自适应智能、基于代理的建模和VFX管道开发。我会继续发表文章。</p></div></div>    
</body>
</html>