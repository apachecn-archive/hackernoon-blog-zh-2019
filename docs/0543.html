<html>
<head>
<title>How to fully customize Rails transactional emails (Devise)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何完全定制Rails事务性电子邮件(设计)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-override-and-customize-devise-mailers-with-rails-bada2cf5a1e1?source=collection_archive---------4-----------------------#2019-01-22">https://medium.com/hackernoon/how-to-override-and-customize-devise-mailers-with-rails-bada2cf5a1e1?source=collection_archive---------4-----------------------#2019-01-22</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/966bd23592df59857c655ae6c23d678c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SF1qjxZtXa31aqQmQN8SLg.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/asbgMLPcp9Q?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Damon Lam</a> on <a class="ae jg" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f099" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在RMTWRK，我们正在建立世界上最大的<a class="ae jg" href="http://rmtwrk.com" rel="noopener ugc nofollow" target="_blank">仅远程工作委员会</a>,以帮助雇用远程或分布式团队的公司与寻求更灵活工作环境的人进行匹配。因此，我们的rails应用程序有两种用户类型，公司用户、招聘人员和个人用户、希望被聘用的人员，我们希望为每种用户类型分别发送确认电子邮件。此外，我们希望使用<a class="ae jg" href="http://mailgun.com/" rel="noopener ugc nofollow" target="_blank"> Mailgun </a>的API来发送电子邮件，而不是通过SMTP(稍后将详细介绍)，最后，我们希望使用令人惊叹的<a class="ae jg" href="https://github.com/premailer/premailer" rel="noopener ugc nofollow" target="_blank"> Premailer </a> gem在发送电子邮件之前内嵌CSS样式。</p><p id="213a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">device是一个历史悠久、写得最好的ruby/rails库，也是最容易定制、变通和覆盖的库之一。虽然它做的太多了，但有时很难知道从哪里开始。</p><p id="8eb7" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将讨论定制Devise电子邮件的3种方法(或者程度，如果你愿意的话)。</p><p id="78a1" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv">方法1: </strong>简单定制device的默认邮件<br/> <strong class="jj hv">方法2: </strong>定制device用于发送邮件的“布局”和“模板”<br/> <strong class="jj hv">方法3: </strong>覆盖device发送邮件的方式，使用API (Mailgun)而不是SMTP</p><p id="8f33" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我将简要介绍前两种方法，并链接到其他资源</p><h2 id="9bee" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">方法1:简单定制Devise的默认电子邮件</h2><p id="f93d" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">如果你只想修改一些简单的布局，比如<strong class="jj hv">电子邮件确认</strong>电子邮件或<strong class="jj hv">密码重置</strong>电子邮件，那么这就是适合你的方法。首先在你的终端中运行以下程序，然后你可以在<em class="lf">视图/设计/邮件</em>中编辑你感兴趣的邮件的视图</p><pre class="lg lh li lj fq lk ll lm ln aw lo dt"><span id="90f0" class="kf kg hu ll b fv lp lq l lr ls">rails generate devise:views</span></pre><p id="b438" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">要了解更多细节，最好的地方是GitHub上的<a class="ae jg" href="https://github.com/plataformatec/devise#configuring-views" rel="noopener ugc nofollow" target="_blank">device Readme</a>。</p><h2 id="439a" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak">方法2: </strong>定制Devise用于发送电子邮件的“布局”和“模板”</h2><p id="5de4" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">如果您想更进一步，定制每个电子邮件模板呈现的布局，那么您可以通过创建自己的Mailer类来实现。Devise也有一个很好的自述文件，告诉你如何做到这一点:<a class="ae jg" href="https://github.com/plataformatec/devise/wiki/How-To:-Create-custom-layouts" rel="noopener ugc nofollow" target="_blank">如何:创建自定义布局</a>。</p><p id="1f8b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">使用这种方法需要注意几个潜在的问题。如果您有两种资源类型，比如说<strong class="jj hv">用户</strong>和<strong class="jj hv">个人</strong>(我们实际模型的名称)，拥有两个独立的邮件程序的最简单方法是在每个<em class="lf">资源</em>中使用方法<code class="eh lt lu lv ll b"><strong class="jj hv">devise_mailer</strong></code>。rb模型文件(下面是简化的例子)。如果您计划移动邮件模板的位置，请确保删除“设计/邮件”中的现有模板，因为它们将覆盖您的其他视图。</p><p id="3736" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是一个简单的定制设计邮件的例子:</p><pre class="lg lh li lj fq lk ll lm ln aw lo dt"><span id="4a01" class="kf kg hu ll b fv lp lq l lr ls">class RmtwrkDeviseMailer &lt; Devise::Mailer<br/>  helper  :application <em class="lf"># helpers defined within `application_helper`<br/>  </em>include Devise::Controllers::UrlHelpers <em class="lf"># eg. `confirmation_url`<br/></em>  default template_path: 'rmtwrk/devise/mailer<em class="lf"><br/>  </em>default from: 'RMTWRK &lt;rmtwrk@wrkhq.com&gt;'<br/>  default reply_to: 'RMTWRK &lt;rmtwrk@wrkhq.com&gt;'<br/>  layout  'mailer_rmtwrk'<br/>end</span></pre><p id="3cc0" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以告诉你的<strong class="jj hv">个人</strong>模型像这样使用<code class="eh lt lu lv ll b">devise_mailer</code>方法来使用这个邮件程序:</p><pre class="lg lh li lj fq lk ll lm ln aw lo dt"><span id="f3ad" class="kf kg hu ll b fv lp lq l lr ls">class Individual &lt; ApplicationRecord<br/>  devise :database_autenticatable,..., :confirmable</span><span id="f130" class="kf kg hu ll b fv lw lq l lr ls">  def devise_mailer<br/>    RmtwrkDeviseMailer<br/>  end<br/>end</span></pre><p id="23eb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">但是如果你想在发送之前对邮件做一些其他的事情呢？这就是方法3的用武之地。</p><h2 id="41b1" class="kf kg hu bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak">方法3: </strong>覆盖Devise发送电子邮件的方式，使用API而不是SMTP</h2><p id="ed62" class="pw-post-body-paragraph jh ji hu jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">我们的限制:</p><ol class=""><li id="4403" class="lx ly hu jj b jk jl jo jp js lz jw ma ka mb ke mc md me mf dt translated">通过API而不是SMTP发送电子邮件。出于各种原因，大多数电子邮件提供商建议使用他们的API而不是SMTP。这里以<a class="ae jg" href="https://sendgrid.com/blog/web-api-or-smtp-relay-how-should-you-send-your-mail/" rel="noopener ugc nofollow" target="_blank">森德里德的</a>和<a class="ae jg" href="https://help.mailgun.com/hc/en-us/articles/202236484-Should-I-use-SMTP-or-the-HTTP-API-" rel="noopener ugc nofollow" target="_blank">麦根的</a>理由为例。</li><li id="bd4e" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke mc md me mf dt translated">两个<em class="lf">资源</em>模型；<strong class="jj hv">用户</strong>和<strong class="jj hv">个人</strong>，使用定计。</li><li id="2f5a" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke mc md me mf dt translated">独立品牌，即每个型号的<em class="lf">布局</em>文件。</li><li id="c499" class="lx ly hu jj b jk mg jo mh js mi jw mj ka mk ke mc md me mf dt translated">使用Premailer内联我们的CSS。</li></ol><p id="221f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了实现这一点，这个难题的关键部分是覆盖您感兴趣的<code class="eh lt lu lv ll b">Devise::Mailer</code>方法。在本例中，我们将只关注电子邮件确认电子邮件。默认情况下，这由<code class="eh lt lu lv ll b">confirmation_instructions</code>方法处理，默认情况下使用<code class="eh lt lu lv ll b">ActionMailer</code>和SMTP。</p><p id="8a6a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是我们最终定制设计邮件程序的样子:</p><figure class="lg lh li lj fq iv"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="ed8d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我希望这有所帮助！请留下评论或问题，我很乐意回应，但老实说，在10个月左右的时间里，最有可能发现这个问题的人可能就是我，嗨，未来的我！</p><p id="726a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最佳——安德鲁·格蒂格</p></div></div>    
</body>
</html>