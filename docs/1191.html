<html>
<head>
<title>Ingesting IoT and Sensor Data at Scale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">大规模吸收物联网和传感器数据</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ingesting-iot-and-sensor-data-at-scale-ee548e0f8b78#2019-02-19">https://medium.com/hackernoon/ingesting-iot-and-sensor-data-at-scale-ee548e0f8b78#2019-02-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="22cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">随着过去几年物联网设备数量的激增，智能工厂和智能城市等相对较新的物联网和传感器数据用例导致了时间序列数据的大规模产生。在这种用例中，大量不同种类的传感器发送万亿字节的数据，以便实时监控可以提高效率并避免故障。举个例子，一架波音 787 飞机在一次飞行中会产生 5tb 的数据。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/7a112df740772b2bb66bdb102f526513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*RLi0U8tWY-tRnJ4qQV28jg.gif"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A factory producing bottle packaging</figcaption></figure><p id="de1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们来看看如何应对时间序列数据的挑战，并在保持高可用性的同时大规模处理此类数据的高吞吐量。</p><h1 id="bf5d" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">时间序列数据</h1><p id="4ef3" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">时间序列数据是带有时间戳的任何数据。如果你将这种数据绘制在图表上，它的一个轴上会有时间。时间序列数据工作负载不同于其他种类数据的工作负载，因为时间序列数据主要是插入的，但很少更新。时间序列数据库通过将时间视为一等公民来引入效率。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff li"><img src="../Images/6effbea9cf350e41e0790ec15e44da41.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHrJIW-0R7a7LfWChPYPtw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">A time-series data graph</figcaption></figure><p id="0525" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">记录大量时间序列数据使我们能够深入了解操作的各个方面，例如:</p><ol class=""><li id="2502" class="lj lk hu it b iu iv iy iz jc ll jg lm jk ln jo lo lp lq lr dt translated"><strong class="it hv">分析过去:</strong>了解各种传感器的状态如何随时间变化，有助于我们了解当系统处于特定状态时，性能是如何受到影响的。它还允许我们回到某个特定的时间点，并了解特定错误发生的原因。</li><li id="27d3" class="lj lk hu it b iu ls iy lt jc lu jg lv jk lw jo lo lp lq lr dt translated"><strong class="it hv">监控现状:</strong>让传感器实时传输数据到您的仪表盘上有助于监控关键任务系统，以便有效地调试和识别需要维修的组件。</li><li id="a4e4" class="lj lk hu it b iu ls iy lt jc lu jg lv jk lw jo lo lp lq lr dt translated"><strong class="it hv">预测未来:</strong>将丰富的历史数据插入机器学习框架，可以用来生成关于未来的可行见解，以便在问题出现之前就发现并解决问题(预测性维护)。</li></ol><h1 id="b649" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">时序数据的使用案例和挑战</h1><p id="66b6" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">在抽象层次上，时序用例可以分为两大类。第一个是传统的 IT 和系统监控。InfluxDB 之类的时序数据库非常适合为这类用例获取时序数据。第二个用例是智能工厂或智能城市，其中工业时间序列数据通常需要完全不同的尺度，这不适合由传统的时间序列数据库处理。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lx"><img src="../Images/2cbb044fd192847ee5c0657856786e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MSpgw5TkJ014mNz7WdTwDQ.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">IT Monitoring vs Smart Factory use case</figcaption></figure><p id="5480" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看此<a class="ae ly" href="http://go.cratedb.com/time-series.html" rel="noopener ugc nofollow" target="_blank">白皮书</a>以了解更多关于 CrateDB 时间序列和专门的时间序列数据库(如 InfluxDB)之间的功能差异，以及 CrateDB 和 InfluxDB 之间的性能基准。</p><h1 id="cd36" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">什么是 CrateDB？</h1><p id="ac25" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">我们在这些用例中寻找的关键特征是水平扩展和自我修复集群。<a class="ae ly" href="https://crate.io/" rel="noopener ugc nofollow" target="_blank"> CrateDB </a>是一种新型的分布式 SQL 数据库，它非常擅长处理工业时间序列数据，因为它易于使用，并且能够处理具有数千个传感器数据结构的数万亿字节的时间序列数据。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lz"><img src="../Images/e3d7459e83a428cc043d551bd548f99a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4pSiMK3Fb23Qh4PlmmdjFw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">CrateDB Admin UI</figcaption></figure><p id="2842" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">CrateDB 在一个无共享架构中作为一个由相同配置的服务器(节点)组成的集群运行。这些节点彼此无缝协作，写和查询操作的执行自动分布在集群中的节点上。</p><p id="abb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">增加或减少数据库容量是一项添加或删除节点的任务。随着群集大小的变化，数据的分片、复制(用于容错)和重新平衡都是自动进行的。你为什么不带着 CrateDB 去兜兜风？</p><p id="60fc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">CrateDB 也托管在 Microsoft Azure 上，允许您连接到 Azure 必须提供的各种服务。</p><h1 id="44ae" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">活动枢纽+ CrateDB？</h1><p id="0a66" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">Azure Event Hubs 是一个实时数据摄取服务，允许您每秒从任何来源传输数百万个事件，以构建动态数据管道。它专为大规模消息传递和处理数据流而构建，例如来自智能工厂或智能城市基础设施的工业物联网数据。通过事件中心的数据流可以传递给 Azure 函数，以便进一步丰富或转换。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ma"><img src="../Images/5fd2c9bceccc64ba988a14d97c347bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTO7kTWFXy-0je-RWm1ijw.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">CrateDB on Microsoft Azure</figcaption></figure><p id="9010" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完成后，处理后的数据被捕获到 CrateDB 中进行分析。使用<a class="ae ly" href="https://crate.io/event-hubs-integration/" rel="noopener ugc nofollow" target="_blank"> CrateDB 活动中心连接器</a>可以将 CrateDB 连接到活动中心。这使得实时集成和分析物联网数据变得更加容易，以便监控、预测或控制智能系统的行为。该连接器可以扩展到每秒从事件中心或物联网中心接收数百万个遥测数据读数，并将其插入 CrateDB。</p><h1 id="4563" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">摄取性能的实验</h1><p id="8828" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">这听起来确实像是天作之合。我们决定检查一下 CrateDB 在这个工作流中的表现。首先需要决定的是输入数据的格式。我们选择的数据看起来接近智能工厂中传感器的数据。</p><pre class="jq jr js jt fq mb mc md me aw mf dt"><span id="413a" class="mg kg hu mc b fv mh mi l mj mk">OBJECT<br/>payload[‘model’] STRING<br/>payload[‘objectId’] STRING<br/>payload[‘timestamp’] STRING<br/>payload[‘value’] LONG<br/>payload[‘variable’] STRING</span></pre><p id="4a1c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">每条消息的有效负载大小约为 100 字节。我们继续部署两个 Event hub 名称空间，每个名称空间有 20 个吞吐量单位(TPU)的 Azure Event Hubs。活动中心的<a class="ae ly" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-features#capacity" rel="noopener ugc nofollow" target="_blank">吞吐能力</a>由吞吐单位控制。我们通过使用 CrateDB 的事件中心连接器将事件中心连接到 CrateDB，并运行 32 个消费者 pod(每个分区一个消费者)。可以调整这两个设置来增加吞吐量。</p><p id="69f6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于 CrateDB 云设置，我们部署了 7 个节点，复制因子设置为 1 和 21 个碎片(每个节点 3 个碎片)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ml"><img src="../Images/b48ad8c501df80266c23e3c913b8cd22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54Jz2GkKAt3osfKeP6-LOg.png"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Grafana dashboard showing the ingestion metrics</figcaption></figure><p id="f3db" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们每秒能够接收超过 110，000 条消息，也就是每天大约 100 亿条消息。顺便说一下，以这样的速度摄入，每天会产生大约 1.5 TB 的数据。</p><h1 id="53c2" class="kf kg hu bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc dt translated">让机器数据发挥作用！</h1><p id="ca1f" class="pw-post-body-paragraph ir is hu it b iu ld iw ix iy le ja jb jc lf je jf jg lg ji jj jk lh jm jn jo hn dt translated">这个实验展示了在事件中心的帮助下，你可以从你的物联网设备或传感器摄取大量数据到 CrateDB。拥有如此丰富的时间序列数据使我们能够收集真正有价值的数据，这些数据可以为我们提供关于调试问题和避免未来可能发生的故障的可行见解。</p><p id="9df9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">CrateDB Cloud 托管在微软 Azure 上，你可以将它连接到 Azure 提供的许多服务，如用于生成见解的机器学习工作室或用于可视化数据的 Grafana。我们正处于一个数据蓬勃发展的时代，为什么不把它运用到工作中，让我们的生活更轻松、更安全、更美好呢！</p><p id="22c9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在推特上给我喊一声！我很想知道你们目前是如何扩展机器数据基础设施的，以及你们打算如何使用 CrateDB。</p></div></div>    
</body>
</html>