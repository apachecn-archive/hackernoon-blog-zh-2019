<html>
<head>
<title>Deploying a Node.js Twitter Bot on AWS Lambda using Webpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Webpack在AWS Lambda上部署Node.js Twitter Bot</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/deploying-a-node-js-twitter-bot-on-aws-lambda-using-webpack-df6e2e187a78?source=collection_archive---------9-----------------------#2019-02-11">https://medium.com/hackernoon/deploying-a-node-js-twitter-bot-on-aws-lambda-using-webpack-df6e2e187a78?source=collection_archive---------9-----------------------#2019-02-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c7a516fa48b3bc3cda7189f7c27c6520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DieJz9sNLgCBgPlraWy85Q.png"/></div></div></figure><p id="c183" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最近，我有了一个为<a class="ae ka" href="https://twitter.com/hashtag/LearnInPublic" rel="noopener ugc nofollow" target="_blank"> #LearnInPublic </a>社区开发一个<a class="ae ka" href="https://twitter.com/_LearnInPublic_" rel="noopener ugc nofollow" target="_blank"> Twitter机器人</a>的想法，我认为这将是一个有趣的项目，只需要半天的工作。而且，为了学习，我想用AWS Lambda函数。为什么选择AWS Lambda？因为维护一个twitter机器人实际上是免费的，而且我也亲身体验了一个在业界广泛使用的看似复杂的工具。AWS Lambda每月有100万个免费请求和40万秒的计算时间。我的bot使用上述数字的0.02%。</p><p id="27f8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这个过程中，我发现了一个很酷的用例Webpack。我很高兴阅读webpack文档并了解了这些问题。尽管这是一个非常原始的用例，但有一天我感觉像一个真正的肖恩·拉金。这里有一篇关于如何做同样事情的详细文章。</p><blockquote class="kb kc kd"><p id="2577" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated"><strong class="je hv">关于机器人本身的一点信息。</strong></p><p id="9b9b" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">大约半年前，当Shaun Weng写下关于在公共场合学习的文章时，我产生了前所未有的共鸣。这感觉像是朝着正确的方向推了一把，我最终保存了这篇文章，并不时地阅读它作为激励。我认为写一个机器人会很酷，它会定期发布相同的<a class="ae ka" href="https://twitter.com/swyxa" rel="noopener ugc nofollow" target="_blank"> swyx </a>帖子(这样它会不断出现在我的feed上)并转发所有带有#LearnInPublic标签的帖子，将社区的工作集中在一个屋檐下(个人资料)。</p></blockquote><h1 id="d564" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">先决条件</h1><p id="697e" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">不用说，您需要在计算机上安装Node.js、一个用于bot的Twitter帐户和一个AWS帐户。本教程还假设您熟悉node，不会深入研究bot的工作方式。</p><p id="f74e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">本教程分为三个主要部分</strong></p><ol class=""><li id="2c19" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lq lr ls lt dt translated">设置好一切(Twitter、AWS控制台、Bot配置)。</li><li id="b886" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">编写bot并用Webpack构建它。</li><li id="07f8" class="ll lm hu je b jf lu jj lv jn lw jr lx jv ly jz lq lr ls lt dt translated">使用AWS Lambda部署！</li></ol><h1 id="6aef" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated"><strong class="ak">设置</strong></h1><p id="c657" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">这一部分处理所有你需要为你将要使用的每个平台注意的帐户设置。</p><ul class=""><li id="c3a1" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated"><strong class="je hv">推特</strong></li></ul><p id="d1b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你必须为机器人创建一个新帐户，它将负责在其个人资料上发布/转发。一旦你完成了，去https://developer.twitter.com/建立一个开发者账户。</p><p id="9c39" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过填写适当的信息，在https://developer.twitter.com/en/apps/create创建一个新的应用程序。成功创建应用程序后，记下API密钥和访问令牌。</p><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ma"><img src="../Images/819b1c00c72f8da062acb08f51d73e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XN9M9CL6Qcv4RfPsmd5BNg.png"/></div></div></figure><ul class=""><li id="1436" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated"><strong class="je hv"> AWS </strong></li></ul><p id="2296" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您应该有一个AWS帐户才能继续，如果没有，您可以在<a class="ae ka" href="https://aws.amazon.com/account/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/account/</a>创建一个。完成后，我们可以继续设置lambda函数。</p><p id="af38" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我是第一次使用AWS，所以我不确定我是否正确理解了身份工具(I am用户和角色),或者我是否正确使用了它们，但是这些是我根据对文档的最佳理解采取的步骤，它确实有效，所以这里不再赘述\_(ツ)_/。</p><p id="32ad" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当您在AWS上创建帐户并使用电子邮件/密码登录时，您是以root用户身份登录的。root用户拥有对所有AWS服务和资源的完全访问权限，因此建议不要使用root用户执行日常任务。为了提高安全性和组织性，您可以将AWS帐户的访问权限授予特定用户，即您使用自定义权限创建的身份。这就是AWS IAM发挥作用的地方。</p><blockquote class="kb kc kd"><p id="0dda" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">WS身份和访问管理(IAM)使您能够安全地管理对服务和资源的访问。使用IAM，您可以创建和管理AWS用户和组，并使用权限来允许和拒绝他们对AWS资源的访问。</p></blockquote><p id="b068" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">转到<a class="ae ka" href="https://console.aws.amazon.com/iam/home" rel="noopener ugc nofollow" target="_blank"> AWS IAM控制台</a>创建一个新用户。给它起个名字，这样你就能知道它的用途(比如twitter-bot)。请确保用户附加了AWSLambdaFullAcces策略。</p><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/eb4ee8c5c9717ee0346dafccf167acdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSqhbLmMy-ye3A7cIkt83w.png"/></div></div></figure><p id="f055" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，还要创建IAM角色，IAM角色是向您信任的实体授予权限的安全方式。您可以从同一个AWS IAM控制台创建角色。选择Lambda作为将使用此角色的服务。</p><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mg"><img src="../Images/f50f86c35f6d3f34b6d492c0f57ea31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FXLVtIJgEWxvgxF07xSO8Q.png"/></div></div></figure><p id="1bcd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您还必须为该角色附加相同的AWSLambdaFullAcces权限策略。给它一个合适的名字(如lambda-twitter-bot)，描述并创建角色。</p><ul class=""><li id="7785" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated"><strong class="je hv">推特机器人</strong></li></ul><p id="293b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我使用了npm包<a class="ae ka" href="https://www.npmjs.com/package/twit" rel="noopener ugc nofollow" target="_blank"> twit </a>，它是一个Twitter API客户端，用于node与Twitter API进行交互。一旦你写好了机器人，你需要上传一个压缩的zip文件到AWS Lambda控制台。</p><p id="8ff6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用Webpack捆绑应用程序，并为上传压缩一个文件，而不是上传整个<code class="eh mh mi mj mk b">node_modules</code>,这可能会有开发依赖关系和其他配置文件夹。</p><p id="7025" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为您的项目创建一个文件夹，并在切换到该目录后初始化您的节点项目。然后，安装twit作为项目的依赖项。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="98d7" class="mp kj hu mk b fv mq mr l ms mt">mkdir twitter-bot</span><span id="52fb" class="mp kj hu mk b fv mu mr l ms mt">cd twitter-bot &amp;&amp; npm init -y</span><span id="32bb" class="mp kj hu mk b fv mu mr l ms mt">npm install --save twit</span></pre><p id="ce9d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们需要为开发和生产环境设置从twitter获得的API键。我们将使用API键的本地副本维护一个<code class="eh mh mi mj mk b">dev.js</code>，并使用<code class="eh mh mi mj mk b">prod.js</code>来访问绑定到相同API键的生产环境变量，我们最终将在AWS Lambda控制台上设置这些变量。如果你上传你的代码到GitHub，确保你没有提交<code class="eh mh mi mj mk b">dev.js</code>，把它添加到. gitignore。根据环境我们会导出适当的文件。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="35d1" class="mp kj hu mk b fv mq mr l ms mt">mkdir config &amp;&amp; cd config</span><span id="30ff" class="mp kj hu mk b fv mu mr l ms mt">touch index.js<br/>touch dev.js<br/>touch prod.jS</span></pre><p id="7dcd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> index.js </strong></p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="bca2" class="mp kj hu mk b fv mq mr l ms mt">if (process.env.NODE_ENV === 'production') {<br/>module.exports = require('./prod');<br/>} else {<br/>module.exports = require('./dev');<br/>}</span></pre><p id="f433" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> dev.js </strong></p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="bdd0" class="mp kj hu mk b fv mq mr l ms mt">module.exports = {<br/>consumer_key: 'YOUR CONSUMER KEY HERE',<br/>consumer_secret: 'YOUR CONSUMER SECRET HERE',<br/>access_token: 'YOUR ACCESS TOKEN HERE',<br/>access_token_secret: 'YOUR ACCESS TOKEN  HERE'<br/>};</span></pre><p id="5fbe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> prod.js </strong></p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="2688" class="mp kj hu mk b fv mq mr l ms mt">module.exports = {<br/>consumer_key: process.env.CONSUMER_KEY,<br/>consumer_secret: process.env.CONSUMER_SECRET,<br/>access_token: process.env.ACCESS_TOKEN,<br/>access_token_secret: process.env.ACCESS_TOKEN_SECRET<br/>}</span></pre><h1 id="b40c" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">编写bot并用Webpack构建它</h1><p id="98ac" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">对于我的机器人，我需要AWS Lambda在不同的时间间隔触发两种不同的功能(tweet和retweet)。让我们仅以其中一个为例进行讨论。(如果你有和我相似的用例，就像我一样部署两个lambda函数)。这个例子是一个机器人转发某个标签，但不转发自己的帖子。</p><p id="d63d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">AWS lambda函数的格式如下，因此您需要导出您的函数:</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="75c5" class="mp kj hu mk b fv mq mr l ms mt">exports.handler = (event, context, callback) =&gt; {<br/>   //function logic<br/>}</span></pre><figure class="mb mc md me fq iv"><div class="bz el l di"><div class="mv mw l"/></div></figure><p id="d6fd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">有趣的事实:不要使用forEach循环，因为它们不支持异步代码。</strong> <a class="ae ka" href="https://codeburst.io/javascript-async-await-with-foreach-b6ba62bbf404" rel="noopener" target="_blank"> <strong class="je hv">这里有一篇关于同一</strong> </a> <strong class="je hv">的大文章。</strong></p><p id="06df" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我不会太深入地探究机器人代码的工作原理，如果你阅读twit 的<a class="ae ka" href="https://www.npmjs.com/package/twit" rel="noopener ugc nofollow" target="_blank">文档的话，这很简单。你查询所有带有给定标签的最近的推文。在收到响应时，您分解所有的状态，遍历它们并转发它们。<code class="eh mh mi mj mk b">for .. of</code>循环与异步async/await配合得很好。</a></p><p id="d82b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以通过进入Node.js控制台来测试代码。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="c496" class="mp kj hu mk b fv mq mr l ms mt">&gt; node<br/>&gt; let retweeter = require('index.js');<br/>&gt; retweeter.retweet();</span></pre><p id="618a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">网络背包！！！！！！</strong></p><p id="2865" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我们捆绑代码，以便更容易地部署到AWS Lambda，因为我们不需要在我们的zip中没有<code class="eh mh mi mj mk b">node_modules</code>。</p><blockquote class="kb kc kd"><p id="9311" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated"><a class="ae ka" href="https://webpack.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> Webpack </strong> </a>是一个针对现代JavaScript应用的<em class="hu">静态模块捆绑器</em>。当webpack处理您的应用程序时，它会在内部构建一个<a class="ae ka" href="https://webpack.js.org/concepts/dependency-graph/" rel="noopener ugc nofollow" target="_blank">依赖图</a>，它会映射您的项目需要的每个模块，并生成一个或多个<em class="hu">包</em>。</p></blockquote><p id="6981" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Webpack v4比以前更容易使用，默认情况下甚至不需要配置文件。对于初学者来说，这可能看起来令人生畏(就像很长一段时间以来它对我一样)，但是它被很好地记录下来，并且很容易找到绕过它的方法。</p><p id="bc9f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">步骤1:将Webpack安装为开发依赖项。</strong></p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="024f" class="mp kj hu mk b fv mq mr l ms mt">npm install --save-dev webpack wepback-cli</span></pre><p id="dd5c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第二步:修改</strong> <code class="eh mh mi mj mk b"><strong class="je hv">package.json</strong></code> <strong class="je hv">添加构建脚本。</strong></p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="b0f7" class="mp kj hu mk b fv mq mr l ms mt">//package.json</span><span id="1b45" class="mp kj hu mk b fv mu mr l ms mt">{<br/>  "name": "twitter-bot", <br/>  "version": "1.0.0",<br/>  ...<br/>  "scripts":{<br/>   <strong class="mk hv"> "build": "webpack",</strong><br/>    ....<br/>  },<br/>  ......<br/>  "devDependencies": {<br/>    "webpack": "^4.29.0",<br/>    "webpack-cli": "^3.2.1"<br/>  },  <br/>  "dependencies": {<br/>    "twit": "^2.2.11"<br/>  }<br/>}</span></pre><p id="e52b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第三步:添加Webpack配置。</strong></p><p id="c5cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将<code class="eh mh mi mj mk b">webpack.config.js</code>添加到项目目录的根级别。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="5c12" class="mp kj hu mk b fv mq mr l ms mt">//webpack.config.js</span><span id="d9f7" class="mp kj hu mk b fv mu mr l ms mt">const path = require('path');</span><span id="ff46" class="mp kj hu mk b fv mu mr l ms mt">module.exports = {<br/>    entry: './index.js',<br/>    output: {<br/>      path: path.resolve(__dirname, './dist'),<br/>      filename: 'index.js',<br/>      libraryTarget: 'commonjs'<br/>    },<br/>    target: 'node',<br/>    mode: 'production'<br/>}</span></pre><p id="5657" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">以下是所有参数的用途列表</p><p id="6d22" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意:如果你有多个不同配置的函数(就像我需要两个不同的输出给不同的lambda函数)，你可以通过导出一个config对象数组来导出多个配置。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="cf32" class="mp kj hu mk b fv mq mr l ms mt">module.exports = [{<br/>  //config 1<br/>},{<br/>  //config 2<br/>}]</span></pre><p id="146b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">条目</strong></p><blockquote class="kb kc kd"><p id="9539" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">入口点指示webpack应该使用哪个模块来开始构建它的内部<a class="ae ka" href="https://webpack.js.org/concepts/dependency-graph/" rel="noopener ugc nofollow" target="_blank">依赖图</a>。Webpack将计算出入口点依赖于哪些其他模块和库(直接和间接)。</p></blockquote><p id="0875" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个机器人的切入点是<code class="eh mh mi mj mk b">index.js</code>。</p><p id="8ddd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">输出</strong></p><blockquote class="kb kc kd"><p id="50ad" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">output属性告诉webpack在哪里发出它创建的<em class="hu">包</em>以及如何命名这些文件。</p></blockquote><p id="2a29" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mh mi mj mk b">output.path</code>告诉webpack在哪里发出包，<code class="eh mh mi mj mk b">output.filename</code>用于指定包名。</p><p id="ae7d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为按照AWS规范，<code class="eh mh mi mj mk b">index.js</code>用<code class="eh mh mi mj mk b">retweet</code>函数导出一个对象，所以我们的bundle也应该这样做。您可以在节点控制台中测试这种行为。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="25b6" class="mp kj hu mk b fv mq mr l ms mt">&gt; var library = require('./index.js');</span><span id="af6a" class="mp kj hu mk b fv mu mr l ms mt">&gt; library</span><span id="554e" class="mp kj hu mk b fv mu mr l ms mt">{  retweet: [AsyncFunction: hashtagRetweet]  }</span></pre><p id="3caa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh mh mi mj mk b">output.libraryTarget: "commonjs"</code>确保在包本身中，由webpack从入口点生成的函数将被分配给<code class="eh mh mi mj mk b">exports</code>对象。</p><p id="5aaf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">目标</strong></p><blockquote class="kb kc kd"><p id="d2ba" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">指示webpack以特定环境为目标。使用<code class="eh mh mi mj mk b">node</code>编译以便在类似Node.js的环境中使用</p></blockquote><p id="90d9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">模式</strong></p><blockquote class="kb kc kd"><p id="6a35" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">通过将<code class="eh mh mi mj mk b">mode</code>参数设置为<code class="eh mh mi mj mk b">development</code>、<code class="eh mh mi mj mk b">production</code>或<code class="eh mh mi mj mk b">none</code>，您可以启用webpack对应于每个环境的内置优化。默认值为<code class="eh mh mi mj mk b">production</code>。</p></blockquote><p id="9e0f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是webpack的全部内容！快速启动您的终端和<code class="eh mh mi mj mk b">npm run build</code>，在<code class="eh mh mi mj mk b">./dist</code>中生成您的生产级捆绑包。压缩dist文件夹，因为Lambda控制台只接受。压缩文件。</p><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="a418" class="mp kj hu mk b fv mq mr l ms mt">&gt; <!-- -->npm run build<br/>&gt; cd dist<br/>&gt; zip bot.zip index.js</span></pre><h1 id="f961" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated">使用AWS Lambda部署！</h1><p id="4225" class="pw-post-body-paragraph jc jd hu je b jf lg jh ji jj lh jl jm jn li jp jq jr lj jt ju jv lk jx jy jz hn dt translated">在我们旅程的最后阶段，我们会让这个坏小子活下来！我们想上传我们的lambda函数，并确保它在设定的时间间隔内被触发。AWS自带的CloudWatch Event是完美的解决方案。CloudWatch事件触发器允许您安排函数调用。这基本上是你的lambda函数的cronjob。</p><ul class=""><li id="20dd" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">转到您的Lambda管理控制台，您可以从导航栏中的服务访问它。在那里创建一个新的lambda函数。</li></ul><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mx"><img src="../Images/3373d214129a64b9e6a2255848bb98cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H76uoaH7OWUuUY4sCH3mqA.png"/></div></div></figure><ul class=""><li id="913e" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">给它一个合适的名称，选择Node.js 8.10运行时，并选择您之前在设置阶段创建的角色。async/await语法等新特性可以工作，因为AWS Lambda支持最新的节点运行时。在lambda控制台中，你有各种选项来触发你的功能。</li></ul><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/ce33d00473617fc4ecc885b26d03e3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaWPchodU0hta6L9Af_5NQ.png"/></div></div></figure><ul class=""><li id="25d8" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">从dist文件夹上传zip文件。在这个例子中，将文件名改为<code class="eh mh mi mj mk b">[filename].[function name]</code>，它将是<code class="eh mh mi mj mk b">index.retweet</code></li></ul><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/3624cc073e5fd8b0be2c3f702593e7b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ac7zayF1fhOcxdskGs-gig.png"/></div></div></figure><ul class=""><li id="f380" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">接下来，我们添加生产环境变量。向下滚动找到输入环境变量的部分。打开你的<code class="eh mh mi mj mk b">prod.js</code>文件，一个一个复制环境变量。要特别注意，确保复制了准确的变量名。</li></ul><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/3a66e6ac0e20f189597e42fbc39fd4af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jCrqyPcllMRAuOtiHo4y9A.png"/></div></div></figure><ul class=""><li id="9ae0" class="ll lm hu je b jf jg jj jk jn ln jr lo jv lp jz lz lr ls lt dt translated">最后，在函数设计器中添加一个CloudWatch事件触发器。选择CloudWatch事件并向下滚动以配置它。创建一个新规则，您可以在其中声明调用函数的速率。</li></ul><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff my"><img src="../Images/8a8d75ac2c405f7edbde2603a51a0b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGsGCLeojWXpPRYpGwsVyQ.png"/></div></div></figure><pre class="mb mc md me fq ml mk mm mn aw mo dt"><span id="de78" class="mp kj hu mk b fv mq mr l ms mt">//Syntax:</span><span id="3fc0" class="mp kj hu mk b fv mu mr l ms mt">rate(V<em class="ke">alue</em><em class="ke"> U</em><em class="ke">nit</em>)</span><span id="aa32" class="mp kj hu mk b fv mu mr l ms mt">// <em class="ke">Value</em> is a positive number<br/>// <em class="ke">Unit</em> can be minute | minutes | hour | hours | day | days</span></pre><p id="6e47" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，函数调用之间的持续时间为5分钟，表达式应该是<code class="eh mh mi mj mk b">rate(5 minutes)</code></p><figure class="mb mc md me fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mz"><img src="../Images/6e6e56744edf61e83f37a00fb3c5f5e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MXS_22RYmn79cHbLJJyN9w.png"/></div></div></figure><p id="26f3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存这个函数，你的机器人应该准备好了！使用顶部的测试按钮测试您的功能。Out bot的函数不带任何参数。你的机器人会准备好，发挥它的魔力，为你节省时间和金钱。</p><p id="2c66" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您不需要lambda函数的一些指标，monitoring选项卡下的CloudWatch指标提供了一些关于调用、持续时间、错误、可用性等的很酷的图表，可以为您提供函数性能的估计。你也可以阅读捕获<code class="eh mh mi mj mk b">console.log</code>的CloudWatch日志，这可能有助于你调试东西。</p><p id="5711" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">但是你的机器人现在已经可以在没有任何人工帮助的情况下运行推特了！为自己感到骄傲！感谢阅读</p></div><div class="ab cl na nb hc nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="hn ho hp hq hr"><p id="4582" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我是一个在印度的网络和移动开发人员。我喜欢React/React Native/JavaScript。我写我在技术、项目和黑客马拉松方面的冒险经历。如果这篇文章对你有帮助，那就砸了那个like按钮(jk但是你可以拍拍他们)。</p><p id="8695" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我是Twitter上的sumdook，如果你想和我谈论React，tech，JS，足球，动漫，电子竞技和任何事情。我也在重做我的网站，我一完成就链接，干杯。</p></div></div>    
</body>
</html>