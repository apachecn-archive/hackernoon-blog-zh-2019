<html>
<head>
<title>Custom business insight using built-in AWS features</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用内置 AWS 功能定制业务洞察力</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/custom-business-insight-using-built-in-aws-features-c399272b44d#2019-06-25">https://medium.com/hackernoon/custom-business-insight-using-built-in-aws-features-c399272b44d#2019-06-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="f0ed" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">使用无服务器框架轻松创建仪表板</h2></div><p id="a9a1" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了这篇文章的目的，我们将进入一个新创建的网上赌场的主人的鞋子。我们的第一个游戏是轮盘赌，它的后端是 AWS 上的一个无服务器 API。我们将会发现如何获得一些关于我们游戏的指标。</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff kf"><img src="../Images/b3a1177518a63e74a7a6808d298bfcc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkBtlzwZQZYdVrpLYk6ewQ.jpeg"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Photo by <a class="ae kv" href="https://unsplash.com/@kaysha?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Kay</a> on <a class="ae kv" href="https://unsplash.com/search/photos/gambling?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="d9a7" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">轮盘 API</h1><p id="835e" class="pw-post-body-paragraph jj jk hu jl b jm lo iv jo jp lp iy jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">我们的 API 提供了一个端点来处理玩家的赌注，并返回一个 0 到 36 之间的随机整数。使用<a class="ae kv" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器框架</a>，您可以轻松实现这一点:</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lt lu l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">The definition of our service, we will complete it later</figcaption></figure><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lt lu l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">A simplified roulette game (only checks for the exact value)</figcaption></figure><p id="489c" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们的代码已经准备好了，您可以通过运行:</p><p id="922f" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lv lw lx ly b">serverless deploy —-stage staging --region eu-west-3</code></p><p id="a428" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在部署日志中找到 API URL，并通过查询 API 开始播放:</p><pre class="kg kh ki kj fq lz ly ma mb aw mc dt"><span id="ffef" class="md kx hu ly b fv me mf l mg mh">export CASINO_URL=<a class="ae kv" href="https://ls7sjcayle.execute-api.eu-west-3.amazonaws.com/staging/roulette" rel="noopener ugc nofollow" target="_blank">https://xxxxxxxxxx.execute-api.eu-west-3.amazonaws.com/staging/roulette</a></span><span id="ab20" class="md kx hu ly b fv mi mf l mg mh">curl -X POST $CASINO_URL -d '{"bet":50,"number": 13}' -H 'Content-Type: application/json'</span><span id="e1dc" class="md kx hu ly b fv mi mf l mg mh">{"win":false,"result":12}</span></pre><p id="9729" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">太好了，我们有一个正常运转的赌场，多亏了我们的广告宣传，玩家们开始使用它了。为了推动我们的下一步决策，我们需要一些商业洞察力。特别是，我们想知道下注值在一天中如何随时间变化。我们的工程团队已经在忙于构建一个扑克游戏，所以我们需要一些真正快速设置。</p><p id="a8a3" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">好消息，各位！你可以在 CloudWatch 上创建这种自定义指标/仪表板，甚至有一个无服务器插件来实现自动化。您将看到我们甚至不需要更新 JavaScript 代码。</p><h1 id="e9ea" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">云观察指标</h1><blockquote class="mj mk ml"><p id="6cb0" class="jj jk mm jl b jm jn iv jo jp jq iy jr mn jt ju jv mo jx jy jz mp kb kc kd ke hn dt translated">度量是 CloudWatch 中的基本概念。<strong class="jl hv">指标代表发布到 CloudWatch 的一组按时间排序的数据点。</strong>将一个指标想象成<strong class="jl hv">一个要监控的变量</strong>，数据点代表<strong class="jl hv">该变量在一段时间内的值</strong>。例如，特定 EC2 实例的 CPU 使用率是 Amazon EC2 提供的一个指标。数据点本身<strong class="jl hv">可以来自您收集数据的任何应用程序或业务活动</strong>。— <a class="ae kv" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/cloudwatch_concepts.html#Metric" rel="noopener ugc nofollow" target="_blank">文档</a></p></blockquote><p id="55a9" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在我们的例子中，我们将创建一个定制的指标:随时间变化的 bet 值。我们已经记录了请求体，因此下面是我们的自定义指标属性:</p><ul class=""><li id="86c0" class="mq mr hu jl b jm jn jp jq js ms jw mt ka mu ke mv mw mx my dt translated"><strong class="jl hv">过滤模式:</strong> <code class="eh lv lw lx ly b">{ $.bet = * }<br/></code>该语法使用 JSON 路径来过滤我们想要用于度量的日志。在我们的例子中，我们对打印请求体的日志感兴趣(包括<code class="eh lv lw lx ly b">bet</code>属性)。</li><li id="26fd" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jl hv">度量值:</strong> <code class="eh lv lw lx ly b">$.bet<br/></code>仍然使用 JSON 路径，定义您想要保留什么属性作为度量值:在我们的例子中是 bet 值。</li><li id="2fa0" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated"><strong class="jl hv">日志组名称:</strong> <code class="eh lv lw lx ly b">/aws/lambda/online-casino-staging-roulette<br/></code>表示数据的来源。我们希望我们的指标显示出对轮盘游戏的洞察力，而不是对新扑克游戏的洞察力。还有，别忘了更新名字里的舞台。</li></ul><p id="3112" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">你可以在这里得到更多关于过滤器和模式语法的信息。</p><h1 id="4e45" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">无服务器插件指标</h1><p id="9422" class="pw-post-body-paragraph jj jk hu jl b jm lo iv jo jp lp iy jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">就像几乎所有的一样，有一个无服务器插件来自动创建定制的指标。首先，安装它，我们将在我们的<code class="eh lv lw lx ly b">serverless.yml</code>后面添加几行来创建指标:</p><p id="fbea" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><code class="eh lv lw lx ly b">npm install --save-dev serverless-plugin-metric</code></p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lt lu l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Append these lines to the existing serverless.yml file</figcaption></figure><h1 id="c790" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">CloudWatch 仪表盘</h1><p id="6c1c" class="pw-post-body-paragraph jj jk hu jl b jm lo iv jo jp lp iy jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">现在我们已经配置了数据源，让我们创建仪表板。将这些行追加到您的<code class="eh lv lw lx ly b">serverless.yml</code>中:</p><figure class="kg kh ki kj fq kk"><div class="bz el l di"><div class="lt lu l"/></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Append these lines to the existing serverless.yml file</figcaption></figure><p id="1624" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">一些注意事项:</p><ul class=""><li id="be41" class="mq mr hu jl b jm jn jp jq js ms jw mt ka mu ke mv mw mx my dt translated">您可以在仪表板中添加许多小部件。每个小部件都由一个配置和一个指标列表组成。相同的配置将用于同一个小部件中的每个指标。</li><li id="df74" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated"><code class="eh lv lw lx ly b">period</code>属性定义了计算一个值的频率。这里我们设置 300 秒(每 5 分钟一次)。</li><li id="a684" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated"><code class="eh lv lw lx ly b">stat</code>属性允许您选择如何聚合值。对于我们的第一个图表，我们想要平均下注值，所以我们使用了<code class="eh lv lw lx ly b">Average</code>。对于第二个，我们需要下注的数量，我们使用了<code class="eh lv lw lx ly b">SampleCount</code>。最后，我们将使用<code class="eh lv lw lx ly b">Sum</code>显示该期间的总下注额。其他可能性包括<code class="eh lv lw lx ly b">Minimum</code>、<code class="eh lv lw lx ly b">Maximum</code>和各种百分点。</li><li id="430e" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated">有三种不同的视图可用:<br/> - <code class="eh lv lw lx ly b">"view": "singleValue"</code>显示单个值<br/> - <code class="eh lv lw lx ly b">"view": "timeSeries"</code>显示折线图<br/> - <code class="eh lv lw lx ly b">"view": "timeSeries", "stacked": true</code>显示堆积折线图</li><li id="44f1" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated">您可以在 CloudWatch 控制台中创建仪表板，并在编辑时在 source 选项卡中导出小部件 JSON 定义。</li></ul><h1 id="65d8" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">结果</h1><p id="8944" class="pw-post-body-paragraph jj jk hu jl b jm lo iv jo jp lp iy jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">通过 API 发送随机值一小时后，结果如下:</p><figure class="kg kh ki kj fq kk fe ff paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="fe ff ne"><img src="../Images/31bbabeca3b100835c3fc85586969b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lHjOsKRrM3-sBfIFR_XPkA.png"/></div></div><figcaption class="kr ks fg fe ff kt ku bd b be z ek">Our wonderful dashboard</figcaption></figure><p id="68e7" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于要求的少量工作来说已经很不错了，你不觉得吗？哦，这是定价:</p><ul class=""><li id="fd5e" class="mq mr hu jl b jm jn jp jq js ms jw mt ka mu ke mv mw mx my dt translated">3 美元/仪表板/月</li><li id="60ce" class="mq mr hu jl b jm mz jp na js nb jw nc ka nd ke mv mw mx my dt translated">0.30 美元/米/月</li></ul><p id="1952" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这使得这个仪表板每月 3.30 美元。</p><h1 id="c887" class="kw kx hu bd ky kz la lb lc ld le lf lg ja lh jb li jd lj je lk jg ll jh lm ln dt translated">好处:在控制台外使用小部件</h1><p id="3eb4" class="pw-post-body-paragraph jj jk hu jl b jm lo iv jo jp lp iy jr js lq ju jv jw lr jy jz ka ls kc kd ke hn dt translated">最后一件事:我们想与赌场的执行董事会分享这些图表。但让他们访问 CloudWatch 控制台似乎不是一件应该做的事情。嗯，你很幸运，因为有这样一个 API:<a class="ae kv" href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricWidgetImage.html" rel="noopener ugc nofollow" target="_blank">GetMetricWidgetImage</a>。除了在您的<code class="eh lv lw lx ly b">serverless.yml</code>中创建仪表板，您还可以从电路板可以访问的 web 应用程序中检索小部件图像，并且您可以为工程师保留 AWS 控制台。</p></div><div class="ab cl nf ng hc nh" role="separator"><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk nl"/><span class="ni bw bk nj nk"/></div><div class="hn ho hp hq hr"><p id="f4af" class="pw-post-body-paragraph jj jk hu jl b jm jn iv jo jp jq iy jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">瞧！感谢您的阅读。欢迎在评论中分享你的想法和<strong class="jl hv">快乐仪表板</strong>！</p></div></div>    
</body>
</html>