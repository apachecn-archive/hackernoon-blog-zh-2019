<html>
<head>
<title>Serverless Ruby on AWS Lambda with the Jets framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Jets框架的AWS Lambda上的无服务器Ruby</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/serverless-ruby-on-aws-lambda-with-the-jets-framework-989147f9d07b?source=collection_archive---------11-----------------------#2019-05-29">https://medium.com/hackernoon/serverless-ruby-on-aws-lambda-with-the-jets-framework-989147f9d07b?source=collection_archive---------11-----------------------#2019-05-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/4ac736029c71e773ce2416f37721b883.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhYVOsLeY9so62hb96bDDg.png"/></div></div></figure><p id="cf8e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当AWS在2014年推出λ时，没有人喜欢Ruby。Python、Node.js和Java等平台开启了在云中托管和运行功能的<a class="ae ka" href="https://www.twilio.com/docs/glossary/what-is-serverless-architecture" rel="noopener ugc nofollow" target="_blank">无服务器</a>革命。2018年底，终于推出了对Ruby的支持。</p><p id="ed35" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以使用原始函数和<a class="ae ka" href="https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html" rel="noopener ugc nofollow" target="_blank">无服务器应用模型(SAM)模板</a>来构建Ruby on Lambda，如<a class="ae ka" href="https://aws.amazon.com/blogs/compute/announcing-ruby-support-for-aws-lambda/" rel="noopener ugc nofollow" target="_blank">的《Ruby on Lambda入门指南</a>中所述，但是Ruby完全是为了开发者的快乐，当配置文件比你的程序长时，这个过程可以说是痛苦的。进入<a class="ae ka" href="http://rubyonjets.com/" rel="noopener ugc nofollow" target="_blank"> Jets框架</a>这是一个“利用Ruby的力量让每个人都享受无服务器服务”的框架。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/5742aaced2ac4ea958fd2dbb9c733ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*wObLlys3xUSlv0jY.png"/></div></figure><h1 id="e10a" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">从铁路到喷气式飞机</h1><p id="08d6" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">Jets将构建<a class="ae ka" href="https://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"> Rails应用</a>的经验与部署到AWS Lambda和相关服务的能力相结合，包括<a class="ae ka" href="https://aws.amazon.com/api-gateway/" rel="noopener ugc nofollow" target="_blank"> API网关</a>、<a class="ae ka" href="https://aws.amazon.com/s3/" rel="noopener ugc nofollow" target="_blank"> S3 </a>和<a class="ae ka" href="https://aws.amazon.com/dynamodb/" rel="noopener ugc nofollow" target="_blank"> DynamoDB </a>。在这篇文章中，我们将看到如何开始使用Jets并部署一个用Ruby编写的Lambda驱动的Twilio应用程序。</p><h1 id="879d" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">我们正在建造的东西</h1><p id="c999" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">为了保持简单，我们将建立一个基于SMS的应用程序，并使它更有趣，我们将包括一个小幽默。当你向应用程序发送文本时，它会用一个糟糕的笑话来回应。抱歉，我拼错了，我指的是一个爸爸的笑话，由T21 API提供。</p><p id="2832" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个应用程序将向我们展示如何开始使用Jets，创建控制器，动作和路线。我们将构建一个单一端点，当一个号码收到一条输入的SMS消息时，它会响应来自Twilio的HTTP请求。每次端点都会返回两个随机的爸爸笑话，笑声随之而来。</p><h1 id="287d" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">你需要什么</h1><p id="f34f" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">要跟进这个项目，您需要:</p><ul class=""><li id="b930" class="lk ll hu je b jf jg jj jk jn lm jr ln jv lo jz lp lq lr ls dt translated">Twilio账户(<a class="ae ka" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank">在这里注册一个免费账户</a>)</li><li id="5d3b" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><a class="ae ka" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank">AWS账户</a></li><li id="8e77" class="lk ll hu je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><a class="ae ka" href="https://www.ruby-lang.org/en/downloads/" rel="noopener ugc nofollow" target="_blank">安装了Ruby 2.5</a>(Lambda支持的版本)和<a class="ae ka" href="https://bundler.io/" rel="noopener ugc nofollow" target="_blank"> Bundler </a>。如果你没有安装Ruby 2.5，你可以使用这里列出的工具之一来安装和管理你的Ruby版本。</li></ul><p id="013b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">明白了吗？那我们开始吧。</p><h1 id="9957" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">入门指南</h1><p id="0610" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">我们将从在全球安装<code class="eh ly lz ma mb b">jets</code> gem开始。在命令行中键入:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="4540" class="mg kh hu mb b fv mh mi l mj mk">gem install jets</span></pre><p id="0c94" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Jets可执行文件可以像Rails一样作为一个生成器来启动一个新项目，然后在项目中运行命令。我们现在将创建一个新项目，但是考虑到我们在这篇文章中的范围，我们将对它进行一点限制。首先，我们将在API模式下创建项目，因为在这个应用程序中不需要HTML视图。这也避免了使用<a class="ae ka" href="https://github.com/rails/webpacker" rel="noopener ugc nofollow" target="_blank"> webpacker </a>进行资产编译，这将节省我们的构建时间。我们也不需要数据库。运行以下命令创建一个新项目:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="e830" class="mg kh hu mb b fv mh mi l mj mk">jets new dad-jokes-sms --mode api --no-database</span></pre><p id="53a9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦生成器完成运行，切换到<code class="eh ly lz ma mb b">dad-jokes-sms</code>目录，使用以下命令在本地运行您的应用程序:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="38dd" class="mg kh hu mb b fv mh mi l mj mk">jets serve</span></pre><p id="608e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">打开<a class="ae ka" href="http://localhost:8888" rel="noopener ugc nofollow" target="_blank"> http://localhost:8888 </a>，您将看到一个类似如下页面:</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/adee0c6c35bfb822d66474f876d52e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*mU6gvknYW4SDCoco.png"/></div></figure><p id="b567" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您看到此页面，那么您的新Jets项目正在成功运行。</p><h1 id="bfc2" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">我们的第一个喷气机控制器</h1><p id="64fc" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">现在我们有了一个Jets应用程序，我们可以使用gem来生成应用程序的各个部分，从模型和控制器到完整的脚手架。对于我们的应用程序，我们需要一个具有一个动作的控制器。使用以下内容生成它:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="a960" class="mg kh hu mb b fv mh mi l mj mk">jets generate controller Messages create</span></pre><p id="28a9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">生成器将为我们创建和编辑一些文件。我们需要检查新开的<code class="eh ly lz ma mb b">config/routes.rb</code>航线。</p><p id="68b6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Jets生成了一条<code class="eh ly lz ma mb b">GET</code>路线，但是Twilio webhooks会默认生成<code class="eh ly lz ma mb b">POST</code>请求，我更喜欢保持这种方式。将应用程序设置为在<code class="eh ly lz ma mb b">/messages</code>端点上接收<code class="eh ly lz ma mb b">POST</code>请求webhooks，如下所示:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="bdef" class="mg kh hu mb b fv mh mi l mj mk">Jets.application.routes.draw do<br/>  post 'messages', to: 'messages#create'<br/>  root "jets/public#show"<br/><br/>  # The jets/public#show controller can serve static utf8 content out of the public folder.<br/>  # Note, as part of the deploy process Jets uploads files in the public folder to s3<br/>  # and serves them out of s3 directly. S3 is well suited to serve static assets.<br/>  # More info here: http://rubyonjets.com/docs/assets-serving/<br/>  any "*catchall", to: "jets/public#show"<br/>end</span></pre><p id="8f81" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，让我们去写控制器动作。打开<code class="eh ly lz ma mb b">app/controllers/messages_controller.rb</code>，你会看到<code class="eh ly lz ma mb b">create</code>动作的一个方法。这个动作将接收我们的Twilio webhook，并用TwiML作出响应，发回一个爸爸笑话。</p><h1 id="3971" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">拿一个爸爸的笑话</h1><p id="2b9f" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">要发送回一个爸爸笑话，我们需要调用<a class="ae ka" href="https://icanhazdadjoke.com/api" rel="noopener ugc nofollow" target="_blank">icanhazdadjooke API</a>。让我们写一个快速的私有方法来实现这一点。</p><p id="747c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用<code class="eh ly lz ma mb b">open-uri</code>,因为它对于进行简单的web请求(包括<a class="ae ka" href="https://www.twilio.com/blog/download-image-files-ruby" rel="noopener ugc nofollow" target="_blank">下载文件和图像</a>)很有用。如果我们要求的话，API会用纯文本来响应，这样我们就不用做任何解析了。将以下内容添加到<code class="eh ly lz ma mb b">MessagesController</code>:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="4028" class="mg kh hu mb b fv mh mi l mj mk">require 'open-uri'<br/><br/>class MessagesController &lt; ApplicationController<br/>  def create<br/>  end<br/><br/>  private<br/><br/>  def random_joke<br/>    open('https://icanhazdadjoke.com/', { 'Accept' =&gt; 'text/plain' }).read<br/>  end<br/>end</span></pre><p id="b808" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们准备以TwiML的身份把我们的笑话还给Twilio。</p><h1 id="657f" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">返回TwiML</h1><p id="97fc" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">我们将使用twilio-ruby助手库中的助手构建一个响应。打开<code class="eh ly lz ma mb b">Gemfile</code>，添加<code class="eh ly lz ma mb b">twilio-ruby</code>:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="42fd" class="mg kh hu mb b fv mh mi l mj mk">source "https://rubygems.org"</span><span id="7f1c" class="mg kh hu mb b fv ml mi l mj mk">gem "jets"<br/>gem "twilio-ruby"</span></pre><p id="55b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在命令行上，运行<code class="eh ly lz ma mb b">bundle install</code>来安装gem。现在在<code class="eh ly lz ma mb b">create</code>动作中实例化一个新的TwiML响应对象，使用<code class="eh ly lz ma mb b"><a class="ae ka" href="https://www.twilio.com/docs/sms/twiml/message" rel="noopener ugc nofollow" target="_blank">&lt;Message&gt;</a></code> <a class="ae ka" href="https://www.twilio.com/docs/sms/twiml/message" rel="noopener ugc nofollow" target="_blank"> TwiML元素</a>回复传入的消息，并呈现XML响应，如下所示:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="2291" class="mg kh hu mb b fv mh mi l mj mk">require 'open-uri'<br/><br/>class MessagesController &lt; ApplicationController<br/>  def create<br/>    twiml = Twilio::TwiML::MessagingResponse.new<br/>    twiml.message body: random_joke<br/>    render xml: twiml.to_xml<br/>  end<br/><br/>  private<br/><br/>  def random_joke<br/>    open('https://icanhazdadjoke.com/', { 'Accept' =&gt; 'text/plain' }).read<br/>  end<br/>end</span></pre><p id="6472" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以在文档中阅读更多关于如何使用 <code class="eh ly lz ma mb b"><a class="ae ka" href="https://www.twilio.com/docs/sms/twiml/message" rel="noopener ugc nofollow" target="_blank">twilio-ruby</a></code> <a class="ae ka" href="https://www.twilio.com/docs/sms/twiml/message" rel="noopener ugc nofollow" target="_blank">助手库来生成TwiML </a>的信息。</p><p id="0872" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们可以在本地运行这个来测试我们是否得到了预期的响应。如果您停止了应用程序，使用<code class="eh ly lz ma mb b">jets serve</code>再次启动它。使用<code class="eh ly lz ma mb b">curl</code>向localhost:8888/messages发出一个<code class="eh ly lz ma mb b">POST</code>请求，您将在TwiML响应中看到由<a class="ae ka" href="https://icanhazdadjoke.com/" rel="noopener ugc nofollow" target="_blank">icanhazdadjock</a>提供的笑话:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="cdb7" class="mg kh hu mb b fv mh mi l mj mk">curl --data "" http://localhost:8888/messages<br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;Response&gt;<br/>&lt;Message&gt;What’s the advantage of living in Switzerland? Well, the flag is a big plus.&lt;/Message&gt;<br/>&lt;/Response&gt;</span></pre><p id="356d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了，我们的Jets应用程序正在工作！现在将它部署到AWS Lambda。</p><h1 id="e57b" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">你准备好部署了吗？我是！</h1><p id="3950" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">要将我们的Jets应用程序部署到AWS，我们首先需要用凭证设置我们的项目，以允许它访问AWS服务。这里的一个好的实践是创建一个用户，该用户具有完成所有需要的事情所需的最少数量的权限。Jets文档描述了我们的用户需要的最小权限。在我们的AWS帐户中，我们将创建一个包含这些权限的策略，并为一个新用户分配该策略。然后，我们可以使用该用户的凭证来部署我们的应用程序。</p><p id="ef11" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在您的<a class="ae ka" href="https://console.aws.amazon.com/console/home" rel="noopener ugc nofollow" target="_blank"> AWS控制台</a>中找到<em class="lj"> IAM </em>服务(或者直接前往<em class="lj"> IAM </em> <a class="ae ka" href="https://console.aws.amazon.com/iam/home" rel="noopener ugc nofollow" target="_blank">部分</a>)。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/de4eac9b94db494dadf5bb82168109d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*MdHznXx64Vg1Wy3x.png"/></div></figure><p id="e461" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">转到<em class="lj">策略</em>部分并创建一个新策略。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/1d5b961216342d57767669e5c0c140b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*5WTEwNx9gxCfVsQj.png"/></div></figure><p id="398a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择JSON选项卡，并从Jets文档中输入以下JSON <a class="ae ka" href="http://rubyonjets.com/docs/extras/minimal-deploy-iam/#commands-summary" rel="noopener ugc nofollow" target="_blank">:</a></p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="1f19" class="mg kh hu mb b fv mh mi l mj mk">{<br/>    "Version": "2012-10-17",<br/>    "Statement": [<br/>        {<br/>            "Effect": "Allow",<br/>            "Action": [<br/>                "apigateway:*",<br/>                "cloudformation:*",<br/>                "dynamodb:*",<br/>                "events:*",<br/>                "iam:*",<br/>                "lambda:*",<br/>                "logs:*",<br/>                "route53:*",<br/>                "s3:*"<br/>             ],<br/>            "Resource": [<br/>                "*"<br/>            ]<br/>        }<br/>    ]<br/>}</span></pre><p id="a233" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">单击查看策略，并为其命名。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/72e2c2c85af48b8056166bfb34903f83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*aVopFYWR-JFnQP-5.png"/></div></figure><p id="0488" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存策略。现在我们需要创建一个新用户，并将策略附加到它上面，授予它创建Jets需要部署的资源的权限。打开<em class="lj"> IAM </em>控制台中的<em class="lj">用户</em>部分，创建一个新用户。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/a9a19cc66068d99376dbd5147535f63d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*hrMBrhx6fH3pAgVj.png"/></div></figure><p id="1b66" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">给用户一个名字，选择<em class="lj">访问类型</em>的<em class="lj">编程访问</em>。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/99237e7eac6f5aa987082e08d69901fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*wQ0uOjcwTUz-7h6o.png"/></div></figure><p id="ed61" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击<em class="lj">下一步</em>为您的新用户选择权限。选择<em class="lj">直接附加现有策略</em>并过滤您刚刚创建的策略的名称。选择该策略并点击下一步按钮<em class="lj">。</em></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/c59bc9a45ff910b1248534195d2caca7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*Flv5A0h5KQusKBGf.png"/></div></figure><p id="5363" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击<em class="lj">下一步</em>直到到达成功页面。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/93d55562ce869207714c7d350a7fbe63.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*R8eOt185uFC7NZgS.png"/></div></figure><p id="3ba4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存上一屏幕的<em class="lj">访问密钥ID </em>和<em class="lj">秘密访问密钥</em>。我们需要他们一起部署。现在我们准备部署。</p><h1 id="01fa" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">部署到Lambda</h1><p id="2bb9" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">在命令行上输入:</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="e845" class="mg kh hu mb b fv mh mi l mj mk">AWS_ACCESS_KEY_ID=YOUR_USER_KEY AWS_SECRET_ACCESS_KEY=YOUR_USER_SECRET_KEY jets deploy</span></pre><p id="cad7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Jets将使用凭证作为环境变量来设置您的AWS帐户中的所有资源以运行应用程序。这需要一点时间，但当它完成时，您将有一个运行您的应用程序的URL。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/83b48e0079893a1dfa40f448f6b3f400.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*_8PI121Fhh_He7so.png"/></div></figure><p id="da9c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您会注意到它被部署到一个“开发”环境中。你可以在文档中阅读更多关于Jets如何处理环境的信息。</p><p id="5a93" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们现在可以使用<code class="eh ly lz ma mb b">curl</code>测试这个URL。记住我们使用路由<code class="eh ly lz ma mb b">/messages</code>,所以将它添加到API网关端点的末尾，并发出一个<code class="eh ly lz ma mb b">POST</code>请求。</p><pre class="kc kd ke kf fq mc mb md me aw mf dt"><span id="c090" class="mg kh hu mb b fv mh mi l mj mk">curl --data "" https://YOUR_API_GATEWAY_ENDPOINT/messages<br/>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;Response&gt;<br/>&lt;Message&gt;I knew a guy who collected candy canes, they were all in mint condition&lt;/Message&gt;<br/>&lt;/Response&gt;</span></pre><p id="32a0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，为了让爸爸随时随地都能讲笑话，让我们把这个和一个Twilio数字联系起来。</p><h1 id="e312" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">爸爸短信开玩笑</h1><p id="a431" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">进入你的<a class="ae ka" href="https://www.twilio.com/console" rel="noopener ugc nofollow" target="_blank"> Twilio控制台</a>查看你的<a class="ae ka" href="https://www.twilio.com/console/phone-numbers/incoming" rel="noopener ugc nofollow" target="_blank">活动电话号码</a>。如果您已经有一个想要使用的号码，请对其进行编辑，否则请购买一个可以接收短信的新号码。在<em class="lj">字段中，会出现一条消息</em>，输入您的应用程序URL。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/50b3dc8aa89862e05d45c6d3f187fe46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*ep-ulo4YO7vG0BUk.png"/></div></figure><p id="7004" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保存您的号码并向其发送消息。你应该得到一个爸爸的笑话作为回应。现在，为了庆祝，去告诉附近的人这个笑话，让我知道他们是笑还是呻吟。</p><h1 id="6ef0" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">无服务器喜剧</h1><p id="2317" class="pw-post-body-paragraph jc jd hu je b jf le jh ji jj lf jl jm jn lg jp jq jr lh jt ju jv li jx jy jz hn dt translated">在这篇文章中，我们看到了如何开始使用Jets编写可以部署到AWS Lambda的Ruby应用程序。你可以在GitHub 上看到完整的<a class="ae ka" href="https://github.com/philnash/dad-jokes-jets" rel="noopener ugc nofollow" target="_blank">项目。</a></p><p id="dde1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Jets可以帮助你完成的事情还有很多，包括响应<a class="ae ka" href="http://rubyonjets.com/docs/events/" rel="noopener ugc nofollow" target="_blank">事件</a>，<a class="ae ka" href="http://rubyonjets.com/docs/database-support/" rel="noopener ugc nofollow" target="_blank">在数据库中存储数据</a>，甚至<a class="ae ka" href="http://rubyonjets.com/docs/rails-support/" rel="noopener ugc nofollow" target="_blank">运行你现有的Rails应用</a>。查看Jets文档中的这些文章，了解更多关于Jets的内容。</p><p id="0db8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你对在无服务器环境中运行Ruby感到兴奋吗？你对喷气机有什么看法？请在评论中告诉我，或者在Twitter上给我留言，地址是<a class="ae ka" href="https://twitter.com/philnash" rel="noopener ugc nofollow" target="_blank"> @philnash </a>。也可以和我分享你最喜欢的爸爸笑话！</p></div><div class="ab cl mm mn hc mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="hn ho hp hq hr"><p id="bff1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="lj">原载于https://www.twilio.com</em><a class="ae ka" href="https://www.twilio.com/blog/serverless-ruby-on-aws-lambda-with-the-jets-framework" rel="noopener ugc nofollow" target="_blank"><em class="lj"/></a><em class="lj">。</em></p></div></div>    
</body>
</html>