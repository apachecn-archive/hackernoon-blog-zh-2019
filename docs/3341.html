<html>
<head>
<title>Postmortem: CyberMiles Blockchain Service Disruption Incident</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">事后分析:CyberMiles区块链服务中断事件</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/postmortem-cybermiles-blockchain-service-disruption-incident-8ba65c3f410c?source=collection_archive---------9-----------------------#2019-05-28">https://medium.com/hackernoon/postmortem-cybermiles-blockchain-service-disruption-incident-8ba65c3f410c?source=collection_archive---------9-----------------------#2019-05-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="d701" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">总部设在区块链的DPoS和dBFT在过去一年中广受欢迎。与PoW区块链相比，DPoS和dBFT替代品具有高性能、高能效、快速终结和几乎从不硬分叉等优势。</p><p id="b6d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">但是，一个值得注意但很少为人所知的权衡是，这些区块链可能会偶尔出现服务中断和不可用的情况。已经记录了<a class="ae jp" href="https://www.trustnodes.com/2018/06/16/eos-stops-functioning-network" rel="noopener ugc nofollow" target="_blank"> EOS </a>、<a class="ae jp" href="https://unhashed.com/cryptocurrency-news/steemit-online-nine-hour-outage/" rel="noopener ugc nofollow" target="_blank"> Steemit </a>、<a class="ae jp" rel="noopener" href="/stellar-developers-blog/may-15th-network-halt-a7b933103984"> Stellar </a>等的长时间服务中断。区块链的所有dpo/dBFT都会遇到这样的问题，这只是时间问题。</p><p id="94e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在这篇文章中，我们将使用一个对<a class="ae jp" href="https://cybermiles.io/" rel="noopener ugc nofollow" target="_blank">区块链</a>网络里程<a class="ae jp" href="https://blog.cybermiles.io/post/20190527-incident-postmortem-en/" rel="noopener ugc nofollow" target="_blank">最近服务中断</a>的事后分析作为一个例子来说明问题并提出潜在的解决方案。</p></div><div class="ab cl jq jr hc js" role="separator"><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv jw"/><span class="jt bw bk ju jv"/></div><div class="hn ho hp hq hr"><p id="f413" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2019年5月26日，CyberMiles public区块链遭遇技术故障，导致区块链运营暂停17个小时。在此期间，区块链没有接受或记录任何交易。<strong class="it hv">既没有数据丢失，也没有事务回滚。</strong></p><p id="a502" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个分散的公共区块链，CyberMiles由全球24个验证者维护。任何软件变更都必须经过23名验证人员的批准和实施才能生效。区块链网络万里行的停机时间虽然令人遗憾，但由于有一组不同的独立验证者，它达到了通过协商一致来维护交易的安全性和完整性的目的。</p><p id="9c28" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事情是这样的。</p><p id="ee47" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">美国东部时间2019年5月26日凌晨5点左右，一名用户在区块链网络英里(CyberMiles)上提交了一项创建智能合同的交易。该交易包含在地块高度1724748中。</p><blockquote class="jx"><p id="68b3" class="jy jz hu bd ka kb kc kd ke kf kg jo ek translated">当事务由每个区块链节点上的CyberMiles虚拟机(CVM)执行时，它触发了一个使CVM崩溃的错误。</p></blockquote><p id="516f" class="pw-post-body-paragraph ir is hu it b iu kh iw ix iy ki ja jb jc kj je jf jg kk ji jj jk kl jm jn jo hn dt translated">具体来说，当用户请求在不支付汽油费的情况下执行交易时，CVM的<a class="ae jp" href="https://www.litylang.org/gas/" rel="noopener ugc nofollow" target="_blank">“免费汽油”</a>规则检查交易的目标地址。但是，在智能合同创建事务的情况下，目标地址为空。</p><blockquote class="jx"><p id="95ec" class="jy jz hu bd ka kb kc kd ke kf kg jo ek translated">这导致软件抛出一个臭名昭著的空指针异常，使CVM崩溃。</p></blockquote><figure class="kn ko kp kq kr ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff km"><img src="../Images/8a7c3bb20337d4f5c15f7d0d0fb39ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hvGoLmXBcVX6vd8jypN_ug.png"/></div></div></figure><p id="b329" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有CyberMiles节点在块高度1724747处停止，无法处理块高度1724748。该问题被报告并上报给CyberMiles核心开发人员。</p><blockquote class="jx"><p id="43e5" class="jy jz hu bd ka kb kc kd ke kf kg jo ek translated">在台北的CVM开发人员立即着手解决这个问题，并制作了一个软件补丁。</p></blockquote><p id="f0d3" class="pw-post-body-paragraph ir is hu it b iu kh iw ix iy ki ja jb jc kj je jf jg kk ji jj jk kl jm jn jo hn dt translated">区块链在北京和美国的工程团队随后对其进行了测试，并发布了新的软件版本<a class="ae jp" href="https://github.com/CyberMiles/travis/releases/tag/v0.1.8-beta-hotfix" rel="noopener ugc nofollow" target="_blank"> v0.1.8-beta-hotfix </a>。核心开发人员已经准备好通知验证人员审查、批准和实现v0.1.8-beta-hotfix。</p><figure class="la lb lc ld fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff kz"><img src="../Images/28ac7db81fb4fc98be6cf8ab1473a1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56N8w7RIz7ij2_EalEaERA.png"/></div></div></figure><blockquote class="jx"><p id="2ab7" class="jy jz hu bd ka kb le lf lg lh li jo ek translated">然而，这时第二个问题出现了。由于空指针异常导致CVM崩溃，虚拟机异常关闭。</p></blockquote><p id="2616" class="pw-post-body-paragraph ir is hu it b iu kh iw ix iy ki ja jb jc kj je jf jg kk ji jj jk kl jm jn jo hn dt translated">位于北京、洛杉矶和奥斯汀的运营团队发现，在这次崩溃之后，一些节点可能已经损坏了数据库文件。因此，直接重启新的二进制应用程序是不可能的。</p><figure class="la lb lc ld fq ks fe ff paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="fe ff lj"><img src="../Images/089aa98302226ba8473c3522f1b375ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*toEtVQxFFgll5x6bR4NKlw.png"/></div></div></figure><p id="9555" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于充分的预防措施，工程团队决定建议所有节点按照CyberMiles的<a class="ae jp" href="https://travis.readthedocs.io/en/latest/connect-mainnet.html#option-2-binary-from-snapshot" rel="noopener ugc nofollow" target="_blank">快照快速同步程序</a>，从块高度为1724748的未损坏快照重启。</p><p id="94c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在社区中发现了块高度为1724748的具有所有验证程序签名的未损坏节点。压缩后的数据大小为18GB。然后，来自该节点的数据快照在再次对社区可用<a class="ae jp" href="https://s3-us-west-2.amazonaws.com/travis-ss-bucket/mainnet/travis_ss_mainnet_1558862782_1724747.tar" rel="noopener ugc nofollow" target="_blank">之前被审查、验证和确认。</a></p><p id="3e04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">美国东部时间下午5点，北美的第一批验证器节点带着更新软件v0.1.8-beta-hotfix上线。然而，如果没有17个有效验证器的法定人数(即块高度1724748处的24的23 ),区块链就不能产生下一个块。当亚洲验证者在周一早上醒来时，法定人数在美国东部时间晚上10点达到。区块链服务，如<a class="ae jp" href="https://www.cybermiles.io/en-us/blockchain-infrastructure/cmt-wallet/" rel="noopener ugc nofollow" target="_blank"> CMT钱包</a>、<a class="ae jp" href="https://www.cybermiles.io/en-us/cmt/cmt-cube/" rel="noopener ugc nofollow" target="_blank"> CMT魔方</a>、<a class="ae jp" href="https://www.cmttracking.io/" rel="noopener ugc nofollow" target="_blank"> CMT追踪</a>等，不久后全面恢复。</p><p id="5a36" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">主要经验教训</p><ul class=""><li id="72a8" class="lk ll hu it b iu iv iy iz jc lm jg ln jk lo jo lp lq lr ls dt translated">CyberMiles开发团队必须增加软件测试的覆盖面。</li><li id="cc39" class="lk ll hu it b iu lt iy lu jc lv jg lw jk lx jo lp lq lr ls dt translated">可以改进核心开发人员和验证人员之间的事件响应协调。在这种情况下，根本原因被很快地识别和修补，但是跨验证器的协调花费了很长时间。</li><li id="86ea" class="lk ll hu it b iu lt iy lu jc lv jg lw jk lx jo lp lq lr ls dt translated">多样化的验证器组提高了区块链的安全性，但由于难以达到法定人数，可能会延长服务中断时间。</li></ul><figure class="la lb lc ld fq ks"><div class="bz el l di"><div class="ly lz l"/></div></figure></div></div>    
</body>
</html>