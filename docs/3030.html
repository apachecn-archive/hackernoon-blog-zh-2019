<html>
<head>
<title>📡 A Serverless Failover Solution for Web 3.0 Validator Nodes 🤖 🔧</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">📡Web 3.0验证器节点的无服务器故障转移解决方案🤖 🔧</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/a-serverless-failover-solution-for-web-3-0-validator-nodes-e26b9d24c71d?source=collection_archive---------12-----------------------#2019-05-14">https://medium.com/hackernoon/a-serverless-failover-solution-for-web-3-0-validator-nodes-e26b9d24c71d?source=collection_archive---------12-----------------------#2019-05-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4bae" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Web 2基础设施上建立自动化节点故障转移解决方案非常容易。它有两个内容相同的节点。外部服务器监控主节点并检测是否有问题。如果是这样，您站点的内部DNS会自动更新，以便流量会被重定向到您的辅助节点。一旦您的主节点恢复工作，流量将返回到您的主节点。</p><p id="7394" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">根据最终配置，此解决方案可能会带来高冗余。然而，它并不便宜；它需要三台服务器，即使它们没有做太多工作，也会持续消耗大量资源。</p><p id="b502" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本教程的主要目标之一是降低成本。虚拟云提供商有许多工具来管理云基础架构，让我们能够更好地控制预算。</p><p id="a2e5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Web 3.0基础设施中，我们需要更复杂的解决方案来创建类似的方法。管理对等连接和重定向流量要复杂得多。</p><p id="ef83" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将在本教程中探索的另一个解决方案是，只有当我们的主节点关闭时，才启动辅助验证节点。我们可以把它想象成一个“应急电力系统”</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/5359e66100b66d9faca5ed1f4392b707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qw7UVbl4TSk11jfLxhYm1A.png"/></div></div></figure><p id="5d08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了实现这一点，我们将使用一个AWS EC2实例来替换主节点，以防出现故障。主节点可以在您的办公室、家中或任何云提供商的位置。通过使用简单的发布/订阅设置，该节点将通过AWS物联网网关连接到AWS云。</p><h1 id="0dae" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是AWS IoT？</h1><p id="c5cb" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">AWS IoT是一个高效管理“物联网”设备的平台，也称为“东西”。AWS物联网可以连接到AWS云中的其他应用程序，如Lambda函数，这是无服务器基础设施的一个方便工具。</p><p id="7b03" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">东西通过物联网网关传输数据，称为消息，在那里它们更新一个<strong class="it hv">东西影子</strong>或到达一个<strong class="it hv">规则引擎</strong>。事物阴影是一个(JSON)对象，它包含当事物/设备的状态改变时更新的关于设备的信息。它允许我们设置、存储和同步事物状态及其云表示。<br/>规则引擎，顾名思义，是一组规则，使消息能够与从物联网网关到少数下游AWS服务的SQL类型语句进行交互。<br/>我们将关注规则引擎，因为我们希望将我们的东西/设备连接到Lambda函数。</p><blockquote class="le lf lg"><p id="9167" class="ir is lh it b iu iv iw ix iy iz ja jb li jd je jf lj jh ji jj lk jl jm jn jo hn dt translated">消息队列遥测传输(<strong class="it hv"> MQTT </strong>)是一个客户端-服务器发布/订阅消息传输协议。它是轻量级的、开放的、简单的，并且被设计成易于实现。这些特性使它非常适合在许多情况下使用，包括受限环境，如机器对机器(M2M)和物联网(IoT)环境中的通信，在这些环境中需要少量代码和/或网络带宽非常宝贵。它启用了一种在发生异常断开时通知相关方的机制。<br/>该协议运行在TCP/IP或其他提供有序、无损、双向连接的网络协议上。——<a class="ae ll" href="http://mqtt.org/" rel="noopener ugc nofollow" target="_blank">http://mqtt.org/</a></p></blockquote><p id="9c2e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">物联网网关</strong>作为<strong class="it hv"> MQTT </strong> <strong class="it hv">代理</strong>工作，以允许设备-云通信。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff lm"><img src="../Images/fef1e8c101bfbb15fa548aa6b5c50315.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_Cp5reOGUo7b9PuCUqkCA.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek"><a class="ae ll" href="http://micrasystems.com/real-time-messaging-using-mqtt/" rel="noopener ugc nofollow" target="_blank">http://micrasystems.com/real-time-messaging-using-mqtt/</a></figcaption></figure><ol class=""><li id="69e0" class="lr ls hu it b iu iv iy iz jc lt jg lu jk lv jo lw lx ly lz dt translated">订户(事物/服务)连接到代理。它可以订阅代理中的任何消息“主题”。</li><li id="1b20" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated">发布者(客户端/事物)通过向代理发送消息和主题来发布主题下的消息。对于敏感消息，此连接将被加密。</li><li id="d7e3" class="lr ls hu it b iu ma iy mb jc mc jg md jk me jo lw lx ly lz dt translated">然后，代理(IoT MQTT代理)将消息转发给订阅该主题的所有事物/服务。</li></ol><h1 id="3307" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">什么是Lambda函数？</h1><p id="3deb" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">AWS Lambda是一个事件驱动的计算平台，按需执行代码。此功能支持任何应用程序的无服务器架构。</p><p id="a74c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">触发AWS Lambda函数的一种常见方式是通过主题使用规则。我们之前提到过AWS物联网规则引擎；我们将使用它作为从MQTT代理触发规则的工具。这是一种分离消息发布者和订阅者的令人信服的方式，并且消除了轮询新消息的需要。</p><p id="83a3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将设置一个规则，并订阅一个Lambda函数，以便在每次主题收到消息时启动/停止EC2实例。这个规则还会触发一个SNS话题通过邮件通知我们。</p><h1 id="1339" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">云的形成</h1><p id="1dde" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">CloudFormation是一个AWS工具，可以帮助我们毫不费力地建立云基础设施。我们定义AWS应该构建到模板文档中的所有资源，点击一个按钮，AWS就神奇地创建了一切。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mf"><img src="../Images/0e9ce28ff18ee9a53ee07d530c0cd046.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DyZ9xZmlzk0bkUq1uFMu-g.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek"><a class="ae ll" href="https://aws.amazon.com/cloudformation/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/cloudformation/</a></figcaption></figure><p id="f83b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将使用一个模板来创建我们的物联网，配置规则引擎，创建Python Lambda函数，最后设置相关的事件、角色和策略。</p><h1 id="6133" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">我们来建吧！</h1><p id="0e5b" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">无服务器架构将处理EC2实例的启动和停止。本教程要求您已经拥有一个带有<a class="ae ll" href="http://wiki.polkadot.network/en/latest/polkadot/node/guides/how-to-validate/" rel="noopener ugc nofollow" target="_blank"> polkadot客户端</a>并配置有<a class="ae ll" href="http://wiki.polkadot.network/en/latest/polkadot/node/guides/how-to-systemd/" rel="noopener ugc nofollow" target="_blank"> systemd服务</a>的EC2实例验证器节点。它仍然是这个堆栈的一个独立组件。</p><p id="9773" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要X.509证书和私钥来建立安全的AWS物联网连接。出于安全原因和遵循最佳实践，我们不会在CloudFormation上创建它。</p><p id="c4d5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在物联网核心控制台上，进入<strong class="it hv">安全</strong>-&gt;T6】证书。点击<strong class="it hv">创建</strong>并选择<strong class="it hv">推荐的</strong> <strong class="it hv">一键选择</strong>创建证书。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mg"><img src="../Images/b9e8bad751268a7be6f2f3f12f30d274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*10a71yAWqvaLm8tBxKu2uw.png"/></div></div></figure><p id="0b83" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">完成后，将所有证书下载到您的本地工作区文件夹中，然后单击<strong class="it hv">激活</strong>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mh"><img src="../Images/1708c571ad303a56376692bfd7f2df38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qEEphYnS10aKLkp_YsBgfg.png"/></div></div></figure><p id="701a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">不要忘记下载通用根证书来验证AWS服务器的连接。AWS IoT的根CA<a class="ae ll" href="https://docs.aws.amazon.com/iot/latest/developerguide/managing-device-certs.html#server-authentication" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">下载</strong> </a> <strong class="it hv">。</strong></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mi"><img src="../Images/23beb1abfe86c59b7b441fd00488edb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OhvfobwFrnz6DbXDGLJzCA.png"/></div></div><figcaption class="ln lo fg fe ff lp lq bd b be z ek"><a class="ae ll" href="https://docs.aws.amazon.com/iot/latest/developerguide/managing-device-certs.html#server-authentication" rel="noopener ugc nofollow" target="_blank">https://docs.aws.amazon.com/iot/latest/developerguide/managing-device-certs.html#server-authentication</a></figcaption></figure><p id="623b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将下一个模板下载或复制到本地工作区文件夹中。我们会把它上传到云形成控制台。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="bf80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在创建我们的ClourFormation堆栈之前，我们需要获得IoT证书ID和EC2实例ID。</p><p id="916e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在物联网核心控制台上，进入<strong class="it hv">安全</strong>-&gt;-<strong class="it hv">证书</strong>。点击证书并复制ID。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ml"><img src="../Images/5f0c89635f367a2a86b2d8f04d229d8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kCMeolivIcDBRWbn_DHgfg.png"/></div></div></figure><p id="b58c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从EC2实例控制台，复制您的验证器的实例ID。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/19167afe2c86e417cbab456592636ee1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/1*M2vuYFf1JtPAJMeJkbS6xA.png"/></div></figure><p id="5373" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">是时候构建我们的无服务器基础架构了。进入<a class="ae ll" href="https://console.aws.amazon.com/cloudformation/home" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">云形成控制台</strong> </a>并点击<strong class="it hv">创建堆栈</strong>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mn"><img src="../Images/58c1f83ad4350f31c95ecac3d7c6e418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sY2KxYnib_I7_uAwKnqORA.png"/></div></div></figure><p id="199e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们将被要求选择一个模板或上传一个。选择<strong class="it hv">上传模板</strong>选项，并使用我们之前存储在本地工作区的<strong class="it hv">basicserverlessfvalidator . yml</strong>文件。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mo"><img src="../Images/3933dea213b86db2cba58e31b99eb8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_0Bm0VlXygkFnReMnPXEw.png"/></div></div></figure><p id="e961" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">填写所有必填字段(堆栈名称、证书ID、电子邮件、实例ID)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mp"><img src="../Images/883e7410d01ea702bc5a18ac11c12854.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NkojAFX773PBE1YqPg2Ehw.png"/></div></div></figure><p id="14dc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">下一个</strong>两次，跳过创建堆栈定制，直到到达创建堆栈选项。勾选复选框<strong class="it hv">确认</strong>我们的无服务器堆栈使用的角色和策略所需的IAM资源的创建。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mq"><img src="../Images/c8c883ebb6336342f1b04f65c1e9397a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lsD-1WiGVSbq1J43zDilMw.png"/></div></div></figure><p id="7419" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">创建堆栈</strong>并等待创建完成。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mr"><img src="../Images/835eea5dd3847dc42dc688807bc94b5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2HUc_i9_lh4tJDclCL-Wg.png"/></div></div></figure><p id="b41a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们已经创建了无服务器云基础架构。🎉</p><p id="220c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">重要提示:您需要验证触发器已经在Lambda函数中注册。有时，由于云形成中的竞争条件，它们不会出现在Lambda函数中。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ms"><img src="../Images/44ff37a278da405be42c914b26f424bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8eGdSBntWroTFxR_9m-AAw.png"/></div></div></figure><p id="0d08" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要解决这个问题，您只需要更新触发事件，而不需要做任何更改。然后它将出现在Lambda函数触发器上。对3个物联网规则重复此步骤(ValidatorNodeDisconnected、ValidatorNodeStart、ValidatorNodeStop)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mt"><img src="../Images/ddd12a880b47c490d82ea4db3a061e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jNMi93fprX4ia0BJPO7z7A.png"/></div></div></figure><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mu"><img src="../Images/d5649616cfdb06308f238820f9f10ade.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xdvEpGDWq9aw6QqAD6zyA.png"/></div></div></figure><p id="f6a9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">更新后，您可以验证触发器是否在Lambda函数上注册。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff ca"><img src="../Images/2785a3793cf6ca145cea60df80c23309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dIAq7P9jJEWqm2J17QtjMw.png"/></div></div></figure><h1 id="309c" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">主验证器节点</h1><p id="1e58" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">现在，我们已经准备好了无服务器云基础架构。我们需要在我们的验证器节点(Thing)和AWS物联网网关之间建立数据连接。</p><p id="bce1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将下一个python脚本下载或复制到主验证器节点中。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mj mk l"/></div></figure><p id="a5cd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">安装使用Python脚本所需的依赖项。</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="137b" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv">$ </strong>python3 -m pip install AWSIoTPythonSDK pystemd</span></pre><p id="65ea" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们需要用我们的证书和私钥文件替换Python脚本上的配置参数。</p><p id="4c7c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在物联网核心控制台中，点击我们创建的东西“ValidatorNodeThing”。选择<strong class="it hv">交互</strong>选项卡，复制HTTPS物联网Rest API端点地址。用此地址替换host_name值。</p><p id="241e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如-“主机名”:“<a class="ae ll" href="http://a1yfesihws3xl1ats.iot.eu-west-1.amazonaws.com/" rel="noopener ugc nofollow" target="_blank">a1yfesihws3xl1-ats.iot.eu-west-1.amazonaws.com</a>”</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff nf"><img src="../Images/45b4b65d9dd4b7f940d21b91354ae1c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W1rNfOtHgI0yO5pIwkhX8Q.png"/></div></div></figure><p id="604a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lh">' root _ ca ':/absolute-path-to-file/amazonrootca 1 . PEM "</em></p><p id="8860" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lh">' private _ key ':/absolute-path-to-file/yourkeyid-private . PEM . key "</em></p><p id="8808" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="lh">' cert _ file ':/absolute-path-to-file/yourkeyid-certificate . PEM . CRT "</em></p><p id="0b58" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">出于安全原因，AWS不使用具有打开权限的文件。更改文件权限以启用只读访问。</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="a7d8" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv"><em class="lh">$ </em></strong><em class="lh">chmod 440 /path-to-downloaded-files/*</em></span></pre><h1 id="fc14" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">将Python脚本注册为Linux systemd服务</h1><p id="95db" class="pw-post-body-paragraph ir is hu it b iu kz iw ix iy la ja jb jc lb je jf jg lc ji jj jk ld jm jn jo hn dt translated">准备好Python脚本后，接下来要做的事情是创建一个配置文件，告诉systemd我们希望它做什么。</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="3758" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv">$ </strong>sudo vi /lib/systemd/system/polkadot-node-iot.service</span></pre><p id="3248" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">该文件需要包含以下文本(替换<strong class="it hv">脚本路径</strong>):</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="9e7c" class="na kc hu mw b fv nb nc l nd ne">[Unit]<br/>Description=Python script for the ValidatorNodeThing connection.<br/>After=multi-user.target</span><span id="6881" class="na kc hu mw b fv ng nc l nd ne">[Service]<br/>Restart=always<br/>ExecStart=/usr/bin/python3 /<strong class="mw hv">path-to-script</strong>/<a class="ae ll" href="https://gist.github.com/riusricardo/4f9143a1dd9b9ca069b36280be6e492a" rel="noopener ugc nofollow" target="_blank">BasicValidatorNode.py</a></span><span id="f271" class="na kc hu mw b fv ng nc l nd ne">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="f8e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">将文件权限更新为644:</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="c80f" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv">$ </strong>sudo chmod 644 /lib/systemd/system/polkadot-node-iot.service</span></pre><p id="2465" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">配置系统d:</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="e7e2" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv">$ </strong>sudo systemctl daemon-reload</span></pre><p id="bcf8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">启动时启用服务自动启动:</p><pre class="jq jr js jt fq mv mw mx my aw mz dt"><span id="7675" class="na kc hu mw b fv nb nc l nd ne"><strong class="mw hv">$ </strong>sudo systemctl enable polkadot-node-iot.service</span></pre><blockquote class="nh"><p id="ae8f" class="ni nj hu bd nk nl nm nn no np nq jo ek translated">我们的无服务器故障转移解决方案已经完成！！🎊 🎉</p></blockquote><p id="a5eb" class="pw-post-body-paragraph ir is hu it b iu nr iw ix iy ns ja jb jc nt je jf jg nu ji jj jk nv jm jn jo hn dt translated">每当我们的主节点断开连接或polkadot-validator.service关闭时；我们的无服务器基础设施将负责管理辅助验证器。</p></div><div class="ab cl nw nx hc ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="hn ho hp hq hr"><p id="2849" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">关注<strong class="it hv"> Github </strong> repo，了解更多高级解决方案的最新成果。</p><p id="efd8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">github:<em class="lh">T15<a class="ae ll" href="https://github.com/riusricardo/validator-failover" rel="noopener ugc nofollow" target="_blank">T17】https://github.com/riusricardo/validator-failover</a></em>T19】</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="od mk l"/></div></figure></div></div>    
</body>
</html>