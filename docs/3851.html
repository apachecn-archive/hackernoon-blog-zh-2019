<html>
<head>
<title>Gentle Introduction to the Envoy Proxy and Load-balancing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Envoy代理和负载平衡简介</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/gentle-introduction-to-the-envoy-proxy-and-load-balancing-b3e3eb72c71f?source=collection_archive---------1-----------------------#2019-06-27">https://medium.com/hackernoon/gentle-introduction-to-the-envoy-proxy-and-load-balancing-b3e3eb72c71f?source=collection_archive---------1-----------------------#2019-06-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/4cdbbd10ef9283d9674679b12110ec29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GX_S3rGJPNif9M95i8TbOA.jpeg"/></div></div></figure><p id="d983" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于一个DevOps工程师来说，负载均衡是一个很流行的词。您需要找到一种方法来扩展系统，以便当大量流量进入您的系统时，系统能够正确地管理它。一种替代方法是提高正在运行的单个节点的效率。添加更多节点并在这些节点之间分配作业是另一种选择。拥有许多节点还有另一个高可用性的好处。</p><p id="087a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Envoy proxy是一种代理服务，在不断增长的趋势下，它已被用作服务网格。在这篇博文中，我们将看到Envoy代理的负载平衡方面。</p><h1 id="25cc" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">负载平衡器</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/6888ebd2352c18202b072f4443cdc751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/0*nqzUb8QM_YnF0vVJ.jpeg"/></div></figure><p id="5e6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">负载平衡器是一个端点，它监听进入计算集群的请求。当应用程序进入负载平衡器时，它会检查可访问的工作节点，并在工作节点之间分发请求。负载平衡器具有以下特征。</p><ul class=""><li id="0e7d" class="ld le hu je b jf jg jj jk jn lf jr lg jv lh jz li lj lk ll dt translated">服务发现:检查可用的工作节点</li><li id="012a" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">健康检查:定期检查工作节点的健康状况。</li><li id="684a" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">负载平衡:在工作节点之间分发请求。</li></ul><h1 id="f8d7" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">代理人</h1><p id="f350" class="pw-post-body-paragraph jc jd hu je b jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">代理是存在于两个端点之间的中间元素。代理服务将接受来自客户端的请求，并将它们转发到目标服务器。有两种代理。正向代理和反向代理。除了将应用程序直接发送到端点，我们还可以通过代理发送它。这种代理类型称为转发代理。转发代理通常用于绕过防火墙限制，访问被阻止的网站。</p><p id="b7eb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">反向代理是代理服务的一种形式，它接受传入的客户端请求，并将其传输到能够满足这些请求的服务器。结果将被路由回客户端。此外，代理还提供了对客户端请求的更多控制。它还可以缓存应用程序并加快网络的效率。反向代理用于</p><ul class=""><li id="2747" class="ld le hu je b jf jg jj jk jn lf jr lg jv lh jz li lj lk ll dt translated">作为一种安全措施，当网站不允许直接连接时，启用间接访问。</li><li id="a98e" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">向互联网用户传输内部内容。</li><li id="2255" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">以允许服务器之间的负载平衡。</li><li id="f066" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">禁用对网站的访问。</li></ul><h1 id="33c2" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">负载平衡拓扑</h1><p id="899b" class="pw-post-body-paragraph jc jd hu je b jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">代理站在客户端端点和后端端点之间。根据代理服务的位置，负载平衡可以分为以下几种拓扑。</p><h1 id="54dd" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">中间代理</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div class="fe ff ky"><img src="../Images/6c68349110db4a34d831d42fb8cc6d37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/0*Zr9swi8h5oJEMuVq.jpeg"/></div></figure><p id="9293" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">来自客户端的所有请求都进入中间代理。中间代理将请求路由到工作节点。这种负载平衡器简单明了。</p><h1 id="ebca" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">嵌入式客户端库</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/b54ac584e74534c54cb4c477d1809a4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/0*8kYrqGKSJorJQwA8.jpeg"/></div></figure><p id="1aaa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">中间代理的最大问题是单点故障。如果中间代理服务器停机，那么客户端服务就无法访问后端设施。在这种形式的代理中，负载平衡是由客户端自己执行的，而不是主负载平衡。使用gRPC库，可以引入这种类型的机制。</p><p id="eb57" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这种负载平衡器中，不断增长的复杂性成为一个问题。开发人员还需要为每个服务安装负载平衡组件。</p><h1 id="9bb1" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">边车代理</h1><figure class="kz la lb lc fq iv fe ff paragraph-image"><div class="fe ff lx"><img src="../Images/dbb6a16aac4806ccfb80a2d8bcb96624.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/0*Zkzm-mp5Mx56zRWw.jpeg"/></div></figure><p id="76cb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">嵌入式客户端库中最大的问题是为每个服务构造通信元素的复杂性。客户机库被划分为容器，最新的趋势是使用容器技术。在设计分散式负载平衡器时，没有固定的编程语言。这就是所谓的边车。这种类型的代理服务应用程序被称为服务网格。SideCar负责将客户请求发送到合适的后端服务。</p><p id="9c5b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">Envoy是Lyft用C++语言发布的高质量反向代理。在服务网格中使用特使来互连服务。以下是特使代理使用的常用术语。</p><ul class=""><li id="8c25" class="ld le hu je b jf jg jj jk jn lf jr lg jv lh jz li lj lk ll dt translated">主机:能够进行网络通信的实体。</li><li id="4dbe" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">下游:向特使代理发送请求的主机。</li><li id="90e5" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">上游:接收来自特使代理的请求的主机。</li><li id="1ec1" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">侦听器:可以通过下游连接到特使代理的命名网络位置。</li><li id="9d18" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">集群:集群是一组逻辑相同的上游主机，envoy可以连接这些主机。特使可以通过使用服务发现来发现集群。</li></ul><h1 id="0bbd" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">前线特使代理人</h1><p id="1314" class="pw-post-body-paragraph jc jd hu je b jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">从侧车代理端口，特使也可以配置为前端代理。前端代理被配置为来自公共互联网的请求的主要负载平衡器。这个代理也称为边缘代理。服务网格的整体架构如下。</p><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ly"><img src="../Images/44488fd3419b95a9a1f61bcd63725b6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1068/format:webp/0*qfEvXLixIa98CS-e.jpeg"/></div></div></figure><p id="e43c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里，前端代理被用作输入互联网流量的负载平衡器。此外，在此执行TLS终止。然后通过边车代理请求路由到适当的设施。服务网格可以识别通过服务发现可访问的服务。它还为处理故障转移提供了电路制动特性。总的来说，Envoy提供了许多特性来实现服务网格。</p><h1 id="27cc" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated"><strong class="ak">特使代理中负载平衡器的类型</strong></h1><p id="5fc3" class="pw-post-body-paragraph jc jd hu je b jf lr jh ji jj ls jl jm jn lt jp jq jr lu jt ju jv lv jx jy jz hn dt translated">当代理需要获取到上游集群中主机的连接时，集群管理器使用以下策略来路由流量。</p><ul class=""><li id="f0ed" class="ld le hu je b jf jg jj jk jn lf jr lg jv lh jz li lj lk ll dt translated">Round Robbin Rout负载到每个工作节点(上游主机)的循环顺序。所有工作节点被认为是相同的，并且所有节点获得相同的负载量。</li><li id="81f0" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">随机选择工作节点并路由流量。众所周知，这比循环Robbin策略执行得更好。</li><li id="6452" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">加权最小请求此策略基于负载平衡时保持的连接数。假设有两个规格相同的工作节点。由于某种原因，第一个工作节点需要更长的时间来响应。因此，它还必须保持与第一个工作节点的连接时间长于与第二个节点的连接时间。在这种情况下，负载平衡器可以将更多的权重放在第二个工作节点上，而不是将流量发送到第一个节点。</li><li id="28d2" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">原始目的地当给定的连接需要连接到某个特定的上游主机时，使用这种类型的负载平衡器。通过读取客户端的元数据选择的主机。</li></ul><p id="6aca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">除了负载平衡，Envoy还提供了以下特性来实现服务网格。</p><ul class=""><li id="f012" class="ld le hu je b jf jg jj jk jn lf jr lg jv lh jz li lj lk ll dt translated">动态服务发现</li><li id="7985" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">TLS终止</li><li id="b6cb" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">HTTP/2和gRPC代理</li><li id="9066" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">断路器</li><li id="6627" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">健康检查</li><li id="69ef" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">基于%流量分割的分阶段部署</li><li id="92c2" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">故障注入</li><li id="4a77" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">丰富的指标</li></ul><p id="2f59" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将在下一篇文章中讨论这些特性。这篇文章将为您提供关于Envoy代理的基本介绍，以及它如何实现负载平衡。另一篇文章再见。干杯:)</p><h1 id="cc1e" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">参考</h1><ul class=""><li id="d81d" class="ld le hu je b jf lr jj ls jn lz jr ma jv mb jz li lj lk ll dt translated"><a class="ae mc" href="https://devform.netlify.com/introduction-to-envoy-proxy-load-balancing/" rel="noopener ugc nofollow" target="_blank">https://devform . netlify . com/introduction-to-envoy-proxy-load-balancing/</a></li><li id="7cf0" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated"><a class="ae mc" href="https://www.envoyproxy.io/docs/envoy/v1.5.0/intro/arch_overview/load_balancing" rel="noopener ugc nofollow" target="_blank">https://www . envoy proxy . io/docs/envoy/v 1 . 5 . 0/intro/arch _ overview/load _ balancing</a></li><li id="1b21" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated">【https://www.jscape.com/blog/load-balancing-algorithms T4】</li><li id="959d" class="ld le hu je b jf lm jj ln jn lo jr lp jv lq jz li lj lk ll dt translated"><a class="ae mc" href="https://blog.envoyproxy.io/introduction-to-modern-network-load-balancing-and-proxying-a57f6ff80236" rel="noopener ugc nofollow" target="_blank">https://blog . envoy proxy . io/introduction-to-modern-network-load-balancing-and-proxy-a57f 6 ff 80236</a></li></ul><figure class="kz la lb lc fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/43c735f65292db8fa44da92c747706cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9Ff7rvdBCQgSBEPOCblxw.png"/></div></div></figure><p id="9dfe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae mc" href="https://www.amazon.com/-/en/Dhanushka-Madushan-ebook/dp/B0912GTBPQ/" rel="noopener ugc nofollow" target="_blank">现在你可以在亚马逊上预订芭蕾舞书的云原生应用。点击此处预购该书。</a></p></div></div>    
</body>
</html>