<html>
<head>
<title>Generating PDFs in Javascript for fun and profit!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用 Javascript 生成 pdf 以获得乐趣和利润！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/generating-pdfs-in-javascript-for-fun-and-profit-c7af594cf697#2019-04-04">https://medium.com/hackernoon/generating-pdfs-in-javascript-for-fun-and-profit-c7af594cf697#2019-04-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/0148190320e2659b00c4c40188103791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JF16M3jpe_n52JcB-hgZAQ.png"/></div></div></figure><p id="9a2f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直到最近，用 Javascript 创建复杂或优雅的 pdf 仍然是一个挑战。</p><p id="8122" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我将一步一步地向您展示获得漂亮 pdf 的最小阻力的途径。剧透:最近通过 Javascript 将 docx 转换成 PDF 成为可能:-)</p><p id="173b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来是我将在六月份西雅图 PDF 协会会议上的演讲中涉及的一些内容。</p><p id="c3c2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从 1000 英尺开始，你有三个主要选择:</p><ul class=""><li id="2f18" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">第一种是直接创建 PDF，使用<a class="ae ka" href="http://pdfkit.org/" rel="noopener ugc nofollow" target="_blank"> pdfkit </a>、<a class="ae ka" href="https://github.com/mrrio/jspdf" rel="noopener ugc nofollow" target="_blank"> jsPDF </a>，或者更高级别的<a class="ae ka" href="http://pdfmake.org" rel="noopener ugc nofollow" target="_blank"> pdfmake </a>。Pdfkit 就像 Java 世界中的 iText。基于 pdfkit 的 Pdfmake 有自己的格式来表示富文本；它将其转换为 PDF 格式。</li><li id="533f" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">第二种方法是创建 HTML，然后将其转换为 PDF。这些天大概在用<a class="ae ka" href="https://pptr.dev/" rel="noopener ugc nofollow" target="_blank">木偶戏</a>。</li><li id="752f" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">第三种方法是创建一个 docx，然后将其转换为 PDF。</li></ul><p id="f8d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">换句话说，您可以直接创建 PDF，或者使用 HTML 或 docx 作为中间格式。</p><p id="035c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为现在用 Javascript 将 docx 转换成 PDF 很容易，所以 docx 方法是阻力最小的途径——特别是对于商业文档(提案、发票、合同等)。</p><p id="49f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，内容通常已经是 Word 文档格式，这使您的工作变得容易。</p><p id="e94d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更重要的是，预先考虑持续的维护(内容和格式的改变)是值得的。作为一名开发人员，这是您想要做的事情吗？还是让企业自己来做更好？如果它是一个 Word 文档，那么业务用户可以更新文档而不会打扰你。</p><p id="22e2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">几年来，用 Javascript 创建 docx 一直很容易，但直到最近，将它从 Javascript 转换成 PDF 才是症结所在。令人高兴的是，这现在是可行的——不需要调用一些 SAAS API，使用 LibreOffice 或任何类似的东西。</p><p id="62bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<a class="ae ka" href="https://docx.js.org/" rel="noopener ugc nofollow" target="_blank"> docx.js </a>你可以以编程方式构建你的 Word 文档(就像 pdfkit 和 jsPDF 允许你构建 PDF 一样)。但这可能不是一个好主意，因为为了最终的 pdf 看起来正确，您想要使用的任何功能都必须在创建 docx 和 docx 到 PDF 步骤中得到支持。例如，合并表格中的单元格，或者添加水印。</p><p id="e067" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们想要的是一种创建 docx 的简单方法，然后确信我们的 docx 将被干净地转换成 PDF。</p><p id="e85c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于这一点，一种“模板化”的方法是答案:基本上，你用你想要的布局创建一个 docx 模板——在 Microsoft Word、LibreOffice、Google Docs、Native Docs 或其他什么中——然后使用模板引擎替换“变量”。</p><p id="d03c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第一步:填充 docx 模板</strong></p><p id="40ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里我们将在 node.js 中使用<a class="ae ka" href="https://www.npmjs.com/package/docxtemplater" rel="noopener ugc nofollow" target="_blank"> docxtemplater </a></p><p id="5ee8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">比如你想要一张 PDF 发票。由于使用 Word 模板的部分原因是商业用户很容易将它变得漂亮，所以让我们从微软设计并包含在 Word 中的一个发票模板开始。</p><figure class="kq kr ks kt fq iv fe ff paragraph-image"><a href="https://demo.nativedocuments.com/editUrl?url=https%3A%2F%2Fwww.nativedocuments.com%2Fassets%2Fdocs%2Farticles%2Finvoice-template.docx"><div class="fe ff kp"><img src="../Images/02c2f96f0079db43c8db7d91ce68b124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QZ0TQTUzGiSd1TWDpfIQQ.png"/></div></a><figcaption class="ku kv fg fe ff kw kx bd b be z ek">invoice-template.docx</figcaption></figure><p id="f4a3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以看到我添加了一些变量(按照 docxtemplater 的要求，用花括号表示)。</p><p id="3dac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以点击图片在我们的 Word 文件编辑器中查看 docx。点击<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>下载/使用，代码如下。</p><p id="3bf5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为一个 Javascript 库，docxtemplater 接收 JSON 格式的数据:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="0b7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意项目数组。表格行对每个项目重复。您可以在该表行的开头和结尾看到 docxtemplater 对 repeat/ <a class="ae ka" href="https://docxtemplater.readthedocs.io/en/latest/tag_types.html#loops" rel="noopener ugc nofollow" target="_blank">循环</a>的标记。</p><p id="5904" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">出于演示的目的，我们将在 javascript 中提供:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="f84d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要试用它，请按照其<a class="ae ka" href="https://docxtemplater.readthedocs.io/en/latest/installation.html#node" rel="noopener ugc nofollow" target="_blank">说明</a>安装 docxtemplater:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="2358" class="lf lg hu lb b fv lh li l lj lk">npm install docxtemplater<br/>npm install jszip@2</span></pre><p id="6012" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那么它只是:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="5481" class="lf lg hu lb b fv lh li l lj lk">node invoice-template-docx.js</span></pre><p id="3f90" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您会得到一个填充的发票实例:</p><figure class="kq kr ks kt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/1235754e970a1c9ae5e8f4296a369f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjMM1FvBBLNZar6DpfDsfQ.png"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">invoice-instance.docx</figcaption></figure><p id="8e98" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，表格行已被重复，所有变量都被替换。</p><p id="730a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您自己运行代码，您可以通过在您最喜欢的 docx 编辑器或我们的编辑器中打开 invoice-instance.docx 来验证结果:<a class="ae ka" href="https://canary.nativedocuments.com/" rel="noopener ugc nofollow" target="_blank">单击此处</a>然后拖放您的 docx。</p><p id="52ac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第二步:将 docx 转换为 PDF </strong></p><p id="90c9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止一切顺利。现在我们只需要将填充的发票实例转换成 PDF。</p><p id="cc77" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为此，我们将使用 docx-wasm，这是我们在今年早些时候发布的 Native Documents 中的一个节点模块。我们在 Native Documents 的面包和黄油是基于 web 的文档编辑/查看组件<a class="ae ka" href="https://demo.nativedocuments.com/editUrl?url=https%3A%2F%2Fwww.nativedocuments.com%2Fassets%2Fdocs%2Farticles%2Finvoice-template.docx" rel="noopener ugc nofollow" target="_blank">，我们在上面的</a>中使用它来显示<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>，这个节点模块使用 Word 兼容的页面布局代码生成 PDF 输出。换句话说，页面布局非常接近地再现了 Word 的功能，因此也可以用于高质量的 PDF 输出。</p><p id="5054" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，安装它:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="4871" class="lf lg hu lb b fv lh li l lj lk">npm install @nativedocuments/docx-wasm</span></pre><p id="6cda" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将 node.js buffer 对象中的 docx 转换为 PDF 的过程如下:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="1cd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你需要一个 ND_DEV_ID，ND_DEV_SECRET 对来使用这个模块。你可以在 https://developers.nativedocuments.com/的<a class="ae ka" href="https://developers.nativedocuments.com/" rel="noopener ugc nofollow" target="_blank">获得免费钥匙</a></p><p id="c08b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将它们复制到 docx.init 调用中(或者，您可以将它们设置为环境变量)。</p><p id="2db3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我没有在这里发布 PDF，因为它看起来和发票实例 docx 一样。</p><p id="418b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">将所有这些放在一起</strong></p><p id="f899" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是结合了步骤 1 和步骤 2 的 Javascript。</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="44bd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要尝试一下，下载<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>然后:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="92e9" class="lf lg hu lb b fv lh li l lj lk">node docx-template-to-pdf.js</span></pre><p id="7d88" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">部署选项</strong></p><p id="efef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在 AWS Lambda 上有一个很好的运行方式。有了 Lambda，你可以轻松地伸缩，而且不用的时候也不用花钱买服务器。更多信息请参见我即将于六月在西雅图举行的 PDF 协会会议上的演讲！同时，<a class="ae ka" href="https://github.com/NativeDocuments/docx-to-pdf-on-AWS-Lambda" rel="noopener ugc nofollow" target="_blank">docx-to-PDF-on-AWS-Lambda</a>向您展示了如何在 Lambda 上执行 docx-PDF 部分。添加 docx 模板很简单。</p><p id="e851" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在还可以在浏览器中将 docx 转换成 PDF 格式，减少了服务器的负载，并为离线操作开辟了道路。<a class="ae ka" href="https://github.com/NativeDocuments/docx-wasm-client-side" rel="noopener ugc nofollow" target="_blank">docx-wasm-客户端</a>向您展示如何在客户端执行 docx 到 PDF 部分。</p></div></div>    
</body>
</html>