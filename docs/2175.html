<html>
<head>
<title>Generating PDFs in Javascript for fun and profit!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Javascript生成pdf以获得乐趣和利润！</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/generating-pdfs-in-javascript-for-fun-and-profit-c7af594cf697?source=collection_archive---------2-----------------------#2019-04-04">https://medium.com/hackernoon/generating-pdfs-in-javascript-for-fun-and-profit-c7af594cf697?source=collection_archive---------2-----------------------#2019-04-04</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/0148190320e2659b00c4c40188103791.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JF16M3jpe_n52JcB-hgZAQ.png"/></div></div></figure><p id="9a2f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直到最近，用Javascript创建复杂或优雅的pdf仍然是一个挑战。</p><p id="8122" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我将一步一步地向您展示获得漂亮pdf的最小阻力的途径。剧透:最近通过Javascript将docx转换成PDF成为可能:-)</p><p id="173b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来是我将在六月份西雅图PDF协会会议上的演讲中涉及的一些内容。</p><p id="c3c2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从1000英尺开始，你有三个主要选择:</p><ul class=""><li id="2f18" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">第一种是直接创建PDF，使用<a class="ae ka" href="http://pdfkit.org/" rel="noopener ugc nofollow" target="_blank"> pdfkit </a>、<a class="ae ka" href="https://github.com/mrrio/jspdf" rel="noopener ugc nofollow" target="_blank"> jsPDF </a>，或者更高级别的<a class="ae ka" href="http://pdfmake.org" rel="noopener ugc nofollow" target="_blank"> pdfmake </a>。Pdfkit就像Java世界中的iText。基于pdfkit的Pdfmake有自己的格式来表示富文本；它将其转换为PDF格式。</li><li id="533f" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">第二种方法是创建HTML，然后将其转换为PDF。这些天大概在用<a class="ae ka" href="https://pptr.dev/" rel="noopener ugc nofollow" target="_blank">木偶戏</a>。</li><li id="752f" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">第三种方法是创建一个docx，然后将其转换为PDF。</li></ul><p id="f8d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">换句话说，您可以直接创建PDF，或者使用HTML或docx作为中间格式。</p><p id="035c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因为现在用Javascript将docx转换成PDF很容易，所以docx方法是阻力最小的途径——特别是对于商业文档(提案、发票、合同等)。</p><p id="49f5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，内容通常已经是Word文档格式，这使您的工作变得容易。</p><p id="e94d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更重要的是，预先考虑持续的维护(内容和格式的改变)是值得的。作为一名开发人员，这是您想要做的事情吗？还是让企业自己来做更好？如果它是一个Word文档，那么业务用户可以更新文档而不会打扰你。</p><p id="22e2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">几年来，用Javascript创建docx一直很容易，但直到最近，将它从Javascript转换成PDF才是症结所在。令人高兴的是，这现在是可行的——不需要调用一些SAAS API，使用LibreOffice或任何类似的东西。</p><p id="62bc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用<a class="ae ka" href="https://docx.js.org/" rel="noopener ugc nofollow" target="_blank"> docx.js </a>你可以以编程方式构建你的Word文档(就像pdfkit和jsPDF允许你构建PDF一样)。但这可能不是一个好主意，因为为了最终的pdf看起来正确，您想要使用的任何功能都必须在创建docx和docx到PDF步骤中得到支持。例如，合并表格中的单元格，或者添加水印。</p><p id="e067" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们想要的是一种创建docx的简单方法，然后确信我们的docx将被干净地转换成PDF。</p><p id="e85c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于这一点，一种“模板化”的方法是答案:基本上，你用你想要的布局创建一个docx模板——在Microsoft Word、LibreOffice、Google Docs、Native Docs或其他什么中——然后使用模板引擎替换“变量”。</p><p id="d03c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第一步:填充docx模板</strong></p><p id="40ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里我们将在node.js中使用<a class="ae ka" href="https://www.npmjs.com/package/docxtemplater" rel="noopener ugc nofollow" target="_blank"> docxtemplater </a></p><p id="5ee8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">比如你想要一张PDF发票。由于使用Word模板的部分原因是商业用户很容易将它变得漂亮，所以让我们从微软设计并包含在Word中的一个发票模板开始。</p><figure class="kq kr ks kt fq iv fe ff paragraph-image"><a href="https://demo.nativedocuments.com/editUrl?url=https%3A%2F%2Fwww.nativedocuments.com%2Fassets%2Fdocs%2Farticles%2Finvoice-template.docx"><div class="fe ff kp"><img src="../Images/02c2f96f0079db43c8db7d91ce68b124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1QZ0TQTUzGiSd1TWDpfIQQ.png"/></div></a><figcaption class="ku kv fg fe ff kw kx bd b be z ek">invoice-template.docx</figcaption></figure><p id="f4a3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您可以看到我添加了一些变量(按照docxtemplater的要求，用花括号表示)。</p><p id="3dac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你可以点击图片在我们的Word文件编辑器中查看docx。点击<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>下载/使用，代码如下。</p><p id="3bf5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为一个Javascript库，docxtemplater接收JSON格式的数据:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="0b7a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意项目数组。表格行对每个项目重复。您可以在该表行的开头和结尾看到docxtemplater对repeat/ <a class="ae ka" href="https://docxtemplater.readthedocs.io/en/latest/tag_types.html#loops" rel="noopener ugc nofollow" target="_blank">循环</a>的标记。</p><p id="5904" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">出于演示的目的，我们将在javascript中提供:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="f84d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要试用它，请按照其<a class="ae ka" href="https://docxtemplater.readthedocs.io/en/latest/installation.html#node" rel="noopener ugc nofollow" target="_blank">说明</a>安装docxtemplater:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="2358" class="lf lg hu lb b fv lh li l lj lk">npm install docxtemplater<br/>npm install jszip@2</span></pre><p id="6012" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">那么它只是:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="5481" class="lf lg hu lb b fv lh li l lj lk">node invoice-template-docx.js</span></pre><p id="3f90" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">您会得到一个填充的发票实例:</p><figure class="kq kr ks kt fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ll"><img src="../Images/1235754e970a1c9ae5e8f4296a369f11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EjMM1FvBBLNZar6DpfDsfQ.png"/></div></div><figcaption class="ku kv fg fe ff kw kx bd b be z ek">invoice-instance.docx</figcaption></figure><p id="8e98" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，表格行已被重复，所有变量都被替换。</p><p id="730a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您自己运行代码，您可以通过在您最喜欢的docx编辑器或我们的编辑器中打开invoice-instance.docx来验证结果:<a class="ae ka" href="https://canary.nativedocuments.com/" rel="noopener ugc nofollow" target="_blank">单击此处</a>然后拖放您的docx。</p><p id="52ac" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">第二步:将docx转换为PDF </strong></p><p id="90c9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">到目前为止一切顺利。现在我们只需要将填充的发票实例转换成PDF。</p><p id="cc77" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为此，我们将使用docx-wasm，这是我们在今年早些时候发布的Native Documents中的一个节点模块。我们在Native Documents的面包和黄油是基于web的文档编辑/查看组件<a class="ae ka" href="https://demo.nativedocuments.com/editUrl?url=https%3A%2F%2Fwww.nativedocuments.com%2Fassets%2Fdocs%2Farticles%2Finvoice-template.docx" rel="noopener ugc nofollow" target="_blank">，我们在上面的</a>中使用它来显示<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>，这个节点模块使用Word兼容的页面布局代码生成PDF输出。换句话说，页面布局非常接近地再现了Word的功能，因此也可以用于高质量的PDF输出。</p><p id="5054" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，安装它:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="4871" class="lf lg hu lb b fv lh li l lj lk">npm install @nativedocuments/docx-wasm</span></pre><p id="6cda" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将node.js buffer对象中的docx转换为PDF的过程如下:</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="1cd6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你需要一个ND_DEV_ID，ND_DEV_SECRET对来使用这个模块。你可以在https://developers.nativedocuments.com/的<a class="ae ka" href="https://developers.nativedocuments.com/" rel="noopener ugc nofollow" target="_blank">获得免费钥匙</a></p><p id="c08b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将它们复制到docx.init调用中(或者，您可以将它们设置为环境变量)。</p><p id="2db3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我没有在这里发布PDF，因为它看起来和发票实例docx一样。</p><p id="418b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">将所有这些放在一起</strong></p><p id="f899" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是结合了步骤1和步骤2的Javascript。</p><figure class="kq kr ks kt fq iv"><div class="bz el l di"><div class="ky kz l"/></div></figure><p id="44bd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要尝试一下，下载<a class="ae ka" href="http://www.nativedocuments.com/assets/docs/articles/invoice-template.docx" rel="noopener ugc nofollow" target="_blank"> invoice-template.docx </a>然后:</p><pre class="kq kr ks kt fq la lb lc ld aw le dt"><span id="92e9" class="lf lg hu lb b fv lh li l lj lk">node docx-template-to-pdf.js</span></pre><p id="7d88" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">部署选项</strong></p><p id="efef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在AWS Lambda上有一个很好的运行方式。有了Lambda，你可以轻松地伸缩，而且不用的时候也不用花钱买服务器。更多信息请参见我即将于六月在西雅图举行的PDF协会会议上的演讲！同时，<a class="ae ka" href="https://github.com/NativeDocuments/docx-to-pdf-on-AWS-Lambda" rel="noopener ugc nofollow" target="_blank">docx-to-PDF-on-AWS-Lambda</a>向您展示了如何在Lambda上执行docx-PDF部分。添加docx模板很简单。</p><p id="e851" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在还可以在浏览器中将docx转换成PDF格式，减少了服务器的负载，并为离线操作开辟了道路。<a class="ae ka" href="https://github.com/NativeDocuments/docx-wasm-client-side" rel="noopener ugc nofollow" target="_blank">docx-wasm-客户端</a>向您展示如何在客户端执行docx到PDF部分。</p></div></div>    
</body>
</html>