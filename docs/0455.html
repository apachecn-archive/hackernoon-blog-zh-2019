<html>
<head>
<title>Dockerizing an existing Rails-Postgresql app with Docker compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用 Docker compose 对现有的 Rails-Postgresql 应用程序进行 Dockerizing</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/dockerizing-an-existing-rails-postgresql-app-with-docker-compose-a30a7e1b3f40#2019-01-18">https://medium.com/hackernoon/dockerizing-an-existing-rails-postgresql-app-with-docker-compose-a30a7e1b3f40#2019-01-18</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/7dcfc847bbb0163c65722be765423555.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_rudTXVoO7O2rQe-P8KEQ.png"/></div></div></figure><p id="8262" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用 Docker compose 对现有 Rails-Postgresql 应用程序进行 Docker 化的快速入门</p><p id="5b24" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Dockerfiles —定义项目</strong></p><p id="9514" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在 app 的根目录下创建<em class="ka"> Dockerfile </em>，通过向<em class="ka"> Dockerfile 添加依赖项来定义项目。</em></p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="c6d1" class="kk kl hu kg b fv km kn l ko kp">FROM ruby:2.5.3</span><span id="2a3c" class="kk kl hu kg b fv kq kn l ko kp">RUN apt-get update -qq &amp;&amp; apt-get install -y build-essential libpq-dev nodejs</span><span id="6e64" class="kk kl hu kg b fv kq kn l ko kp">RUN mkdir /myapp</span><span id="eea5" class="kk kl hu kg b fv kq kn l ko kp">WORKDIR /myapp</span><span id="50a3" class="kk kl hu kg b fv kq kn l ko kp">COPY Gemfile /myapp/Gemfile</span><span id="4321" class="kk kl hu kg b fv kq kn l ko kp">COPY Gemfile.lock /myapp/Gemfile.lock</span><span id="af8d" class="kk kl hu kg b fv kq kn l ko kp">RUN bundle install</span><span id="6389" class="kk kl hu kg b fv kq kn l ko kp">COPY . /myapp</span></pre><p id="a5e4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">确保添加您的应用程序使用的特定版本的 ruby</p><p id="f23e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Docker-compose —构建项目</strong></p><p id="e527" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在根目录下创建<em class="ka"> docker-compose.yml </em>文件。这个文件可以神奇地从当前目录构建您的应用程序，并通过 web 应用程序运行预构建的 postgresql 映像</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="247f" class="kk kl hu kg b fv km kn l ko kp">version: '3'<br/>services:<br/> db:<br/>  image: postgres<br/>  volumes:<br/>   - ./tmp/db:/var/lib/postgresql/data<br/> web:<br/>  build: .<br/>  command: bundle exec rails s -p 3000 -b '0.0.0.0'<br/>  volumes:<br/>   - .:/myapp<br/>  ports:<br/>   - "3000:3000"<br/>  depends_on:<br/>   - db</span></pre><p id="44aa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Database.yml —配置数据库</strong></p><p id="3dd4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在您的<em class="ka"> database.yml </em>文件中将主机改为‘db ’,以指向 docker 服务</p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="84f5" class="kk kl hu kg b fv km kn l ko kp">default: &amp;default</span><span id="0b59" class="kk kl hu kg b fv kq kn l ko kp"> adapter: postgresql</span><span id="67cb" class="kk kl hu kg b fv kq kn l ko kp"> encoding: unicode</span><span id="b140" class="kk kl hu kg b fv kq kn l ko kp"> host: db</span><span id="4394" class="kk kl hu kg b fv kq kn l ko kp"> username: postgres</span><span id="dd07" class="kk kl hu kg b fv kq kn l ko kp"> password:</span><span id="7501" class="kk kl hu kg b fv kq kn l ko kp"> pool: 5</span><span id="cc85" class="kk kl hu kg b fv kq kn l ko kp">development:</span><span id="cc1f" class="kk kl hu kg b fv kq kn l ko kp"> &lt;&lt;: *default<br/> database: myapp_development</span></pre><p id="f369" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过运行相应的命令，可以完成以下任务</p><p id="debc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">构建 Docker 映像</strong></p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="2b48" class="kk kl hu kg b fv km kn l ko kp">docker-compose build</span></pre><p id="6d4e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">数据库—创建和迁移</strong></p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="3883" class="kk kl hu kg b fv km kn l ko kp">docker-compose run web rake db:create db:migrate</span></pre><p id="1663" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">访问 Rails 控制台</strong></p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="4281" class="kk kl hu kg b fv km kn l ko kp">docker-compose exec web rails console</span></pre><p id="27ca" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">开始申请</strong></p><pre class="kb kc kd ke fq kf kg kh ki aw kj dt"><span id="9e99" class="kk kl hu kg b fv km kn l ko kp">docker-compose up</span></pre><p id="a058" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在您应该能够浏览到<a class="ae kr" href="http://localhost:3000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>并看到您的应用程序正在运行。</p></div></div>    
</body>
</html>