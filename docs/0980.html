<html>
<head>
<title>How To Set Up a Network Bridge for LXD Containers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何为 LXD 集装箱建立一个网桥</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-set-up-a-network-bridge-for-lxd-containers-98e3e7d1f273#2019-02-08">https://medium.com/hackernoon/how-to-set-up-a-network-bridge-for-lxd-containers-98e3e7d1f273#2019-02-08</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/f1654f40323f80a5f21d33d35e33907f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uLLNy70Ieky5MyIN6LCc8w.jpeg"/></div></div></figure><p id="8608" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们的大多数 web 应用程序都运行在 LXD 容器中。对我来说，LXD 是 Ubuntu 服务器最重要的特性之一。有许多方法可以从外部访问 LXD 容器中的 web 应用程序。例如，您可以使用反向代理来控制对容器的访问。另一种可能性是建立一个网桥，这样容器就和容器主机(Ubuntu 服务器)在同一个网络中。在这篇文章中，我将描述如何为 LXD 容器建立一个网桥。</p><h1 id="ef11" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">LXD 集装箱的网桥</h1><p id="ae1f" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">要在 Ubuntu 下建立一个网桥，你需要安装<em class="le">网桥工具</em>:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="d1a8" class="lo kc hu lk b fv lp lq l lr ls">$ apt install bridge-utils</span></pre><p id="a31f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后就可以设置网桥了。</p><h1 id="9a45" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Ubuntu 16.04</h1><p id="4f99" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">直到 Ubuntu 16.04 Ubuntu 使用<em class="le"> ifupdown </em>来设置网络连接设置。配置在<strong class="je hv"> /etc/network/ </strong>下的文件中完成。一个简单的网桥(用于将容器接入主机网络)可能如下所示:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="3dc1" class="lo kc hu lk b fv lp lq l lr ls">$ cat /etc/network/interfaces<br/># This file describes the network interfaces available on your system<br/># and how to activate them. For more information, see interfaces(5).</span><span id="11c7" class="lo kc hu lk b fv lt lq l lr ls">source /etc/network/interfaces.d/*</span><span id="8b25" class="lo kc hu lk b fv lt lq l lr ls"># The loopback network interface<br/>auto lo<br/>iface lo inet loopback</span><span id="4944" class="lo kc hu lk b fv lt lq l lr ls"># The main Bridge<br/>auto br0<br/>iface br0 inet dhcp<br/>    bridge-ifaces enp4s0<br/>    bridge-ports enp4s0<br/>    up ip link set enp4s0 up</span><span id="2057" class="lo kc hu lk b fv lt lq l lr ls"># The primary network interface<br/>iface enp4s0 inet manual</span></pre><p id="4206" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本例中，网桥从 DHCP 服务器获取其地址。真实网卡<em class="le"> enp4s0 </em>设置为手动模式，分配给网桥。</p><h1 id="5100" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">Ubuntu 18.04</h1><p id="f6f9" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">从 Ubuntu 18.04 <a class="ae ka" href="https://netplan.io/" rel="noopener ugc nofollow" target="_blank">开始，网络计划</a>用于配置网络连接。配置文件可以在<strong class="je hv"> /etc/netplan/ </strong>下找到。桥的定义可能如下所示:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="3bad" class="lo kc hu lk b fv lp lq l lr ls">$ cat /etc/netplan/50-cloud-init.yaml <br/># This file is generated from information provided by<br/># the datasource.  Changes to it will not persist across an instance.<br/># To disable cloud-init's network configuration capabilities, write a file<br/># /etc/cloud/cloud.cfg.d/99-disable-network-config.cfg with the following:<br/># network: {config: disabled}<br/>network:<br/>    ethernets:<br/>        enp3s0:<br/>            dhcp4: no<br/>    version: 2<br/>    bridges:<br/>        br0:<br/>            dhcp4: no<br/>            addresses:<br/>            - 10.10.10.5/24<br/>            gateway4: 10.10.10.254<br/>            nameservers:<br/>                addresses:<br/>                - 10.10.10.254<br/>            interfaces:<br/>            - enp3s0</span></pre><p id="e8e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在上部，您配置了真正的网卡(<em class="le"> enp3s0 </em>)，但没有为其分配地址。接下来是网桥的定义。它的设置类似于静态网络连接，并且还包含关键的<em class="le">接口</em>。在那里你定义哪个真正的网卡应该被“桥接”。你会在官网上找到<a class="ae ka" href="https://netplan.io/examples#configuring-network-bridges" rel="noopener ugc nofollow" target="_blank">更进一步(更复杂)的网桥示例</a>。</p><p id="e929" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，以下命令将更改应用于网络设置:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="09fe" class="lo kc hu lk b fv lp lq l lr ls">$ netplan apply --debug</span></pre><h1 id="ad0f" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">分配网桥</h1><p id="fc3d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">一旦您完成了网桥的设置，并且它获得了正确的 IP 地址，您必须告诉 LXD 容器从网桥获得它的 IP 地址。这可以通过以下命令完成:</p><pre class="lf lg lh li fq lj lk ll lm aw ln dt"><span id="de69" class="lo kc hu lk b fv lp lq l lr ls">$ lxc config device add containername eth0 nictype=bridged parent=br0 name=eth0</span></pre><p id="430d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用<em class="le"> name=eth0 </em>你定义在哪个名字下可以在容器中找到网卡。现在，您可以在容器中随意配置 eth0。从现在开始，容器将从主机网络获得一个 IP 地址。</p><h1 id="ee88" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="9452" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">你可以设置一个简单的网桥，并将其分配给一个容器。这允许网络上的其他用户访问 web 应用程序，而不需要在容器主机上设置反向代理。更复杂的情况也是可能的(VLANs、将容器放入不同网络的多个网桥等。)，但这超出了这篇短文的范围。</p></div><div class="ab cl lu lv hc lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="hn ho hp hq hr"><p id="dcdf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="le">最初发表于</em><a class="ae ka" href="https://openschoolsolutions.org/set-up-network-bridge-lxd/" rel="noopener ugc nofollow" target="_blank"><em class="le">【openschoolsolutions.org】</em></a><em class="le">。</em></p></div></div>    
</body>
</html>