<html>
<head>
<title>useRedux — state management pattern with React Hooks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">useRedux —带React挂钩的状态管理模式</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/useredux-state-management-pattern-with-react-hooks-fa8e1413b9f1?source=collection_archive---------0-----------------------#2019-02-20">https://medium.com/hackernoon/useredux-state-management-pattern-with-react-hooks-fa8e1413b9f1?source=collection_archive---------0-----------------------#2019-02-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="4cdc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">自从<a class="ae jp" href="https://reactjs.org/docs/hooks-intro.html" rel="noopener ugc nofollow" target="_blank"> React Hooks </a>特性公布，API公开以来，我一直在思考这对<em class="jq">Redux</em>——一个众所周知的状态管理库——意味着什么。相当一段时间以来，一直有声音喊着我们不需要<em class="jq"> Redux </em>，我们可以用<em class="jq"> React Context </em>达到同样的效果。嗯，我认为<em class="jq"> Redux </em>与其说是一个库，不如说是一种模式。在玩了一天<em class="jq"> React钩子</em>之后，我能够使用<strong class="it hv">上下文</strong>和<strong class="it hv">钩子</strong>来实现这个模式。我将向你展示如何制作你自己的<em class="jq">提供者</em>包装器和<em class="jq"> useRedux </em>钩子。哦，而且是在<strong class="it hv">打字稿</strong>里全打出来的。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/f39dbddedec15a31ad5dd9192ab2d49c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GUPx7ub3lOOpp9SkiIXGSw.jpeg"/></div></div><figcaption class="kd ke fg fe ff kf kg bd b be z ek">Unrelated, yet still a nice photo. ( by <a class="ae jp" href="https://unsplash.com/photos/bShDAAlPLKc?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Agustin Gaute</a> on <a class="ae jp" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a>)</figcaption></figure></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="33c3" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">供应者</h1><p id="677d" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">首先，我们为我们的状态和动作创建一个<em class="jq">提供者</em>。让我们创建一个名为<code class="eh lr ls lt lu b">initRedux</code>的函数，它将有两个参数:root reducer和应用程序的初始状态，因此我们可以将它们传递给<a class="ae jp" href="https://reactjs.org/docs/hooks-reference.html#usereducer" rel="noopener ugc nofollow" target="_blank"> useReducer </a> hook。</p><pre class="js jt ju jv fq lv lu lw lx aw ly dt"><span id="a89e" class="lz kp hu lu b fv ma mb l mc md">const [state, dispatch] = useReducer(rootReducer, initialState)</span></pre><p id="402c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个钩子会给我们<em class="jq">状态</em>对象和<em class="jq">分派</em>函数。这两个应该在整个应用程序中都是可访问的。实现这一点的最好方法是用<em class="jq"> React Context </em>沿着组件树向下传递它们，每个上下文对应一个上下文。</p><pre class="js jt ju jv fq lv lu lw lx aw ly dt"><span id="6713" class="lz kp hu lu b fv ma mb l mc md">const StateContext = React.createContext(null)<br/>const DispatchContext = React.createContext(null)</span></pre><p id="4e8a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们的<code class="eh lr ls lt lu b">initRedux</code>方法创建了一个已经包含这两个上下文的提供者的<code class="eh lr ls lt lu b">Provider</code>。</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="9620" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这个<code class="eh lr ls lt lu b">Provider</code>,您可以包装整个应用程序，并在每个组件中提供应用程序状态和调度功能。但是我们如何在组件中使用它们呢？</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="df98" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">useRedux</h1><p id="ed00" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">钩子的一个很大的优点是它们的组合能力。你可以用另一个钩子做你自己的钩子。只要你遵守钩子的<a class="ae jp" href="https://reactjs.org/docs/hooks-rules.html" rel="noopener ugc nofollow" target="_blank">规则，你想怎么玩就怎么玩。</a></p><p id="b0c5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如我所说的，我们需要访问应用程序状态，并且能够调度我们的操作。为了方便起见，我决定使用一个与<a class="ae jp" href="https://github.com/reduxjs/react-redux" rel="noopener ugc nofollow" target="_blank"> React-Redux </a>中的<code class="eh lr ls lt lu b">connect</code>函数非常相似的接口。如果不熟悉，肯定查一下，很有用的。</p><p id="a0e4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，我们的<code class="eh lr ls lt lu b">useRedux</code>钩子将接受两个参数，称为<code class="eh lr ls lt lu b">extractState</code>和<code class="eh lr ls lt lu b">actionMap</code>(与<code class="eh lr ls lt lu b">mapStateToProps</code>和<code class="eh lr ls lt lu b">mapDispatchToProps</code>平行)。</p><p id="3420" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先，我们检索两个上下文。</p><pre class="js jt ju jv fq lv lu lw lx aw ly dt"><span id="8d49" class="lz kp hu lu b fv ma mb l mc md">const appState = React.useContext(StateContext)<br/>const dispatch = React.useContext(DispatchContext)</span></pre><p id="87cc" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当然，我们不想返回应用程序的整个状态，而是使用<code class="eh lr ls lt lu b">extractState</code>函数从参数中提取状态的所需部分。</p><pre class="js jt ju jv fq lv lu lw lx aw ly dt"><span id="e965" class="lz kp hu lu b fv ma mb l mc md">const stateExtract = extractState(appState)</span></pre><p id="c825" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这部分很简单。<code class="eh lr ls lt lu b">useRedux</code>的一个消费者已经提供了一个函数，它将应用程序状态作为一个参数，并且只选择相关的值。现在我们需要使用<code class="eh lr ls lt lu b">actionMap</code>参数并做一些映射魔术。假设<code class="eh lr ls lt lu b">actionMap</code>是一个形状为<code class="eh lr ls lt lu b">{key: myActionCreator}</code>的对象，让我们给那些动作创建者绑定一个<code class="eh lr ls lt lu b">dispatch</code>函数。</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="5247" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">代码遍历<code class="eh lr ls lt lu b">actionMap</code>对象中的键，并用函数替换它的值(动作创建者),这些函数直接调度那些动作创建者返回的动作。通过一个简单的修改，我们也可以调度<em class="jq"> thunks </em>。只要加一个条件:</p><pre class="js jt ju jv fq lv lu lw lx aw ly dt"><span id="98d0" class="lz kp hu lu b fv ma mb l mc md">const fn = (...args) =&gt; {<br/>    const action = actionCreator(...args)<br/>    if (typeof action === 'function') {<br/>        action(dispatch, () =&gt; appState)<br/>    } else {<br/>        dispatch(action)<br/>    }<br/>}</span></pre><p id="e217" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们需要做的就是从我们的自定义钩子返回<code class="eh lr ls lt lu b">stateExtract</code>和<code class="eh lr ls lt lu b">actions</code>。一个完整的<code class="eh lr ls lt lu b">initRedux</code>函数如下所示。</p><figure class="js jt ju jv fq jw"><div class="bz el l di"><div class="me mf l"/></div></figure><p id="ede9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在大约40行代码中，你可以创建自己的<em class="jq"> Provider </em>和<em class="jq"> useRedux </em>定制钩子。我照做了，用TypeScript把它全部打出来，并把它作为<code class="eh lr ls lt lu b">redoox</code>包发布给npm。如果你愿意，你可以试着玩玩它，但是要知道这只是一个实验，它绝对不适合生产。</p><p id="b4ce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">已经有相当多的软件包试图达到同样的效果。有一个甚至来自脸书孵化器。我认为最好不要有大量的软件包试图用稍微不同的API来解决同一个问题。如果你知道有一个公平的机会成为“官方的”，让我在评论中知道。我很乐意帮助实现它。</p><p id="c181" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们来看看由于类型化接口，开发人员的体验有多好。</p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><h1 id="3166" class="ko kp hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">它是如何工作的？</h1><p id="e8b9" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">用法很简单。例如，我创建了一个简单的应用程序，它从REST API加载用户，显示他们，您可以增加/减少他们的年龄。</p><ol class=""><li id="8c63" class="mg mh hu it b iu iv iy iz jc mi jg mj jk mk jo ml mm mn mo dt translated">创建应用程序状态</li></ol><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff mp"><img src="../Images/1c95c1f8b6797df3ad9061ff76c8c5a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*FYD0NaZPveL61OG9zXZ8gg.png"/></div></figure><p id="a678" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">2.实施行动创建者</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff mq"><img src="../Images/309df60795e0038568906af34118163a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*nqHn1pG77XU27XEyfZlqTQ.png"/></div></figure><p id="b9e3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">3.机具减速器。我使用了<a class="ae jp" href="https://github.com/mweststrate/immer" rel="noopener ugc nofollow" target="_blank"> immer </a>库来确保不变性。<em class="jq">请注意，在访问action payload时，您几乎不会出错。</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mr"><img src="../Images/1f496aee32deb393504825f1b69c46a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/format:webp/1*L2dD06h9JsR_qApyhihqAg.png"/></div></div></figure><p id="3426" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">4.实现选择器。我正在使用<a class="ae jp" href="https://github.com/reduxjs/reselect" rel="noopener ugc nofollow" target="_blank">重新选择</a>库。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff ms"><img src="../Images/0166fda255d82c39645be72fc3dfc796.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*qymN8zmGpih75YqxgvhayQ.png"/></div></figure><p id="05b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">5.创建一个商店。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mt"><img src="../Images/d4cec63e98ea9596c8fe134d85ffa510.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*l_1lL_cxM4VM_mPgT4IhkA.png"/></div></div></figure><p id="d8c6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">6.最后，在组件中使用钩子。如果所有的接口都被正确地输入，您将总是知道您提取了状态的哪一部分，以及哪些动作是可用的。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mu"><img src="../Images/a3e857ba3bfd2266494393c43e019188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1096/format:webp/1*fvM52qHq6gyxml0rlC7ihg.png"/></div></div></figure><p id="4e68" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你可以在这里找到完整的例子<a class="ae jp" href="https://github.com/jake-daniels/redoox" rel="noopener ugc nofollow" target="_blank">。<br/>只克隆一个库，然后<code class="eh lr ls lt lu b">yarn</code>、<code class="eh lr ls lt lu b">yarn build</code>和<code class="eh lr ls lt lu b">yarn start</code>。</a></p></div><div class="ab cl kh ki hc kj" role="separator"><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km kn"/><span class="kk bw bk kl km"/></div><div class="hn ho hp hq hr"><p id="022d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我作为软件开发人员的职业生涯中，我遇到过许多不同的状态管理模式，不仅仅是React /JavaScript。到目前为止，我最喜欢Redux。它是可预测的、可维护的和易于测试的。就应用程序的数据层而言，这些属性对我来说非常重要。如果我们能让它在更大范围内与React挂钩一起工作，那就太好了。</p><p id="fdad" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">感谢阅读。如果你有问题或有趣的想法，请在评论区分享。</p></div></div>    
</body>
</html>