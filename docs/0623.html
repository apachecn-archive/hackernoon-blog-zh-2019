<html>
<head>
<title>Setting up a Serverless Contact form in React — using Nodemailer and Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 React 中设置无服务器联系人表单—使用 Nodemailer 和 Express</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/setting-up-a-serverless-contact-form-in-react-using-nodemailer-and-express-19df9fdb20ed#2019-01-26">https://medium.com/hackernoon/setting-up-a-serverless-contact-form-in-react-using-nodemailer-and-express-19df9fdb20ed#2019-01-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/2777d3afbc194da7df8874b9d654e011.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VZFqBGdxvJl5mh2tXUpiRg.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">Illustration by <a class="ae ih" href="http://dribbble.com/akritibhusal" rel="noopener ugc nofollow" target="_blank">Akriti Bhusal</a> 🥳</figcaption></figure><div class=""/><p id="4aab" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">拥有一个联系方式总比仅仅在我们的网站上显示一个电子邮件地址要好。联系表格给我们的访问者提供了一个与我们联系的简单方法。在这篇文章中，我们将通过一个简单的方法来使用<a class="ae ih" href="https://nodemailer.com/" rel="noopener ugc nofollow" target="_blank">节点邮件</a>和<a class="ae ih" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express </a> API 在<a class="ae ih" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"> React </a>中设置我们自己的。这篇文章还将带我们了解现在如何使用<a class="ae ih" href="https://zeit.co/now" rel="noopener ugc nofollow" target="_blank"> Zeit </a>部署无服务器 it。</p><h2 id="f909" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak">这个应用程序将做什么:</strong></h2><p id="544a" class="pw-post-body-paragraph jh ji ik jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">本教程结束时，您的网站上将会有一个联系表单，它会将邮件直接发送到您的收件箱。</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="lj lk l"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">GIFs from <a class="ae ih" href="https://giphy.com/gifs/stefanie-shank-house-of-joy-stef-l46Cq6Bro9CsP149q" rel="noopener ugc nofollow" target="_blank">Gip</a><a class="ae ih" href="https://media.giphy.com/media/3o6Mbfsf4DI4Cds5Ms/giphy.gif" rel="noopener ugc nofollow" target="_blank">hy</a></figcaption></figure><h2 id="6af1" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">此应用将使用的工具</h2><ul class=""><li id="f1f1" class="ll lm ik jj b jk la jo lb js ln jw lo ka lp ke lq lr ls lt dt translated"><a class="ae ih" href="http://github.com" rel="noopener ugc nofollow" target="_blank"><strong class="jj il">GitHub</strong></a>——(用于托管代码。稍后还需要与 Zeit 一起部署)</li><li id="08b8" class="ll lm ik jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><a class="ae ih" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jj il">Npm</strong></a>——(用于使用 create-react-app 等 JS 包)</li><li id="b476" class="ll lm ik jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><a class="ae ih" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="jj il">节点 JS</strong></a><a class="ae ih" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"><strong class="jj il">Express JS</strong></a><strong class="jj il"/>(因为我们的 API 会内置在 Express 中)</li><li id="b004" class="ll lm ik jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><a class="ae ih" href="https://reactjs.org/" rel="noopener ugc nofollow" target="_blank"><strong class="jj il">React JS</strong></a>(<a class="ae ih" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank">create-React-app</a>用于引导标准 React 应用程序并设置我们的表单)</li><li id="7999" class="ll lm ik jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><a class="ae ih" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> <strong class="jj il"> Axios </strong> </a>(用于向我们的远程 API 提交表单数据)</li><li id="554c" class="ll lm ik jj b jk lu jo lv js lw jw lx ka ly ke lq lr ls lt dt translated"><a class="ae ih" href="https://zeit.co/now" rel="noopener ugc nofollow" target="_blank"> <strong class="jj il"> Zeit Now </strong> </a>(部署我们的 app 无服务器)</li></ul></div><div class="ab cl lz ma hc mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="hn ho hp hq hr"><h2 id="0148" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">步伐</h2><h2 id="81db" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">1.准备好东西</h2><p id="36c0" class="pw-post-body-paragraph jh ji ik jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated"><strong class="jj il"> GitHub repos — </strong>我们首先创建两个<a class="ae ih" href="http://github.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a> repos，一个托管 React 表单，另一个托管节点 API。我们也可以在单个回购中完成，但是为了更好的可维护性，我们使用了两个回购。</p><p id="fb0f" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj il"> Node &amp; npm — </strong>从<a class="ae ih" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">链接</a>下载最新版本的<a class="ae ih" href="https://hackernoon.com/tagged/node-js" rel="noopener ugc nofollow" target="_blank"> node.js </a>。在本帖中，我们使用的是 11.7.0 版本。节点附带 npm。要确保安装了 node 和 npm，请在终端上使用以下命令检查它们的版本:</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="e733" class="kf kg ik mh b fv ml mm l mn mo">// For node version<br/>node -v<br/>v11.7.0</span><span id="2987" class="kf kg ik mh b fv mp mm l mn mo">//For npm version<br/>npm -v<br/>6.4.1</span></pre><p id="01fc" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj il"> React — </strong>我们在 React 应用程序中使用<a class="ae ih" href="https://github.com/facebook/create-react-app" rel="noopener ugc nofollow" target="_blank"><strong class="jj il">create-React-app</strong></a>来构建表单。使用以下命令全局安装 create-react-app 并生成 react 应用程序:</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="c3d6" class="kf kg ik mh b fv ml mm l mn mo">//Install create-react-app globally<br/>npm install create-react-app -g</span><span id="926d" class="kf kg ik mh b fv mp mm l mn mo">//Generate a new react app called my-app<br/>create-react-app my-app &amp;&amp; cd my-app &amp;&amp; npm start</span></pre><h2 id="0564" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak"> 2。表单</strong></h2><p id="cb6a" class="pw-post-body-paragraph jh ji ik jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">让我们从设置一个返回 HTML 表单的组件开始。我们在下面的代码中使用了<a class="ae ih" href="https://getbootstrap.com/" rel="noopener ugc nofollow" target="_blank"> Bootstrap </a>类，所以它们是可选的，你也可以使用自己的 CSS 类。</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><p id="27dc" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这里，每个输入都有一个<em class="mr"> onChange </em>处理程序，对应于组件状态中的一个特定变量。因此，当输入改变时，状态也会更新。表单本身有一个<em class="mr"> onSubmit </em>处理程序，它调用处理我们的 API 调用的<em class="mr"> formSubmit </em>函数。</p><p id="af22" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们将看一下这个函数，但是在此之前，让我们安装 axios(我们将在函数中使用它)来向 API 发出 HTTP 请求。</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="588c" class="kf kg ik mh b fv ml mm l mn mo">//Install axios</span><span id="b695" class="kf kg ik mh b fv mp mm l mn mo">npm install axios --save</span></pre><p id="1d67" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">设置我们的组件 src/App.js:</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><p id="6c90" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，我们在组件中添加处理表单提交的函数。</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><p id="1e74" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mr"> preventDefault()函数(在第 2 行)，</em>顾名思义<em class="mr">，</em>阻止表单的默认动作，否则会导致页面重载。发送消息时，按钮文本变为“…发送”，并且<a class="ae ih" href="https://github.com/axios/axios" rel="noopener ugc nofollow" target="_blank"> axios </a>进行 API 调用。</p><p id="78ff" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mr">注意:“API_URI”(第 14 行)是我们的 API 的端点的 URI，这将在本文的部署部分讨论(步骤 4)。</em></p><p id="d121" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果一切顺利，调用<em class="mr"> resetForm </em>，我们还没有定义。因此，让我们定义重置函数，该函数将重置我们的表单字段并更新我们的按钮标签:</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><h2 id="dbab" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated"><strong class="ak"> 3。API </strong></h2><p id="eee6" class="pw-post-body-paragraph jh ji ik jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">现在，我们需要将表单输入传输到 API，所以我们设置了 nodemailer、配置文件和路由。但在此之前，我们需要在我们的节点 API repo 中设置<a class="ae ih" href="https://expressjs.com/" rel="noopener ugc nofollow" target="_blank"> Express.js </a>:</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="5176" class="kf kg ik mh b fv ml mm l mn mo">//Initialize<br/>npm init</span><span id="93f8" class="kf kg ik mh b fv mp mm l mn mo">//Install express and other dependencies<br/>npm install express body-parser nodemailer cors --save</span></pre><p id="656c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们需要在 package.json 文件中做一个小的改动。找到“脚本”并在其中添加以下“开始”行:</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="d67d" class="kf kg ik mh b fv ml mm l mn mo">"scripts": {<br/>  "start": "node ."<br/>}</span></pre><p id="4537" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，在我们的目录中，我们用以下代码创建一个 index.js 文件:</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><blockquote class="ms mt mu"><p id="71b7" class="jh ji mr jj b jk jl jm jn jo jp jq jr mv jt ju jv mw jx jy jz mx kb kc kd ke hn dt translated"><strong class="jj il"> <em class="ik">重要提示</em> </strong> <em class="ik">:由于我们是开发版，所以</em> <strong class="jj il"> <em class="ik">凭证会在 GitHub </em> </strong> <em class="ik">上暴露，所以要确保你的回购是私密的，或者使用开发版的测试邮箱。在以后的生产中，您可以使用 Zeit 环境变量</em> <strong class="jj il"> <em class="ik"> </em> </strong> <em class="ik">来安全地存储凭证。</em></p></blockquote><p id="1b98" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们安装了 body-parser 来处理表单数据，安装了 CORS 来允许跨源请求。</p><p id="7cfe" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我们已经设置了一个 Nodemailer SMTP 传输和路由，它将接收来自 React 表单的数据，并向我们指定的目标电子邮件地址发送一封电子邮件。</p><h2 id="923c" class="kf kg ik bd kh ki kj kk kl km kn ko kp js kq kr ks jw kt ku kv ka kw kx ky kz dt translated">4.部署</h2><p id="6e7c" class="pw-post-body-paragraph jh ji ik jj b jk la jm jn jo lb jq jr js lc ju jv jw ld jy jz ka le kc kd ke hn dt translated">终于！完成所有这些后，是时候部署我们的应用程序了。我们现在使用 Zeit 进行部署，你可以选择你喜欢的任何其他服务。</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="my lk l"/></div><figcaption class="id ie fg fe ff if ig bd b be z ek">GIF form <a class="ae ih" href="https://media.giphy.com/media/zLrMT1J1RuJ9u/giphy.gif" rel="noopener ugc nofollow" target="_blank">Giphy</a></figcaption></figure><p id="7cbb" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">首先在<a class="ae ih" href="https://zeit.co/" rel="noopener ugc nofollow" target="_blank"> Zeit </a>上创建一个账户。登录，从顶部的导航栏进入“现在”。连接您的 GitHub 帐户，添加我们刚刚创建的两个回购。现在，我们回到代码，在两个 repos 中添加一个空的 now.json 文件。</p><p id="f246" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在是时候把我们的代码推送到各自的 github repos 了。</p><p id="0882" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，我们在两个回购中创建新分支，并与它们一起工作，因为我们需要为 Zeit now 创建拉请求来运行部署。</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="4568" class="kf kg ik mh b fv ml mm l mn mo">//create and change to new branch<br/>git checkout -b new-branch</span></pre><p id="e1e6" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在我们向 now.json 文件添加一些内容。对于我们的 React 回购，我们将在 now.json 上使用以下内容:</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><p id="2801" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">对于我们的节点回购，我们将使用 now.json 上的以下内容:</p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mq lk l"/></div></figure><p id="03ee" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mr">注:更多 Zeit Now 配置的例子可以在</em> <a class="ae ih" href="https://github.com/zeit/now-examples" rel="noopener ugc nofollow" target="_blank"> <em class="mr">这里</em> </a> <em class="mr">找到。</em></p><p id="dc7c" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最后，我们在 React repo 中对 package.json 做了一点小小的修改。<br/>找到“脚本”,并在其中添加“现在构建”行:</p><pre class="lf lg lh li fq mg mh mi mj aw mk dt"><span id="6d2c" class="kf kg ik mh b fv ml mm l mn mo">{<br/>    "scripts": {<br/>        ...<br/>        "now-build": "react-scripts build &amp;&amp; mv build dist"<br/>    }<br/>}</span></pre><p id="0096" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">现在，我们将代码推送到它们各自的 Github repos(new-branch ),然后在每个 repos 中创建一个 Pull 请求。Zeit Now 将立即部署识别 now.json 文件的应用程序。您可以通过单击“显示所有检查”，然后单击“拉取请求摘要”中的“详细信息”来查看应用程序 URL。最后，<strong class="jj il"> <em class="mr">一定要复制链接，替换 React app </em> </strong>中 App.js 文件中的 API_URI。现在我们的表单应该可以成功发送电子邮件了。</p><p id="c218" class="pw-post-body-paragraph jh ji ik jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="mr">感谢阅读！<br/>快乐编码！</em></p><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="mz lk l"/></div></figure></div></div>    
</body>
</html>