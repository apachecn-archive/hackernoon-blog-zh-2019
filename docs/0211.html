<html>
<head>
<title>Build a Personal Facebook Messenger Bot in 10 minutes with Nodejs and Standard Library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Nodejs和标准库在10分钟内构建一个个人Facebook Messenger Bot</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/build-a-personal-facebook-messenger-bot-in-10-minutes-a7a237f3f018?source=collection_archive---------6-----------------------#2019-01-09">https://medium.com/hackernoon/build-a-personal-facebook-messenger-bot-in-10-minutes-a7a237f3f018?source=collection_archive---------6-----------------------#2019-01-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="e06e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">拥有一个可以全天给你发送酷毙了的东西的个人聊天机器人不是很棒吗？也许在<strong class="it hv">上更新你家庭设备的状态</strong>或者从<a class="ae jp" href="https://www.reddit.com/r/catsstandingup" rel="noopener ugc nofollow" target="_blank"> Reddit </a>上发送<strong class="it hv">可爱猫咪的照片</strong>？</p><p id="8302" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们构建一个向您发送您最喜欢的 <a class="ae jp" href="https://www.reddit.com/r/catsstandingup" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">子编辑</strong> </a>中的<strong class="it hv">热门帖子的程序。你当然可以用你想发送的任何内容来扩展它。</strong></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/8ce928b75d035efdbefca9a5259a77c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qK3FR-T8OMpK3CZYFhokjA.jpeg"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">The bot will send you top posts from the subreddits you specify</figcaption></figure><p id="c52d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为此，我们需要三样东西:</p><ol class=""><li id="d291" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated"><a class="ae jp" href="https://www.facebook.com" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">脸书</strong> </a> <strong class="it hv">页面</strong> <br/> <em class="kp">一个Facebook信使机器人与一个脸书页面相关联。你需要注册成为</em> <a class="ae jp" href="https://developers.facebook.com" rel="noopener ugc nofollow" target="_blank"> <em class="kp">开发者</em> </a> <em class="kp">然后创建一个页面。</em></li><li id="b41d" class="kg kh hu it b iu kq iy kr jc ks jg kt jk ku jo kl km kn ko dt translated"><a class="ae jp" href="https://dialogflow.com/" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">Dialogflow</strong></a><br/><em class="kp">一家谷歌公司，dialog flow在NLP(自然语言处理)方面有帮助。这将有助于以后您扩展您的机器人来响应特定的事情。</em></li><li id="1a23" class="kg kh hu it b iu kq iy kr jc ks jg kt jk ku jo kl km kn ko dt translated"><a class="ae jp" href="https://code.stdlib.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">代码上标准库</strong> </a> <br/> <em class="kp">自面包片以来最伟大的事情，</em> <a class="ae jp" href="https://code.stdlib.com/" rel="noopener ugc nofollow" target="_blank"> <em class="kp">代码上标准库</em> </a> <em class="kp">帮助你在云端运行代码。这将是我们行动的大脑。</em></li></ol><p id="754d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，让我们开始吧。</p><h1 id="8ecd" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated">设置脸书页面</h1><p id="7142" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">前往<a class="ae jp" href="https://developers.facebook.com" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">developers.facebook.com</strong></a>用你的脸书凭证登录。登录后，点击<strong class="it hv">开始</strong>并按照说明<strong class="it hv">添加新应用。</strong></p><div class="jr js jt ju fq ab cb"><figure class="ly jv lz ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/f1f9fad73fd444f3908c7b72b5e58498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*kDtMhXFlI9FUgPmpT2NI4g.png"/></div></figure><figure class="ly jv me ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/b70d10dd38f02f870398ecd3efc231e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*hnbmybRM45MpDknGYLwVqg.png"/></div></figure></div><div class="ab cb"><figure class="ly jv mf ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/5b453cb40acce74669181afc973f398f.png" data-original-src="https://miro.medium.com/v2/resize:fit:966/format:webp/1*CLxEq09HNY5WvwzgOVtbkg.png"/></div></figure><figure class="ly jv mg ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/6eddadd171f054528618d066a8e6a18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*b8rsbZQwtrnLuzMOLb6Msw.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek mh di mi mj">Create a new App on FB Developer Portal</figcaption></figure></div><p id="18c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">给你的应用命名。这是您接收通知时使用的名称。做一些酷的东西，比如<strong class="it hv">达斯·维德</strong>。</p><p id="438f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后导航到左侧栏菜单上的<strong class="it hv">仪表板</strong>选项卡。向下滚动找到<strong class="it hv">信使</strong>并选择<strong class="it hv">设置</strong>。在添加Messenger集成之前，您需要创建一个脸书页面。</p><div class="jr js jt ju fq ab cb"><figure class="ly jv mk ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/869c946eb3f0087415f4fd17c4741662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*XI-QPFFcBPuzMt_732A2SA.png"/></div></figure><figure class="ly jv ml ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/100292a6582e0fb548e5c3c0495625db.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*S1pMUklT3DCGlSJWPGaRzA.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek mm di mn mj">On the Dashboard tab, choose Set Up on the Messenger card and then Create a new page</figcaption></figure></div><p id="fc6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这会带你去脸书。按照说明创建一个<strong class="it hv">社区或公众人物</strong>页面。</p><div class="jr js jt ju fq ab cb"><figure class="ly jv mo ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/c4c6dfb0df633333ca2bfb26c39a0d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*9eJjllJRxfOZH1jnIi9_Rw.png"/></div></figure><figure class="ly jv mp ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/655e7a6a1c8180853caee0ffd112f816.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*Y21quwGYw_ZJPtNzJfqS-A.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek mq di mr mj">Create a Community or public figure Facebook page</figcaption></figure></div><p id="e3b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你的页面创建完毕，<strong class="it hv">切换回FB开发者门户</strong>并刷新页面。现在你应该看到你的页面在下拉列表中列出<strong class="it hv">选择一个页面</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ms"><img src="../Images/bf494169bffd04fd38d7023cfb2f29f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYo7QPtxaqrKRf36ViAUug.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Refresh the page and then choose your Facebook page name from the dropdown to generate a token</figcaption></figure></div><div class="ab cl mt mu hc mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hn ho hp hq hr"><p id="ad3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们设置<a class="ae jp" href="https://dialogflow.com/" rel="noopener ugc nofollow" target="_blank">对话流</a>。点击<strong class="it hv">进入控制台</strong>，用你的谷歌凭证登录。</p><div class="jr js jt ju fq ab cb"><figure class="ly jv na ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/6b49c618d7a56e3a2b7325c128c609df.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*Xi0PRWXV7aEZwBL5KrEDUQ.png"/></div></figure><figure class="ly jv nb ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/58c43d047a38e4c6a4c4e253e01c5468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1084/format:webp/1*-FxlZxKP6GK0WAsw1pv8sg.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek nc di nd mj">Dialogflow uses Natural Language Processing to understand chat conversation</figcaption></figure></div><p id="5620" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">创建代理</strong>并填写详细信息。给你的代理一个名字。它可以与您的脸书页面同名。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/e05799ab509783e445e4a209a8e921c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8NcvnO1WJ8_C6SZfcVINIQ.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Give your agent a name and choose the right time zone</figcaption></figure><p id="8f6f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">当您的代理被创建时，它将自动添加两个意图。点击<strong class="it hv">默认欢迎意向</strong>进行编辑。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/ef8594a1d72b46d8146c581cf87f706e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sZ4HXr2xRhjjCg6zHmAYKA.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">You can add more intents if you want.</figcaption></figure><p id="be74" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在<strong class="it hv">事件</strong>部分，添加事件FACEBOOK_WELCOME。这使您的机器人能够在用户第一次与机器人交互时识别用户。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/6b99557023ab0879d3334a0eaf929220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zBCc8UbKwuTGp1LCEVwunQ.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Add Facebook Welcome to Events</figcaption></figure><p id="2732" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">向下滚动页面，点击垃圾桶图标<strong class="it hv">删除默认响应</strong>，因为我们将从代码中响应用户。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/b1259687dd4c4f0c8a759f3e4c7d5684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZuWccuYWbsQrA2eP_d2XXA.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click on the Trash icon to delete the default responses</figcaption></figure><p id="b007" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">进一步向下滚动<strong class="it hv">启用履行</strong>。这确保了所有请求都通过我们在标准库 的<a class="ae jp" href="https://code.stdlib.com" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">代码上的聊天机器人函数进行路由。</strong></a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ne"><img src="../Images/a19f54dbc9dbba4968cea951939fd88f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FJrzYRZKrHRgeNq5hXm_9Q.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Enable Fulfillment to receive messages on your webhook</figcaption></figure><p id="c29c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，我们需要将Facebook Messenger连接到Dialogflow。点击<strong class="it hv">集成</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff nf"><img src="../Images/60b82a07804a7de6942f64f623e29e09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6Y92-0prl3Ytvw3rvFmLw.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Integrations allow the agent to work with a variety of different services including Facebook Messenger</figcaption></figure><p id="f7b2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">打开<strong class="it hv">信使整合</strong>。这将打开一个模态窗口。你需要在这里输入两件事。第一个是<strong class="it hv">验证令牌</strong>，它可以是任何文本，第二个是<strong class="it hv">页面访问令牌</strong>。</p><p id="80a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">切换到脸书开发者门户</strong>复制页面访问令牌。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ms"><img src="../Images/558bd34e45ae96642d187a50b5a44b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXimN2j4uuTak_ALIyGHsg.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Choose your Page name from the dropdown to generate a Page Access Token</figcaption></figure><p id="6355" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在Dialogflow模式窗口中粘贴页面访问令牌，并输入您的验证令牌。点击<strong class="it hv">开始</strong>按钮开始整合。现在<strong class="it hv">点击剪贴板图标复制回调URL </strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ng"><img src="../Images/3fc582ab680d96b6acefdb09a40318d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pGzGHO6-nHDdj18Rm7-Hg.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click on the Clipboard icon to copy the Callback URL</figcaption></figure><p id="e716" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在切换到脸书开发者门户。是时候设置<strong class="it hv"> Webhooks集成</strong>了。选择位于<strong class="it hv">令牌生成</strong>部分下方的<strong class="it hv">设置Webhooks </strong>。将您复制的URL粘贴到<strong class="it hv">回调URL </strong>字段，并输入您在上一步中指定的<strong class="it hv">验证令牌</strong>。勾选所有订阅字段。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ng"><img src="../Images/393169e11b2ed4b087c84935eedc3222.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X9ZN43loILwu3RZ28op3Sg.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Not all are required, but Dialogflow will take care of the unnecessary ones and send you only the relevant ones</figcaption></figure><p id="6479" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">验证并保存</strong>，如果你设置正确，你应该会看到一个绿色的<strong class="it hv">和完整的</strong>。现在从下拉列表中选择您的页面名称，并点击<strong class="it hv">订阅</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff nh"><img src="../Images/009547c9691ed569e86b440d72c53034.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ayLw4QUonunmd5ASTkh__g.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Choose your page name from the dropdown and then click on Subscribe to subscribe to your page</figcaption></figure><p id="6617" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">要完成设置，您还需要做一些事情。进入<em class="kp">设置</em> &gt; <em class="kp">基本</em>添加一个<strong class="it hv">隐私政策URL </strong>并为你的应用选择一个<strong class="it hv">类别</strong>。隐私策略URL可以是任何有效的URL。</p><blockquote class="ni nj nk"><p id="43c2" class="ir is kp it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">您也可以使用代码中包含的隐私政策，如下面的标准库代码部分所示</p></blockquote><div class="jr js jt ju fq ab cb"><figure class="ly jv no ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/7ac342d636b5f581b7f7fd5a6707aef8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*08Wk9D5vuxasnX19vjq9Aw.png"/></div></figure><figure class="ly jv np ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/c0f04694aeec801279de18068a870412.png" data-original-src="https://miro.medium.com/v2/resize:fit:930/format:webp/1*G04sh-8IWJBZSjZKwcQshA.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek nq di nr mj">Enter the Privacy URL and choose a category for your page</figcaption></figure></div><p id="f559" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">保存更改并切换上的<strong class="it hv">状态按钮，使您的应用程序上线。</strong></p><div class="jr js jt ju fq ab cb"><figure class="ly jv ns ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/2937c0b6b3eb7d19958a3ce2a56b2785.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*DnOeuUtWo0JSi1z0DTAehA.png"/></div></figure><figure class="ly jv nt ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/9f9ed65502d46ebb1800be83b7ceae7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*5CJxZqAj03oAIPJReQF3Cg.png"/></div></figure></div><p id="e016" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">图标将显示状态为<strong class="it hv">实时</strong>。你可能会认为这意味着整个世界都可以看到你的应用程序并与之互动。<strong class="it hv">没有</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff nu"><img src="../Images/b276a04ea0a40ae2bb91ce1bd16ba60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*U4jrhFCLUPbcuoWxDEtEKA.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Your App is Live</figcaption></figure></div><div class="ab cl mt mu hc mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="hn ho hp hq hr"><h1 id="bb39" class="kv kw hu bd kx ky nv la lb lc nw le lf lg nx li lj lk ny lm ln lo nz lq lr ls dt translated"><a class="ae jp" href="https://code.stdlib.com" rel="noopener ugc nofollow" target="_blank">标准库</a>设置上的代码</h1><p id="cb2f" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">这是我们的代码所在的地方，它将<strong class="it hv">支持所有的通信</strong>。当我们向脸书上的机器人发送消息时，它将首先进入<a class="ae jp" href="https://console.dialogflow.com" rel="noopener ugc nofollow" target="_blank">对话流</a>。<a class="ae jp" href="https://console.dialogflow.com" rel="noopener ugc nofollow" target="_blank"> Dialogflow </a>会把它路由到正确的目的地，然后转发给我们的函数——这个函数。</p><p id="e52c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">首先在社区API源代码中搜索<code class="eh oa ob oc od b">fb-messenger-bot</code>。点击<strong class="it hv">创建新的API </strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff oe"><img src="../Images/2e113887a5664585e22eda28ef9dcef3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60WLJpOEl9GmKKaniZycQw.png"/></div></div></figure><p id="c66d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">创建完成后，您会在<strong class="it hv">功能</strong>文件夹中看到三个文件。</p><ol class=""><li id="369d" class="kg kh hu it b iu iv iy iz jc ki jg kj jk kk jo kl km kn ko dt translated"><code class="eh oa ob oc od b">__main__.js</code> <br/>主函数<strong class="it hv">获取Reddit帖子</strong>并发送给用户。修改函数顶部的<code class="eh oa ob oc od b">multi</code>对象，以<strong class="it hv">定制子编辑</strong>。</li><li id="ae5a" class="kg kh hu it b iu kq iy kr jc ks jg kt jk ku jo kl km kn ko dt translated"><code class="eh oa ob oc od b">webhook.js</code> <br/>该函数将处理来自Dialogflow 的所有<strong class="it hv"> webhook请求。如果你想<strong class="it hv">扩展机器人</strong>的功能，这里是你添加自定义意图的地方。</strong></li><li id="74a6" class="kg kh hu it b iu kq iy kr jc ks jg kt jk ku jo kl km kn ko dt translated"><code class="eh oa ob oc od b">privacy.js</code> <br/>你知道标准库上的<a class="ae jp" href="https://code.stdlib.com" rel="noopener ugc nofollow" target="_blank">代码<strong class="it hv">可以返回HTML文件</strong>吗？这是一个<strong class="it hv">隐私文件</strong>，你可以在</a><a class="ae jp" href="https://developers.facebook.com" rel="noopener ugc nofollow" target="_blank"> FB开发者门户</a>上使用。该URL看起来类似于<code class="eh oa ob oc od b"><a class="ae jp" href="https://boetie.lib.id/tinkr-fb-messenger-bot@dev/" rel="noopener ugc nofollow" target="_blank">https://username.lib.id/fb-messenger-bot@dev/</a>privacy</code>。你应该在这份文件的底部加上你自己的电子邮件。</li></ol><p id="bdf8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，导航到<code class="eh oa ob oc od b">env.json</code>文件，用您的<strong class="it hv">标准库令牌</strong>和<strong class="it hv">脸书页面访问令牌</strong>填充环境。</p><blockquote class="ni nj nk"><p id="e1ac" class="ir is kp it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">要检索标准库令牌，请将光标放在黄色引号之间，然后右键单击。从下拉菜单中选择您的标准库令牌，变量应该会自动填充。</p></blockquote><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff of"><img src="../Images/92654d7111f9e85bd32ee77cfcf416d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vmv-W-Z-3_FstDrXQZEBAA.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Enter your FB Access Token and the Standard Library Token in your env.json file</figcaption></figure><p id="e345" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦保存了<code class="eh oa ob oc od b">env.json</code>文件，点击<strong class="it hv">运行</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff og"><img src="../Images/abc04dcac5d67c195c9fbe20ebe42295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CL9mk9p9jlcfNqhKKJNJfw.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click Run to deploy the service</figcaption></figure><blockquote class="ni nj nk"><p id="3060" class="ir is kp it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">请记住，每次您更改任何代码时，您都需要<strong class="it hv">保存</strong>，然后<strong class="it hv">运行</strong>它，以部署新代码。</p></blockquote><p id="1aa0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">部署完成后，<strong class="it hv">复制显示的API端点URL </strong>。这是你的webhook端点。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff oh"><img src="../Images/065f306ef534fea46648eba31463757e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9FWsiBh7abgpauUuEevlw.png"/></div></div></figure><p id="c6b9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在让我们完成<a class="ae jp" href="https://console.dialogflow.com" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">对话流程</strong> </a> <strong class="it hv">设置</strong>。切换到<a class="ae jp" href="https://console.dialogflow.com" rel="noopener ugc nofollow" target="_blank">对话流</a>并点击<strong class="it hv">履行</strong>并打开Webhook。</p><div class="jr js jt ju fq ab cb"><figure class="ly jv oi ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/fb94bf983de2cdb3f745013220e86451.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*d6ynUljxO1Da4QfDJkwIDQ.png"/></div></figure><figure class="ly jv oj ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/11134597a3c4a350eebc70672939f9a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*dkWDjdISGbAbSjLqdCrr7Q.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek ok di ol mj">Enable the webhook and add URL</figcaption></figure></div><p id="9e88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在复制的网址后面加上<strong class="it hv"> <em class="kp"> /webhook/ </em> </strong>，点击页面底部的保存。你的网页挂钩网址应该看起来像<code class="eh oa ob oc od b"><a class="ae jp" href="https://boetie.lib.id/tinkr-fb-messenger-bot@dev/" rel="noopener ugc nofollow" target="_blank">https://username.lib.id/fb-messenger-bot@dev/</a>webhook/</code></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff om"><img src="../Images/bd5512c5bbb04503863bf5508d086625.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9GRUDYqP9lxhAZjpzMlW-w.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Append /webhook/ to your base URL</figcaption></figure><p id="5d85" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我们差不多完成了。我们现在需要做的就是在脸书页面上启用我们的机器人。进入你的脸书页面，点击<strong class="it hv">添加一个按钮</strong>。选择<strong class="it hv">发送信息</strong>，完成详细信息并保存。</p><div class="jr js jt ju fq ab cb"><figure class="ly jv on ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/785a346694c30ad9d80cede0241899dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*oanPOIexEeo4t554ou7LVg.png"/></div></figure><figure class="ly jv oo ma mb mc md paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><img src="../Images/463daeebe8b123bf5ef55d6110708e26.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*P-_i_SA2N7MFizQaom8iXw.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek op di oq mj">Add a Send Message Button to your Facebook Page</figcaption></figure></div><p id="9cdb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，当你悬停在<strong class="it hv">发送消息</strong>按钮上时，会显示一个下拉菜单。点击<strong class="it hv">测试按钮</strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff or"><img src="../Images/97989f898d4d74dba2beb5df217d3e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iu-DtLY57T6MqTMVSGKEAg.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click on Test button to Test your bot</figcaption></figure><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff os"><img src="../Images/b748b0586a365c55c41110d8e917892e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*og2xpRYGn6nVMGCS6peWtQ.png"/></div></figure><p id="3c60" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这将打开一个带有<strong class="it hv">开始按钮</strong>的聊天。点击它，如果你已经设置正确，你会看到"<em class="kp"> Woohoo！。欢迎{Name}。您已被添加到数据库中。</em>”。</p><p id="4845" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着您已经作为用户被添加到标准库本地存储的<a class="ae jp" href="http://code.stdlib.com" rel="noopener ugc nofollow" target="_blank">代码的函数中。</a></p><p id="67c2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您再次向您的机器人发送“嗨”消息，它将回复“<em class="kp">嗨{Name}”，您已经被添加到数据库中。</em></p><p id="7b5c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在来设置<strong class="it hv">任务</strong>。</p><h1 id="9d36" class="kv kw hu bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls dt translated">关于标准库代码的任务</h1><p id="dacd" class="pw-post-body-paragraph ir is hu it b iu lt iw ix iy lu ja jb jc lv je jf jg lw ji jj jk lx jm jn jo hn dt translated">标准库上<a class="ae jp" href="https://code.stdlib.com" rel="noopener ugc nofollow" target="_blank">代码最酷的特性之一是<strong class="it hv">任务</strong>。设置任务使您的<strong class="it hv">代码按照指定的时间表自动运行</strong>。</a></p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff ot"><img src="../Images/15852919bed94dd3cb507556f759c08a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*sT-pNoYBJI8fX2lKoyC6hQ.png"/></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click on Tasks to set up your code to run on a schedule</figcaption></figure><blockquote class="ni nj nk"><p id="edb7" class="ir is kp it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">我目前设置了一天四个通知的功能。你可以把它改成你喜欢的任何数字。请记住，您还需要更改函数顶部的<strong class="it hv"> max_notifications变量</strong>，并在cron规范中添加相同数量的可重复任务。</p></blockquote><p id="997d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在任务窗口中，<strong class="it hv">选择您的bot函数</strong>来添加一个时间表。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ou"><img src="../Images/7f01443e6e7d1c5db17c6786383bba46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RQ0sAeXNg6kieswZw8ttw.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Choose your function to add a Task schedule</figcaption></figure><p id="29f4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您可以使用计划下拉菜单设置任务计划。但是我们想要更多一点的控制，所以我们使用<strong class="it hv">高级(cron) </strong>。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ou"><img src="../Images/2798a2d0b1ed64d10e5b694a1caad393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d2DK5Oy-u1ip8OnavxUnNA.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">Click on Advanced (cron) to use cron expressions for task schedule</figcaption></figure><p id="85a8" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">cron表达式很难理解。该表达式有5个值—* * * * * *。第一个是<strong class="it hv">分钟</strong>值，第二个是<strong class="it hv">小时</strong>值。</p><p id="99e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因此，如果您输入<code class="eh oa ob oc od b">30 5,8,11,15 * * *</code>，它将转化为在<code class="eh oa ob oc od b">05:30</code>、<code class="eh oa ob oc od b">08:30</code>、<code class="eh oa ob oc od b">11:30</code>和<code class="eh oa ob oc od b">15:30</code>运行的4个任务，每天重复。时间是用世界协调时(UTC)的<strong class="it hv">表示的，所以你需要加上或减去你的<strong class="it hv">时区偏移量</strong>来得到正确的当地时间。</strong></p><p id="f5e0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">因为我住在印度，我的时区偏移量是<code class="eh oa ob oc od b">+05:30</code>，这个时间表将在当地时间<code class="eh oa ob oc od b">11:00</code>、<code class="eh oa ob oc od b">14:00</code>、<code class="eh oa ob oc od b">17:00</code>和<code class="eh oa ob oc od b">21:00</code>运行。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff ov"><img src="../Images/7a157fd6957b2f73a10f821b52e16797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4Nd9Br3mSo6VxE7LRThNBw.png"/></div></div><figcaption class="kc kd fg fe ff ke kf bd b be z ek">If the cron expression is valid, the next three invocation times are shown below it</figcaption></figure><p id="a17a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">点击<strong class="it hv">计划任务</strong>就大功告成了。现在，您应该会在预定的时间在messenger上收到通知。</p><blockquote class="ni nj nk"><p id="37a1" class="ir is kp it b iu iv iw ix iy iz ja jb nl jd je jf nm jh ji jj nn jl jm jn jo hn dt translated">如果您想测试任务计划，请选择每分钟一次。一旦你得到了正确的消息，关掉它，使用上面的cron表达式或类似的东西来定制时间表。</p></blockquote><p id="5c91" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">恭喜你！</strong>你现在有一个<strong class="it hv">个人聊天机器人</strong>。<em class="kp">在接下来的几个月里，我会添加更多关于聊天机器人</em>还能做什么有趣事情的教程。</p><p id="8c41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">查看<a class="ae jp" href="https://hackernoon.com/create-an-alexa-radio-skill-in-5-minutes-with-standard-library-and-nodejs-93dc32b08c42" rel="noopener ugc nofollow" target="_blank">创建一个Alexa电台技能</a>，如果你想<strong class="it hv">用你的个性化电台建立一个Alexa技能</strong>。</p></div></div>    
</body>
</html>