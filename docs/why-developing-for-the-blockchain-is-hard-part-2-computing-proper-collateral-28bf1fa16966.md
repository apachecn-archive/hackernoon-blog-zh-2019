# 为什么开发区块链很难第二部分:计算合适的抵押品

> 原文：<https://medium.com/hackernoon/why-developing-for-the-blockchain-is-hard-part-2-computing-proper-collateral-28bf1fa16966>

许多提议的区块链解决方案使用验证游戏，无论是非正式的如 TrueBit 和 Plasma，还是正式的如 [Alacris.io](https://alacris.io/) 。在这些系统中，一个重要的挑战是合同能够评估参与者是否为其索赔提供了足够的抵押品；这种评估关键取决于有一个好的天然气价格模型。

# 我叫邦德，抵押债券

在基于验证游戏的系统中，参与者做出*声明*，如果声明无效，其他人可能会反驳。验证游戏(或“智能诉讼”)的每一步都是通过调用区块链上的“智能合同”来进行的，该合同带有详细说明索赔的参数(进行“智能法律论证”)。如果没有人在其*质疑期*内通过*反诉*成功反驳索赔，则索赔被视为有效。为了惩罚那些提出虚假索赔的人，奖励那些证明其索赔无效的人，提出索赔的参与者必须同时交存适当的抵押品。索赔人被*担保*，担保品是他的*担保*，如果索赔有效，担保品将返还给索赔人，如果索赔无效，担保品将返还给反索赔人。

![](img/d7034e3277c48e2638c345c49c34afa4.png)

Don’t misbehave or bounty hunters will come for you and collect your bond.

在正常使用模式中，一个诚实的参与者做出一个有效的声明，最终只需为做出声明付出代价，而无需为证明声明的正确性付出任何代价。不诚实的参与者提出无效索赔或反索赔，最终因失去抵押品而付出代价。这种“坏人买单”的属性让验证游戏变得廉价而有吸引力。不利的一面是，挑战期太长会让用户感到痛苦，太短会带来安全问题。然而，在计算适当的保证金时也有一个关键的困难:保证金必须足够小，不会成为诚实参与者无法承受的负担，但又足够大，足以阻止不诚实的索赔者，并通过弥补反索赔者支付的任何汽油费用来奖励他们的反索赔者。

如果没有抵押品，或者如果抵押品太低，一个坏演员可能会用大量无聊的诉讼“绑架”或“伤害”一个诚实的当事人。诚实的被告可能不得不为“聪明的法庭费用”在汽油上花很多钱，并可能被迫犯可利用的错误，泄露使攻击成为可能的信息(如基于位置信息的 DoS 攻击)，愤怒地放弃，或破产。担保金额应该足够高，以阻止不良行为，并向诚实的参与者提供损害赔偿，涵盖所有诉讼成本:进行交易的汽油成本、在冗余数据中心运行和保护计算机的运营成本、应对与其他成本相关的风险和波动的保险成本，以及所有这些成本的道德成本。

另一方面，担保金额应该足够低，以使收入微薄的诚实当事人能够为自己辩护——尽管解决这个问题的一种方法是允许他们将自己的债权出售给更富有的当事人，后者有足够的时间、金钱和计算机资源来完成诉讼。另一个解决方案是借入资金用作抵押品，但这不能完全在区块链实施。如果不良行为者甚至可以暂时导致合同要求过高的抵押债券，他们可能会阻止其他各方为自己辩护。

# 估算天然气价格

债券必须涵盖的主要内容是，如果当前的索赔人是败诉方，另一方的“智能诉讼费”。这些费用是对方在区块链上发表观点所需的交易费用。

就以太坊而言，成本与天然气价格成正比，而天然气价格在以太坊中并不固定，而是根据供求关系以及令人讨厌的矿商和交易海报对市场的操纵而浮动。但是，请注意，这个问题并不是以太坊特有的；这是任何区块链的基本问题。有限的事务空间供应是任何公共区块链的必要限制，因为块验证是大规模分散的，这意味着块数据必须适合参与验证网络的那些人的有限网络和 cpu 带宽。给定这种有限的供应，天然气的经济价值(是交易空间的固定部分)自然会随着需求而变化，在某种程度上与代币本身的价值无关；因此，唯一经济合理的定量供应方式是让天然气与代币的相对价格浮动。当固定价格高于自由市场均衡时，它会导致人为的稀缺，当它低于自由市场均衡时，会导致长时间的等待。

因此，交易费用会浮动，合同的结构只能告诉你，相对于一些浮动的基础价格，你必须支付多少。为了使智能合同确保索赔人公布足够的费用来支持他们的索赔，它必须能够将这些费用与天然气价格或其他基价的适当估计的某个倍数进行比较。

因此，对于基于高级验证的合同来说，重要的是能够预测在不久的将来、接下来的几个小时或几天内的天然气价格，无论最长的智能诉讼可能需要多长时间，这可以通过合同条款中的量词替换的数量乘以一个质疑期的持续时间来静态确定。该预测不一定非常准确，但它必须是该窗口内天然气价格的严格上限，即使考虑到市场的异常波动和共识矿商中相当多的少数同谋的蓄意市场操纵。

一个公式可能是观察最近几天完全确认交易的天然气价格；在每个区块中，丢弃 33%(通过气体限制)最昂贵的交易，并保持剩余的高价格；然后丢弃这些价格中最贵的 33%(按块计算)，保留剩余的高价，但假设它可能飙升至未丢弃价格中观察到的波动率的五倍(或其他倍数)；再乘以 8，并以此作为汽油价格的基础。确切的公式必须由具有经济或精算建模专业知识的人来设计——关键是，该公式必须可靠地高估诚实的人可能需要支付多少汽油来保护自己，但不能大到无法负担的程度。

当使用几天后到期的短期合同时，签约人可以就价格预测达成一致，并在合同创建期间将其作为明确的参数。如果预测变得太低，对每个参与者或每对参与者的一次投诉的限制也可以限制不诚实的参与者可以造成多大的麻烦。但是，在天然气价格可能大幅波动的情况下，管理几周、几个月甚至几年资产的长期合同怎么办？无论使用哪种公式，都必须非常复杂，因此对于低级契约来说，每次调用它时都要重新计算，这太昂贵了。除非区块链的低级合同虚拟机本身支持根据这个完全相同的公式预测天然气。然而，像所有计算一样，可以使用我们通常的交互式证明技术来验证天然气预测的公式，因此对天然气价格估计的更新可以作为对合同的声明，并且可以作为分布式应用程序常规操作的一部分的其他声明的一部分。

# 维护天然气价格估算的协议

如果分布式应用包括侧链，则侧链操作者可以更新价格估计，可能结合对其侧链状态的更新。如果在长期运行的合同中没有特权方来定期维护合同状态，则分布式应用的某个协议部分可以指定下次先前注册的估计超出某个安全范围(比如低于当前价格预测的 4 倍或超过 16 倍)时更新天然气价格基础是谁的责任(例如，每个参与者以某种顺序依次更新)。在某些合同中，他们自身的自私利益，即其他参与者不会对他们提出虚假索赔，也可能足以激励一些参与者自发地提出索赔，以将天然气价格基础维持在安全范围内。无效的索赔将被验证为无效并被拒绝，并且错误的索赔者将失去他们的抵押品以及他们的操作者特权(如果有的话),这足以激励谴责他们的一方——只要先前最后确认的预测仍然是天然气价格的有效上限。

该协议的进一步改进可能包括建立一个天然气价格期货市场。保险公司将为油价上涨提供保险，可能仅用于验证游戏。希望保护自己免受油价波动影响的用户可以以很少的费用避免价格波动。MakerDAO 使用的机制提供了一种与美元挂钩的稳定硬币 DAI，该机制也可用于以美元或 ETH 的固定价格提供未来天然气。保险公司也可以利用以太坊的“气体退款”机制提前购买气体，尽管这些退款只能覆盖任何特定交易的一半气体。

这种协议涉及到很多复杂性；跟踪天然气价格需要仔细观察区块链验证网络的完整节点。因此，只有专业人员才能参与本协议。但是，在区块链可能有一个共同的可验证的近似天然气价格预测合同，作为一项公共服务，该合同的估计值由依赖于相同公式的所有合同共享。作为开发 Alacris 操作系统的一部分，我们将使所有 dapp 能够使用我们的 dapp 维护的天然气价格估计，以及其他有关以太坊和其他区块链数据的可验证 oracles。

*本文是正在进行的题为“为什么为区块链开发很难”系列的第二篇文章请关注我们下一篇关于 DoS 攻击的文章。*