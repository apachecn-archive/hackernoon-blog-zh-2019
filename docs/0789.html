<html>
<head>
<title>How to Recognize a Knife in an Image with Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用机器学习识别图像中的刀</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/recognising-a-knife-in-an-image-with-machine-learning-c7479f80525?source=collection_archive---------14-----------------------#2019-02-01">https://medium.com/hackernoon/recognising-a-knife-in-an-image-with-machine-learning-c7479f80525?source=collection_archive---------14-----------------------#2019-02-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9f57720d84f6d0b1633e8e2d62285752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1LI9TzwDU1l6IyJFBRcULw.jpeg"/></div></div></figure><p id="17d3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了一个有趣的挑战，我开始学习一点人工智能和机器学习。我一直在快速研究优秀的<a class="ae ka" href="https://www.fast.ai/" rel="noopener ugc nofollow" target="_blank">。AI </a>课程。这是一系列免费带你从零到英雄学习机器的视频。</p><p id="caa2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为我学习过程的一部分，我想使用我自己的数据集。我花了几天时间来选择一个问题，但我的标准是:</p><ul class=""><li id="9ead" class="kb kc hu je b jf jg jj jk jn kd jr ke jv kf jz kg kh ki kj dt translated">免费提供的数据集</li><li id="2129" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">可以用于社会公益</li><li id="7799" class="kb kc hu je b jf kk jj kl jn km jr kn jv ko jz kg kh ki kj dt translated">对于我的第一次尝试来说并不过分复杂</li></ul><p id="0407" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，在搜索Kaggle和互联网寻找一个很酷的数据集后，我偶然发现了一个包含正面和负面例子的数据库。手里拿着我的数据集，是时候开始工作了！</p><h1 id="2053" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">社会公益</h1><p id="3f18" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">不幸的是，持刀犯罪在英国是一个严重的问题。在截至2018年3月的一年中，英格兰和威尔士约有<a class="ae ka" href="https://researchbriefings.parliament.uk/ResearchBriefing/Summary/SN04304" rel="noopener ugc nofollow" target="_blank">40100起涉及刀具或利器的犯罪</a>。</p><p id="c310" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我认为，通过能够识别图像中的刀具，可能会在犯罪检测和减少方面有潜在的应用，并将人工智能应用于一些社会公益。</p><h1 id="4552" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">方法</h1><h1 id="41e7" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">数据结构化</h1><p id="4bff" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">首先，我整理了我的数据，并将我所有的图片放入一个文件夹中，命名模式为:</p><p id="45e5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ls lt lu lv b">knife_1.bmp</code> <code class="eh ls lt lu lv b">notknife_1.bmp</code></p><p id="0980" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">数字是连续的:所以刀_1，刀_2，等等。</p><h1 id="3053" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">跑步Jupyter笔记本</h1><p id="d8a1" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated"><a class="ae ka" href="https://jupyter.org/" rel="noopener ugc nofollow" target="_blank"> Jupyter笔记本</a>是运行这些数据集的事实上的工具，我没有偏离这一点。</p><p id="59dc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，我将我的笔记本设置为自动更新，并加载了我的FastAI库:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="e766" class="me kq hu lv b fv mf mg l mh mi"><br/>!pip install --upgrade fastai %reload_ext autoreload %autoreload 2 %matplotlib inline from fastai.vision import * from fastai.metrics import error_rate</span></pre><p id="a880" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我导入我的数据，以便我的模型可以轻松地访问它:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="5f3c" class="me kq hu lv b fv mf mg l mh mi">path = Path('/data/') knives = fnames = get_image_files(path) print(knives[:5])</span></pre><p id="19e8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我打印了一组五个文件名，以检查它们是否被有效地导入:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="9bfa" class="me kq hu lv b fv mf mg l mh mi">[PosixPath('/data/notknife_3198.bmp'), PosixPath('/data/notknife_2790.bmp'), PosixPath('/data/notknife_2296.bmp'), PosixPath('/data/notknife_8269.bmp'), PosixPath('/data/notknife_5795.bmp')]</span></pre><p id="be16" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，我创建了一个正则表达式模式来从我们的每个文件名中获取标签，以便能够将它们分类为刀或者不是刀:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="a692" class="me kq hu lv b fv mf mg l mh mi">pat = r'/([^/]+)_\d+.bmp$'</span></pre><p id="640d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我利用FastAI的一个功能，将我们的图像以适合计算机视觉的格式捆绑在一起:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="2a38" class="me kq hu lv b fv mf mg l mh mi">data = (ImageDataBunch .from_name_re(path, knives, pat, ds_tfms=get_transforms(), size=224, bs=64) .normalize(imagenet_stats))</span></pre><p id="0b19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如你在上面看到的，我们有访问数据的路径，我们的训练集是以<code class="eh ls lt lu lv b">knives</code>的形式，然后我们通过应用我们的正则表达式来确保它们是有效的，我们将图像的大小调整为统一的224(乘数为7，这对于我们后面的RestNet数据来说是最佳的)，然后我们归一化数据集。</p><p id="12d2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了检查这一切是否如我们所料，我输出了4行图像以及两个预期的标签:<code class="eh ls lt lu lv b">knife, notknife</code>:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="c529" class="me kq hu lv b fv mf mg l mh mi">data.show_batch(rows=4) print(data.classes)</span></pre><p id="aad5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为输出，我得到以下内容:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mj"><img src="../Images/b51c3a5c64a6692abb6c6b5fd4c864f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ycY09omvdW5jQ3xc.png"/></div></div></figure><p id="ec2e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">太好了，我得到了我想要的图像，并且它们被正确地标记了。现在是时候开始训练我的模型了。</p><h1 id="4f68" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">训练模型</h1><p id="eaf9" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">为此，我使用卷积神经网络或CNN，并对resnet50进行训练，正如其名称所暗示的那样，resnet 50是一个50层残差网络。这使得我们可以使用迁移学习，即利用存储在一个模型中的知识，并将其应用到另一个模型中。本质上，这是我们模型的起点。</p><p id="34e8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用快速。艾这是极其简单的:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="f42a" class="me kq hu lv b fv mf mg l mh mi">learn = create_cnn(data, models.resnet50, metrics=error_rate) learn.fit_one_cycle(4) learn.save('knives-stage-1')</span></pre><p id="1fef" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">正如您在上面看到的，我们正在创建CNN，从我们提供的数据和从resnet推断的模型中创建一个学习者对象。我们使用不同的学习率来训练模型。</p><p id="15c8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦完成，这可能需要一段时间！我们最终会得到这样的结果:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/de94db1a770ae96a3d6286147cabf9de.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*2_JdhtFylnPM7VZCo1Jlog.png"/></div></figure><p id="2bc2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如你所见，我们从较高的错误率开始，逐渐将其从98%的准确率降低到99.5%。</p><p id="e9a8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所以这已经很棒了！但是我们能做得更好吗？让我们找出我们的模型在哪里变得混乱。</p><h1 id="4ad4" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">识别模型错误</h1><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="1383" class="me kq hu lv b fv mf mg l mh mi">interp = ClassificationInterpretation.from_learner(learn) interp.plot_top_losses(9)</span></pre><p id="3dc1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过运行上面的程序，我要求FastAI解释结果并显示前9个不正确的猜测，返回结果如下:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/5b7ed745ff1b409f01128674db1e2bd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kKIHRSp0-B33a_5S.png"/></div></div></figure><p id="5654" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">嗯。所以用我们人类的眼睛看它是有意义的。这个女人对付蛇的工具看起来很像一把刀，右上角的图像对比度很差，所以很难识别刀刃。</p><p id="d054" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">很好，让我们找出错误率开始上升的地方，看看我们是否可以改进:</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="974b" class="me kq hu lv b fv mf mg l mh mi">learn.lr_find() learn.recorder.plot()</span></pre><p id="63a6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将呈现以下图表:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/b81cccb5d26f71910fada7641552450c.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/format:webp/0*Mml8N8I2k3AJ3o5s.png"/></div></figure><p id="75ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，在错误率再次达到峰值之前，我们可以看到图表右侧有一个强烈的下降，因此，让我们校准我们的模型，以使用从下降顶部开始到结束之间的数据。</p><pre class="lw lx ly lz fq ma lv mb mc aw md dt"><span id="98f3" class="me kq hu lv b fv mf mg l mh mi">learn.fit_one_cycle(10, max_lr=slice(1e-03,1e-02)) learn.save('knives-stage-2')</span></pre><p id="0328" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这里，我们运行十个周期(或时期)的训练，并对数据进行切片以符合上述图表。</p><p id="bed8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们会收到以下内容:</p><figure class="lw lx ly lz fq iv fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/1faf7ce48e1c29fd031038a46960214e.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*8y2uDrtKma5yuhiipZiZmg.png"/></div></figure><p id="18d4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">因此，我们可以看到第二遍的错误率低得多，并且在最后会有一组特别好的结果。训练完成时，我们已经达到了惊人的<em class="mo"> 99.84% </em>准确率！</p><p id="7c37" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下一步，我将把这个模型封装在一个API中，这样你就可以上传图片，并可靠地获知是否有刀。我可以想象这对于执法或安全特别有用，但这里使用的技术可以很容易地应用于任何主题。</p><h1 id="6567" class="kp kq hu bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm dt translated">结论</h1><p id="2f30" class="pw-post-body-paragraph jc jd hu je b jf ln jh ji jj lo jl jm jn lp jp jq jr lq jt ju jv lr jx jy jz hn dt translated">希望你会发现这是一篇信息丰富的阅读，并尝试使用相同的技术来生成自己的计算机视觉应用程序。</p><p id="0353" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是我第一次深入研究这项技术，所以我确信在我的过程或解释中会有错误。如果您发现任何问题或认为有进一步改进的方法，请联系我们。我很想听听！</p></div><div class="ab cl mp mq hc mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="hn ho hp hq hr"><p id="22ec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mo">原载于2019年2月1日</em><a class="ae ka" href="https://ruairidhwm.github.io/2019/02/01/image-classification.html" rel="noopener ugc nofollow" target="_blank"><em class="mo">ruairidhwm . github . io</em></a><em class="mo">。</em></p></div></div>    
</body>
</html>