<html>
<head>
<title>3 Approaches for Using the Google Sheets API in Node.js: A Tutorial</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在 Node.js 中使用 Google Sheets API 的 3 种方法:教程</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/3-approaches-for-using-the-google-sheets-api-in-node-js-a-tutorial-ebf276f0ad32#2019-05-12">https://medium.com/hackernoon/3-approaches-for-using-the-google-sheets-api-in-node-js-a-tutorial-ebf276f0ad32#2019-05-12</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="b771" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">最初发布于</em><a class="ae jq" href="https://blog.stephsmith.io/tutorial-google-sheets-api-node-js/" rel="noopener ugc nofollow" target="_blank"><em class="jp">https://blog . steph Smith . io/tutorial-Google-sheets-API-node-js/</em></a><em class="jp">。</em></p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff jr"><img src="../Images/48e79cf4997f2ffaef8f0827b1779bc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*H7owFotF7nUAk1Vn.jpg"/></div></div></figure><p id="fea7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在学习编码一年后，我最近发现自己进入了异步 Javascript 的领域。</p><p id="55c7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在过去的几个月里，我一直在努力学习这门语言的这个组成部分，并且不得不重温我已经学过很多次的<a class="ae jq" href="https://www.udemy.com/modern-javascript/" rel="noopener ugc nofollow" target="_blank">课程的部分内容。即使这样做了，我仍然感到很失落，不知道如何获取信息并将其转化为可操作的东西。</a></p><p id="95a7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在我最近对这些材料的回顾中，我意识到唯一能让它真正坚持下去的方法就是用它来创造一些东西。所以，我决定通过开发一个叫做<a class="ae jq" href="https://progression.page" rel="noopener ugc nofollow" target="_blank">进程页面</a>的工具来测试我的知识。在创建这个应用程序时，我确实觉得能够更好地利用异步工具箱中的工具。</p><p id="bbda" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Progression Page 是一个帮助人们跟踪和可视化他们学习编码的日常进展的工具，所以本着帮助他人学习的精神，我决定分享这个教程，以激励他人使用 Google Sheets 作为他们的数据库来创建迷你应用程序。</p><h1 id="8cad" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">使用谷歌工作表作为数据库</h1><p id="e59d" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated"><strong class="it hv">我在谷歌表单上追踪我做的每一件事</strong>。我说的一切，就是一切。</p><p id="5229" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我跟踪我锻炼的频率，我看了多少本书，我学习编码的频率，等等。我这样做是为了让自己负责任，因为我相信量化进展是“success"﹣not”的重要前兆，不仅在我的“工作生活”中，而且在所有方面。</p><p id="39b7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">由于跟踪我的努力对我的个人进步至关重要，当别人不这样做时，我总是感到惊讶，尤其是当缺乏跟踪往往会导致这样的结果时:</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff lg"><img src="../Images/5b7653f54ca04fe0fb627f547b5e14ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p6dzJt9YtwfxPulq"/></div></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">An all too frequent outcome of people’s journey learning to code.</figcaption></figure><p id="58fd" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我希望有一个地方，人们可以很容易地公开记录他们的编码进度，这样人们就可以对他们负责。这正是<a class="ae jq" href="http://progression.page" rel="noopener ugc nofollow" target="_blank">前进页面</a>所做的；它允许每个成员在谷歌表单中记录他们的日常进展，包括他们正在学习的内容、学习时间和学习频率，以及他们的技能、目标等。这些信息直接从表单中提取并显示在网页上。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff ll"><img src="../Images/b44dfd7621f79cc6baf6fc45797f9c93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWX4UDy5_vJOSzhhYqVPsQ.png"/></div></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">Example of Progression Page output, with all data pulled directly from a Google sheet.</figcaption></figure><p id="9b80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Progression Page 是人们使用 Google Sheets 作为数据库的众多例子之一。例如，<a class="ae jq" href="https://www.sheet2site.com/" rel="noopener ugc nofollow" target="_blank"> Sheet2Site </a>利用 Google Sheets 作为从活动到产品再到招聘信息的数据库。尽管使用工作表作为数据库肯定有缺陷。它的美妙之处在于，您(和其他人)可以根据需要轻松查看、编辑和缩放信息。考虑到这一点，我迫不及待地想看看人们用这项技术在指尖创造了什么。</p><h1 id="13dd" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">前言</h1><p id="6110" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">在开始之前，我想先说明一下，我的代码可能不是“最佳”的，或者没有按照它应该的那样进行重构。记住，我还是个 n00b(我们不都是吗？).</p><p id="8a88" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">作为一个开发新手，在担心应用程序的可伸缩性或完美性之前，我专注于创建有用的东西。</p><p id="23e1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我还应该提到，这篇文章是专门为那些使用 Node.js 的人创建的，尽管我确信它可以为其他后端量身定制。我不会从头开始介绍设置 Node.js/Express.js 应用程序的步骤，因此它实际上是为那些熟悉基础设施的人准备的。</p><p id="3e0b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文将讨论的内容:</p><ul class=""><li id="8a9d" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">如何在 Node.js 中认证 OAuth2</li><li id="3b30" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">如何通过 3 种方法连接 Google Sheets API with Node 来创建 Google 电子表格数据库</li><li id="387b" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">如何将 API 中的数据集成到 Express.js 应用程序中</li></ul><p id="50b0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">事情说明本文将<strong class="it hv">而非</strong>过一遍:</p><ul class=""><li id="5865" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">如何设计或部署网页</li><li id="78ca" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">如何从头开始使用 Node.js 或 Express.js</li><li id="a148" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">如何跨其他后端语言使用 API</li></ul><h1 id="cb44" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">入门指南</h1><p id="e2a4" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">首先，您应该有一个初始化了 npm 的基本节点应用程序。</p><p id="690d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从这里开始，您需要安装将用于该应用程序的软件包:</p><ul class=""><li id="5329" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">快速(用于呈现动态页面)</li><li id="eb68" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">请求(用于发出 HTTP 请求)</li><li id="b7d9" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">fs(用于 Google API)</li><li id="59ac" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">readline(用于 Google API)</li><li id="e3c2" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">Google API(用于 Google API)</li></ul><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="fdcc" class="mf ke hu mb b fv mg mh l mi mj">npm install express ejs request gs readline googleapis@39 --save</span></pre><p id="c9de" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">确保在索引文件的顶部正确地要求了这些依赖项，如下所示。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="9537" class="mf ke hu mb b fv mg mh l mi mj">var express    = require("express"), <br/>fs             = require('fs'), <br/>readline       = require('readline'), <br/>{google}       = require('googleapis'), <br/>request        = require('request'), <br/>app            = express();</span></pre><p id="5857" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从这里开始，您还应该将视图引擎设置为 ejs，以便程序识别正在呈现的 EJS 文件，而无需每次都定义文件扩展名(即:您可以轻松地调用<code class="eh mk ml mm mb b">res.render('test'</code>而不是<code class="eh mk ml mm mb b">res.render('test.ejs')</code>)。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="9c2b" class="mf ke hu mb b fv mg mh l mi mj">app.set("view engine", "ejs");<!-- --> </span></pre><h1 id="562d" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">在 Node.js 中设置路线</h1><p id="bace" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">由于这个特定的应用程序将把提取的数据发送到一个网页，我们首先需要设置为这个应用程序服务的路由。首先，这可以是一条标准路径，我们将把它指向<code class="eh mk ml mm mb b">test</code>子目录，呈现出<code class="eh mk ml mm mb b">test.ejs</code>。我将为教程的每一部分编辑这个端点。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="2bdb" class="mf ke hu mb b fv mg mh l mi mj">app.get("/test", function(req, res){ <br/>     res.render('test') <br/>});</span></pre><h1 id="d268" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">设置呈现的页面</h1><p id="db82" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">您需要创建一个视图目录来存放您的 EJS 文件。我还设置了一些我在节点应用程序中使用的其他东西，这些东西对于开始并不重要，但是对于本教程之后的其他步骤是必需的，比如添加样式。</p><ul class=""><li id="21fd" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">我添加了页眉和页脚部分，尽管这些并不是每个应用程序都需要的。如果您不知道这些是什么，只需确保您的 EJS 文件像普通 HTML 文件一样包含所有必需的信息，如 DOCTYPE 和<code class="eh mk ml mm mb b">&lt;head&gt;</code>部分。</li><li id="f471" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">我添加了一个公共目录来存放支持站点的样式和其他文件。为了让应用程序识别这个目录，在任何路由之前需要下面一行。</li></ul><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="94fd" class="mf ke hu mb b fv mg mh l mi mj">app.use(express.static(__dirname+"/public"));</span></pre><p id="b41c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你采取了这些步骤，你的目录应该看起来像这样！</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/08528b6900581a5df87bb01c997c6320.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/format:webp/0*7PB8Mofj1SJAuJ4T.png"/></div></figure><p id="ab49" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时，您应该已经为我们的节点应用程序准备好了核心依赖项，所以我们可以开始使用 API 了！</p><h1 id="a95a" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">将 Node.js 链接到 Google Sheets</h1><p id="aa13" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">本教程的大部分内容将是如何连接 Google API。有多种方法可以连接到 API，我将分享三种方法:</p><ul class=""><li id="38a3" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">通过 V3 的 Google Sheets HTTP 请求</li><li id="6441" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">带有 OAuth2 的 Google Sheets API v4</li><li id="c4a0" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">谷歌开发者控制台和谷歌电子表格包</li></ul><p id="ee23" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">欢迎您使用下面的任何方法，并跳到对您最有帮助的方法。在开始之前，我应该提到我会鼓励大多数应用程序使用 v4，原因如下:</p><p id="8aec" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">使用 v3 HTTP 方法的理由:</strong></p><ul class=""><li id="5d90" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">它更容易设置</li></ul><p id="92c0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">使用 v4 的理由:</strong></p><ul class=""><li id="fd6e" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated">v3 最终会被弃用</li><li id="80ed" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">使用 v3 方法需要发布电子表格</li><li id="7e81" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">使用 v3 方法只允许读取，不允许写入</li><li id="1ef0" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">在 v3 方法中，您依赖于制表符的顺序</li><li id="18c6" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">在 v3 方法中，您的请求灵活性较差</li><li id="e2aa" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated">v4 中的输出更清晰</li></ul><h1 id="cbc4" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">方法 1:通过 V3 的 HTTP 请求</h1><p id="bf54" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">迄今为止，可以说访问 API 最简单的方式是通过<a class="ae jq" href="https://developers.google.com/sheets/api/v3/" rel="noopener ugc nofollow" target="_blank"> v3 </a>。</p><p id="4300" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个版本提供了一个端点，只需访问指定的 URL，就可以返回单个 JSON 中的所有信息。要使用这种方法，只需执行以下步骤:</p><ol class=""><li id="5610" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo mo ls lt lu dt translated">转到您的电子表格，然后单击文件→发布到 Web</li></ol><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mp"><img src="../Images/e87b42cf8edb1dd469ef903488dc0a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9CdURoDJhcGLn_yL"/></div></div></figure><ol class=""><li id="8576" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo mo ls lt lu dt translated">选择要从中提取数据的文档部分。这些<strong class="it hv">必须发布</strong>以便通过此方法提取数据。</li><li id="c658" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">利用这个 URL 结构访问数据，用工作表中的正确信息替换<code class="eh mk ml mm mb b">SPREADSHEET_ID</code>和<code class="eh mk ml mm mb b">TAB_NUMBER</code>:</li></ol><p id="850a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jq" href="https://spreadsheets.google.com/feeds/cells/SPREADSHEET_ID/TAB_NUMBER/public/values?alt=json" rel="noopener ugc nofollow" target="_blank">https://spreadsheets . Google . com/feeds/cells/spread sheet _ ID/TAB _ NUMBER/public/values？alt=json </a></p><p id="7a0c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">例如，下面的 URL 将返回第一个图像中的信息，第二个图像中描述了一个 JSON:<a class="ae jq" href="https://spreadsheets.google.com/feeds/cells/1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I/1/public/values?alt=json" rel="noopener ugc nofollow" target="_blank">https://spreadsheets . Google . com/feeds/cells/1 uiv 4 rkox 8 kjk 2 zqyig 0 klh 5 _ f 8 fcodwiwv 8 YF 2 yf8 I/2/public/values？alt=json </a></p><p id="2284" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此外，如果您从末尾移除<code class="eh mk ml mm mb b">?alt=json</code>,您将接收到 XML 格式的数据。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mq"><img src="../Images/c64e9242e99ccbcf4cb1a441d78fef81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9OzGF1buWfb2w8u9"/></div></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">Example data input in Google Sheets.</figcaption></figure><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mr"><img src="../Images/90a609cf1ac7fa26bd11969a6d4989f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4nIeADykIx3MT-_u"/></div></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">Example data output when accessing the v3 endpoint.</figcaption></figure><p id="8838" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果我们想通过节点而不是浏览器发出请求，我们可以利用本教程开始时安装的请求包。如果你从未使用过请求包，你可以<a class="ae jq" href="https://www.npmjs.com/package/request" rel="noopener ugc nofollow" target="_blank">在这里找到文档</a>。下面是将在 URL 处的节点中运行的代码示例:domain.xyz/v3,呈现页面并传入可在<code class="eh mk ml mm mb b">test.ejs</code>文件中使用的响应对象。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="ae86" class="mf ke hu mb b fv mg mh l mi mj">app.get("/v3", function(req, res){ </span><span id="44d7" class="mf ke hu mb b fv ms mh l mi mj">// Defining the request URL </span><span id="5542" class="mf ke hu mb b fv ms mh l mi mj">     var options = { <br/>          url: 'https://spreadsheets.google.com/feeds/cells/1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I/2/public/values?alt=json' <br/>     } </span><span id="248f" class="mf ke hu mb b fv ms mh l mi mj">// Using the request package to pull the information using the options object defined above </span><span id="4a66" class="mf ke hu mb b fv ms mh l mi mj">     request(options, callback) </span><span id="68f9" class="mf ke hu mb b fv ms mh l mi mj">// Callback function logging the request body in the console if it was successful </span><span id="87ee" class="mf ke hu mb b fv ms mh l mi mj">     function callback(error, response, body){ <br/>          if (!error &amp;&amp; response.statusCode == 200) {              <br/>               console.log(body); </span><span id="adbe" class="mf ke hu mb b fv ms mh l mi mj">// Rendering test express file while passing in the response object to be used. <br/>          res.render('test', {response: response}) <br/>     } else { <br/>          console.log(error) <br/>     } <br/>     } <br/>}</span></pre><p id="b762" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在编写回调函数(以及本教程的后续部分)时，要记住一件非常重要的事情，就是确保回调响应对象的命名不同于在<code class="eh mk ml mm mb b">app.get()</code>中定义的响应。换句话说，它们必须是独立变量，否则你会出错。在上面的例子中，第一个响应对象名为“res”，而回调中的对象名为“response”。你可以用任何你认为合适的方式称呼他们，但是一定要确保你们彼此独立。</p><p id="2d91" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">回到前面概述的限制，我应该提到，尽管 v3 API 很容易使用，但我建议继续学习如何利用 API 的 v4。</p><p id="c47c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">除了 v3 要求您的数据是公开的、不允许对电子表格进行任何写入以及您的请求灵活性较低之外，最引人注目的问题可能是 v3 将在未来的某个时候被 Google 弃用，因此现在转移到更可靠的解决方案是值得的。</p><h1 id="d46d" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">方法 2:使用 V4 的 OAuth2</h1><p id="75f0" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">让我们从 v4 开始吧！这一节将教你通过 Google 提供的方法来使用 v4(没有任何第三方包)。</p><p id="c2eb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Google 已经为如何开始与 Sheets API 的 v4 集成提供了很好的文档。他们提供了大多数后端语言的快速入门指南，包括 PHP、Python、Ruby、.NET，Go，Java，Go，当然还有<a class="ae jq" href="https://developers.google.com/sheets/api/quickstart/nodejs#step_3_set_up_the_sample" rel="noopener ugc nofollow" target="_blank"> Node.js </a>。<br/>您将在快速入门部分看到需要遵循的四个步骤。你可以直接按照谷歌提供的<a class="ae jq" href="https://developers.google.com/sheets/api/quickstart/nodejs#step_3_set_up_the_sample" rel="noopener ugc nofollow" target="_blank">这个页面</a>上的说明去做，但是我在下面留了一些指导性的注释。</p><h1 id="c870" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">步骤 1:打开 Google Sheets API</h1><ul class=""><li id="c8a2" class="lm ln hu it b iu lb iy lc jc mt jg mu jk mv jo lr ls lt lu dt translated">一旦您启用了 API，您将获得一个客户机 ID 和客户机秘密，以后可以在 API 控制台中对其进行管理。出于这种认证的目的，您只需要 credentials.json 文件，该文件应该保存在您的工作目录中(即:您运行<code class="eh mk ml mm mb b">app.js</code>或<code class="eh mk ml mm mb b">index.js</code>的任何地方)。</li></ul><h1 id="13ae" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">步骤 2:安装客户端库</h1><ul class=""><li id="ea7e" class="lm ln hu it b iu lb iy lc jc mt jg mu jk mv jo lr ls lt lu dt translated">如果您遵循了本教程前面的步骤，您将已经安装了依赖项。</li></ul><h1 id="56f5" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">步骤 3:设置示例</h1><ul class=""><li id="d3bb" class="lm ln hu it b iu lb iy lc jc mt jg mu jk mv jo lr ls lt lu dt translated">如果您遵循了本教程前面的步骤，您将已经需要 app.js 或 index.js 文件顶部的依赖项。现在，您可以将代码从快速入门页面复制到工作节点文件中。关于谷歌提供的代码的一些说明:</li></ul><p id="21c3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">认证</strong></p><p id="7380" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">函数<code class="eh mk ml mm mb b">fs.readFile()</code>实际上通过调用<code class="eh mk ml mm mb b">authorize()</code>函数，使用您的<code class="eh mk ml mm mb b">credentials.json</code>文件中的信息来启动认证过程。</p><p id="1cb5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">测试代码被设置为在认证时调用<code class="eh mk ml mm mb b">listMajors()</code>作为回调函数，这一点我们稍后会更改。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="bc78" class="mf ke hu mb b fv mg mh l mi mj">fs.readFile('credentials.json', (err, content) =&gt; { <br/>     if (err) return console.log('Error loading client secret file:', err); </span><span id="e350" class="mf ke hu mb b fv ms mh l mi mj">// Authorize a client with credentials, then call the Google Sheets API. <br/>     authorize(JSON.parse(content), listMajors); <br/>});</span></pre><p id="6646" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了执行身份验证，有一组实际运行该过程的函数。<code class="eh mk ml mm mb b">authorize()</code>和<code class="eh mk ml mm mb b">getNewToken()</code>函数是预定义的，可以移动到节点文件的底部，甚至可以从另一个文件中导出。没有必要乱搞下面的代码，它实际上可以放在你的路由之外，以便清理你的代码。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="e8f6" class="mf ke hu mb b fv mg mh l mi mj">function authorize(credentials, callback) { <br/>     const {client_secret, client_id, redirect_uris} = credentials.installed; <br/>     const oAuth2Client = new google.auth.OAuth2( <br/>          client_id, client_secret, redirect_uris[0]); </span><span id="c692" class="mf ke hu mb b fv ms mh l mi mj">// Check if we have previously stored a token.<br/>     fs.readFile(TOKEN_PATH, (err, token) =&gt; { <br/>          if (err) return getNewToken(oAuth2Client, callback);<br/>          oAuth2Client.setCredentials(JSON.parse(token));<br/>          callback(oAuth2Client); <br/>     }); <br/>} </span><span id="49ad" class="mf ke hu mb b fv ms mh l mi mj">function getNewToken(oAuth2Client, callback) { <br/>     const authUrl = oAuth2Client.generateAuthUrl({ <br/>          access_type: 'offline', <br/>          scope: SCOPES, <br/>     }); <br/>     console.log('Authorize this app by visiting this url:', authUrl); <br/>     const rl = readline.createInterface({ <br/>          input: process.stdin, <br/>          output: process.stdout, <br/>     }); <br/>     rl.question('Enter the code from that page here: ', (code) =&gt; {<br/>           rl.close(); <br/>           oAuth2Client.getToken(code, (err, token) =&gt; { <br/>           if (err) return console.error('Error while trying to retrieve access token', err); <br/>           oAuth2Client.setCredentials(token); <br/>           // Store the token to disk for later program executions <br/>           fs.writeFile(TOKEN_PATH, JSON.stringify(token), (err) =&gt; { <br/>           if (err) return console.error(err); <br/>           console.log('Token stored to', TOKEN_PATH); <br/>      }); <br/>      callback(oAuth2Client); <br/>      }); <br/>      }); <br/>}</span></pre><p id="9b83" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">测试节点</strong>中的 API 调用</p><p id="8d5d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">Google 提供的最后一个函数<code class="eh mk ml mm mb b">listMajors()</code>实际上是用来定义使用 API 操作什么信息的函数。</p><p id="2e8e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">ListMajors 目前从 Google 设置的预定义电子表格(id = ' 1 bximvs 0x ra 5 nfmdkvbdbzjgmuuqptlbs 74 ogve 2 upms ')中提取。在这种情况下，代码被设置为从范围 A2:E 中提取，您会注意到在 response.data.values 对象中返回的数据。</p><p id="1cfb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">listMajors 函数(或者你把它改成的名字)是对原始认证函数的回调，这个函数将是你存放你的<code class="eh mk ml mm mb b">res.render()</code>和发送数据到你的网页的地方。稍后将详细介绍。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="7ac1" class="mf ke hu mb b fv mg mh l mi mj">function listMajors(auth) { <br/>     const sheets = google.sheets({version: 'v4', auth});<br/>     sheets.spreadsheets.values.get({ <br/>          spreadsheetId: '1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms', <br/>          range: 'Class Data!A2:E', <br/>}, (err, res) =&gt; { <br/>          if (err) return console.log('The API returned an error: ' + err); <br/>          const rows = res.data.values; <br/>          if (rows.length) { console.log('Name, Major:'); <br/>          // Print columns A and E, which correspond to indices 0 and 4. <br/>               rows.map((row) =&gt; { <br/>               console.log(`${row[0]}, ${row[4]}`); <br/>          }); <br/>     } else { <br/>          console.log('No data found.'); <br/>     } <br/>}); <br/>}</span></pre><h1 id="904c" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">步骤 4:运行示例</h1><ul class=""><li id="17ca" class="lm ln hu it b iu lb iy lc jc mt jg mu jk mv jo lr ls lt lu dt translated">在节点应用程序的命令行中，运行<code class="eh mk ml mm mb b">node .</code>，这将提示您授权访问。当您授予访问权限时，您可能会注意到在您的目录中创建了一个<code class="eh mk ml mm mb b">token.json</code>文件。不要删除这个文件，因为它是用来记住这个特定的应用程序已被验证。</li></ul><p id="dcc1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，通过在终端中运行您的<code class="eh mk ml mm mb b">app.js</code>文件，您应该能够测试出一切是否设置正确。当这种情况发生时，你应该看到从<code class="eh mk ml mm mb b">listMajors()</code>打印到控制台的数据如下。</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div class="fe ff mw"><img src="../Images/34d1fb388a0814838e912e62d7998025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/0*oYUEKidcXBhxAo-5"/></div><figcaption class="lh li fg fe ff lj lk bd b be z ek">Example output from the listMajors() function.</figcaption></figure><h1 id="7683" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">定制 API 调用</h1><p id="cb99" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">现在您已经在应用程序中设置了身份验证层，是时候实际使用 API 了！如上所述，这意味着您将定制回调函数，目前是<code class="eh mk ml mm mb b">listMajors()</code>。</p><p id="7310" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了提取数据，您将继续使用<code class="eh mk ml mm mb b">sheets.spreadsheets.values.get()</code>，或者如果您希望提取多个部分，您可以使用<code class="eh mk ml mm mb b">sheets.spreadsheets.values.batchGet()</code>功能。这两种方法的文档可以在以下位置找到:</p><ul class=""><li id="7fd4" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo lr ls lt lu dt translated"><a class="ae jq" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/get" rel="noopener ugc nofollow" target="_blank"> spreadsheets.get </a></li><li id="7dca" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo lr ls lt lu dt translated"><a class="ae jq" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/batchGet" rel="noopener ugc nofollow" target="_blank">spreadsheets . values . batch get</a></li></ul><p id="5ca5" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">先说前者。</p><p id="6677" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">获取数据</strong></p><p id="ee04" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于这种情况，您将只编辑 listMajors 函数中的一些内容，因为它已经用<code class="eh mk ml mm mb b">get()</code>方法设置好了。为清晰起见，我将其重命名为<code class="eh mk ml mm mb b">datapull()</code>，并做了以下调整:</p><ol class=""><li id="5922" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo mo ls lt lu dt translated">将电子表格 ID 更改为我的电子表格 ID</li><li id="7b57" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">编辑区域以仅提取我想要的单元格(' tab2！A1:本例中为“A10”)</li><li id="6ebe" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">设置我命名为“rows”的响应对象</li><li id="d8e5" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">通过<code class="eh mk ml mm mb b">res.render</code>调用将数据从 rows 对象传递到 express 文件中</li></ol><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="625e" class="mf ke hu mb b fv mg mh l mi mj">app.get("/v4-get", function(req, res){ </span><span id="4dbf" class="mf ke hu mb b fv ms mh l mi mj">// Authorization <br/>fs.readFile('credentials.json', (err, content) =&gt; { <br/>     if (err) return console.log('Error loading client secret file:', err); </span><span id="61d6" class="mf ke hu mb b fv ms mh l mi mj">     // Authorize a client with credentials, then call the Google Sheets API. <br/>     authorize(JSON.parse(content), datapull); <br/>}); </span><span id="ac1e" class="mf ke hu mb b fv ms mh l mi mj">// Callback function pulling data <br/>function datapull(auth) { </span><span id="de7a" class="mf ke hu mb b fv ms mh l mi mj">const sheets = google.sheets({version: 'v4', auth}); </span><span id="987e" class="mf ke hu mb b fv ms mh l mi mj">// Pulling the data from the specified spreadsheet and the specified range <br/>var result = sheets.spreadsheets.values.get({ </span><span id="b964" class="mf ke hu mb b fv ms mh l mi mj">// (1) Changed spreadsheet ID <br/>     spreadsheetId: '1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I', </span><span id="7c40" class="mf ke hu mb b fv ms mh l mi mj">// (2) Changed the range of data being pulled <br/>     range: 'tab2!A1:A10', <br/>}, (err, response)=&gt;{ <br/>     if (err) return console.log('The API returned an error: ' + err); </span><span id="3b5e" class="mf ke hu mb b fv ms mh l mi mj">// (3) Setting data for daily tracking <br/>       const rows = response.data.values; </span><span id="5621" class="mf ke hu mb b fv ms mh l mi mj">// (4) Rendering the page and passing the rows data in res.render('test', {rows: rows}) <br/>     }); <br/>}</span></pre><p id="4c6a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">获取批量数据</strong></p><p id="d198" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如果您需要从电子表格中提取多个部分，您可以保持大部分代码不变，用<code class="eh mk ml mm mb b">.batchGet()</code>替换<code class="eh mk ml mm mb b">.get()</code>，同时对请求进行以下更改:</p><ol class=""><li id="9a60" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo mo ls lt lu dt translated">更新函数为<code class="eh mk ml mm mb b">batchGet()</code>函数</li><li id="aaec" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">将“范围”更新为复数“范围”，同时输入要抓取的一系列单元格</li><li id="1756" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">将每个范围的输出设置为常数</li><li id="6502" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">将输出数据组织成两个数组</li><li id="1025" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">在传递两个数组时呈现 express 文件(在本例中为“rows”和“data”)</li></ol><p id="7664" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">对于这种情况，您将只编辑 listMajors 函数中的一些内容，因为它已经用<code class="eh mk ml mm mb b">get()</code>方法设置好了。为了清晰起见，我把它重新命名为<code class="eh mk ml mm mb b">datapull()</code>，并做了如下调整:</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="fd0e" class="mf ke hu mb b fv mg mh l mi mj">app.get("/v4-batch-get", function(req, res){</span><span id="b3e2" class="mf ke hu mb b fv ms mh l mi mj">fs.readFile('credentials.json', (err, content) =&gt; { <br/>     if (err) return console.log('Error loading client secret file:', err); <br/>     // Authorize a client with credentials, then call the Google Sheets API. <br/>     authorize(JSON.parse(content), datapull); <br/>}); </span><span id="5926" class="mf ke hu mb b fv ms mh l mi mj">function datapull(auth) { <br/>const sheets = google.sheets({version: 'v4', auth}); </span><span id="aa47" class="mf ke hu mb b fv ms mh l mi mj">// (1) Updating function to use batchGet() <br/>      var result = sheets.spreadsheets.values.batchGet({<br/>      spreadsheetId: '1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I', </span><span id="1cbb" class="mf ke hu mb b fv ms mh l mi mj">// (2) Updating "range" to "ranges" and inputting the series of cells to grab within the array </span><span id="b912" class="mf ke hu mb b fv ms mh l mi mj">ranges: ['tab2!A2:A12', 'tab2!B2:B12', 'tab3!A2:A', 'tab3!B2:B'] <br/>}, (err, resp)=&gt;{ <br/>     if (err) return console.log('The API returned an error: ' + err); </span><span id="4144" class="mf ke hu mb b fv ms mh l mi mj">// (3) Pulling first two ranges into arrays - data format changes from.values to .valueRanges[range defined above].values </span><span id="ef1d" class="mf ke hu mb b fv ms mh l mi mj">     const rows1 = resp.data.valueRanges[0].values; <br/>     const rows2 = resp.data.valueRanges[1].values; </span><span id="9922" class="mf ke hu mb b fv ms mh l mi mj">// Pulling last two ranges into arrays- same data format as above<br/>     const data1 = resp.data.valueRanges[2].values; <br/>     const data2 = resp.data.valueRanges[3].values; </span><span id="889a" class="mf ke hu mb b fv ms mh l mi mj">// (4) Organizing the data output into two arrays: rows and data<br/>     const rows = [rows1, rows2] <br/>     const data = [data1, data2] </span><span id="b95c" class="mf ke hu mb b fv ms mh l mi mj">// (5) Rendering the page and passing both the rows and data arrays through <br/>     res.render('test', {rows: rows, data:data}) <!-- --> </span><span id="ac9c" class="mf ke hu mb b fv ms mh l mi mj">     }); <br/>     } <br/>});</span></pre><p id="2e96" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">很明显，希望在 v4 中使用<code class="eh mk ml mm mb b">.get()</code>和<code class="eh mk ml mm mb b">.batchGet()</code>方法能够让您对希望发出的请求有更多的控制。Google API 通过 v4 支持许多其他方法，包括通过和<code class="eh mk ml mm mb b"><a class="ae jq" href="https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets.values/batchUpdate" rel="noopener ugc nofollow" target="_blank">batchUpdate()</a></code>方法编写的能力。记住这一点，让我们进入使用 Google API 的最后一种方法，它利用了第三方包。</p><h1 id="480a" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">方法 3: Node.js OAuth2 — Google 开发人员控制台和 npm google 电子表格包</h1><p id="1edf" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">最后一种方法利用了 google 开发人员控制台和一个名为 google-spreadsheet 的第三方 npm 包，可以说它比 Google 文档中概述的功能要干净得多。为了利用这种方法，第一步是安装 google-spreadsheet，并在您的文件顶部要求模块:</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="feb3" class="mf ke hu mb b fv mg mh l mi mj">npm install google-spreadsheet<!-- --> </span><span id="4ba6" class="mf ke hu mb b fv ms mh l mi mj">var express       = require("express"), <br/>fs                = require('fs'), <br/>readline          = require('readline'), <br/>{google}          = require('googleapis'), <br/>request           = require('request'), <br/>GoogleSpreadsheet = require('google-spreadsheet'), <br/>creds             = require('./client_secret.json'), <br/>app               = express();</span></pre><p id="4496" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过这种方法实现身份验证需要几个管理步骤。</p><ol class=""><li id="10da" class="lm ln hu it b iu iv iy iz jc lo jg lp jk lq jo mo ls lt lu dt translated">转到<a class="ae jq" href="https://console.developers.google.com/apis/dashboard" rel="noopener ugc nofollow" target="_blank">谷歌开发者控制台</a>并导航到 API 部分。你应该会看到一个仪表盘。</li><li id="17f6" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">单击“启用 API”或“库”,这将带您进入可以连接的服务库。搜索并启用 Google Sheets API。</li><li id="0b94" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">转到凭据并选择“创建凭据”。</li><li id="eb1d" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">选择“服务帐户”并继续创建此服务帐户。你想叫它什么都可以。</li><li id="a55d" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">在“角色”下，根据您要授予的访问权限级别，选择“项目”&gt;“所有者”或“编辑”。</li><li id="246d" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">选择 JSON 作为密钥类型，然后单击“创建”。这应该会用您的凭证自动下载一个 JSON 文件。</li><li id="e98a" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">将这个凭证文件重命名为<code class="eh mk ml mm mb b">client_secret.json</code>，并将其复制到您的工作目录中。</li><li id="05f1" class="lm ln hu it b iu lv iy lw jc lx jg ly jk lz jo mo ls lt lu dt translated">最后的行政步骤是<strong class="it hv">超级重要的</strong>！获取您的凭证文件中的“客户电子邮件”,并在您工作的表单中授予对该特定电子邮件的访问权限。你可以点击电子表格左上方的“分享”，然后将该电子邮件粘贴到字段中，启用“可以编辑”。如果不这样做，在尝试提取数据时会出现错误。</li></ol><p id="e282" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了测试代码是否有效，我们可以开始使用 API！下面是一些示例代码，它们有效地验证并从所标识的电子表格的第二个选项卡中获取数据。我已经记下了身份验证发生的位置、请求的内容以及响应返回的位置。</p><p id="a962" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在测试时，请确保查看控制台中的输出，它将记录错误或响应对象。如果您得到一个 403 错误，这意味着在设置身份验证时可能出错了。</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="e204" class="mf ke hu mb b fv mg mh l mi mj">app.get("/google-spreadsheet", function(req, res){ </span><span id="9bd9" class="mf ke hu mb b fv ms mh l mi mj">// Identifying which document we'll be accessing/reading from </span><span id="d27a" class="mf ke hu mb b fv ms mh l mi mj">var doc = new GoogleSpreadsheet('1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I');</span><span id="ce9f" class="mf ke hu mb b fv ms mh l mi mj">// Authentication </span><span id="c057" class="mf ke hu mb b fv ms mh l mi mj">doc.useServiceAccountAuth(creds, function (err) { </span><span id="bb30" class="mf ke hu mb b fv ms mh l mi mj">// Getting cells back from tab #2 of the file <br/>doc.getCells(2, callback) </span><span id="2c5a" class="mf ke hu mb b fv ms mh l mi mj">// Callback function determining what to do with the information function callback(err, rows){ </span><span id="c8f5" class="mf ke hu mb b fv ms mh l mi mj">// Logging the output or error, depending on how the request went<br/>     console.log(rows) <br/>     console.log(err) </span><span id="096d" class="mf ke hu mb b fv ms mh l mi mj">// Rending the test page while passing in the response data through "rows". Can access specific data points via: rows[i]._value<br/>     res.render('test', {rows:rows}) <br/>     } <br/>     }); <br/>});</span></pre><p id="6b41" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">有了这个包，开始写电子表格也变得更加容易。例如，您可能希望每天向电子表格中写入您的进度。下面是一个如何实现这一点的示例:</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="de7e" class="mf ke hu mb b fv mg mh l mi mj">app.get("/google-spreadsheet", function(req, res){ </span><span id="2f02" class="mf ke hu mb b fv ms mh l mi mj">// Identifying which document we'll be accessing/reading from <br/>var doc = new GoogleSpreadsheet('1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I'); </span><span id="0f4f" class="mf ke hu mb b fv ms mh l mi mj">// Authentication <br/>doc.useServiceAccountAuth(creds, function (err) { </span><span id="4013" class="mf ke hu mb b fv ms mh l mi mj">// Adding a row in tab #4 with the date and the number 1<br/>doc.addRow(4, { date: "=today()", progress: "1" }, callback) </span><span id="2c81" class="mf ke hu mb b fv ms mh l mi mj">function callback(err) { <br/>     if(err) { <br/>          console.log(err); <br/>     } else { <br/>           console.log('You added your progress for the day.') </span><span id="07d3" class="mf ke hu mb b fv ms mh l mi mj">     // Rendering test page <br/>     res.render('test') <br/>     } <br/>} <br/>}); <br/>});</span></pre><p id="a57c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">从这里，你可以利用<a class="ae jq" href="https://www.npmjs.com/package/google-spreadsheet" rel="noopener ugc nofollow" target="_blank">谷歌电子表格包</a>的文档中的功能。</p><h1 id="899d" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">将 Google Sheets 数据库连接到 Express</h1><p id="1790" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">希望最后几节有助于确定可以用来连接、验证和从 Google API 提取数据的不同方法。利用数据库生成实时使用该信息的网站/应用程序的最后一步是将数据传递给渲染的 EJS 文件。</p><p id="ee0d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此时，您应该已经设置了一些从 API 获取所需数据的路线。您可以自由地使用您选择的任何路线，以便将该数据传递到您选择的 express 文件(通过您的<code class="eh mk ml mm mb b">res.render()</code>调用)。在 express 文件本身中，您可以通过<a class="ae jq" href="https://ejs.co/" rel="noopener ugc nofollow" target="_blank"> EJS(嵌入式 javascript)标签</a>来利用这些数据。</p><p id="9291" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这些标签允许您以内联方式或者在 HTML 旁边呈现 Javascript。例如，如果您从一个将数据作为“数据”和“行”传递给 express 文件的<code class="eh mk ml mm mb b">batchGet()</code>函数中提取数据，您可以使用 EJS 标签循环遍历您的数据并直接打印到页面上。</p><p id="582d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">输入(从<a class="ae jq" href="https://docs.google.com/spreadsheets/d/1UIV4RkOx8KJK2zQYig0klH5_f8FCOdwIWV8YF2VyF8I/edit?usp=sharing" rel="noopener ugc nofollow" target="_blank">文件</a>中提取):</p><pre class="js jt ju jv fq ma mb mc md aw me dt"><span id="32be" class="mf ke hu mb b fv mg mh l mi mj">&lt;% include partials/header %&gt; </span><span id="8f08" class="mf ke hu mb b fv ms mh l mi mj">&lt;div class="container"&gt; <br/>     &lt;h2&gt;This is a tutorial for using the Google Sheets API!&lt;/h2&gt; </span><span id="5e63" class="mf ke hu mb b fv ms mh l mi mj">     &lt;div&gt;This data is pulling from the second tab:&lt;/div&gt; </span><span id="df5f" class="mf ke hu mb b fv ms mh l mi mj">      &lt;!--Looping through the 'rows' array and printing the output within the EJS tags--&gt; <br/>      &lt;% for(i=0; i&lt;10; i++) { %&gt; <br/>      &lt;div &gt; <br/>      Rows data: &lt;%= rows[0][i] %&gt;, &lt;%= rows[1][i] %&gt; <br/>      &lt;/div&gt; <br/>      &lt;% } %&gt; </span><span id="684e" class="mf ke hu mb b fv ms mh l mi mj">      &lt;br&gt; <br/>      &lt;hr&gt; <br/>      &lt;br&gt; </span><span id="52e4" class="mf ke hu mb b fv ms mh l mi mj">&lt;div&gt;This data is pulling from the third tab:&lt;/div&gt; </span><span id="831f" class="mf ke hu mb b fv ms mh l mi mj">&lt;!--Looping through the 'data' array and printing the output within the EJS tags--&gt; <br/>&lt;% for(i=0; i&lt;10; i++) { %&gt; <br/>&lt;div &gt; <br/>     On &lt;%= data[0][i] %&gt;, I made the following progress: &lt;%=data[1][i]%&gt; <br/>&lt;/div&gt; </span><span id="a480" class="mf ke hu mb b fv ms mh l mi mj">&lt;% } %&gt; <br/>&lt;/div&gt; </span><span id="ed71" class="mf ke hu mb b fv ms mh l mi mj">&lt;% include partials/footer %&gt;</span></pre><p id="aa72" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">输出(从 EJS 文件渲染):</p><figure class="js jt ju jv fq jw fe ff paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="fe ff mr"><img src="../Images/99bdaea72569b49e5e0c281190b8b25a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HKhLlj1JtyXdrIlg"/></div></div></figure><p id="8f71" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦你建立了正确的数据库链接，你就可以自由地设计页面风格和添加额外的功能，就像任何其他的 HTML 页面一样，因为 EJS 本质上是嵌入了 Javascript 的 HTML。</p><h1 id="5f35" class="kd ke hu bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la dt translated">通话完毕</h1><p id="bd3c" class="pw-post-body-paragraph ir is hu it b iu lb iw ix iy lc ja jb jc ld je jf jg le ji jj jk lf jm jn jo hn dt translated">我希望所提供的信息为您理解如何发出请求以及如何在 Node/Express 应用程序中嵌入请求提供了足够的基础。您将不得不考虑建立您可能需要的数据结构的个人方法，但是方法仍然是相同的。</p><p id="5bb7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">如前所述，Google API 提供了多种从 Google 电子表格中访问数据的方法，我鼓励您使用最适合您需求的方法。我还鼓励您深入研究文档，了解更多可用的解决方案。我真的很兴奋看到你创造的东西，一如既往，如果你在学习过程中有任何问题，请随时给我发消息。</p></div><div class="ab cl mx my hc mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="hn ho hp hq hr"><p id="0f80" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="jp">原载于 2019 年 5 月 12 日</em><a class="ae jq" href="https://blog.stephsmith.io/tutorial-google-sheets-api-node-js/" rel="noopener ugc nofollow" target="_blank"><em class="jp">https://blog . steph Smith . io</em></a><em class="jp">。</em></p></div></div>    
</body>
</html>