<html>
<head>
<title>Microsoft Orleans — Dashboard Update — CPU/Memory Stats</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微软奥尔良—仪表板更新—CPU/内存统计</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/microsoft-orleans-dashboard-update-cpu-memory-stats-706daed82cf8?source=collection_archive---------12-----------------------#2019-02-25">https://medium.com/hackernoon/microsoft-orleans-dashboard-update-cpu-memory-stats-706daed82cf8?source=collection_archive---------12-----------------------#2019-02-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk ir is it iu fe ff paragraph-image"><div class="ab fr cl iv"><img src="../Images/cd150e1085adf57813fd8540c488ff26.png" data-original-src="https://miro.medium.com/v2/format:webp/0*JnJHfNGV4tkv8UPw.png"/></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Orleans Logo</figcaption></figure><p id="4e23" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">快速更新我不久前发表的一篇关于Orleans Dashboard的帖子—针对您的集群的附加报告指标！</p><p id="56e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">作为复习，Orleans是一个虚拟演员模型框架——一个可以用来构建新的、分布式“原语”的框架。这些原语的工作可以外包给一个节点集群，作为一种比局限于单个硬件更快完成“工作”的方式。</p><p id="f989" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在之前的帖子中:</p><div class="ka kb fm fo kc kd"><a href="https://medium.freecodecamp.org/microsoft-orleans-reporting-dashboard-16465d255199" rel="noopener  ugc nofollow" target="_blank"><div class="ke ab ej"><div class="kf ab kg cl cj kh"><h2 class="bd hv fv z el ki eo ep kj er et ht dt translated">如何设置Microsoft Orleans的报告仪表板</h2><div class="kk l"><h3 class="bd b fv z el ki eo ep kj er et ek translated">Orleans是一个易于使用的actor框架，但是如何监控您的部署呢？幸运的是，有些事情很简单…</h3></div><div class="kl l"><p class="bd b gc z el ki eo ep kj er et ek translated">medium.freecodecamp.org</p></div></div><div class="km l"><div class="kn l ko kp kq km kr iw kd"/></div></div></a></div><p id="4796" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我曾指出:</p><blockquote class="ks kt ku"><p id="c708" class="jc jd kv je b jf jg jh ji jj jk jl jm kw jo jp jq kx js jt ju ky jw jx jy jz hn dt translated">目前，CPU/内存使用情况在中不可见。奥尔良的net核心实现。希望将来能有所补救？也许是netstandard中可用的API的限制？</p></blockquote><p id="6036" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这个***好像* * *在某个时间点上曾经是真的，但现在已经不是了！(至少如果你在windows运行时环境下运行。)</p><p id="27e6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">额外的CPU和内存指标完全取决于注册的<code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>实现。默认情况下，会注册一个“NoImplementation”实现，您会在Orleans日志中看到类似这样的内容:</p><figure class="le lf lg lh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff ld"><img src="../Images/98772c0b85aa7cbf06c98be5feff88bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LUNEWSPH4EmnMcjyeX4KyA.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Orleans log showing an issue that prevents LoadShedding from working</figcaption></figure><p id="77b5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">你仪表板上的这个:</p><figure class="le lf lg lh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff ld"><img src="../Images/04feda157475aa9dcf6fc65e861f53bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkh0T8cIULk5Qnjh26ecxQ.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">Sad Orleans Dashboard w/o CPU/Memory metrics :(</figcaption></figure><p id="1403" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我偶然发现让这些CPU/内存指标在仪表板上工作的全部原因是，我在追求让特性<code class="eh kz la lb lc b">LoadShedding</code>工作——这显然依赖于这些指标。</p><p id="67c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">通过在<a class="ae lm" href="https://gitter.im/dotnet/orleans" rel="noopener ugc nofollow" target="_blank"> Orleans Gitter </a>上的反复讨论，我发现了一个<code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>类需要注册的实现。其中一个类确实存在于Orleans代码中，尽管它在一个单独的包中，并且是该包的一个内部类:</p><div class="ka kb fm fo kc kd"><a href="https://github.com/dotnet/orleans/blob/e2b25a695767ae5746ffe47218c1331427997894/src/TelemetryConsumers/Orleans.TelemetryConsumers.Counters/Statistics/PerfCounterEnvironmentStatistics.cs" rel="noopener  ugc nofollow" target="_blank"><div class="ke ab ej"><div class="kf ab kg cl cj kh"><h2 class="bd hv fv z el ki eo ep kj er et ht dt translated">dot net/奥尔良</h2><div class="kk l"><h3 class="bd b fv z el ki eo ep kj er et ek translated">奥尔良分布式虚拟演员模型。在GitHub上创建一个帐户，为dotnet/orleans的发展做出贡献。</h3></div><div class="kl l"><p class="bd b gc z el ki eo ep kj er et ek translated">github.com</p></div></div><div class="km l"><div class="ln l ko kp kq km kr iw kd"/></div></div></a></div><p id="ef20" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">幸运的是，有一个SiloHost扩展方法注册了这个<code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>的实现供使用——尽管是在一个仅支持Windows的运行时环境中(至少在编写本文时是这样)。</p><p id="f4ee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了让CPU/内存指标在我们的仪表板上工作(并让我们能够在<code class="eh kz la lb lc b">LoadShedding</code>工作)，我们需要做一些事情:</p><ul class=""><li id="77f4" class="lo lp hu je b jf jg jj jk jn lq jr lr jv ls jz lt lu lv lw dt translated">安装新的NuGet包</li><li id="8207" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated">注册一个<code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>的实现——类似于NuGet包本身提供的实现。</li></ul></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><h2 id="d9be" class="mj mk hu bd ml mm mn mo mp mq mr ms mt jn mu mv mw jr mx my mz jv na nb nc nd dt translated">安装NuGet包</h2><p id="84ed" class="pw-post-body-paragraph jc jd hu je b jf ne jh ji jj nf jl jm jn ng jp jq jr nh jt ju jv ni jx jy jz hn dt translated"><code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>实现存在于<code class="eh kz la lb lc b">Microsoft.Orleans.OrleansTelemetryConsumers.Counters</code>包中，通过GUI、CLI等安装它。完成后，SiloHost项目中的csproj文件应该如下所示:</p><figure class="le lf lg lh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff nj"><img src="../Images/20a6b4826f61c1bdc60ad929f01b01a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XDZnP9oDOIz96A2XZBOC0A.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">csproj after installing the NuGet package Microsoft.Orleans.OrleansTelemetryConsumers.Counters</figcaption></figure><h2 id="23f4" class="mj mk hu bd ml mm mn mo mp mq mr ms mt jn mu mv mw jr mx my mz jv na nb nc nd dt translated">注册IHostEnvironmentStatistics的实现</h2><p id="25b4" class="pw-post-body-paragraph jc jd hu je b jf ne jh ji jj nf jl jm jn ng jp jq jr nh jt ju jv ni jx jy jz hn dt translated">如前所述，新的NuGet包中包含了一个特定于Windows的<code class="eh kz la lb lc b">IHostEnvironmentStatistics</code>实现，尽管它是一个内部类。然而，有一个扩展方法可以用来注册这个内部类。</p><p id="356d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们更新我们的SiloHostBuilder:</p><p id="0daa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">原创</p><pre class="le lf lg lh fq nk lc nl nm aw nn dt"><span id="d5f1" class="mj mk hu lc b fv no np l nq nr">var builder = new SiloHostBuilder()<br/> .ConfigureClustering(<br/>  ServiceProvider.GetService&lt;IOptions&lt;OrleansConfig&gt;&gt;(),<br/>  Startup.HostingEnvironment.EnvironmentName<br/> )<br/> .Configure&lt;ClusterOptions&gt;(options =&gt;<br/> {<br/>  options.ClusterId = "dev";<br/>  options.ServiceId = "HelloWorldApp";<br/> })<br/> .Configure&lt;EndpointOptions&gt;(options =&gt; options.AdvertisedIPAddress = IPAddress.Loopback)<br/> .AddMemoryGrainStorage(Constants.OrleansMemoryProvider)<br/> .ConfigureApplicationParts(parts =&gt;<br/> {<br/>  parts.AddApplicationPart(typeof(IGrainMarker).Assembly).WithReferences();<br/> })<br/> .ConfigureServices(DependencyInjectionHelper.IocContainerRegistration)<br/> .UseDashboard(options =&gt; { })<br/> .UseInMemoryReminderService()<br/> .ConfigureLogging(logging =&gt; logging.AddConsole());</span></pre><p id="5c9a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">而我们只需要加上<code class="eh kz la lb lc b">.UsePerfCounterEnvironmentStatistics()</code>。</p><p id="37fa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">更新</p><pre class="le lf lg lh fq nk lc nl nm aw nn dt"><span id="4a52" class="mj mk hu lc b fv no np l nq nr">var builder = new SiloHostBuilder()<br/> .ConfigureClustering(<br/>  ServiceProvider.GetService&lt;IOptions&lt;OrleansConfig&gt;&gt;(),<br/>  Startup.HostingEnvironment.EnvironmentName<br/> )<br/> .Configure&lt;ClusterOptions&gt;(options =&gt;<br/> {<br/>  options.ClusterId = "dev";<br/>  options.ServiceId = "HelloWorldApp";<br/> })<br/> .Configure&lt;EndpointOptions&gt;(options =&gt; options.AdvertisedIPAddress = IPAddress.Loopback)<br/> .AddMemoryGrainStorage(Constants.OrleansMemoryProvider)<br/> .ConfigureApplicationParts(parts =&gt;<br/> {<br/>  parts.AddApplicationPart(typeof(IGrainMarker).Assembly).WithReferences();<br/> })<br/> .ConfigureServices(DependencyInjectionHelper.IocContainerRegistration)<br/> .UsePerfCounterEnvironmentStatistics() // &lt;- this guy<br/> .UseDashboard(options =&gt; { })<br/> .UseInMemoryReminderService()<br/> .ConfigureLogging(logging =&gt; logging.AddConsole());</span></pre><p id="9e69" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是全部了！现在，我们应该在Orleans仪表板上报告我们的CPU/内存使用情况，并且可以更好地在<code class="eh kz la lb lc b">LoadShedding</code>工作——也许是为了下一篇帖子！</p><p id="98fc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，在我们的仪表板上，我们可以看到:</p><figure class="le lf lg lh fq iu fe ff paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="fe ff ns"><img src="../Images/922ef07de3cdc0bf2233da755bfe2e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*050BNc2zKDgssiqmx4VSbQ.png"/></div></div><figcaption class="iy iz fg fe ff ja jb bd b be z ek">CPU/Memory utilization!</figcaption></figure></div><div class="ab cl mc md hc me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="6275" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们对我们的集群如何运行有了更深入的了解，而且我们还可以使用其他功能，如<code class="eh kz la lb lc b">LoadShedding</code>！</p><h2 id="16e3" class="mj mk hu bd ml mm mn mo mp mq mr ms mt jn mu mv mw jr mx my mz jv na nb nc nd dt translated">相关:</h2><div class="ka kb fm fo kc kd"><a href="https://medium.freecodecamp.org/microsoft-orleans-reporting-dashboard-16465d255199" rel="noopener  ugc nofollow" target="_blank"><div class="ke ab ej"><div class="kf ab kg cl cj kh"><h2 class="bd hv fv z el ki eo ep kj er et ht dt translated">如何设置Microsoft Orleans的报告仪表板</h2><div class="kk l"><h3 class="bd b fv z el ki eo ep kj er et ek translated">Orleans是一个易于使用的actor框架，但是如何监控您的部署呢？幸运的是，有些事情很简单…</h3></div><div class="kl l"><p class="bd b gc z el ki eo ep kj er et ek translated">medium.freecodecamp.org</p></div></div><div class="km l"><div class="kn l ko kp kq km kr iw kd"/></div></div></a></div><div class="ka kb fm fo kc kd"><a href="https://github.com/OrleansContrib/OrleansDashboard/pull/212" rel="noopener  ugc nofollow" target="_blank"><div class="ke ab ej"><div class="kf ab kg cl cj kh"><h2 class="bd hv fv z el ki eo ep kj er et ht dt translated">关于启用CPU/内存指标的信息。由克里特纳拉动请求#212 …</h2><div class="kk l"><h3 class="bd b fv z el ki eo ep kj er et ek translated">更新了自述文件，扩展了在仪表板上启用CPU/内存指标的内容。这些指标(在撰写本文时)…</h3></div><div class="kl l"><p class="bd b gc z el ki eo ep kj er et ek translated">github.com</p></div></div><div class="km l"><div class="nt l ko kp kq km kr iw kd"/></div></div></a></div><ul class=""><li id="358c" class="lo lp hu je b jf jg jj jk jn lq jr lr jv ls jz lt lu lv lw dt translated">发布时的代码—<a class="ae lm" href="https://github.com/Kritner-Blogs/OrleansGettingStarted/releases/tag/v0.57" rel="noopener ugc nofollow" target="_blank">https://github . com/krit ner-Blogs/OrleansGettingStarted/releases/tag/v 0.57</a></li><li id="4c87" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/getting-started-with-microsoft-orleans-882cdac4307f?source=friends_link&amp;sk=1fc3451d71a19dcb49f2c8bbeb6b079e">微软奥尔良入门</a></li><li id="a72a" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/microsoft-orleans-reusing-grains-and-grain-state-136977facd42?source=friends_link&amp;sk=f19cfa3f17665c3d700bfe0df56e27a9">微软奥尔良——再利用谷物和谷物状态</a></li><li id="9feb" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/microsoft-orleans-reporting-dashboard-16465d255199">微软奥尔良—报告仪表板</a></li><li id="ee5e" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/updating-orleans-project-to-be-more-ready-for-new-orleans-examples-2105b29a46fd?source=friends_link&amp;sk=61d1f591e5b5c498688439db50ad310e">使用多态性更新新奥尔良项目，为新奥尔良范例做好准备！</a></li><li id="2091" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/microsoft-orleans-dependency-injection-6379d52a7169?source=friends_link&amp;sk=6c3883a5213d65eb251b56c717e0e4f2">微软奥尔良—依赖注入</a></li><li id="0240" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/microsoft-orleans-easily-switching-between-development-and-production-configurations-20e109be6458?source=friends_link&amp;sk=1e8fc6aa072a5b293d029c00012165b3">微软奥尔良——在“开发”和“生产”配置之间轻松切换。</a></li><li id="051e" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/net-core-console-application-ioptions-t-configuration-ae74bfafe1c5?source=friends_link&amp;sk=c5bcab4f7f10c97175ad68fc12cb9cc6">。网络核心控制台应用程序操作&lt;测试&gt;配置</a></li><li id="cc5a" class="lo lp hu je b jf lx jj ly jn lz jr ma jv mb jz lt lu lv lw dt translated"><a class="ae lm" rel="noopener" href="/@kritner/microsoft-orleans-observables-5e0040c949cd?source=friends_link&amp;sk=bcb921fdf593bdc97b9c5909b2730f2d">微软奥尔良—观察家</a></li></ul></div></div>    
</body>
</html>