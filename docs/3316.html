<html>
<head>
<title>ECS Secrets Done Right</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ECS 的秘密做对了</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/ecs-secrets-done-right-9e094cfa6200#2019-05-27">https://medium.com/hackernoon/ecs-secrets-done-right-9e094cfa6200#2019-05-27</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/76dbe4d034ebae7e194384a49955776a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8YFMfHdXK5hEOdCD"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@markusspiske?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="8a6a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">去年，我写了一篇关于 ECS 中<a class="ae jg" href="https://hackernoon.com/secrets-management-within-aws-ecs-1b6975819ccd" rel="noopener ugc nofollow" target="_blank">秘密管理的痛苦的文章，但随着 AWS 对 ECS 的一些升级，世界现在变得更加光明。</a></p><p id="6ede" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">大变化？秘密现在在 ECS 任务定义中有一级支持。根据您的使用情况，它们可以从 AWS secrets manager 或 SSM 参数存储中传递。更好的是，这些值都不会显示在 ECS 控制台的任务摘要中。对于那些使用 CLI 或<a class="ae jg" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Boto3 </a>的用户，使用<code class="eh kf kg kh ki b">containerDefinitions</code>中的<code class="eh kf kg kh ki b">secrets</code>部分，并指定秘密的完整 ARN，如下所示。如果您使用同一地区的 SSM 参数，您可以使用参数名称而不是完整的 ARN。</p><figure class="kj kk kl km fq iv"><div class="bz el l di"><div class="kn ko l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Secrets Manager — specify the full ARN</figcaption></figure><figure class="kj kk kl km fq iv"><div class="bz el l di"><div class="kn ko l"/></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">SSM Parameter Store — full ARN or parameter name (if parameter is in the same region)</figcaption></figure><p id="5487" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果您更喜欢 ClickOps，也可以在任务定义控制台中指定秘密。它们没有自己的部分，而是属于使用<code class="eh kf kg kh ki b">valueFrom</code>字段的常规<code class="eh kf kg kh ki b">Environment variables</code>选项卡。与该特性的初始实现不同，当您访问任何正在运行的任务的概要时，任何使用<code class="eh kf kg kh ki b">valueFrom</code>类型的变量都不会出现在环境变量列表中(这正是您所期望的秘密)。</p><figure class="kj kk kl km fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kp"><img src="../Images/552eebc7b0ddd6e2944392ab676993f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dRseB1n4oiNggT04_2zBQQ.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">AWS Console — Task Definition Container Configuration</figcaption></figure><p id="94d2" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">您还需要向您的 ECS 任务执行角色添加一些新的权限，以利用该功能。下面的内联策略应该是您开始工作所需的全部内容。<code class="eh kf kg kh ki b">secretsManager:GetSecretValue</code>和<code class="eh kf kg kh ki b">ssm:GetParameters </code>权限是必需的，这取决于你从哪里提取秘密，而<code class="eh kf kg kh ki b">kms:Decrypt</code>只有在你使用秘密管理器中的自定义 KMS 密钥时才是必需的。</p><figure class="kj kk kl km fq iv"><div class="bz el l di"><div class="kn ko l"/></div></figure><p id="6d66" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">最初，这种方法只针对 EC2 启动类型，但是从 Fargate 版本 1.3.0 开始，Fargate 用户也可以使用 secrets 支持。和往常一样，记住价格是很重要的，尤其是 Secrets manager 的价格是每个秘密每月 0.40 美元。如果您只运行几个服务，每个服务都有几个秘密，这应该不是问题，但它不会很好地扩展，尤其是如果您预算紧张。</p><p id="dae9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">遗憾的是，该功能的云形成稍微滞后，但已根据<a class="ae jg" href="https://github.com/aws/containers-roadmap/issues/97" rel="noopener ugc nofollow" target="_blank">功能请求确认在某些地区有效。</a>要了解 ECS 机密的最新变化，或 ECS、ECR 和 EKS 的任何其他信息，请查看下面的官方容器路线图。</p><h2 id="0652" class="kq kr hu bd ks kt ku kv kw kx ky kz la js lb lc ld jw le lf lg ka lh li lj lk dt translated">链接:</h2><div class="ll lm fm fo ln lo"><a href="https://github.com/aws/containers-roadmap/projects/1" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab ej"><div class="lq ab lr cl cj ls"><h2 class="bd hv fv z el lt eo ep lu er et ht dt translated">AWS/容器-路线图</h2><div class="lv l"><h3 class="bd b fv z el lt eo ep lu er et ek translated">这是 AWS 容器服务(ECS、ECR、Fargate 和 EKS)的公共路线图。-AWS/容器-路线图</h3></div><div class="lw l"><p class="bd b gc z el lt eo ep lu er et ek translated">github.com</p></div></div><div class="lx l"><div class="ly l lz ma mb lx mc ja lo"/></div></div></a></div><div class="ll lm fm fo ln lo"><a href="https://docs.aws.amazon.com/AmazonECS/latest/developerguide/specifying-sensitive-data.html" rel="noopener  ugc nofollow" target="_blank"><div class="lp ab ej"><div class="lq ab lr cl cj ls"><h2 class="bd hv fv z el lt eo ep lu er et ht dt translated">指定敏感数据——亚马逊弹性容器服务</h2><div class="lv l"><h3 class="bd b fv z el lt eo ep lu er et ek translated">Amazon ECS 使您能够通过将敏感数据存储在 AWS……</h3></div><div class="lw l"><p class="bd b gc z el lt eo ep lu er et ek translated">docs.aws.amazon.com</p></div></div><div class="lx l"><div class="md l lz ma mb lx mc ja lo"/></div></div></a></div></div></div>    
</body>
</html>