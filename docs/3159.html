<html>
<head>
<title>Node.js Rocks in Docker for Dev and Ops (Part 2)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js 在 Docker 中的应用(第 2 部分)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/nodejs-rocks-in-docker-for-dev-and-ops-part-2-4d72c6d14690#2019-05-19">https://medium.com/hackernoon/nodejs-rocks-in-docker-for-dev-and-ops-part-2-4d72c6d14690#2019-05-19</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk ir is it iu"><div class="bz el l di"><div class="iv iw l"/></div></figure></div><div class="ab cl ix iy hc iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hn ho hp hq hr"><p id="53d0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Kelsus 的乔恩·克里斯滕森和克里斯·希克曼以及 Secret Stache 的里奇·斯塔茨在 Bret Fisher 的 DockerCon 2019 年会议上结束了他们的系列，题为:<em class="kc">node . js Rocks in Docker for Dev and Ops</em>。</p><p id="6316" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><strong class="jg hv">展览的一些亮点包括:</strong></p><ul class=""><li id="f145" class="kd ke hu jg b jh ji jl jm jp kf jt kg jx kh kb ki kj kk kl dt translated">突发新闻:史蒂夫·辛格辞去首席执行官职务；前任 Hortonworks 首席执行官罗伯·比尔登将接任</li><li id="fceb" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">1–2 次预测:VMWare 将支付过高价格收购 Docker 对双方都是双赢</li><li id="da29" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">第 59 集节点文档最佳实践概述</li><li id="e989" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">节点流程管理:依赖 Docker 和 orchestrator 处理代码错误</li><li id="cfa3" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">容器中节点应用程序的健康关闭和正常停止的各个方面</li><li id="41ee" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">3 节点关闭选项:使用 Tini 修改 Docker 启动命令；将 Tini 打造为 Docker 形象；更新 Linux 信号的节点应用程序</li><li id="b331" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">连接跟踪:使用 Stoppable 包装 Node.js 服务器以实现关闭/关闭功能</li><li id="fa03" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">安全扫描和审计:识别漏洞以了解要更改的代码</li><li id="c256" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">使用 Docker Compose 利用健康检查</li><li id="70c9" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">生产清单:</li><li id="c69d" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">CMD 节点直接</li><li id="ace5" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">用...建造。dockerignore</li><li id="8ca1" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">捕获信号术语，正确关闭</li><li id="56bd" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">npm ci 或 NPM I-only =生产</li><li id="7fb0" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">构建期间的扫描/审核/测试</li><li id="a610" class="kd ke hu jg b jh km jl kn jp ko jt kp jx kq kb ki kj kk kl dt translated">健康检查(就绪性/活性)</li></ul><p id="b67f" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><strong class="jg hv">链接和资源</strong></p><p id="2f71" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.docker.com/dockercon/" rel="noopener ugc nofollow" target="_blank"> DockerCon 2019 </a></p><p id="ff1d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.docker.com/dockercon/2019-videos?watch=node-js-rocks-in-docker-for-dev-and-ops" rel="noopener ugc nofollow" target="_blank"> Bret Fisher's Node.js 在 Docker for Dev and Ops 中表现出色</a></p><p id="baf6" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank">码头工人</a></p><p id="4fe5" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></p><p id="0795" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://mobycast.fm/episode/node-js-rocks-in-docker-for-dev-and-ops-a-dockercon-2019-recap/" rel="noopener ugc nofollow" target="_blank"> Mobycast 第 59 集:Node.js 在 Docker for Dev and Ops(一个 Dockercon 2019 年回顾)</a></p><p id="bb72" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a></p><p id="a11d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://docs.docker.com/engine/swarm/" rel="noopener ugc nofollow" target="_blank">码头工人群</a></p><p id="3941" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank">码头工人作曲</a></p><p id="f05c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.vmware.com/" rel="noopener ugc nofollow" target="_blank"> VMware </a></p><p id="efa8" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://hortonworks.com/" rel="noopener ugc nofollow" target="_blank"> Hortonworks </a></p><p id="c593" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="http://www.jboss.org/" rel="noopener ugc nofollow" target="_blank"> JBoss </a></p><p id="81d3" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://spring.io/" rel="noopener ugc nofollow" target="_blank">春源</a></p><p id="9adb" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://aws.amazon.com/ecs/" rel="noopener ugc nofollow" target="_blank"> AWS ECS </a></p><p id="8179" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.npmjs.com/get-npm" rel="noopener ugc nofollow" target="_blank">安装 NPM </a></p><p id="b082" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://github.com/hunterloftis/stoppable" rel="noopener ugc nofollow" target="_blank">可停止</a></p><p id="f2bb" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://github.com/aquasecurity/microscanner" rel="noopener ugc nofollow" target="_blank">Aqua Security 公司的微型扫描仪</a></p><p id="6291" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="http://gluecon.com/" rel="noopener ugc nofollow" target="_blank">胶水图标</a></p><p id="ccfc" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://kelsus.com/" rel="noopener ugc nofollow" target="_blank">凯尔苏斯</a></p><p id="734c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><a class="ae kr" href="https://www.secretstache.com/" rel="noopener ugc nofollow" target="_blank">秘密 Stache 媒体</a></p></div><div class="ab cl ix iy hc iz" role="separator"><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc jd"/><span class="ja bw bk jb jc"/></div><div class="hn ho hp hq hr"><p id="e34e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated"><strong class="jg hv">转录</strong></p><p id="ea78" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Rich:在 Mobycast 的第 60 集，我们结束了 Bret Fisher 的 DockerCon 会话系列，Node.js 在 Docker for Dev 和 Ops 中表现出色。欢迎来到 Mobycast，这是一个关于云原生开发、AWS 和构建分布式系统的每周对话。让我们直接开始吧。</p><p id="5a05" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:欢迎你，克里斯。又是一集 Mobycast。</p><p id="9bc3" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:嘿，乔恩。欢迎光临。回来真好。</p><p id="8df3" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:你回来真好。今天，我们将播放您在 DockerCon 上听到的演讲的第二部分，这是 Bret Fisher 和 Node.js 在 Docker for Dev and Ops 中最受欢迎的演讲之一。这是第二部分。</p><p id="7f64" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">上周，我们讨论了一些节点 Dockerfile 最佳实践。也许你可以给我们快速回顾一下我们在那里讨论过的内容，然后我们将进入接下来的讨论。还有很多好东西。</p><p id="3f46" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:当然。首先，我希望我们做我们的，“你在做什么？”</p><p id="1f82" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:哦，当然。</p><p id="5a67" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:只是因为我有一些我很想说的事情。</p><p id="2d83" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:当然。</p><p id="b5be" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:这是个有趣的消息。就在最近，Docker 发布新闻稿称，“史蒂夫·辛格(Steve Singh)即将卸任首席执行官。”</p><p id="1d49" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我们只是在播客开始前聊天，我不知道你有这个秘密。</p><p id="c39c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。保持新鲜感和自发性。这不是非常令人震惊的消息，但却非常有趣，原因有很多。这是 DockerCon 发布新闻稿的一周后。就像，“嗯，在 DockerCon 之前做这个可能会更好，”然后，帮助做介绍，如果你愿意，并有过渡。根据 Docker 的说法，这笔交易并没有完全到位。这就是他们没有那样做的原因。</p><p id="9f76" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:这不是从巨大的安全开始的。他们离码头还有三天时间。</p><p id="00c5" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。所有这些因素都包括在内，比如幕后真正发生的事情。来自他们的官方消息是他们已经讨论了几个月，直到 DockerCon 之后才最终确定。但是谁知道呢？他们在 DCO 挑选的人是 Rob Bearden，他是 Hortonworks 的前首席执行官。此外，其他一些开源公司，如 SpringSource 和 JBoss。</p><p id="5d2f" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:哇。肯定会说企业语言的人。</p><p id="7744" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:是的，从开源的角度来看。那里很有趣。我再次重申这一点。我只是要放下预测。Docker 将被 VMware 收购。VMware 将为他们支付过高的价格，但他们会这样做。这可能是对虚拟机和容器的一记连击，先是 now […]、Kubernetes 创始人，然后是 Docker。</p><p id="e639" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">我认为这对两家公司来说实际上是双赢的。我认为 Docker 在这方面肯定处于困境，真的很难找到自己的立足点和商业模式。收购真的是他们唯一的出口。他们一直在说，“哦，是的。我们可以进行首次公开募股，到今年年底，我们将实现正现金流。”我只是不明白。</p><p id="c537" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我很想不同意，在节目中有一点冲突，但这听起来对我来说是正确的。</p><p id="e1b2" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。我们走着瞧。如果在六个月内，有一项收购，我不会感到惊讶。</p><p id="a364" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:我不记得你说的首席执行官的名字了，但看看他与 VMware 有什么样的关系会很有趣。</p><p id="d448" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:你提到这一点很有意思。他是 SpringSource 的首席运营官，该公司于 2009 年被 VMware 以 4.2 亿美元收购。Hortonworks 去年上市并被 Cloudera 收购时，他显然也在那里。他绝对有经验和能力。他了解事情的关系。再说一次，VMware，我认为这是下一次收购。</p><p id="df98" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:确实有道理。这将使 VMWare 成为虚拟机的来源。这就是你去的操作系统，而不是操作系统。</p><p id="fe2e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。就整个企业空间、混合云空间而言，它实际上是有意义的。我认为从一个生态系统来看，像这次收购，对他们来说是有意义的，我认为他们会为此支付过高的价格。仅从纯收入业务的角度来看，他们有望从中获利。他们赋予它的价值不会是 Docker 的独立价值。这将是 VMware 中的某个人可以从中提取并在此基础上构建的协同价值。</p><p id="c798" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:对。非常酷。现在，我们可以回顾一下第一部分。</p><p id="941e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:在第一部分，我们基本上讨论了 Node.js 应用程序的 Dockerfile 最佳实践。我们讨论了基础映像，这就是你要开始做的，有什么指导方针可以用来构建最好的 docker 文件。我们讨论了节点模块，并确保它不包含在您的映像中。我们有时会特别讨论编译本机代码。在节点模块中，正确地为目标平台构建节点非常重要。最后，我们讨论了最小特权原则，并特别利用了官方 Node.js Docker 映像附带的内置节点用户，这些映像虽然存在，但默认情况下并未启用。你必须在那里做一些工作，才能真正切换到使用它。这就是我们在第一部分讨论的内容。</p><p id="facf" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">在第二部分，我们要讲的内容更多。我想 Bret 的演讲有 40 分钟，可能是前 7 分钟。这是传统的码头工人。我去过的每个码头区，感觉这些会议就像从消防水管里喝水一样。他们总是 40 分钟长，但考虑到他们给你的材料数量，总感觉至少是 60 分钟，如果不是 90 分钟的话。</p><p id="2162" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:对。谈到他谈到的下一件事，看起来他谈到了节点流程管理。我真的对此很好奇，因为最近，随着容器突破的消息和几个月前在 Kelsus 营地，我们深入了一点。那不是 Mobycast，只是和我们自己的公司。我们做了一些工作来了解 Unix 进程是如何工作的。他们最近一直在我的脑海里。我很好奇你对容器的过程管理有什么看法。</p><p id="a71d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:这里有几个分支，都是在那个领域进行交易的。我们可以稍微深入研究一下。真正理解这里发生的事情是很有趣的。在一天结束时，这是一路向下的过程。</p><p id="9494" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">这样，就流程管理而言，您实际上不需要任何额外的东西。依靠你的管弦乐队为你做到这一点。依靠码头工人，依靠你的指挥者。</p><p id="f266" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">特别是 Node.js，它已经有了很多处理流程管理的工具。像永远，模块，PM2，节点，还有集群模块。在那个领域一直有流程管理。</p><p id="7c6c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:对于那些可能不是 Node 人的听众，我认为这是因为 Node 没有一个在出现错误时保持运行的管理流程。如果你在代码中犯了一个错误，代码就会自动关闭。它只是终止了进程。</p><p id="c313" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:当然。Node 本身没有内置的流程管理。如果你有[……]例外，你的过程就结束了。你的服务器搞定了。</p><p id="9210" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:我认为人们已经习惯了使用应用服务器，不管是 Java 服务器、Python 服务器还是 Ruby 服务器，都已经习惯了应用服务器能够很好地应对代码组件中出现的错误。</p><p id="9cdd" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。Node 相对于 Java 或。网也是。这些工具涌现出来，然后你看起来越来越像是与平台上的成熟结合在一起。</p><p id="82de" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">还有一些工具已经出现，用于支持和热重装代码。你在你的机器上开发，你运行它，你测试它，然后你去改变代码行。您有一个进程管理器，它负责监视文件系统[…]的变化，当它看到进程崩溃并重新启动时，它会拾取您刚才所做的更改。</p><p id="788e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">他的观点是，“你不需要在服务器上的生产中使用这些东西。相反，让你的乐队指挥和码头工人来帮你处理吧。”我们有健康检查之类的东西。您可以根据需要运行尽可能多的这些任务，让您的 orchestrator 来完成，但要注意的是，当您在本地开发时，可以使用 nodemon 之类的东西。这是有道理的，因为这将给你热重装之类的东西。</p><p id="da0e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">另一方面，使用 npm start，这是您的节点应用程序的反模式。不要使用 NPM 来启动你的应用程序，你应该通过节点进程直接启动它。我们会深入探讨为什么会这样。</p><p id="f7ce" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">这是在演讲的特定部分中，两个主要的观点。从那以后，就变成了“现在让我们谈谈关闭吧。这对节点应用程序的健康关闭意味着什么？”</p><p id="991e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:容器中的节点应用程序，对吗？</p><p id="53e1" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:这是一个容器中的节点应用程序。其中一些也适用于容器之外。具体来说，在容器内部运行时，它作为 PID 1 运行。这是系统或容器中的第一个过程，即初始化。这是典型的情况。您已经将您的节点应用程序分类。你正在根据那个图像旋转一个容器。这是第一个运行的东西。它以 PID 1 运行。这是初始化过程。</p><p id="10ce" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">只是一些背景信息。容器中的 init 进程基本上有两个任务。一个是收获僵尸进程。僵尸进程是失去了父进程的子进程。它还负责向子流程传递信号。一般来说，对于节点和节点应用程序，僵尸进程应该是个大问题。您实际上只是在运行您的节点应用程序，除非它只是在生成一堆其他进程。这可能不会是太大的问题。信号是重要的，尤其是[……]这种关闭在剧中出现。</p><p id="2b50" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">为了正确关机，Docker 使用 Linux 信号来控制应用程序。这是像 SIGINT，SIGTERM，然后 SIGKILL，原力退出，如果你愿意。SIGINT 和 SIGTERM，这些 Linux 信号允许您的应用程序优雅地停止。当您在特定的 Docker 进程上执行 Docker stop 时，这就是它正在做的事情。它向容器发送 SIGTERM，然后等待。默认情况下，将等待 10 秒钟，让该容器响应并关闭。如果没有，那就杀了它。它会使力退出。</p><p id="953e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">为了有一个优雅健康的关机，你需要一个容器来响应这些 Linux 信号。这就是 NPM 的由来。对于 NPM，它不响应 SIGINT 和 SIGTERM。如果你使用 npm start 来启动你的应用程序，你就有问题了。它根本不会被处理。</p><p id="d004" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:有意思。</p><p id="2ef7" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:这就是为什么 npm start 是反模式的。建议不要这样做。</p><p id="bf50" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:如果我能确保我理解，如果你做 npm 启动，那么你的节点应用程序运行在 NPM 拥有的进程中。然后，当你向同一个进程发送信号说，“好了，我们完成了。停下来，”NPM 很喜欢，“我很忙。我什么也没听到。”</p><p id="f942" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。在这种情况下，NPM 是 PID 1。</p><p id="14a7" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:是的。您实际的节点代码可能是它的一个子节点。好的，明白了。有意思。</p><p id="f24b" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:需要记住的另一件事是，Node 默认情况下不响应 SIGINT 和 SIGTERM，但是代码可以。你必须特别添加代码来处理它。这就产生了你能做什么。他在这里概述了三种可能变通方法和解决方案。第一个提议是临时或权宜之计。docker 1.13 版有一个–init 标志。它的作用是用一个轻量级的 init 系统包装你的进程。基本上叫 Tini，是一个模块。它被设计成 PID 1 运行并做正确的事情，</p><p id="c7be" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">当你运行你的容器时，docker start，如果你使用–init，它将基本上使用 Tini 作为 PID 1，现在你将响应 SIGINT 和 SIGTERM 信号。问题是，你可能无法控制这一点。我们在 AWS 中运行它，但我们使用 ECS。不是我们发出 docker 启动和停止命令的。实际上是 ECS 代理。</p><p id="87df" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">我还没有研究 ECS 代理与 Docker 的集成，以及它允许在您的任务定义文件中实际指定这种参数。</p><p id="c3c0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我想是的。</p><p id="9ffe" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:可能是这样，但那是你能做的。或者，如果您不能修改 docker start 命令，那么另一个解决方法是简单地将 Tini 构建到您的映像中，并将 Tini 设为 PID 1。</p><p id="963c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:你将通过 Tini 命令拥有你的 docker 文件的最后一个命令？</p><p id="1428" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:嗯。</p><p id="309d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:好的。</p><p id="0c40" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:这很简单，也很容易做到。您可以修复 PID 1 问题。也许最好的方法，也绝对是正确的方法是更新你的节点应用程序，确保它能正确地捕捉 Linux 信号。确保它有 SIGINT、SIGTERM 和 SIGKILL 的处理程序。其实 SIGINT 和 SIGTERM。</p><p id="c5b3" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:当然。</p><p id="d3e6" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:因为你……其中的一些，你不需要去杀人，很有可能。除此之外，不要用 NPM 启动你的应用。直接调用 Node 即可。让 Node 成为您的 PID 1，调用它来启动您的应用程序，然后正确处理这些信号。</p><p id="aecb" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:我可能是错的，但是如果有人在听，他们会说，“我真的想贡献一个开源更新。我想贡献一些比 Node 更重要的东西。”这可能是一个你可以做些事情的领域。感觉好像有一些通用的东西，如果你把它放入 Node 本身，几乎任何 Node 应用都会从中受益。我是说，这就像打电话找人帮忙一样。这就像是每个构建节点应用程序的人都应该编写额外的代码一样。为什么不是一个人在树根处做，而是一个人在他们的带领下做呢？</p><p id="51f0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。这里的好消息是，Node 中已经有了事件处理。这实际上很容易做到，而且实际上是样板代码，可以添加到这些 Linux 信号的事件处理程序中。不同寻常的是，对于每个应用程序来说，关闭是不同的。那些事件处理程序的主体实际上取决于您。你不想让别人做这件事。你必须做出这样的决定，“我要关门了。我需要做哪些清理工作？”</p><p id="48e8" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我同意。太真实了。从来不知道这是一般情况。</p><p id="7d24" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。这里没有很多工作要做。作为一种标准做法，人们不会去想它。你确实有这样的事情，10 秒钟后，Docker 就会杀了它。不是两三秒就关机，而是 10 秒就关机。这是其中的一件事，也许人们不会挠头问:“为什么每次关机都要 10 秒钟？为什么 Control-C 在控制台中不起作用？”</p><p id="7b33" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:对。我们下一步去哪里？</p><p id="a178" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:这是“更好的关机，更健康的关机”主题的一部分。谈了一下连接跟踪。基本上，您应该跟踪您的 HTTP 连接，并在关闭时向它们发送 FIN 数据包。这主要是为有关系的人准备的。当你处理这些信号之一时，你将调用 server close 来关闭你的服务器，默认情况下，Node.js 不会在它发生时关闭 keepalive 连接。它们会被突然终止。相反，你应该做的是你应该发送 FIN 包，以便这些东西以一种优雅的方式关闭。你还需要确保停止接受新的连接，关闭现有的连接等等。</p><p id="18b0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">实际上有一个开源的 NPM 模块。它叫做 stoppable，你可以用它来包装 Node.js 服务器对象。它提供了这种非常优雅的连接处理。当你叫它的时候它就停止了。它停止接受新的连接。它关闭现有的空闲连接，而不终止当前正在运行的请求。它允许这种真正优雅的关机，排空这些连接，然后关机。</p><p id="5f2d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我觉得这可能只是超级，超级简约，非常非常轻便的节点精神，没有假设人们可能会用它来导致这一点。我更倾向于“伙计，当你对你的软件有一些想法时，事情就容易多了。”这件事让我很困扰。stoppable 是一个你需要添加的独立模块，这也让我感到困扰。我宁愿心安理得，这不是我需要考虑的事情。事实上，你不得不考虑这几乎就像炫耀。就像是，“大家猜猜我想到了什么？”</p><p id="6c25" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:寻找小包。</p><p id="be8f" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:是的。我不知道。总之。</p><p id="e7ac" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:从第一天开始，ethos 节点就非常像 Unix 系统软件。把一件事做得非常非常好，然后你就可以有一个围绕它建立起来的其他工具的社区，这个社区建立了那个生态系统。我想现在，也许他们不想这么顽固，除了现在，他们有向后兼容之类的东西。如果他们去改变这种工作方式，那么他们会破坏什么？他们可能会打破很多，他们会为此受到很多批评。有些事情，是你在八、九、十年前做的决定，我们现在只能接受。</p><p id="bef1" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:对。伙计，我是不是觉得这个决定不是真的做的，而是像“哦，嘿。猜猜我们不做什么？我们只是不明白。我们刚刚发布了。我们很早就发布了，而且经常发布，”这是我们在发布时没有考虑的事情之一。</p><p id="b9c9" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">当每个人都记得为他们的 HTTP 连接，特别是他们的 keepalive 连接使用 stoppable 之后，接下来会发生什么呢？</p><p id="997b" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:Bret 的演讲中有很多关于多阶段 Docker 文件的讨论，以及如何使用这些文件将您的流程分成不同的阶段，如生产、开发、测试等等。这是一个很大的话题。我们在 Mobycast 的前几集里已经涉及到了这一点，也许我们将来还会做一个，但我们将跳过这一集，因为这是一个如此大的话题。我们可以谈论这个问题很长一段时间，今天我们想把它保持在一个合理的长度。</p><p id="d5b7" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">在讨论了多阶段 Docker 文件之后，我们谈了一下安全扫描和审计。这是那种不需要动脑筋就能做到的事情。应该只是牌桌赌注。这很容易做到。你可以免费做。您可以使用付费服务，但只是将审计和扫描作为 CI 流程的一部分。</p><p id="9d87" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">NPM 有审计，这是通过检查已知的安全漏洞。你也可以使用像 Aqua 的 MicroScanner 这样的工具进行全 CVE 扫描。这真的很简单，只需将其构建到您的 Docker 形象或 CI 流程的一部分。去做吧。确保你在做 CVE 扫描，这肯定是我们团队要努力的方向，确保我们在做这件事。</p><p id="12b7" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:是的。我认为发现自己没有做这件事的一个很好的方法是，如果你三次忽略 NPM 审计信息中的一条，那么你将永远忽略它。不要让自己像任何类型的代码编译器警告一样连续三次这样做。我相信每个人都有过这样的经历，当你第一次编译它的时候，你会想，“我们怎么能忍受 5000 个编译器警告呢？怎么会这样？”这是同样的事情，当有安全审计时，甚至当只有编译器对可能应该以不同方式编写的代码的警告时，情况会更严重。</p><p id="1119" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:是的，甚至只是知道，只是看到它的结果。如果你运行这些扫描仪，你会看到很多东西。有些是你可以改变的，有些是你无能为力的，因为它来自于依赖。但只要知道什么是服务，发生了什么，或者我们正在编写的特定代码，以及我们可以控制的依赖关系。只要知道这一点，只要有这些信息，你就可以在网上做出决定，你想要多严格就有多严格。你真的想要一个失败的构建还是继续下去？仅仅知道或拥有那种知识就是这里的[……]。</p><p id="2140" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:这些审计更新得太快了。在过去的几个月里，我一直在自己编写一些节点代码，但被吹走了。它清除了我所有的安全审计，这总是需要一点点工作，一点点更新，然后两天，三天或四天之后，它就像，“哇，又有一个。”它工作了。他们真的可以追踪。</p><p id="62ca" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:当然。它是在 CVE 级别完成的，来自所有不同的软件包等等。他们还在 NPM 内部对实际模块本身进行更多的安全评估，他们实际上是在那里进行安全审计和标记问题。</p><p id="c26c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Jon:还有一点也很重要，在 Babel 这样的地方，当你进行传输时，你实际上是在让某些东西接触你的每一段代码。确保没有恶意软件或类似的东西是非常重要的。</p><p id="9ab0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对，或者你正在安装的 NPM 模块不会获取或获取内存中的密码或凭证，然后将其转发给某个代理或其他什么东西。</p><p id="e20f" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:这不是单挑巴贝尔的重点。这只是一个问题，就像它可以访问任何东西一样。我们从安全扫描走向何方？</p><p id="385d" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:关于 Docker Compose 并将其作为您工作流程的一部分，尤其是它如何与 Docker health checks 之类的东西集成，有很多讨论。但我只是想指出，打破神话，码头工人作曲 YAML，它的版本。先是 V1，然后是 V2，现在是 V3。</p><p id="4ddc" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">一个误区是 V3 没有取代 V2。V2 的重点基本上是单节点开发测试，而 V3 实际上是针对多节点协调的。实际上是针对 Swarm 和 Kubernetes 这样的工具。这是为了实现部署和管理群集等目的而需要的额外资源。</p><p id="4914" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">这只是一个高层次的观点，只是意识到如果你是 V2 的 Docker Compose YAML，那没关系。你没错过什么。你不必觉得你必须升级到 V3。所以，有一点要记住。</p><p id="75a2" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我对此有些感觉，但我会让他们走。我会和 V2 在一起，不去想太多。</p><p id="a4fd" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:给你。我将只谈一点节点模块，特别是如何安装它。[…]装载的卷装载类型。同样，我们在过去已经讨论过这个问题，在容器和主机之间戳一个洞，你共享什么，并在容器承诺的隔离和实用程序之间找到正确的混合，开发人员可以灵活地做热重装之类的事情。</p><p id="2f39" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">它们只是各种各样的技术，您可以毫不费力地确保您不会陷入这样一种情况:您正在使用为一个目标编译的节点模块，但是您正在另一个目标上运行。这又是一个我们可以谈论很多的更大的话题之一，所以我们就到此为止吧。</p><p id="3173" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">这里有用的一个小技巧是，你在 Mac 上使用卷安装，只需使用 Docker Compose 文件中的专用装饰，因此当你在 Docker Compose 中指定卷时，如果你只是使用你想要的任何名称，然后调用并委托它，你将获得性能提升。去搜索一下。去多查查吧。作为一名保护者，如果您在 volume ounce 上使用授权模式，您可以获得更好的性能。</p><p id="0eaf" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:这很有意思。我认为这是完美的，因为它与我们之前做的关于不要让事情成为秘密的一集相吻合。我们今天真的没有时间来详细说明它是如何工作的，以及它为什么能提高性能，但是不要在没有理解这一点的情况下这样做。去阅读它，然后去做。</p><p id="b317" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:爬，走，跑。</p><p id="674e" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:是的。</p><p id="6ae3" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:Bret 演讲的最后一部分是关于健康检查，特别是如何通过 Docker Compose 利用 Docker 健康检查。同样，我们做了一整集的健康检查和[…]。我们可能会做另一集，内容是 Docker 运行状况检查、编写文件、如何设置这些文件、如何根据运行状况检查的内容指定依赖关系和条件，以及 Docker 编写文件中各种不同服务的运行状况检查状态。</p><p id="44e2" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">这里的重点是一定要意识到这一点。绝对要考虑其中的杠杆作用并加以利用。它是您与 Docker Compose 一起使用的基础设施的一部分，您应该仔细看看它。</p><p id="d9d6" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:非常酷。我想我们可以完成我一直想做的事情了。这是一份清单，我喜欢好的清单。我们有什么？</p><p id="7ed0" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:总之，这是你在 Docker 下运行 Node.js 的生产清单。第一，确保你直接指挥节点。这个我们谈过了。不要使用 npm 启动。相反，只需让 Node 成为您的 PID 1。正如我们所说的，确保你正在处理、捕获 SIGTERM 并正确关闭。</p><p id="dfa5" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">此外，确保当你构建时，确保你有一个 Docker 忽略文件，并明确确保节点模块之类的东西包含在那里。git 目录在里面，日志文件，还有其他的东西。只要确保无论你的构建机器上有什么，你构建的映像都是用 Docker ignore 文件排除了不应该出现在该映像中的内容。</p><p id="ad5c" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">清单的另一部分是确保您使用 NPM CI，或者您也可以使用唯一的生产命令标志执行 NPM-I。当你在做 NPM 失速时，你想要工件的最小代码集。使用这些选项。</p><p id="26df" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:我只是对此很好奇。我对 NPM 并不熟悉。NPM CI 或 NPM-我只生产，我猜，只知道把生产需要的部分投入生产。我猜想，无论是谁在编写你和 NPM 一起安装的库，都需要意识到这一点，并知道他们应该在生产版本和开发版本中放入什么之间的区别。如果他们没有意识到，那么可能没有什么不同。[……]特色吧？比如，你有没有在你的库中建立对这个的支持？我想这是我的问题。</p><p id="c777" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。我认为这真的只适用于你打包 JSON 文件。在 JSON 包中，你可以有你的依赖项，然后你有你的 deb 依赖项。生产只是安装依赖项，而不是 deb 依赖项。</p><p id="dd86" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:所以这不是图书馆的水平？</p><p id="0cc2" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">Chris:不。不要把它想成“哦，在后端 C 土地上，它现在是我的编译器上的一个优化标志，用来做像展开循环这样的事情，”或者类似的事情。不是那样的。</p><p id="f20b" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:好的，谢谢你。</p><p id="8afc" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:对。另一个要点是确保你正在扫描、审计和测试你的构建。我们谈到了 CVE 扫描和使用的东西，如 NPM 审计。真正利用你在 CICD 管道中可以利用的东西。然后，健康检查。再次，准备就绪和活力。看看 Docker，它的基础设施支持一个非常强大的健康检查生态系统，包括指定条件、如何在 Docker 合成文件中使用它们以及 Docker 本身，最终通过 Docker 进行健康检查。</p><p id="60b1" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:好的，非常好。非常感谢 Bret Fisher 为我们带来的精彩演讲。尽管我不在观众席上，但我从中学到了很多。谢谢你给我解释，克里斯。</p><p id="5fa5" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:是的，没错。这是一个非常好的演讲，一个非常可行的事情清单。我很喜欢这样，因为这里至少有两三件事，就像，“是的，我们必须去做。”</p><p id="5f38" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:对。我认为你听的多克顿演讲，还有一个我们可能会投入多克顿的水桶，做另一集。这可能会在下周出现。几周后我也要去 GlueCon。那真的很有趣，我已经经历了几年了。这其中应该也有一些有趣的东西值得一谈。</p><p id="0e9a" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:太棒了。</p><p id="b226" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:非常感谢你，克里斯。</p><p id="bbf9" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:好吧。谢谢你乔恩。</p><p id="70ea" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">乔恩:下周再聊。</p><p id="d218" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">克里斯:再见。</p><p id="a197" class="pw-post-body-paragraph je jf hu jg b jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb hn dt translated">亲爱的听众，你坚持到了最后。感谢您抽出时间，并邀请您继续与我们在线交流。这一集，以及显示笔记和其他宝贵的资源可在 mobycast.fm/60.如果你有任何问题或额外的见解，我们鼓励你给我们留下评论。谢谢你，我们下周再见。</p></div></div>    
</body>
</html>