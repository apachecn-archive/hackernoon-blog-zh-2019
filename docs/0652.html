<html>
<head>
<title>List Comprehension in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的列表理解</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/list-comprehension-in-python-c762ba1f523f?source=collection_archive---------5-----------------------#2019-01-28">https://medium.com/hackernoon/list-comprehension-in-python-c762ba1f523f?source=collection_archive---------5-----------------------#2019-01-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/82de93fe0a77a0ec55a1a8d915f85bfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vWntfgeKQaEdHb-AS8EPrg.png"/></div></div><figcaption class="id ie fg fe ff if ig bd b be z ek">List Comprehension in Python</figcaption></figure><div class=""/><p id="8013" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">对于任何语言的开发人员来说，列表都是一个基本的构件。Python也不例外。然而，起初，列表理解有时似乎令人困惑。由于它不是所有语言都提供的功能，它也可能是一个完全陌生的概念。一些包含列表理解的流行语言有JavaScript、Perl 6、C#当然还有Python。今天，我们将看看Python中的列表理解是如何工作的。在本帖中，我们将介绍以下概念:</p><ol class=""><li id="41eb" class="ke kf ij ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated"><strong class="ji ik">什么是列表理解？</strong></li><li id="aee2" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><strong class="ji ik">列表理解有什么好处？</strong></li><li id="0fda" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><strong class="ji ik">列表理解可以用在哪些方面？</strong></li><li id="a0e6" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated"><strong class="ji ik">列表理解有哪些常见的例子？</strong></li><li id="ceb1" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">与其他方法相比，什么时候应该使用列表理解法？</li></ol><h1 id="f290" class="ks kt ij bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">什么是列表理解？</h1><p id="714e" class="pw-post-body-paragraph jg jh ij ji b jj lq jl jm jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd hn dt translated">在最基本的层面上，列表理解是一种从现有列表创建列表的语法结构。这个定义描述了我们将在后面讨论的一些用途。如果我们不需要创建一个新的列表，而只是简单地打印现有列表的结果，那么列表理解对我们来说就没有什么帮助了。在Python中，有许多方法可以创建列表。</p><p id="9b5e" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">如果我们想创建一个空列表，我们可以这样声明:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="8325" class="me kt ij ma b fv mf mg l mh mi">listA = []</span></pre><p id="50c0" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">或者，如果我们想创建一个包含值的列表，我们可以这样做:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="e3aa" class="me kt ij ma b fv mf mg l mh mi">listB = [1,2,3,4]</span></pre><p id="3970" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">如果我们想创建一个包含10个条目的列表，每个条目都有相同的值，我们也可以这样做:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="d080" class="me kt ij ma b fv mf mg l mh mi">listB = [1]*10<br/># which would give us the following output:</span><span id="95d4" class="me kt ij ma b fv mj mg l mh mi">&gt;&gt;listB<br/>&gt;&gt;1,1,1,1,1,1,1,1,1,1</span></pre><p id="c7d7" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">创建列表的另一种方法是遍历现有列表，将第一个列表中的数据追加或插入到第二个列表中。</p><p id="2be7" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">这可能如下所示:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="0a8a" class="me kt ij ma b fv mf mg l mh mi">listA = []<br/>listB = [1,2,3,4,5,6]<br/>for number in listB:<br/>    if number % 2 == 0:<br/>        listA.append(number)</span></pre><p id="542e" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这里，我们在listB上循环，如果列表中的当前值是偶数，我们将它追加到listA。在这种情况下，我们可能会用到列表理解。让我们首先考虑如上所示的标准循环的语法，并将其与相同概念的语法进行比较，但使用的是列表理解。</p><p id="9dfc" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">for循环的语法:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="2c0e" class="me kt ij ma b fv mf mg l mh mi"><strong class="ma ik">for</strong> item <strong class="ma ik">in</strong> list:<br/>    <strong class="ma ik">if</strong> conditional:<br/>        expression</span></pre><p id="e4d9" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">相当于这个列表的理解:</strong></p><pre class="lv lw lx ly fq lz ma mb mc aw md dt"><span id="3c83" class="me kt ij ma b fv mf mg l mh mi">[ expression <strong class="ma ik">for</strong> item <strong class="ma ik">in</strong> list <strong class="ma ik">if</strong> conditional ]</span></pre><p id="1553" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">表达式是“输出”的一种花哨说法。所以在每种情况下，输出都是执行一些代码的结果。在我们之前的例子中，输出是向一个新的列表追加内容。</p><p id="30eb" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">同样，在传统的for循环和list comprehension中，我们有要迭代的列表、列表中的iterable项和一个条件语句。</p><p id="562d" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">让我们仔细看看for循环的语法:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/4b62df410c31c4dbb4a47c71ee32c59f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/1*DBaUiW3mN-pdb-WnJ6ADow.png"/></div></figure><p id="8f97" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在Python for循环中，我们会开始循环，如果需要的话，使用一个条件语句，然后执行一段代码。在上面的例子中，我们可以看到这是如何工作的，以及预期的输出。</p><p id="684f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">下面是我们如何用列表理解重写这段代码:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/791c7fbda179ae4b964c9a3b616705f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*G4Saik68tdHShhjVNSS_2A.png"/></div></figure><p id="5689" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这里，我们可以看到，我们在for循环中使用的所有相同的构件仍然存在于list comprehension中，尽管顺序略有不同。</p><h1 id="d6f5" class="ks kt ij bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">列表理解的优势</h1><p id="158f" class="pw-post-body-paragraph jg jh ij ji b jj lq jl jm jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd hn dt translated">这就把我们带到了下一个话题，列表理解的优势。上面的例子虽然没有for循环那么麻烦，但仍然可以合并成更简洁的格式。列表理解的一个很大的优点是，它们允许开发人员编写更少的代码，这些代码通常更容易理解。</p><p id="6178" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">下面是我们如何进一步简化上面的例子:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/ad7fa4ea4bf63e4e2552f3276cc6482d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*0vWfjv2g-H96SPknNTd13A.png"/></div></figure><p id="9b12" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在这里，我们将原来的三行代码简化为一行易于阅读的代码。</p><p id="0325" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">其他优势:</strong></p><p id="cd07" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">列表理解通常更快，但前提是它实际上被用来创建一个新列表。如果你注意到，在第一个例子中，我们在for循环中包含了append方法，但是当我们完全合并我们的代码时，我们把append方法完全排除在列表理解之外。这是因为在Python中，我们不需要从列表中加载append属性并作为函数调用它。相反，在理解中，生成一个专门的LIST_APPEND字节码，用于快速追加到结果列表中。</p><p id="2c96" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在第一个例子中，append()方法必须在循环的每次迭代中调用。这意味着，如果我们的循环有一百万次迭代，append()方法将被调用一百万次，这使得它明显比列表理解慢。</p><h1 id="0958" class="ks kt ij bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">列表理解怎么用？</h1><p id="80d8" class="pw-post-body-paragraph jg jh ij ji b jj lq jl jm jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd hn dt translated">上面的例子可以称为过滤函数。我们正在获取一个现有列表，并过滤该列表以创建一个新列表。在这种情况下，它是从一个序列中获取奇数或偶数，但同样可以在其他过滤场景中完成，如生成斐波那契数列。</p><p id="3945" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">这里有一些我们可能使用列表理解的其他方法的例子</p><ol class=""><li id="a62f" class="ke kf ij ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">筛选现有列表。</li><li id="5150" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">生成数据列表</li><li id="3ccd" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">展平多维列表</li></ol><p id="8cd6" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们已经看到了如何使用列表理解将一个列表的结果过滤到一个新列表中的例子。现在让我们看看如何使用它来生成数据列表。</p><p id="5108" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">在之前的一篇文章中，我们研究了如何使用python来确定贷款的复利。</p><p id="c73f" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">下面，我们将生成一个字典列表，每个字典包含一笔具有不同本金值和最终值的贷款。每个字典中的最终值将由我们给它的初始值决定，基于确定复利的公式。这个公式和字典生成将存储在它自己的函数中，但是在循环中，我们将基于循环中的一系列数字来调用函数。</p><p id="dc87" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">我们先来看看for循环:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/453e73111e7b67a42ee21a85d3925c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*9uRPehNCo-bpWfpAN_AqdA.png"/></div></figure><p id="86e9" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">每当for循环遍历我们设置的范围内的一个数字时，它就会调用newDict函数，并将该函数的结果附加到我们的newList中。如果我们打印结果，我们应该看到一个字典列表，每个字典都包含一组独特的数据。</p><p id="1e67" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果我们使用list comprehension重写，我们可以再次避免使用append方法，在如此大的数据集上节省宝贵的资源。</p><p id="bd68" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">下面是它的样子:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff mn"><img src="../Images/d2b7af363d80dab76bbfe18d1bccfd38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*4k3FxapQvYOMCNjnu745Jg.png"/></div></figure><p id="9846" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">最后，让我们看看如何使用列表理解来展平Python中的多维列表。</p><p id="8598" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">如果我们用for循环来做这件事，它可能需要一个嵌套循环，类似于下面的:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/80d7162dce22e42606670376c6b03153.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*gG4bB2DRFZhNhLQc13d9AA.png"/></div></figure><p id="845c" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">我们可以在这里看到，如果我们有一个名字列表的列表，并需要将它们快速展平为一个列表，这可能会很方便。</p><p id="71a7" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated"><strong class="ji ik">使用列表理解重写这段代码，如下所示:</strong></p><figure class="lv lw lx ly fq hw fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/2a8e4009059691bdf63e7631396b165a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*X5FuUc_qYc-nWfAVkri_9w.png"/></div></figure><h1 id="7425" class="ks kt ij bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp dt translated">什么时候应该使用列表理解？</h1><p id="5a22" class="pw-post-body-paragraph jg jh ij ji b jj lq jl jm jn lr jp jq jr ls jt ju jv lt jx jy jz lu kb kc kd hn dt translated">我们之前谈到了理解列表的优势之一。这个优点是我们不需要使用append()方法来创建一个新的列表。列表理解对于创建新列表非常有用，原因有很多:</p><ol class=""><li id="bb31" class="ke kf ij ji b jj jk jn jo jr kg jv kh jz ki kd kj kk kl km dt translated">代码更加简洁</li><li id="2405" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">代码通常可读性更好</li><li id="df39" class="ke kf ij ji b jj kn jn ko jr kp jv kq jz kr kd kj kk kl km dt translated">在大多数情况下，代码会运行得更快</li></ol><p id="82f5" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">然而，这可能并不总是需要的。在某些情况下，我们可能只需要在迭代时打印列表的结果。在这种情况下，列表理解并没有提供明显的优势。事实上，我们最终会创建一个不需要的列表，使用不必要的内存。当决定列表理解是否是比循环更好的选择时，我们可以简单地问自己，“我在创建一个新的列表吗？”</p><p id="e04b" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">如果答案是肯定的，那么列表理解可能是最好的方法。如果不是，比一个好的老式for循环可能更好。</p><p id="db20" class="pw-post-body-paragraph jg jh ij ji b jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd hn dt translated">感谢您的阅读，如果您有任何反馈，我很乐意听到。谢谢！</p></div></div>    
</body>
</html>