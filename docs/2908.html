<html>
<head>
<title>How to integrate 0x(ZRX) Protocol to setup your own Decentralized Exchange (DEX)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何集成 0x(ZRX)协议来设置您自己的分散交换(DEX)</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-integrate-0x-zrx-protocol-to-setup-your-own-decentralized-exchange-dex-584daea7a8f0#2019-05-07">https://medium.com/hackernoon/how-to-integrate-0x-zrx-protocol-to-setup-your-own-decentralized-exchange-dex-584daea7a8f0#2019-05-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="155d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">什么是 0x 协议，它是如何工作的？在此了解更多关于<strong class="it hv"> 0x 协议</strong>、其链外顺序中继和其分散式交换中继的信息，以及如何使用 0x 智能合约在以太坊公共或私有网络上创建自己的分散式交换(DEX)。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff jp"><img src="../Images/6341b9a5e1bee1fd6b71458454ada54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zHQnfeMWn9wvMG-tDn0HYw.gif"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Ref — <a class="ae kf" href="https://cdn-images-1.medium.com/max/800/1*1SkgYeGxQ6nn_WF6zgWVpQ.gif" rel="noopener">https://cdn-images-1.medium.com/max/800/1*1SkgYeGxQ6nn_WF6zgWVpQ.gif</a></figcaption></figure><h1 id="04b5" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">什么是 0x 协议？</h1><p id="9d53" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x 是一种开放协议，支持以太坊区块链上的对等资产交换。</p><p id="7969" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">开源基础设施使开发者和企业能够构建能够购买和交易加密令牌的产品，包括所有 ERC-20 和 ERC-721 资产。</p><blockquote class="lj lk ll"><p id="3bf7" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated"><strong class="it hv"> <em class="hu">我们先来讨论一下 0x 协议的特点。</em> </strong></p></blockquote><h1 id="830d" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">0x 协议的特点</h1><ul class=""><li id="8c02" class="lq lr hu it b iu le iy lf jc ls jg lt jk lu jo lv lw lx ly dt translated"><em class="lm">安全的非托管交易</em></li><li id="a67d" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated"><em class="lm">灵活的订单类型</em></li><li id="26b4" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated"><em class="lm">建立业务</em></li></ul><h2 id="ea03" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">安全的非托管交易</h2><p id="4f40" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">支持无存款或取款的钱包对钱包代币交易。</p><h2 id="945d" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">灵活的订单类型</h2><p id="40db" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">选择以特定的“立即购买”价格出售资产，或允许潜在买家投标。</p><h2 id="ba32" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">建立企业</h2><p id="75d0" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">通过对每笔交易收取费用，将你的产品货币化，并加入 0x 生态系统中越来越多的中间商。</p><p id="6a22" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">上面列出的 0x 协议的特征赋予了分散交换功能。</p><h1 id="d999" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">使用 0x 协议的好处-</h1><p id="9914" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x 协议使用模块化方法在以太坊区块链上交易资产。</p><ul class=""><li id="833c" class="lq lr hu it b iu iv iy iz jc ms jg mt jk mu jo lv lw lx ly dt translated"><strong class="it hv">稳健的智能合约</strong></li><li id="dcac" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated"><strong class="it hv">可扩展架构</strong></li><li id="d086" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated"><strong class="it hv">高效设计</strong></li></ul><h2 id="938a" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">稳健的智能合约</h2><p id="740b" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x Protocol 的智能合同已经通过了两轮严格的安全审核。</p><h2 id="4f8f" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">可扩展架构</h2><p id="df64" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x 的模块化管道使您能够通过可扩展的 API 插入自己的智能合同。</p><h2 id="0d61" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">高效设计</h2><p id="ed89" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x 的带链上结算的链外订单中继是一种非常有效的 P2P 交易方式。</p><p id="fc2f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">0x 协议可用于多种用例，如游戏和收藏品、市场预测、分散交易订单簿、分散贷款等等。</p><p id="66aa" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来是“0x 协议的智能合约”。0x 使用以太坊区块链的模块化智能合约，可以通过治理进行升级，而不会影响系统的其他组件，也不会导致活跃市场的中断。</p><h1 id="4810" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">0x 协议的智能合约</h1><ul class=""><li id="3580" class="lq lr hu it b iu le iy lf jc ls jg lt jk lu jo lv lw lx ly dt translated"><strong class="it hv">交换合同</strong></li><li id="5a31" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">ERC20 代理合同</li><li id="d0e6" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated"><strong class="it hv"> ERC721 代理合同</strong></li></ul><h2 id="4350" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">交换合同</h2><p id="4ffc" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">交换合同包含 0x 协议的业务逻辑，交换合同是-的入口点</p><ol class=""><li id="02c9" class="lq lr hu it b iu iv iy iz jc ms jg mt jk mu jo mv lw lx ly dt translated">填写订单</li><li id="de9c" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">取消订单</li><li id="183e" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">执行事务</li><li id="d9d0" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">验证签名</li><li id="3b99" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">在系统中注册新的资产代理合同</li></ol><h2 id="47f9" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">ERC20 代理合同</h2><p id="9a46" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">此合同负责代表用户转让 ERC20 令牌。因此，每个用户(ERC20 令牌持有者)必须批准此合同，以代表令牌持有者转移令牌。</p><h2 id="854e" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">ERC721 代理合同</h2><p id="9997" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">本合同负责转让 ERC721 令牌。因此，每个用户(ERC721 令牌持有者)必须批准此合同，以代表令牌持有者转移令牌。</p><p id="5b9c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">为了部署和使用 0x 智能合同，您需要安装 0x.js。0x.js 是与 0x 协议交互的 JavaScript 库。通过使用该库，您可以轻松调用智能合约来创建、取消或验证订单，检查 ERC20 和 ERC721 令牌持有者的限额和余额。</p><h2 id="c4a9" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">为了深入了解 0x 协议并了解 0x 智能合约如何工作，我们需要了解 0x 协议的架构</h2><p id="303e" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">0x 协议使用一种方法，我们称之为<strong class="it hv">带链上结算的链外顺序中继</strong>。在这种方法中，加密签名的订单通过任意通信信道从区块链广播出去。感兴趣的交易方可以将一个或多个此类订单注入 0x protocol 的交易合同，以直接在区块链上执行和结算交易。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="fe ff mw"><img src="../Images/96015760849c1b18807e8a5dd00f24e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1dgMY5OEtz0QdclC"/></div></div><figcaption class="kb kc fg fe ff kd ke bd b be z ek">Exchange ERC20-ERC20 tokens — 0x-github(source)</figcaption></figure><p id="279f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">可以使用 0x 协议来交换任何 ERC20 或 ERC721 资产。上图显示了当收款人在 exchange 智能合约中提交订单时，代币的实际转移是如何发生的。</p><ol class=""><li id="4c38" class="lq lr hu it b iu iv iy iz jc ms jg mt jk mu jo mv lw lx ly dt translated">收单人使用交易所智能合约的<strong class="it hv"> fillOrder() </strong>函数向交易所智能合约提交已签署的订单。</li><li id="b666" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">兑换合同将区块链结算订单传递给相应的 ERC 20 代理合同，代币的实际转让将在代理合同中进行。<strong class="it hv">注</strong>:造单人和收单人在向交易所提交订单前必须批准 ERC 20 代理合同。</li><li id="610a" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">从代理合同中调用相应的制单人令牌合同的 transferFrom() 函数。</li><li id="3a2b" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">在制造商的 ERC20 令牌合同失败时恢复。</li><li id="ac28" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">从 from 代理合同恢复到交换合同。</li><li id="4dfe" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">交换合同将订单从交换合同传递到 ERC 20 代理合同。</li><li id="4fa1" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">从代理合同中调用相应的收款人令牌合同的 transferFrom() 函数。</li><li id="fc66" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">接受方 ERC20 令牌合同失败时的恢复。</li><li id="9726" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">从 from 代理合同恢复到交换合同。</li><li id="322a" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo mv lw lx ly dt translated">返回填充结果。</li></ol><blockquote class="lj lk ll"><p id="5361" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated"><strong class="it hv">现在我们将讨论使用 0x.js 库在以太坊上交易资产的 0x 智能合约的工作和部署。</strong></p></blockquote><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="2e7e" class="me kh hu my b fv nc nd l ne nf"><strong class="my hv">Use npm install 0x.js — save to install and save 0x.js library</strong></span></pre><h1 id="e215" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">0x 智能合同的部署步骤</h1><p id="4cce" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">为了与智能合约进行交互，我们需要部署 0x 智能合约，并使用智能合约的地址通过 0x.js 库与智能合约进行交互。</p><h2 id="006d" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">Exchange 智能合同</h2><p id="ab60" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在<a class="ae kf" href="https://github.com/0xProject/0x-monorepo/tree/development/contracts/exchange" rel="noopener ugc nofollow" target="_blank"> git </a>上提供源代码，部署 exchange 智能合约，其中 exchange 合约的构造者不需要任何参数，智能合约的部署者(msg.sender)将是智能合约的所有者。</p><p id="e720" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有者将能够在交换合同中设置资产代理合同地址。</p><h2 id="523b" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">ERC20 代理合同</h2><p id="3aff" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在<a class="ae kf" href="https://github.com/0xProject/0x-monorepo/blob/development/contracts/asset-proxy/contracts/src/ERC20Proxy.sol" rel="noopener ugc nofollow" target="_blank"> git </a>上提供源代码，部署 ERC 20 代理契约，其中代理契约的构造者不需要任何参数，智能契约的部署者(msg.sender)将是智能契约的所有者。</p><p id="8df6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">业主将能够在 ERC 20 代理合同中设置交换合同地址。</p><h2 id="ff83" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">ERC721 代理合同</h2><p id="efca" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated">在<a class="ae kf" href="https://github.com/0xProject/0x-monorepo/blob/development/contracts/asset-proxy/contracts/src/ERC721Proxy.sol" rel="noopener ugc nofollow" target="_blank"> git </a>上提供源代码，部署 ERC 20 代理契约，其中代理契约的构造者不需要任何参数，智能契约的部署者(msg.sender)将是智能契约的所有者。</p><p id="6f67" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">业主将能够在 ERC 20 代理合同中设置交换合同地址。</p><p id="cff7" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">部署上述合约后，您需要将<strong class="it hv">交易所</strong>合约的地址设置为<strong class="it hv">资产代理</strong>合约，将<strong class="it hv">资产代理</strong>合约的地址设置为<strong class="it hv">交易所</strong>合约。调用函数<strong class="it hv">registerAssetProxy(</strong>address ERC 20/ERC 721 proxy contract<strong class="it hv">)</strong>函数 exchange smart contract 将存储 assetproxy contract 的地址，实际交易将在该地址进行，以交换令牌。</p><p id="dfd6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">此功能只能由 exchange 智能合约的所有者调用。</p><ul class=""><li id="e901" class="lq lr hu it b iu iv iy iz jc ms jg mt jk mu jo lv lw lx ly dt translated">要在 ERC 20 代理合同上注册交换合同，调用函数<strong class="it hv">addauthorizeddaddress(</strong>address ExchnageContract<strong class="it hv">)。</strong></li><li id="94db" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">要从 ERC 20 代理契约中删除交换契约，调用函数<strong class="it hv">removeauthorizeddaddress(</strong>地址交换契约<strong class="it hv">)。</strong></li></ul><p id="cd7b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用交换地址和资产代理契约通过 0x.js 库进行交互。</p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="b6e3" class="me kh hu my b fv nc nd l ne nf">let contractConfig = {</span><span id="5cef" class="me kh hu my b fv ng nd l ne nf">contractAddresses: {</span><span id="997e" class="me kh hu my b fv ng nd l ne nf">erc20Proxy: proxyAddress.toLowerCase(),</span><span id="23d3" class="me kh hu my b fv ng nd l ne nf">erc721Proxy: "0x1d7022f5b17d2f8b695918fb48fa1089c9f85401",</span><span id="4184" class="me kh hu my b fv ng nd l ne nf">exchange: exchangeAddress.toLowerCase() },</span><span id="f826" class="me kh hu my b fv ng nd l ne nf">networkId: networkId</span><span id="3824" class="me kh hu my b fv ng nd l ne nf">};</span><span id="5409" class="me kh hu my b fv ng nd l ne nf">const contractWrappers = new ContractWrappers(holderEngine, contractConfig);</span></pre><p id="7b7d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，您可以与部署在您的专用或测试网络上的 0x 协议智能合约进行交互。记住添加 RPC 子提供程序来与区块链交互。</p><h2 id="7bd2" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">为了与 0x.js 库交互，我们需要导入如下所示的相关包，最终目标是使用 0x.js 库从 maker 帐户创建订单，接受者将使用 fillOrder()函数提交以交换令牌。</h2><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="62e1" class="me kh hu my b fv nc nd l ne nf"><em class="lm">const {assetDataUtils,BigNumber,ContractWrappers,</em></span><span id="880e" class="me kh hu my b fv ng nd l ne nf"><em class="lm">generatePseudoRandomSalt,orderHashUtils,signatureUtils,} <br/>= require(‘0x.js’);</em></span><span id="1d17" class="me kh hu my b fv ng nd l ne nf"><em class="lm">const TX_DEFAULTS = { gas: 400000 };</em></span><span id="ba5b" class="me kh hu my b fv ng nd l ne nf"><em class="lm">const { RPCSubprovider, Web3ProviderEngine } = require(‘0x.js’);</em></span><span id="b85a" class="me kh hu my b fv ng nd l ne nf">let newWallet = new ethers.Wallet(wallet.signingKey.privateKey, prov);</span><span id="a84d" class="me kh hu my b fv ng nd l ne nf">const holderWallet = new PrivateKeyWalletSubprovider(</span><span id="b0ff" class="me kh hu my b fv ng nd l ne nf">wallet.signingKey.privateKey.slice(2)</span><span id="aba6" class="me kh hu my b fv ng nd l ne nf">);</span></pre><h2 id="cc0e" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">添加 RPC 子提供程序</h2><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="3a3c" class="me kh hu my b fv nc nd l ne nf">const holderEngine = new Web3ProviderEngine();</span><span id="0f53" class="me kh hu my b fv ng nd l ne nf">holderEngine.addProvider(holderWallet);</span><span id="7456" class="me kh hu my b fv ng nd l ne nf">holderEngine.addProvider(new RPCSubprovider(providerUrl));</span><span id="8a2e" class="me kh hu my b fv ng nd l ne nf">holderEngine.start();In new RPC sub provider add custom URL to connect with blockchain that may be ethereum main net, test net or private blockchain.</span></pre><h2 id="c4cc" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">获取协定地址并实例化协定包装</h2><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="b77d" class="me kh hu my b fv nc nd l ne nf">/ Instantiate ContractWrappers with the provider<br/>const contractWrappers = new ContractWrappers(holderEngine, contractConfig);</span><span id="ecb8" class="me kh hu my b fv ng nd l ne nf">const web3Wrapper = new Web3Wrapper(providerEngine);</span><span id="c496" class="me kh hu my b fv ng nd l ne nf">const contractAddresses = getContractAddressesForNetworkOrThrow(100);//networkID</span></pre><p id="25f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">选择网络 id 以从 0x.js 库中获取智能合同的地址。</p><p id="9169" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">现在，制作者(代币 a 的持有者)将创建要约，接受者(代币 B 的持有者)将提交或填写订单以交换代币。</strong></p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="d834" class="me kh hu my b fv nc nd l ne nf">//contract Addresses<br/>const tokenAAddress = contractAddresses.tokenA;</span><span id="7d40" class="me kh hu my b fv ng nd l ne nf">const tokenBAddress = contractAddresses.tokenB;</span><span id="5dc3" class="me kh hu my b fv ng nd l ne nf">const exchange = contractAddresses.exchange;</span></pre><p id="4ab2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有的地址都是从 0x.js 库中获取的。</p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="f36a" class="me kh hu my b fv nc nd l ne nf">//encode all the necessary information about an asset into a single hexadecimal string</span><span id="bcba" class="me kh hu my b fv ng nd l ne nf">const makerAssetData = assetDataUtils.encodeERC20AssetData(tokenAAddress);</span><span id="49f7" class="me kh hu my b fv ng nd l ne nf">const takerAssetData = assetDataUtils.encodeERC20AssetData(tokenBAddress);</span><span id="6fda" class="me kh hu my b fv ng nd l ne nf">const makerAssetAmount = Web3Wrapper.toBaseUnitAmount(new BigNumber(100), DECIMALS);</span><span id="fd55" class="me kh hu my b fv ng nd l ne nf">const takerAssetAmount = Web3Wrapper.toBaseUnitAmount(new BigNumber(200), DECIMALS);</span><span id="4eb7" class="me kh hu my b fv ng nd l ne nf">const NULL_ADDRESS = ‘0x0000000000000000000000000000000000000000’;</span><span id="ad3d" class="me kh hu my b fv ng nd l ne nf">const ZERO = new BigNumber(0);<br/>const DECIMALS = 18;</span></pre><p id="3dce" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在，制造商和接受者应批准相应的资产代理合同，以代表制造商和接受者转让代币。</p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="590e" class="me kh hu my b fv nc nd l ne nf">//Allow ERC20 Proxy to move tokenA on behalf of makerAccount<br/>const makerApprovalTxHash = await contractWrappers.erc20Token.setUnlimitedProxyAllowanceAsync(<br/>    <!-- -->tokenAAddress<!-- -->,<br/>    maker,<br/>);<br/>await web3Wrapper.awaitTransactionSuccessAsync(makerApprovalTxHash);</span><span id="b78b" class="me kh hu my b fv ng nd l ne nf">// Allow ERC20 Proxy to move tokenB on behalf of takerAccount<br/>const takerApprovalTxHash = await contractWrappers.erc20Token.setUnlimitedProxyAllowanceAsync(<br/>    <!-- -->tokenBAddress<!-- -->,<br/>    taker,<br/>);<br/>await web3Wrapper.awaitTransactionSuccessAsync(takerApprovalTxHash);</span></pre><p id="d704" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">在制定者和接受者分别代表制定者和接受者批准资产代理合同以转让代币后。现在，创建者将创建一个要约并签署要约链，接受者将提交要约以交换令牌。</p><h2 id="3d6f" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">创建订单</h2><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="4501" class="me kh hu my b fv nc nd l ne nf">const order = {</span><span id="884e" class="me kh hu my b fv ng nd l ne nf">exchangeAddress: exchangeAddress,</span><span id="903a" class="me kh hu my b fv ng nd l ne nf">makerAddress: maker,//address of maker</span><span id="0980" class="me kh hu my b fv ng nd l ne nf">takerAddress: taker,//address of taker</span><span id="61e4" class="me kh hu my b fv ng nd l ne nf">senderAddress: taker,//address of sender</span><span id="ab8d" class="me kh hu my b fv ng nd l ne nf">feeRecipientAddress: NULL_ADDRESS,//fee in the form of native currency of platform</span><span id="67df" class="me kh hu my b fv ng nd l ne nf">expirationTimeSeconds: randomExpiration,//expire time of order</span><span id="4513" class="me kh hu my b fv ng nd l ne nf">salt: generatePseudoRandomSalt(),//random no to differentiate order</span><span id="bcb0" class="me kh hu my b fv ng nd l ne nf">makerAssetAmount,//maker asset amount</span><span id="5e2b" class="me kh hu my b fv ng nd l ne nf">takerAssetAmount,//taker asset amount</span><span id="f5d3" class="me kh hu my b fv ng nd l ne nf">makerAssetData,//encoded address of tokenA</span><span id="eca4" class="me kh hu my b fv ng nd l ne nf">takerAssetData,//encoded address of tokenB</span><span id="eb30" class="me kh hu my b fv ng nd l ne nf">makerFee: ZERO,//fee if required</span><span id="b003" class="me kh hu my b fv ng nd l ne nf">takerFee: ZERO,//fee if required</span><span id="8418" class="me kh hu my b fv ng nd l ne nf">};</span></pre><p id="b65e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们已经创建了一个报价；我们会在调用 0x.js 库的 getOrderHash()函数得到订单 hash 后，再来签署 offer。根据<a class="ae kf" href="https://github.com/ethereum/EIPs/pull/712/files" rel="noopener ugc nofollow" target="_blank"> EIP712 </a>规范对订单进行哈希处理。</p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="c36c" class="me kh hu my b fv nc nd l ne nf">const orderHashHex = orderHashUtils.getOrderHashHex(order);</span></pre><p id="428c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">获得订单散列后，订单生成者将使用 0x.js 库的 ecSignHashAsync()函数签署订单。</p><pre class="jq jr js jt fq mx my mz na aw nb dt"><span id="da3f" class="me kh hu my b fv nc nd l ne nf">const signature = await signatureUtils.ecSignHashAsync(providerEngine, orderHashHex, maker);</span><span id="14a2" class="me kh hu my b fv ng nd l ne nf">const signedOrder = { …order, signature };</span><span id="e04e" class="me kh hu my b fv ng nd l ne nf">await contractWrappers.exchange.validateFillOrderThrowIfInvalidAsync(signedOrder, takerAssetAmount, taker);</span><span id="6967" class="me kh hu my b fv ng nd l ne nf">try{</span><span id="fd73" class="me kh hu my b fv ng nd l ne nf">txHash = await contractWrappers.exchange.fillOrderAsync(signedOrder, takerAssetAmount, taker, {TX_DEFAULTS,});</span><span id="e45e" class="me kh hu my b fv ng nd l ne nf">var transaction = await web3Wrapper.awaitTransactionSuccessAsync(txHash);}catch(error){}}</span></pre><p id="2aa0" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们快速回顾一下到目前为止我们所学的内容，然后通过介绍已经建立在 0x 基础上的项目来结束我们的讨论。</p><h1 id="21c1" class="kg kh hu bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld dt translated">概述</h1><ul class=""><li id="0ed2" class="lq lr hu it b iu le iy lf jc ls jg lt jk lu jo lv lw lx ly dt translated">0x 协议概述</li><li id="b519" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">0x 协议的特点</li><li id="12c9" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">0x 智能合同的运作</li><li id="2e62" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">Maker 使用 0x.js 创建报价</li><li id="8393" class="lq lr hu it b iu lz iy ma jc mb jg mc jk md jo lv lw lx ly dt translated">接受者向交易所提交报价</li></ul><p id="dd01" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">下面列出了已经使用 0x 协议实现 DEX 和 order book 的项目。</strong></p><h2 id="bd4e" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">分散交换</h2><p id="013f" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated"><a class="ae kf" href="https://radarrelay.com/" rel="noopener ugc nofollow" target="_blank">雷达继电器</a>、<a class="ae kf" href="https://paradex.io/" rel="noopener ugc nofollow" target="_blank"> paradex </a>、<a class="ae kf" href="https://www.starbitex.com/" rel="noopener ugc nofollow" target="_blank"> Star bitex </a>、<a class="ae kf" href="https://www.ledgerdex.com/" rel="noopener ugc nofollow" target="_blank"> LedgerDex </a></p><h2 id="2d6d" class="me kh hu bd ki mf mg mh km mi mj mk kq jc ml mm ku jg mn mo ky jk mp mq lc mr dt translated">定货簿</h2><p id="998f" class="pw-post-body-paragraph ir is hu it b iu le iw ix iy lf ja jb jc lg je jf jg lh ji jj jk li jm jn jo hn dt translated"><a class="ae kf" href="https://openrelay.xyz/" rel="noopener ugc nofollow" target="_blank">打开继电器</a></p></div><div class="ab cl nh ni hc nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="hn ho hp hq hr"><blockquote class="lj lk ll"><p id="cb84" class="ir is lm it b iu iv iw ix iy iz ja jb ln jd je jf lo jh ji jj lp jl jm jn jo hn dt translated">感谢阅读。<em class="hu">希望本指南对您有用，并帮助您理解集成 0x(ZRX)协议以设置您自己的分散式交换(DEX)的过程</em>并且<a class="ae kf" href="https://hackernoon.com/how-is-security-token-different-from-utility-token-5d12d7109740" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv"> <em class="hu">也请查看我之前的博文</em> </strong> </a> <strong class="it hv"> <em class="hu">。<br/> </em> </strong> <a class="ae kf" href="https://www.quillhash.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">在 QuillHash </strong> </a> <strong class="it hv">，</strong>我们了解 0x 协议，并拥有一个开发团队，他们可以在 0x(ZRX)协议之上开发<a class="ae kf" href="https://www.quillhash.com/blockchain/0x-protocol-blockchain-development" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">区块链应用，如 dApp、DeFi、DEX </strong> </a>。<br/> <strong class="it hv">我们再来讨论一下 0x(ZRX)协议，在我的电报手柄上 ping 我—</strong><a class="ae kf" href="https://t.me/bigrkg" rel="noopener ugc nofollow" target="_blank"><strong class="it hv">https://t.me/bigrkg</strong></a></p></blockquote></div></div>    
</body>
</html>