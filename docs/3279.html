<html>
<head>
<title>What Role do DeviceCheck and SafetyNet play in App Authentication?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DeviceCheck和SafetyNet在App认证中起什么作用？</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/what-role-do-devicecheck-and-safetynet-play-in-app-authentication-a0c525599d19?source=collection_archive---------2-----------------------#2019-05-24">https://medium.com/hackernoon/what-role-do-devicecheck-and-safetynet-play-in-app-authentication-a0c525599d19?source=collection_archive---------2-----------------------#2019-05-24</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="0e4a" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">内置Android和iOS移动安全检查</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/a489db6df29c82c391f43391eefe14c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zxfk2KANb-NpsAhL"/></div></div></figure><p id="4401" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">iOS和Android都提供内置的设备级检查，有助于防止移动应用程序滥用。在iOS上，<a class="ae kr" href="https://developer.apple.com/documentation/devicecheck" rel="noopener ugc nofollow" target="_blank"> DeviceCheck </a>提供了一种将每个应用的一些信息与每个设备相关联的方法，在Android上，<a class="ae kr" href="https://developer.android.com/training/safetynet" rel="noopener ugc nofollow" target="_blank"> SafetyNet </a>设备认证试图确保设备在安全的环境中运行。这些都是有用的功能，但它们只是深入的移动应用和API保护方案的一小部分。</p><h1 id="e826" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">相信我！</h1><p id="7a34" class="pw-post-body-paragraph jv jw hu jx b jy lk iv ka kb ll iy kd ke lm kg kh ki ln kk kl km lo ko kp kq hn dt translated">对于今天几乎所有有用的应用程序，通过API与远程服务交互是主要的操作模式。虽然安全问题似乎经常集中在用户身份验证上，但是必须考虑所有可能的攻击面，以确保安全的API事务。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lp"><img src="../Images/48c071430df0d8312317df36e711c363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CXa525QxNx_ICC2g"/></div></div></figure><p id="cfec" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">从API服务的角度来看，所有API调用都必须受到应用程序和服务之间的安全通道的保护。尽管<a class="ae kr" href="https://www.cloudflare.com/learning/ssl/transport-layer-security-tls/" rel="noopener ugc nofollow" target="_blank"> TLS </a>对信道进行加密，但聪明的攻击者可能会危及设备或网络上的证书授权，因此难以实现和维护的<a class="ae kr" href="https://www.owasp.org/index.php/Certificate_and_Public_Key_Pinning" rel="noopener ugc nofollow" target="_blank">证书锁定</a>应该用来防止中间人攻击。</p><p id="4488" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">其次，API服务必须确信设备上运行的应用程序是可信的。所有假冒或篡改的应用程序必须被拒绝。进行API调用时，最常见的应用程序身份验证形式是古老的(也是易受攻击的)静态API密钥。无论隐藏得多么好，如果黑客攻击API服务足够有价值，API密钥就会被窃取，要么通过在应用程序中进行逆向工程，要么通过在未固定的通道中观察它。</p><p id="13f1" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">可靠的篡改检测技术是必不可少的，关于应用程序真实性的决定应该总是在应用程序本身之外做出，以防检查本身被篡改或绕过。<a class="ae kr" href="https://approov.io/product" rel="noopener ugc nofollow" target="_blank">远程移动应用证明技术</a>可以防范假冒和篡改的应用。应用程序的包、安装的代码和运行时环境都是篡改的潜在攻击面。</p><p id="1bfc" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">如果你有一个安全的通道和一个可信的应用程序，那么终于到了担心如何使用像<a class="ae kr" href="https://oauth.net/2/" rel="noopener ugc nofollow" target="_blank"> OAuth2 </a>和<a class="ae kr" href="https://openid.net/connect/" rel="noopener ugc nofollow" target="_blank"> OIDC </a>这样的协议结合生物识别和/或<a class="ae kr" href="https://en.wikipedia.org/wiki/Multi-factor_authentication" rel="noopener ugc nofollow" target="_blank">多因素认证</a>来正确认证和授权用户的时候了。但是不要忘记，用户身份验证的强度取决于其他因素。例如，标准的OAuth2使用秘密进行应用认证，这不足以防止假冒应用窃取用户凭证信息。</p><p id="9f13" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">从长远来看，应用程序认证是当今移动API安全链中最薄弱的环节。那么，iOS上的<a class="ae kr" href="https://developer.apple.com/documentation/devicecheck" rel="noopener ugc nofollow" target="_blank"> DeviceCheck </a>和Android上的<a class="ae kr" href="https://developer.android.com/training/safetynet" rel="noopener ugc nofollow" target="_blank"> SafetyNet </a>在帮助应用认证方面做得如何呢？</p><h1 id="8489" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">iOS设备检查</h1><p id="3293" class="pw-post-body-paragraph jv jw hu jx b jy lk iv ka kb ll iy kd ke lm kg kh ki ln kk kl km lo ko kp kq hn dt translated">DeviceCheck为开发人员提供了一种识别设备的可靠方法，并且可以为每个应用程序存储有关设备的两位信息。即使删除并重新安装应用程序、用户使用不同的凭据登录或执行系统重置，这些标记也会保留。典型的标志可能包括“该设备曾被入侵过吗？”或者“此应用的免费推广期是否已用于此设备?”？。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/12933cd3e2c85b5ebadd457706a87d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2vR3PSetjS9fQ5BT"/></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Source: <a class="ae kr" href="https://fluffy.es/devicecheck-tutorial/" rel="noopener ugc nofollow" target="_blank">Uniquely identify iOS device using DeviceCheck</a></figcaption></figure><p id="3dc6" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">DeviceCheck API生成一个临时令牌，向Apple唯一标识设备。您的API服务将这个令牌与来自Apple的认证密钥相结合，请求或更新由每个设备位标识的标志，并维护一个时间戳来指示它们上次被修改的时间。</p><p id="e633" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">DeviceCheck实现向用户保证了他们的隐私，即使是在唯一地识别设备时。开发者只收到一个短暂的令牌，而不是设备序列号或任何其他识别信息。类似地，苹果存储了标志和时间戳，但是不知道标志是如何被解释的。</p><p id="7d09" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">从应用程序认证的角度来看，这些标志可以用来识别受损的设备或应用程序，但仍由开发人员来确定应用程序的真实性。由于应用程序和设备条件经常变化，存储最后一次真实性检查的能力只有很小的价值。</p><p id="b28c" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated"><a class="ae kr" href="https://info.approov.io/device-security" rel="noopener ugc nofollow" target="_blank"> DeviceCheck和approv</a>提供了有关DeviceCheck如何与最先进的应用认证系统进行比较的更多信息。</p><h1 id="6b4d" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">安卓安全网</h1><p id="80cc" class="pw-post-body-paragraph jv jw hu jx b jy lk iv ka kb ll iy kd ke lm kg kh ki ln kk kl km lo ko kp kq hn dt translated">在Android上，SafetyNet作为Google Play服务的一部分安装在Google批准的Android设备上。它由四个API组成:</p><ul class=""><li id="e214" class="lv lw hu jx b jy jz kb kc ke lx ki ly km lz kq ma mb mc md dt translated">SafetyNet证明API —将设备环境与已知设备配置文件进行比较，以确定设备是否是根设备或有潜在危害。</li><li id="27c0" class="lv lw hu jx b jy me kb mf ke mg ki mh km mi kq ma mb mc md dt translated">SafetyNet安全浏览API:检查URL是否与Google已知的恶意URL相匹配。</li><li id="89f7" class="lv lw hu jx b jy me kb mf ke mg ki mh km mi kq ma mb mc md dt translated">SafetyNet reCAPTCHA API:分析用户与应用程序的交互，以提供关于用户是否实际上是机器人的置信度估计。</li><li id="2fc3" class="lv lw hu jx b jy me kb mf ke mg ki mh km mi kq ma mb mc md dt translated">SafetyNet验证应用程序API:检查设备上是否安装了任何已知的恶意应用程序。</li></ul><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mj"><img src="../Images/0839ba8e6a15742d864b9353714cc5ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3OwRs_uGe3a7SLtL"/></div></div><figcaption class="lr ls fg fe ff lt lu bd b be z ek">Source: <a class="ae kr" href="https://www.mulliner.org/collin/publications/InsideAndroidsSafetyNetAttestation_mulliner44con.pdf" rel="noopener ugc nofollow" target="_blank">Inside Android SafetyNet Attestation</a></figcaption></figure><p id="dfe0" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">使用设备证明API时，应用程序会调用设备证明程序，设备证明程序会向Google Play服务发送运行时间测量值。谷歌评估这些信息，并向应用程序提供密码安全评估。然后，应用程序将评估转发给API服务进行验证。评估决策是在应用程序之外做出的，这是一种良好的做法，应用程序可以使用评估决策来关闭移动银行应用程序，如果它运行在根或非标准的电话设置上。</p><p id="5260" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">应用程序不仅要不断评估设备的健康状况，还要评估应用程序本身的健康状况。安全网提供有限但有效的运行时检查；然而，大多数应用程序将需要额外的，更多的应用程序特定的检查。SafetyNet通过报告应用程序签名提供了一些针对假冒或篡改应用程序的保护，但完整的应用程序证明提供了更多针对零时差和更多动态漏洞的保护。另请注意，使用安全网需要访问Google Play服务。</p><p id="ad2a" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated"><a class="ae kr" href="https://info.approov.io/device-security" rel="noopener ugc nofollow" target="_blank"> SafetyNet和approv</a>提供了有关SafetyNet如何与最先进的应用程序认证系统进行比较的更多信息。</p><h1 id="967b" class="ks kt hu bd ku kv kw kx ky kz la lb lc ja ld jb le jd lf je lg jg lh jh li lj dt translated">更进一步</h1><p id="0157" class="pw-post-body-paragraph jv jw hu jx b jy lk iv ka kb ll iy kd ke lm kg kh ki ln kk kl km lo ko kp kq hn dt translated">DeviceCheck和SafetyNet是移动API深度安全防御方法的潜在有用部分。DeviceCheck使您能够将您的应用程序或设备标记为不可信，如果您可以通过其他方式检测到这一点。SafetyNet为设备的运行时环境提供了更加结构化的检查。这两种服务都可以增强，但不能替代可靠的应用证明技术。</p><p id="cd90" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">要更深入地了解以移动API为重点的安全性，请查看OWASP AppSec California 2019的<a class="ae kr" href="https://hackernoon.com/preventing-mobile-app-and-api-abuse-a3c50c72efc2" rel="noopener ugc nofollow" target="_blank">防止移动应用和API滥用演示</a>。</p></div><div class="ab cl mk ml hc mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="hn ho hp hq hr"><p id="8ff8" class="pw-post-body-paragraph jv jw hu jx b jy jz iv ka kb kc iy kd ke kf kg kh ki kj kk kl km kn ko kp kq hn dt translated">感谢阅读！有关移动API安全性的更多信息，请查看<a class="ae kr" href="https://approov.io" rel="noopener ugc nofollow" target="_blank">www . approv . io</a>。</p></div></div>    
</body>
</html>