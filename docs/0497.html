<html>
<head>
<title>How to Build a Web-based Donation Manager System from Scratch in PHP &amp; MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用 PHP 和 MySQL 从零开始建立一个基于网络的捐赠管理系统</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-a-web-based-donation-manager-system-from-scratch-in-php-mysql-f276e6a16ac3#2019-01-20">https://medium.com/hackernoon/how-to-build-a-web-based-donation-manager-system-from-scratch-in-php-mysql-f276e6a16ac3#2019-01-20</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/183fffac4312d40085fd3ecbd02e34b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UQsAH4eaIP_kS20O"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@katyukawa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kat Yukawa</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="e0b1" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">介绍</h1><p id="0432" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">慈善组织可以使用此捐赠管理器应用程序来管理捐赠流程，并确保准确的数据输入和与捐赠者的无缝通信。此外，我们将在申请中包含一份附有图表的捐赠总结报告。</p><h1 id="d9e1" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">系统需求</h1><ul class=""><li id="5537" class="ld le hu kh b ki kj km kn kq lf ku lg ky lh lc li lj lk ll dt translated">PHP 7+版本</li><li id="435c" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">MySQL 或 MariaDB</li><li id="c2a6" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">phpGrid</li><li id="ecaf" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">phpChart(第二部分)</li></ul><h1 id="5044" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">数据库概述</h1><p id="e72a" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">我们的捐赠管理系统有四个对象。</p><ul class=""><li id="6d8c" class="ld le hu kh b ki lr km ls kq lt ku lu ky lv lc li lj lk ll dt translated">捐赠者—捐赠者的个人信息。</li><li id="9764" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">捐赠——为特定活动捐赠的金额</li><li id="a528" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">活动—捐赠活动信息</li><li id="c783" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc li lj lk ll dt translated">组织—管理捐赠的组织</li></ul><p id="be37" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们的数据库简单明了。每个表都是代表上述对象之一的实体。</p><p id="8197" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">编程术语—对象或实体</p><blockquote class="lz"><p id="a7e0" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">实体是一个数据库术语，通常由数据库模式中的一个表来表示。对象是面向对象的编程术语，通常映射到数据库表。</p></blockquote><p id="f314" class="pw-post-body-paragraph kf kg hu kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc hn dt translated">在我们的数据模型中，<code class="eh mo mp mq mr b">donations</code>用于存储关于捐赠的信息；活动用于收集活动数据和活动信息；管理活动的组织存储在<code class="eh mo mp mq mr b">org</code>中。</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ms"><img src="../Images/ecac5aa0954d0efbd782bd85ffd3581e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ud1egq9f2rWEEXUv."/></div></div></figure><h1 id="aca2" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">建立捐赠管理器数据库</h1><p id="a991" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">从<a class="ae jg" href="https://phpgrid.com/example/step-step-guide-building-donation-manager-scratch-php-part/" rel="noopener ugc nofollow" target="_blank">这里</a>获取<code class="eh mo mp mq mr b">donation_manager_db.sql</code> SQL 脚本，然后使用<a class="ae jg" href="https://hackernoon.com/tagged/mysql" rel="noopener ugc nofollow" target="_blank"> MySQL </a>工具如 MySQL Workbench 或 Sequel Pro 执行 SQL 脚本。这将创建一个名为<code class="eh mo mp mq mr b">donation_manager</code>的新数据库和我们在本教程中需要的表。</p><h1 id="6ef8" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">设置 phpGrid</h1><p id="3cb2" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">数据网格是一种类似电子表格的数据表，它显示代表存储在数据库表中的记录和字段的行和列。这些网格为最终用户提供了从 web 页面读写数据库表的能力。</p><p id="23b1" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><a class="ae jg" href="https://hackernoon.com/tagged/phpgrid" rel="noopener ugc nofollow" target="_blank"> phpGrid </a> datagrid 组件为我们处理所有内部数据库<strong class="kh hv"> CRUD </strong> ( <strong class="kh hv"> C </strong> reate，<strong class="kh hv"> R </strong> emove，<strong class="kh hv"> U </strong> pdate，和<strong class="kh hv"> D </strong> elete)操作，用最少的代码提供更快更好的结果。</p><p id="e9ec" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">在继续之前，请务必<a class="ae jg" href="https://phpgrid.com/download/" rel="noopener ugc nofollow" target="_blank">下载一份免费的 phpGrid </a>副本。</p><p id="f453" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">要安装 phpGrid，请按照下列步骤操作:</p><ol class=""><li id="7ddd" class="ld le hu kh b ki lr km ls kq lt ku lu ky lv lc mx lj lk ll dt translated">解压缩 phpGrid 下载文件。</li><li id="43dc" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc mx lj lk ll dt translated">将<code class="eh mo mp mq mr b">phpGrid</code>文件夹上传到 phpGrid 文件夹。</li><li id="a477" class="ld le hu kh b ki lm km ln kq lo ku lp ky lq lc mx lj lk ll dt translated">通过配置<code class="eh mo mp mq mr b">conf.php</code>文件完成安装。</li></ol><p id="e226" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">在我们开始编码之前，我们必须在 phpGrid 配置文件<code class="eh mo mp mq mr b">conf.php</code>中包含以下信息。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><h1 id="89ea" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">UI 设计</h1><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff na"><img src="../Images/94ed7c8153bbe42ccdc7f4fca15ff5a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XQNqjljEU77UswOt"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@halgatewood?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Hal Gatewood</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6c76" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">基本设计很简单。它由一个单级顶部菜单栏和一个数据网格组成。在报告部分，我们将使用 phpChart 添加图表。</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nb"><img src="../Images/6a04841c42347f36d8841a1fcde50d77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hjjoJSt3bIbiVWNx."/></div></div></figure><h1 id="8d82" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">菜单</h1><p id="1715" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">捐赠管理器有四个菜单项。每个项目代表捐赠管理器数据库中的一个相应的表。</p><p id="cd08" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">菜单的包含文件存储在名为<code class="eh mo mp mq mr b">menu.php</code>的<code class="eh mo mp mq mr b">inc</code>文件夹中。菜单的代码很简单。为了突出重点，我们就不赘述了。请随意查看存储在<code class="eh mo mp mq mr b">inc</code>文件夹中的内容。</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nc"><img src="../Images/28de78f0136c0d79f4b8b44580d84035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*leiSNt4vb457lXH6."/></div></div></figure><p id="f91c" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们还添加了一个名为<code class="eh mo mp mq mr b">Reports</code>的菜单项，我们将在本教程的第二部分讨论它。</p><h1 id="4d14" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">捐赠页面</h1><p id="cb91" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">我们的第一个捐赠管理器页面是捐赠页面，在这个页面上，我们显示从数据网格中的<code class="eh mo mp mq mr b">Donations</code>表中检索到的捐赠信息。</p><p id="c461" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">记住捐赠管理器数据库中的每个表都有<code class="eh mo mp mq mr b">id</code>作为主键。因此，我们可以用下面两行代码轻松创建我们的第一个数据网格。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="8a18" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">phpGrid 101 —一个基本的数据网格</p><blockquote class="lz"><p id="d01c" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">1.在第一行，创建要显示的 phpGrid 对象。</p><p id="8dee" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">2.然后调用<a class="ae jg" href="https://phpgrid.com/documentation/display/" rel="noopener ugc nofollow" target="_blank"> display() </a>在网页上呈现结果数据网格。</p></blockquote><p id="b9df" class="pw-post-body-paragraph kf kg hu kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc hn dt translated">你可以在这里了解更多关于基本数据网格如何工作的信息<a class="ae jg" href="https://phpgrid.com/example/example-1-a-basic-php-datagrid-2/" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="632f" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">下面是我们的<code class="eh mo mp mq mr b">Donations</code>数据网格的样子:</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nd"><img src="../Images/77d3068077ba4c6d19b76eec143a7cf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-4ezU-jLi_3GFF5F."/></div></div></figure><p id="bf71" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">现在，我们将对捐款数据网格做一些改进。</p><p id="d077" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">首先，我们不需要显示主键<code class="eh mo mp mq mr b">Donations</code>因为它只在内部使用，对我们的用户没有意义。我们可以使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_hidden/" rel="noopener ugc nofollow" target="_blank"> set_col_hidden() </a>来隐藏它。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="3115" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">接下来，<code class="eh mo mp mq mr b">Amount</code>列是一个货币值。我们可以使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_currencycol_name-prefix-suffix-thousandsseparator-decimalseparator-decimalplaces2-defaultvalue0-00/" rel="noopener ugc nofollow" target="_blank"> set_col_currency() </a>将该列格式化为货币显示。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="9175" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们还希望我们的数据网格显示人类可读的活动描述和捐赠者姓名，而不是在列<code class="eh mo mp mq mr b">CampaignId</code>和<code class="eh mo mp mq mr b">DonorId</code>中显示无意义的整数。使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_edittype/" rel="noopener ugc nofollow" target="_blank"> set_col_edittype() </a>函数，我们可以很容易地分别从<code class="eh mo mp mq mr b">Campaigns</code>和<code class="eh mo mp mq mr b">Donors</code>表中获得活动描述和捐赠者姓名。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="0a14" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们还想使捐款网格可编辑。我们可以通过添加以下行来实现这一点:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="bedb" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">捐赠数据网格的完整代码:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="144e" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">以下是捐款数据网格在我们改进后的样子:</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/2368c22a5d2f42d86ec661d9f45d1319.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tXDI02rbiDZ5pWxv."/></div></div></figure><p id="a233" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">看起来不错，不是吗？让我们继续前进！</p><h1 id="f63e" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">捐赠者页面</h1><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nf"><img src="../Images/e65be7061553f15b574a240e74897336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XDufkcfHndTgmeQ4"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@akshayspaceship?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Akshay Chauhan</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="85ea" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">第二页是捐赠者页。它包含捐赠者名单和捐赠摘要信息。</p><p id="fb03" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">表<code class="eh mo mp mq mr b">Donors</code>和<code class="eh mo mp mq mr b">Donations</code>之间存在<a class="ae jg" href="https://en.wikipedia.org/wiki/Master%E2%80%93detail_interface" rel="noopener ugc nofollow" target="_blank">一对多</a>关系，因为一个捐赠者可以进行一次或多次捐赠。<code class="eh mo mp mq mr b">Donations</code>表有一个外键字段<code class="eh mo mp mq mr b">donorid</code>，它引用了<code class="eh mo mp mq mr b">Donors</code>表。</p><p id="a355" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们可以使用一个<a class="ae jg" href="https://www.w3schools.com/sql/sql_join_inner.asp" rel="noopener ugc nofollow" target="_blank">内部连接</a>来填充我们的捐赠数据网格，从而连接两个表<code class="eh mo mp mq mr b">Donors</code>和<code class="eh mo mp mq mr b">Donations</code>。</p><p id="7fca" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><em class="ng"> SQL 101 —内部连接</em></p><blockquote class="lz"><p id="f102" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">使用内部联接在两个数据库表之间创建一对多关系。“一对多”关系中“一”方的表应该有一个主键列。另一个表有一个外键，指向第一个表中的主键。</p></blockquote><p id="b9ae" class="pw-post-body-paragraph kf kg hu kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc hn dt translated">这是我们完整的 SQL 语句。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="b464" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">为了让我们的数据看起来更有趣，我们通过用<a class="ae jg" href="https://www.w3schools.com/SQl/func_mysql_concat.asp" rel="noopener ugc nofollow" target="_blank"> CONCAT </a>连接名<code class="eh mo mp mq mr b">FirstName</code>和姓<code class="eh mo mp mq mr b">LastName</code>字段来创建全名，CONCAT 是一个连接两个或更多字符串的 SQL 函数。在 MySQL 中，它具有以下语法:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="fff6" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">为了创建捐献者的全名，我们还在名字后面添加了一个空白字符，在名字和姓氏之间添加了一个空格。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="2ca9" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们还想显示给定捐赠者捐赠的总额。这就是 SQL <a class="ae jg" href="https://en.wikipedia.org/wiki/Aggregate_function" rel="noopener ugc nofollow" target="_blank">聚合函数</a>派上用场的地方。在 MySQL 中，可以使用<a class="ae jg" href="https://www.w3schools.com/sql/sql_count_avg_sum.asp" rel="noopener ugc nofollow" target="_blank"> SUM() </a>函数返回数值列的总和。我们把我们的总数命名为<code class="eh mo mp mq mr b">TotalDonation</code>。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="1cb4" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">因为我们想要显示汇总信息，所以我们需要添加一个<a class="ae jg" href="https://www.w3schools.com/sql/sql_groupby.asp" rel="noopener ugc nofollow" target="_blank"> GROUP BY </a>语句，该语句对结果集中相同的数据进行分组。在这种情况下，我们假设如果<code class="eh mo mp mq mr b">Address</code>和<code class="eh mo mp mq mr b">Email</code>字段相同，这意味着它们指的是同一个施主。GROUP BY 子句将记录分组到每个组的摘要行中。它通常与 COUNT、MAX、MIN、SUM 和 AVG 等聚合函数一起使用。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="b2f7" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">综上所述，这是我们将用来创建数据网格的最终 SQL 语句。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="aef8" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">如果您想知道 SQL 语句中的<code class="eh mo mp mq mr b">d</code>和<code class="eh mo mp mq mr b">dn</code>是干什么的，它们是 SQL 表的别名。</p><p id="d4db" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><em class="ng"> SQL 101 —表别名</em></p><blockquote class="lz"><p id="5b9f" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">SQL 别名是用于表或列的临时名称。别名通常用于提高列名或表名的可读性。它只在查询期间存在。</p></blockquote><h2 id="ebaa" class="nh ji hu bd jj ni nj nk jn nl nm nn jr kq no np jv ku nq nr jz ky ns nt kd nu dt translated">捐赠者数据网格</h2><p id="0d0d" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">下面是我们的<code class="eh mo mp mq mr b">Donors</code>数据网格的代码。它由一个使用上述 SQL 语句的<a class="ae jg" href="https://phpgrid.com/documentation/construct-our-phpgrid/" rel="noopener ugc nofollow" target="_blank"> phpGrid 构造函数</a>和<a class="ae jg" href="https://phpgrid.com/documentation/display/" rel="noopener ugc nofollow" target="_blank"> display() </a>函数组成。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="5ef8" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们的捐赠数据网格看起来像这样:</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff nv"><img src="../Images/339e243354586a31fc516be07ddf3fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mEywTWYNgQlINQjY."/></div></div></figure><p id="623b" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">让我们添加一些东西来提高它的可用性。</p><p id="5d82" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">首先，第一列显示表的主键<code class="eh mo mp mq mr b">id</code>。我们不需要向用户展示这一点。让我们使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_hidden/" rel="noopener ugc nofollow" target="_blank"> set_col_hidden() </a>函数来隐藏它。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="b617" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">每个捐赠者都有一个电子邮件。我们可以使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_format/" rel="noopener ugc nofollow" target="_blank"> set_col_format() </a>轻松地将这个字段变成一个电子邮件超链接。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="2507" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><code class="eh mo mp mq mr b">TotalDonation</code>列是一个货币字段。我们可以使用<a class="ae jg" href="https://phpgrid.com/documentation/set_col_currencycol_name-prefix-suffix-thousandsseparator-decimalseparator-decimalplaces2-defaultvalue0-00/" rel="noopener ugc nofollow" target="_blank"> set_col_currency() </a>将该列更改为货币格式。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="c171" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">并且<code class="eh mo mp mq mr b">Name</code>和<code class="eh mo mp mq mr b">TotalDonation</code>字段都应该是只读的。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="8271" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">最后，我们使用<a class="ae jg" href="https://phpgrid.com/documentation/enable_editedit/" rel="noopener ugc nofollow" target="_blank"> enable_edit() </a>函数使捐助者数据网格可编辑(除了我们刚刚设置为只读的字段)。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="5f46" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">完整的捐赠者数据网格代码:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="f7bd" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">下面是修改后捐赠者数据网格的样子(编辑窗口打开)。</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/945c5894832b48eb1de0b73732307925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JIxrhavi6Xp-8bj6."/></div></div></figure><h2 id="9347" class="nh ji hu bd jj ni nw nk jn nl nx nn jr kq ny np jv ku nz nr jz ky oa nt kd nu dt translated">捐赠详细信息网格</h2><p id="e2c7" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">由于表<code class="eh mo mp mq mr b">Donors</code>和<code class="eh mo mp mq mr b">Donations</code>之间存在一对多的关系，我们可以使用 phpGrid <a class="ae jg" href="https://phpgrid.com/example/master-detail-grid/" rel="noopener ugc nofollow" target="_blank"> master detail </a>特性轻松呈现这种关系。</p><p id="6ed3" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><em class="ng">数据网格 101 —主细节</em></p><blockquote class="lz"><p id="c8a9" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">两个数据模型之间的一对多关系可以使用数据网格以主从格式呈现。</p></blockquote><p id="b1e0" class="pw-post-body-paragraph kf kg hu kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc hn dt translated">细节网格是一个常规的 phpGrid 数据网格对象，可以使用与任何其他数据网格相同的方法，如描述标题、排序和更新等。详细网格是根据从父(主)网格中选择的行动态呈现的。</p><p id="937c" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们将简单地重用我们在本教程前面创建的<code class="eh mo mp mq mr b">Donations</code>数据网格中的代码。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="a356" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">注意，我们没有包括最后一行<code class="eh mo mp mq mr b">$dgDonations-&gt;display()</code>。</p><p id="b106" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">最后，我们使用<a class="ae jg" href="https://phpgrid.com/documentation/set_masterdetail/" rel="noopener ugc nofollow" target="_blank"> set_masterdetails() </a>在代码中设置主从关系。第二个参数是细节表<code class="eh mo mp mq mr b">Donations</code>中定义的外键。第三个参数是主表<code class="eh mo mp mq mr b">Donors</code>中定义的外键。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="a7a5" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">还提供了一系列 phpGrid 主-细节演示以及如何在本教程范围之外使用它们。</p><h1 id="f604" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">活动页面</h1><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ob"><img src="../Images/6738c00266a521bed56959c6dc95095f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UunyyDBjSPF_3TmZ"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/@rawpixel?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">rawpixel</a> on <a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0b49" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">活动页面包含活动信息和捐赠详情。请注意，一个给定的活动可以从一个或多个捐赠者那里获得许多捐赠。同样，我们可以使用 phpGrid 的<a class="ae jg" href="https://phpgrid.com/documentation/set_masterdetail/" rel="noopener ugc nofollow" target="_blank">主-细节</a>特性，就像我们在捐助者页面上所做的那样。</p><p id="4843" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">让我们从活动开始。</p><p id="e68a" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">由于表<code class="eh mo mp mq mr b">Campaigns</code>和<code class="eh mo mp mq mr b">Donations</code>具有一对多的关系，我们可以通过创建一个<a class="ae jg" href="https://www.w3schools.com/sql/sql_join_inner.asp" rel="noopener ugc nofollow" target="_blank">内部连接</a>来连接这两个表。注意，<code class="eh mo mp mq mr b">c</code>和<code class="eh mo mp mq mr b">dn</code>分别是<code class="eh mo mp mq mr b">Campaigns</code>和<code class="eh mo mp mq mr b">Donations</code>表的 SQL 表别名。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="7cf2" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们还想显示特定活动的捐赠总额。同样，我们可以使用 SQL 聚合函数<a class="ae jg" href="https://www.w3schools.com/sql/sql_count_avg_sum.asp" rel="noopener ugc nofollow" target="_blank"> SUM() </a>从<code class="eh mo mp mq mr b">Donations</code>表中返回<code class="eh mo mp mq mr b">Amount</code>列的总和。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="9f0c" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">除了收到的捐款总额之外，衡量捐款活动成功与否的一个关键方法是捐款总数。这里，我们介绍另一个有用的 SQL 聚合函数，叫做<a class="ae jg" href="https://www.w3schools.com/sql/sql_count_avg_sum.asp" rel="noopener ugc nofollow" target="_blank"> COUNT() </a>。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="759d" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">COUNT()函数，顾名思义，计算 SELECT 语句中返回的行数。我们给它起名叫<code class="eh mo mp mq mr b">DonationCount</code>。</p><p id="0d5c" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">最后，由于我们想要显示活动摘要信息，我们将添加一个<a class="ae jg" href="https://www.w3schools.com/sql/sql_groupby.asp" rel="noopener ugc nofollow" target="_blank"> GROUP BY </a>语句，该语句将记录分组并将其总计打印到每个组的摘要行中。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="26c1" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><em class="ng"> SQL 101 —分组依据&amp;聚合</em></p><blockquote class="lz"><p id="9906" class="ma mb hu bd mc md me mf mg mh mi lc ek translated">每当您需要使用诸如 COUNT、MAX、SUM 和 AVG 之类的 SQL 聚合函数时，请使用 GROUP  BY。</p></blockquote><p id="1ce0" class="pw-post-body-paragraph kf kg hu kh b ki mj kk kl km mk ko kp kq ml ks kt ku mm kw kx ky mn la lb lc hn dt translated">我们活动数据网格的完整 SQL SELECT 语句如下所示:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="814b" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">接下来，我们将包含一些 phpGrid 函数来为我们的活动数据网格增添活力。</p><p id="d394" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">首先，正如我们对其他人所做的那样，让我们隐藏列<code class="eh mo mp mq mr b">id</code>。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="d478" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">然后，让我们以货币格式显示我们的<code class="eh mo mp mq mr b">TotalDonation</code>字段。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="de89" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">不要忘记使活动网格可编辑。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="41cc" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">最后，我们通过添加函数<a class="ae jg" href="https://phpgrid.com/documentation/enable_global_search/" rel="noopener ugc nofollow" target="_blank"> enable_global_search() </a>来添加一个全局搜索，该函数支持对任何可搜索列进行多字段全局搜索。这就够了。</p><pre class="mt mu mv mw fq oc mr od oe aw of dt"><span id="6e57" class="nh ji hu mr b fv og oh l oi oj">$dgCamp-&gt;enable_global_search(true);</span></pre><p id="215c" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">这就是活动网格。让我们来看看:</p><figure class="mt mu mv mw fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ne"><img src="../Images/17f5183e3841b9401628825237a1aa5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IkF-xFXYn7wMgxSP."/></div></div></figure><p id="fac4" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">活动网格的完整代码:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><h2 id="f132" class="nh ji hu bd jj ni nw nk jn nl nx nn jr kq ny np jv ku nz nr jz ky oa nt kd nu dt translated">捐赠明细网格</h2><p id="11ce" class="pw-post-body-paragraph kf kg hu kh b ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc hn dt translated">还记得我们之前提到的<code class="eh mo mp mq mr b">Campaigns</code>和<code class="eh mo mp mq mr b">Donations</code>表是一对多的关系吗？我们可以使用 phpGrid <a class="ae jg" href="https://phpgrid.com/example/master-detail-grid/" rel="noopener ugc nofollow" target="_blank"> master detail </a>特性来呈现它们的关系，就像我们对<code class="eh mo mp mq mr b">Donors</code>和<code class="eh mo mp mq mr b">Donations</code>表所做的那样。</p><p id="98b8" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">我们将简单地重用我们在本教程前面制作的用于<code class="eh mo mp mq mr b">Donations</code>数据网格的相同代码。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="ad1a" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">注意，我们没有包括最后一行<code class="eh mo mp mq mr b">$dgDonations-&gt;display()</code>。</p><p id="f00a" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">最后，我们使用<a class="ae jg" href="https://phpgrid.com/documentation/set_masterdetail/" rel="noopener ugc nofollow" target="_blank"> set_masterdetails() </a>在代码中设置主从关系。活动是主网格，捐款是明细网格。</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="3f81" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">因此，活动页面的完整代码是:</p><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="my mz l"/></div></figure><p id="81d9" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated">这标志着创建本教程所需的数据网格的代码已经结束。然而，我们还没有完成。我们还需要创建一个页面—报告。我们将在第二部分讨论这一部分。</p><p id="b611" class="pw-post-body-paragraph kf kg hu kh b ki lr kk kl km ls ko kp kq lw ks kt ku lx kw kx ky ly la lb lc hn dt translated"><strong class="kh hv">敬请期待，获取</strong> <a class="ae jg" href="https://phpgrid.com/example/step-step-guide-building-donation-manager-scratch-php-part/" rel="noopener ugc nofollow" target="_blank"> <strong class="kh hv">源代码</strong> </a> <strong class="kh hv">跳转开始！</strong></p><h1 id="baee" class="jh ji hu bd jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dt translated">感谢阅读。如果你喜欢这篇文章，请点击那个按钮👏帮助其他人找到它。</h1></div><div class="ab cl ok ol hc om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="hn ho hp hq hr"><figure class="mt mu mv mw fq iv"><div class="bz el l di"><div class="or mz l"/></div></figure></div></div>    
</body>
</html>