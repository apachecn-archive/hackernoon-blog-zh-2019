# 无服务器成本大辩论(无服务器！=无成本)

> 原文：<https://medium.com/hackernoon/the-great-serverless-cost-debate-serverless-costless-1a0b6c07cacb>

![](img/d85199755445e4a6133fc6650b41d74d.png)

Source: [skitterphoto.com](https://skitterphoto.com/photos/1221/falling-euro-coins)

如果您担心转换到无服务器框架对您的企业来说过于昂贵，您并不孤单。到 2020 年，云服务的总支出将超过 4110 亿美元。好消息是，有许多方法可以跟踪和降低无服务器操作的成本，而不会降低您的业务。

那么什么是 AWS Lambda，它如何帮助您的业务？阅读这些[常见问题](https://dashbird.io/blog/aws-lambda-faq-for-dummies/)，了解更多信息。

# 与亚马逊合作

AWS 意为亚马逊网络服务，是亚马逊的云计算业务。AWS 无服务器刚刚进入使用的第五个年头。

因为外包计算能力仍然是如此新鲜，它仍然有许多技术工人问，“什么是无服务器？”使用其他人的服务器如何提高效率或成本效益？让我们来谈谈企业转向无服务器基础架构的主要原因。

虽然有很多其他的无服务器产品，但我今天只关注 AWS，以保持简洁。

# 不用再为闲置的服务器付费

无服务器框架最好的部分是，只有当你的用户在线时你才需要付费。您的企业将拥有所需的计算能力，而无需在成长过程中购买新设备。一个新的应用程序可以处理同样多的流量，就好像它有一个设备齐全的服务器室一样。

但是没有服务器的不仅仅是小型企业。让我们回顾一下大企业是如何做出改变的。每月有超过 3000 万独立访问者的在线出版物 business 完全在无服务器架构上开始了他们的新品牌 Romper。

为什么这对你很重要？首先，[business](https://aws.amazon.com/solutions/case-studies/bustle/)的 it 支出下降了 84%。其中很大一部分原因是，如果他们管理自己的服务器，他们的维护人员规模只有同类网站的一半。

因为您的团队不管理服务器，所以您的提供商只在用户向服务器请求数据时收费。

# 请求如何在无服务器框架上工作

AWS Lambda 将请求视为事件通知或调用。即使从控制台测试应用程序的功能，这些测试也算作请求。让我们来看看请求数据的成本:

好消息是，你的前 100 万个请求是免费的。每个帐户都有 400，000 GB 秒的计算时间。

免费使用后，以下所有请求的价格为每 100 万请求 0.20 美元，每 GB 秒 0.00001667 美元。但是还有其他你应该考虑的成本吗？是的，这是你账单高于正常水平的其他原因。

# 您是否在使用其他服务？

许多不熟悉无服务器基础设施的企业通常会对额外费用感到惊讶。让我们来看看如何从云上的其他服务传输数据来增加您的每月请求。这些其他费用包括:

如果你在 Amazon 的 s3 服务上存储 Lambda 将要读取的数据，这些都算作请求。当您的应用程序使用 Amazon DynamoDB 启动外部传输以读取和写入存储时，EC2 数据传输速率适用，例如，您为函数设置了 512 MB 的内存。假设用户在一个月内执行你的功能 300 万次。你的费用是多少？

> 300 万次调用 18 美元是一笔大买卖！

3 个[百万请求](https://aws.amazon.com/lambda/pricing/)只需 18.34 美元。但这需要大量的数据传输。你如何跟踪每件事并管理崩溃？

可口可乐北美公司不久前已经从 EC2 转向了无服务器，并且很友好地[与我们分享了他们的经验。在改用无服务器后，可口可乐从每年 13000 美元降到每年 4500 美元。](https://dashbird.io/blog/serverless-case-study-coca-cola/)

# “我如何跟踪所有这些？”

在无服务器用户中，监视 Lambda 函数是一个日益增长的问题。就像很容易忘记你在手机上使用了多少数据一样，追踪你的请求也会令人困惑。

让我们从阅读你的仪表板开始。AWS 在 Lambda 中内置了一些基本的跟踪服务。这些服务包括:

支出汇总。你的花费总结是预测 Lambda 未来使用的好方法。你可以看到你上个月花了多少钱，这个月的估计使用量，以及下个月的预计使用量。按服务列出的本月累计支出。这显示了您使用最多的 AWS 服务以及您的预算中用于每项服务的百分比。按支出列出的本月迄今最受欢迎的服务。还显示了您最常用的服务及其费用明细。这些工具很适合自由层使用，但是当你有多个 Lambda 函数时，有一个更好的选择。

这就是无服务器追踪器让事情变得简单的地方。无服务器跟踪器在一个地方显示所有 Lambda 函数的状态。它可以让你根据数据来决定如何与客户互动。

**以下是跟踪者可视化成本的一些方法:**

通过 Dashbird.io，你可以从主屏幕跟踪任何特定项目的成本，让你确切地看到你为 AWS Lambda 花费了多少美元。此外，您可以看到每个函数的成本以及其他重要信息，如执行时间、调用、错误等。在 Lambda 函数视图部分下。

![](img/d5729ef27f068d0e3c86c855ec070f09.png)

# 外包服务器如何为您省钱

既然你已经知道了定价是如何工作的，以及如何跟踪它，让我们来谈谈无服务器为你省钱的其他方法。

无服务器无前期成本。如果没有云计算，唯一的其他选择是在创建新应用程序之前购买服务器。这意味着您的服务器需要等待更长时间才能获得投资回报。

缩放要便宜得多。不用购买更多的服务器并希望它们能提供您需要的容量，您可以按使用量付费，而不用担心系统崩溃。

> 你不用支付维护费用。太棒了。

现在被迫雇佣一个大的 DevOps 团队对公司来说是一个巨大的成本节约。有很多这样的例子，通过将基础设施切换到 AWS，并依靠它们来处理日常维护操作，公司成功地在只有两个开发人员的情况下运行了数百万人的应用程序。不要再睁着一只眼睛睡觉，害怕那些午夜的崩溃。

# 在无服务器框架上冷启动

说到崩溃，无服务器以[冷启动](https://hackernoon.com/im-afraid-you-re-thinking-about-aws-lambda-cold-starts-all-wrong-7d907f278a4f)的形式提出了一个独特的问题。lambda 函数的第一次调用需要一些时间来执行，因为容器需要时间来启动。

使用传统的计算方法，每个请求都被放在一个队列中，然后被一个接一个地处理。有了 Lambda，每一个请求都会立刻得到服务，只要它们不会碰到并发限制。这本身可能是人们对这项技术如此兴奋的主要原因。事实上，使用无服务器，您可以毫不费力地同时为 10、100 或 1000 人提供服务，您的应用程序可以优雅地扩展，以满足用户的需求。

# 那么为什么冷启动会发生呢？

为了创建我一直抱怨的这个漂亮的缩放，未使用的 Lambda 容器在一段时间后被销毁。我们已经测试了删除时间，发现它似乎是 40 到 60 分钟的不活动时间。现在，如果这一点直到现在还不清楚，冷启动是必要的，以便让 AWS 几乎无限地扩展我们的 Lambdas。

旧容器为新容器腾出空间，这是生命的循环！

不是每个人都会被这些冷启动所困扰，但对于那些冷启动的人来说，有一种方法可以防止这种情况，那就是预热你的 API，特别是如果你正在期待一个客户高峰。例如，一家使用其应用程序接受订单的餐厅可以在午餐高峰前发送大量并发请求，这样用户就不会有延迟。

您也可以用冷启动时间短的语言编写代码。对第一次请求反应快的语言有 node.js、python 和 go。

如果你的应用程序经历了很多冷启动，试着增加你的内存限制。虽然这会花费更多，但是你可能会因为长时间的等待而失去顾客。

了解冷启动发生的时间和频率是很重要的，如果需要，使用这些知识进行调整，以便为用户创造更好的体验。我使用 Dashbird 的函数视图来过滤冷启动，并记录它们出现的频率。

![](img/5c2baf8b30119ede60fbda061178ec3a.png)

# “使用无服务器框架我会省钱吗？”

我们已经讨论了一些计算无服务器框架成本的方法。虽然不是没有成本，但就前期和维护成本而言，无服务器是难以超越的。任何想尽快启动并运行应用程序的人都应该考虑使用无服务器提供商。

如果你仍在观望，决定因素应该是你的业务是否能继续竞争，同时花更长时间为你的应用程序部署新功能。如果答案是否定的，那么走向无服务器可以把你引向正确的方向。

跑后端运营本身就是一门生意。这就是为什么切换到无服务器提供商是有意义的，并专注于您的业务做得最好，为您的用户提供更好的体验，而不是 it。Annika 写了一篇关于您通过切换到无服务器实际上可以节省多少的[帖子，我建议您亲自去看看它实际上有多大的影响。](https://dashbird.io/blog/saving-money-switching-serverless/)

*原载于 2019 年 1 月 9 日*[*dash bird . io*](https://dashbird.io/blog/cost-of-serverless/)*。*