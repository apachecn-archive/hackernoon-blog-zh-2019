<html>
<head>
<title>Histogram Equalization in Python from Scratch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的直方图均衡化</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/histogram-equalization-in-python-from-scratch-ebb9c8aa3f23?source=collection_archive---------0-----------------------#2019-03-25">https://medium.com/hackernoon/histogram-equalization-in-python-from-scratch-ebb9c8aa3f23?source=collection_archive---------0-----------------------#2019-03-25</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/024a24085295a4a8c7d2a6cb4bf8f059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C_K5dMiqM9aYQDL0u_WI4A.png"/></div></div></figure><p id="c25e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直方图均衡化是图像处理工具包中的基本工具之一。这是一种调整图像中像素值的技术，通过使这些强度更加均匀来增强对比度。通常情况下，图像的直方图会接近于<em class="ka">正态</em>分布，但均衡化旨在实现<em class="ka">均匀</em>分布。在本文中，我们将从头开始用python编写一个直方图均衡器。如果您想查看完整的代码，我在本文底部提供了一个Jupyter笔记本的链接。现在，如果你准备好了，让我们开始吧！</p></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="038c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在此之前，我们必须做一些设置。让我们导入我们将在整个程序中使用的库，加载图像，并显示它:</p><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/f1289dd30566a9453d1a7b8a9d4d8c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LcQlcqMdVsCfJybcZKwPg.png"/></div></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kp"><img src="../Images/949191969f910230723cfc4fe3aeeca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H_ekCDVcynVnNzdTk_fENA.png"/></div></div></figure><p id="a1de" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">出于本教程的目的，我们使用灰度图像，因为灰度图像中的每个像素只代表一个值——T4强度。我认为这使得数学更容易推理，因为我们只需要关心一个值。作为比较，在RGB彩色图像中，每个像素包含三个值(红/绿/蓝)。由于我们读入和处理图像的方式，您仍然可以通过该程序运行彩色图像——我鼓励您这样做，这样您就可以看到您会得到什么样的输出！</p><p id="f147" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将使用的图像是一个褪色的x光片。我们可以假装自己是放射科医生，想要均衡x射线，以便更好地看到一些细节。</p><p id="a4b1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了处理图像，我们必须首先将它作为一个数组读入。但是，numpy会自动返回一个多维数组，所以我们将其展平为一维数组:</p><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/f1289dd30566a9453d1a7b8a9d4d8c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LcQlcqMdVsCfJybcZKwPg.png"/></div></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kq"><img src="../Images/dd11b22a9a086a8c8c1aa9e170d85161.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OfpJjC8EOZMVH89fDDx82A.png"/></div></div></figure><p id="1dbe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在展平的数组中，每个像素都有一个亮度值。数值范围从0 ( <em class="ka">黑色</em>)到255 ( <em class="ka">白色</em>)。介于两者之间的一切都被认为是灰色的。从上图可以看出，我们有一个接近零的峰值，超过200的值不多。</p><p id="482b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，我们可以采用一维数组，并基于相似强度值的频率来计算图像的直方图。有一些预先存在的函数可以帮你做到这一点，但是我们是从零开始做的，所以让我们自己写吧！</p><p id="da4f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">⚠️ <em class="ka">请记住，对于生产环境，您会希望使用预先存在的函数，因为它们得到了更好的优化，并且可以处理更多的用例。</em></p><p id="18aa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们求解的数学公式是:</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kr"><img src="../Images/ffcc47b12c0a97fe55ca415e5ab2e8ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1vgTqBckFxcJ_njZujsgJw.png"/></div></div></figure><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><p id="cf8e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在我们有了直方图，我们可以通过计算直方图的<em class="ka">累积和</em>进行下一步均衡。累积和顾名思义，就是直方图中到该点为止的所有值的和，包括所有以前的值。就像上面一样，有一些函数可以帮你计算，但是让我们自己写:</p><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/8be2b060983fbeb35db9feeffe92a655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i47V21rtuaN5Jor7XDhMeA.png"/></div></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ks"><img src="../Images/a381701b46890889e05de189feacfe37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sAz6oyPNutuKbScRhpvStw.png"/></div></div></figure><p id="0ace" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们在进步！我们现在有了累积和，但是正如您所看到的，值是巨大的(&gt; 6，000，000)。我们将在最后一步将这些值与我们的原始图像进行匹配，因此我们必须将它们归一化以符合0–255的范围。这是我们需要编写的最后一个公式:</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kt"><img src="../Images/a73f336bcd28f888816690b08091c712.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rIAl9KHsWm02N0aXfqo_Q.png"/></div></div></figure><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/8be2b060983fbeb35db9feeffe92a655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i47V21rtuaN5Jor7XDhMeA.png"/></div></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ku"><img src="../Images/90a720b04febe9b1e7a35bd835731501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eI5mAzXbWmcUx-OLj0eWWQ.png"/></div></div></figure><p id="efa6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这样更好——我们的值现在在0-255之间正常化。现在是压轴戏。我们现在可以使用归一化的累积和来修改原始图像的亮度值。如果您以前从未使用过numpy，那么这样做的代码看起来会有点混乱。其实反气候简单。</p><p id="4536" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将从<code class="eh kv kw kx ky b">flat</code>数组中获取所有的值，并使用它作为索引来查找<code class="eh kv kw kx ky b">cs</code>数组中的相关值。结果成为新的亮度值，该值将存储在特定像素的<code class="eh kv kw kx ky b">img_new</code>中。</p><p id="1a49" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">最后一步，我们重塑数组以匹配原始图像，这样我们就可以将结果呈现为图像。</p><figure class="ki kj kk kl fq iv"><div class="bz el l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/8be2b060983fbeb35db9feeffe92a655.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i47V21rtuaN5Jor7XDhMeA.png"/></div></div></figure><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ca"><img src="../Images/0f2af9bbb8767958445c447d4b9adcf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQFBvFQ8MAo2A8qC8NDd0g.png"/></div></div></figure><p id="82c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是我们的情况——原始图像已经被均衡化。我们现在几乎是放射科医生了！请注意整个图像的对比度差异。关于直方图均衡化，要记住的最重要的事情是，它在考虑所有像素的情况下，在<em class="ka">全局</em>级别调整强度。这个过程对于上面这样的图像效果很好，但是对于其他图像效果可能很差。</p><p id="a4fa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">例如，以下面的图片为例——它是使用完全相同的算法转换的，但是，你可以看到它没有增强照片那么多，而是完全破坏了照片。</p><figure class="ki kj kk kl fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kz"><img src="../Images/451a354d0b6c9e47faf50dd2642fb432.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhmQZTHT8djW1yaDVBjS7g.png"/></div></div></figure><p id="b2fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">直方图均衡化并不总是这项工作的完美工具。但是，您可以使用其他方法来考虑相邻像素，而不是使用整个图像。请继续关注下一篇文章，我们将介绍一种更加本地化的均衡算法。</p><p id="c16c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">本文的完整源代码(作为Jupyter笔记本)可以在这里找到:</p><div class="la lb fm fo lc ld"><a href="https://github.com/torywalker/histogram-equalizer/blob/master/HistogramEqualization.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="le ab ej"><div class="lf ab lg cl cj lh"><h2 class="bd hv fv z el li eo ep lj er et ht dt translated">tory walker/直方图均衡器</h2><div class="lk l"><h3 class="bd b fv z el li eo ep lj er et ek translated">一个简单的直方图均衡化实现。通过创建一个……</h3></div><div class="ll l"><p class="bd b gc z el li eo ep lj er et ek translated">github.com</p></div></div><div class="lm l"><div class="ln l lo lp lq lm lr ja ld"/></div></div></a></div></div><div class="ab cl kb kc hc kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="hn ho hp hq hr"><p id="880f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">👏如果你觉得这篇文章很有帮助，并希望看到更多，请留下一些掌声让我知道！🔗关注更多类似的文章！</p></div></div>    
</body>
</html>