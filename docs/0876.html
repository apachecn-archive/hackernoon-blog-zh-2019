<html>
<head>
<title>Socket Programming in Python: Client, Server, and Peer Examples</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的套接字编程:客户端、服务器端和对等端示例</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/socket-programming-in-python-client-server-and-peer-examples-a25c9782b584?source=collection_archive---------5-----------------------#2019-02-05">https://medium.com/hackernoon/socket-programming-in-python-client-server-and-peer-examples-a25c9782b584?source=collection_archive---------5-----------------------#2019-02-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="7eb3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">套接字(又名套接字编程)使程序能够在任何给定的时刻双向发送和接收数据。本教程介绍了如何使用套接字<a class="ae jp" href="https://hackernoon.com/tagged/programming" rel="noopener ugc nofollow" target="_blank">编程</a>在<a class="ae jp" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>中从<strong class="it hv">设备到设备</strong>、<strong class="it hv">客户端到服务器</strong>以及<strong class="it hv">客户端到服务器</strong>发送数据。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="jv jw l"/></div></figure><h1 id="944d" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">为什么使用套接字发送数据？</h1><p id="bd70" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">需要实时操作的互联网连接应用程序从其<strong class="it hv">网络代码</strong>中<strong class="it hv">套接字</strong>的实现中获益匪浅。使用套接字编程的应用程序示例如下:</p><ul class=""><li id="3a21" class="la lb hu it b iu iv iy iz jc lc jg ld jk le jo lf lg lh li dt translated">显示实时通知的网页(脸书、Twitch、易贝)</li><li id="1b13" class="la lb hu it b iu lj iy lk jc ll jg lm jk ln jo lf lg lh li dt translated">多人在线游戏(英雄联盟，哇，反恐精英)</li><li id="57c4" class="la lb hu it b iu lj iy lk jc ll jg lm jk ln jo lf lg lh li dt translated">聊天应用(WhatsApp、微信、Slack)</li><li id="2912" class="la lb hu it b iu lj iy lk jc ll jg lm jk ln jo lf lg lh li dt translated">实时数据仪表板(比特币基地罗宾汉)</li><li id="ba94" class="la lb hu it b iu lj iy lk jc ll jg lm jk ln jo lf lg lh li dt translated">物联网设备(Nest、August Locks)</li></ul><p id="51ff" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae jp" href="https://hackernoon.com/tagged/python" rel="noopener ugc nofollow" target="_blank"> Python </a>与JavaScript不同，是一种同步执行<a class="ae jp" href="https://hackernoon.com/javascript-promises-and-why-async-await-wins-the-battle-4fc9d15d509f" rel="noopener ugc nofollow" target="_blank"/>的语言。这就是开发asyncio的原因——让Python更健壮，特别是对于套接字编程的本质。</p><p id="0087" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">使用流式套接字，可以随时发送或接收数据。如果您的Python程序正在执行某些代码，其他<strong class="it hv">线程</strong>可以处理新的套接字数据。像asyncio这样的库实现了多线程，所以你的Python程序可以异步工作。</p><h1 id="a4d5" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Python套接字编程教程</h1><p id="c0dc" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">Python本身提供了一个<a class="ae jp" href="https://docs.python.org/3/library/socket.html" rel="noopener ugc nofollow" target="_blank"> socket类</a>，因此开发人员可以在他们的源代码中轻松实现<strong class="it hv"> socket对象</strong>。要在程序中使用套接字对象，首先要导入套接字库。不需要安装一个包管理器，它是Python自带的。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><p id="485d" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我们可以在代码中创建套接字对象。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><p id="93ef" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这段代码创建了一个socket对象，我们将它存储在“sock”变量中。为构造函数分别提供了一个族和类型参数。family参数设置为默认值，即<strong class="it hv">地址格式Internet </strong>。</p><p id="ec27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">type参数设置为<strong class="it hv"> Socket Stream </strong>，这也是默认设置，通过<strong class="it hv"> TCP </strong> <a class="ae jp" href="http://man7.org/linux/man-pages/man2/socket.2.html" rel="noopener ugc nofollow" target="_blank"> 1 </a>启用“有序、可靠、双向、基于连接的字节流”。</p><p id="7ea2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">一旦我们有了一个初始化的socket对象，我们可以使用一些方法打开一个<strong class="it hv">连接</strong>，<strong class="it hv">发送</strong>数据，<strong class="it hv">接收</strong>数据，最后<strong class="it hv">关闭</strong>连接。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><h1 id="2313" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Python套接字服务器</h1><p id="6969" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">现在我们知道了一些传输字节的方法，让我们用Python创建一个客户机和服务器程序。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><p id="b68f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这段代码制作了一个socket对象，并将其绑定到<strong class="it hv"> localhost的端口8080 </strong>作为<strong class="it hv"> socket server </strong>。当客户端通过套接字连接到该地址时，服务器监听数据，并将其存储在“data”变量中。</p><p id="0e31" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，程序使用“print”记录客户机数据，然后向客户机发送一个字符串:<strong class="it hv">我是服务器</strong>。</p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="fe ff lp"><img src="../Images/83635f373c314dce0dcd783c2f3bb2b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1fa09gbGxyuYETj7.png"/></div></div></figure><p id="da5f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">让我们看一下将与这个服务器程序交互的客户机代码。</p><h1 id="b6a8" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">Python套接字客户端</h1><p id="db44" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">下面是<strong class="it hv">客户端</strong>套接字演示代码。</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><p id="1579" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这个客户端打开一个与服务器的套接字连接，但是只有当服务器程序当前正在运行时。要自己测试，你需要同时使用<strong class="it hv"> 2个终端窗口</strong>。</p><p id="f317" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">接下来，客户端向服务器发送一些数据:<strong class="it hv">我是客户端</strong></p><p id="3936" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">然后，客户端从服务器接收一些预期的数据。</p><p id="f9a6" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">搞定了。您现在可以开始使用一些基本的Python网络编程在客户机和服务器之间传输数据。</p><h1 id="cdb2" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">你如何在客户端之间发送数据？</h1><p id="7cc9" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">通过互联网在两个或更多客户端设备之间发送数据<strong class="it hv">是很棘手的。由于网络安全实施的保护措施，并非所有连接到万维网的设备都具有可公开访问的互联网协议(IP)地址。</strong></p><p id="dfab" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这意味着我们实现的Python代码对于在我们的实时应用中发送对等数据来说不是100%可靠的。我们在传输<strong class="it hv">点对点数据</strong>时如何实现<strong class="it hv">可靠性</strong>和<strong class="it hv">速度</strong>？</p><p id="8356" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这可以使用中间的服务器<strong class="it hv">来完成。使用互联网的客户端设备可以连接到具有公共IP地址(或网站域)的服务器。然后，中间的这个代理可以传递路由到一个或多个客户端的消息。</strong></p><figure class="jq jr js jt fq ju fe ff paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="fe ff lw"><img src="../Images/c9f36b8323c298be65c4c6db65b6359f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zcGgBPM4S5WrV180.png"/></div></div></figure><p id="d261" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">PubNub用<strong class="it hv">发布/订阅API </strong>做得最好。它快速、可靠、安全，并且易于在<strong class="it hv">任何客户端设备</strong>上实现。无论你有Python服务器、JavaScript网站，还是介于两者之间的任何东西，你都可以使用PubNub在250毫秒内将数据发送给<strong class="it hv">的任何人。</strong></p><p id="27cb" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">通过<strong class="it hv">一对多</strong>、<strong class="it hv">一对一</strong>或<strong class="it hv">多对多</strong>，PubNub <strong class="it hv">自动扩展</strong>以支持任何应用程序负载。使用该API可以在所有拥有发布/订阅API密钥的客户端之间打开一个即时的、始终在线的连接。这实现了与套接字连接相同的目标。</p><h1 id="79f3" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">使用SSL连接的PubNub和Python</h1><p id="eb7a" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">这里有一个<strong class="it hv">点对点数据</strong>的例子，它是用PubNub在一个通道上用<strong class="it hv"> SSL </strong>发送的。您可以将此想象成通过TCP套接字发送数据。当你注册一个免费的PubNub账户时，你可以使用几乎无限的频道来实时发送信息。在你尝试代码之前，一定要<strong class="it hv">制作一个</strong> <a class="ae jp" href="https://dashboard.pubnub.com/signup/?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY19-Q1-Medium-Jan-22" rel="noopener ugc nofollow" target="_blank"> <strong class="it hv">免费的PubNub账号</strong> </a>。</p><h1 id="fd84" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">客户端1</h1><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><h1 id="6696" class="jx jy hu bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dt translated">客户端2</h1><p id="d42a" class="pw-post-body-paragraph ir is hu it b iu kv iw ix iy kw ja jb jc kx je jf jg ky ji jj jk kz jm jn jo hn dt translated">可以在命令行上为这两个客户端程序输入字符串。PubNub发布的最大邮件大小为32kb。使用2个终端窗口来测试代码！</p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="lo jw l"/></div></figure><p id="52d3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">本文中的所有代码都托管在Python Socket演示库的<a class="ae jp" href="https://github.com/ajb413/python-socket-demo" rel="noopener ugc nofollow" target="_blank"> GitHub上。</a></p><p id="ee5a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">PubNub是完全免费的，每月高达100万条消息。要了解API的更多功能，请查看<a class="ae jp" href="https://www.pubnub.com/docs/python/pubnub-python-sdk?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY19-Q1-Medium-Jan-22" rel="noopener ugc nofollow" target="_blank"> PubNub Python v4 SDK文档</a>，或任何其他<a class="ae jp" href="https://www.pubnub.com/developers/?utm_source=Syndication&amp;utm_medium=Medium&amp;utm_campaign=SYN-CY19-Q1-Medium-Jan-22" rel="noopener ugc nofollow" target="_blank"> 75+ PubNub客户端SDK</a>。</p></div><div class="ab cl lx ly hc lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="hn ho hp hq hr"><p id="ffe3" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><em class="me">原载于</em><a class="ae jp" href="https://www.pubnub.com/blog/socket-programming-in-python-client-server-p2p/" rel="noopener ugc nofollow" target="_blank"><em class="me">www.pubnub.com</em></a><em class="me">。</em></p><figure class="jq jr js jt fq ju"><div class="bz el l di"><div class="mf jw l"/></div></figure></div></div>    
</body>
</html>