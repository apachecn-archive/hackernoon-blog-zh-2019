<html>
<head>
<title>ANOTHER way to call restFul API in Redux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Redux 中调用 restFul API 的另一种方式</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/another-way-to-call-restful-api-in-redux-d8dd991d0779#2019-02-26">https://medium.com/hackernoon/another-way-to-call-restful-api-in-redux-d8dd991d0779#2019-02-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="be4a" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">宣布了一种通用方法，使开发人员在 React-Redux 中调用 API 变得更加容易。</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/1e51b33d633e6ec40f0d1937581e49f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JYGU_MEBZaJfWw4HnQtvcg.jpeg"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Photo by <a class="ae jz" href="https://unsplash.com/photos/ymf4_9Y9S_A?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Randy Fath</a> on <a class="ae jz" href="https://unsplash.com/search/photos/hard-working?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ebee" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">最近从后端开发转到前端了。乍一看，我发现 API 调用真的很难。</p><p id="9617" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">为什么我们需要一个类型+动作+采取动作(redux-saga)+处理函数😐对于每个 API 调用？？和一个 type + action + reducer 来存储结果。我一直在问自己。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff kw"><img src="../Images/01912ee254bcd466960a4e268ccee4e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*stv_a1LpjcQlRiuPHA2ffg.png"/></div></div></figure><p id="a8af" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我做了很多研究，所有的样本和文件或多或少都是一样的。比如这个例子:</p><div class="kx ky fm fo kz la"><a href="https://hackernoon.com/moving-api-requests-to-redux-saga-21780f49cbc8" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab ej"><div class="lc ab ld cl cj le"><h2 class="bd hv fv z el lf eo ep lg er et ht dt translated">将 API 请求移动到 Redux-Saga</h2><div class="lh l"><h3 class="bd b fv z el lf eo ep lg er et ek translated">我想和你分享一下我们如何创建应用程序的故事。我们使用什么工具，我们从哪里转移…</h3></div><div class="li l"><p class="bd b gc z el lf eo ep lg er et ek translated">hackernoon.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jt la"/></div></div></a></div><p id="77bb" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">所以我想换一种方式，更实用的方式。</p><h1 id="cc77" class="lp lq hu bd lr ls lt lu lv lw lx ly lz ja ma jb mb jd mc je md jg me jh mf mg dt translated">API 客户端</h1><p id="a31a" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">API client 是一个在一个地方处理最多 API 调用而没有重复代码的结构(<a class="ae jz" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank"> DRY </a>)。我将使用 redux 中间件来解释这种结构，但是您可以用自己的方式来实现它。即使在另一个中间件库中，如 Tunk 或 Saga。如你所见，解释是如此简单明了。我试着让它容易理解</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mm"><img src="../Images/eab26156caeebecde46e858f3dc76b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FGSmrOpvIxlcick6CmQ37g.png"/></div></div></figure><h2 id="e09b" class="mn lq hu bd lr mo mp mq lv mr ms mt lz kj mu mv mb kn mw mx md kr my mz mf na dt translated">履行</h2><p id="b378" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">API 请求是我们的基本 API 类。你可以这样定义它:</p><blockquote class="nb nc nd"><p id="aaa0" class="ka kb ne kc b kd ke iv kf kg kh iy ki nf kk kl km ng ko kp kq nh ks kt ku kv hn dt translated">我使用<a class="ae jz" href="https://carbon.now.sh" rel="noopener ugc nofollow" target="_blank">碳</a>来生成代码片段的图像。你可以在我的 GitHub 中看到完整的实现。</p></blockquote><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/bfcefbfdd5b47c22763abcd9cd4b901b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v5l2nN_nCp6lWTIocqPCmw.png"/></div></div></figure><p id="d5a2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">每当你想调用一个 API 时，你只需要创建这个类的一个实例，并将这个动作分派给 redux。</p><p id="8642" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我们可以创建一个动作函数:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/4335aa58e4a52ef13237fc6e1ffda4f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TxIUOd0UTd2gwDv97MaB9Q.png"/></div></div></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/404a1b66c35592f1d79bc14d0798c34f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MazwglnS9sBGEbmySxj1hg.png"/></div></div></figure><p id="9dcc" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">通过使用这个函数，我们也可以在一个承诺中直接使用调用 API(如果需要的话)。</p><p id="6797" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">对于响应，我们可以定义 APIResponse 类:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/d9b4e09784290a150c24da0ffba863c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MGGJlHStqLr267zSDxyk6g.png"/></div></div></figure><p id="3903" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在我们需要处理请求并完成拼图。<strong class="kc hv">redux 中间件</strong>(我使用<a class="ae jz" href="https://github.com/axios" rel="noopener ugc nofollow" target="_blank"> Axios </a>发送请求):</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/b6d5ffc6d8516f756431894e990f5c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1jK8kYBWtslAG3sZEc2bhA.png"/></div></div></figure><h1 id="8c05" class="lp lq hu bd lr ls lt lu lv lw lx ly lz ja ma jb mb jd mc je md jg me jh mf mg dt translated">怎么用？</h1><p id="617c" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">调用 API 不可能比它更简单😎像一般的方法一样，我们可以在组件中使用 redux connect 来发送请求和接收响应。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/2e2a0718efebcd7d11c0ccd6a19acfdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6m7eRUHIS5BuB6ev094iAA.png"/></div></div></figure><h1 id="a633" class="lp lq hu bd lr ls lt lu lv lw lx ly lz ja ma jb mb jd mc je md jg me jh mf mg dt translated">怎么定制？</h1><p id="388c" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">你可能会想到一些具体的场景，以及如何用这种结构来处理。这个强大的选项解决了我的问题:</p><h2 id="f175" class="mn lq hu bd lr mo mp mq lv mr ms mt lz kj mu mv mb kn mw mx md kr my mz mf na dt translated">[计]选项</h2><p id="20c8" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">带选项。您可以根据需要定义选项对象。类似这样的东西</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/196eb2a9cde1fd1addd730fa824ad375.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-Srz8z79fGYAxzIm15zpA.png"/></div></div></figure><p id="a789" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">您可以定义一个选项，用于在存储中保存响应或在操作后显示消息，以及基于您需要的任何内容。</p><h2 id="b1d3" class="mn lq hu bd lr mo mp mq lv mr ms mt lz kj mu mv mb kn mw mx md kr my mz mf na dt translated">中间件</h2><p id="4de1" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">另一个可以给你更多控制的东西是中间件。如果选项不足以满足您的需求，您可以像这样定义中间件接口:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/0c682849f9815b4a35713c7e7b21c51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mAEpq4Gl5X9p8qs9ie0Ztw.png"/></div></div></figure><p id="9ba6" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">现在实现这个接口，并将其添加到请求对象中，以获得对请求流的完全控制。</p><p id="e7c2" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">我们需要更改 APIRequest 类来支持选项和中间件。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ni"><img src="../Images/747a5b830d209ccfffc07db975c95029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruIe6_znfnmKMNDctFvLqQ.png"/></div></div></figure><h1 id="f703" class="lp lq hu bd lr ls lt lu lv lw lx ly lz ja ma jb mb jd mc je md jg me jh mf mg dt translated">超出</h1><p id="b0f2" class="pw-post-body-paragraph ka kb hu kc b kd mh iv kf kg mi iy ki kj mj kl km kn mk kp kq kr ml kt ku kv hn dt translated">你甚至可以做得更好。例如，使用这种结构，您可以轻松地处理本地存储中的所有更改，以避免重复。更具体地说，您可以实现一个流程，在发送删除请求后从本地存储中删除记录。</p></div><div class="ab cl nj nk hc nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="hn ho hp hq hr"><p id="6a1a" class="pw-post-body-paragraph ka kb hu kc b kd ke iv kf kg kh iy ki kj kk kl km kn ko kp kq kr ks kt ku kv hn dt translated">正如我之前提到的，我想给你们一个概念，我是什么意思。如果你感兴趣，你可以在 GitHub 上看到完整的演示:</p><div class="kx ky fm fo kz la"><a href="https://github.com/PejmanNik/redux-call-api-sample" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab ej"><div class="lc ab ld cl cj le"><h2 class="bd hv fv z el lf eo ep lg er et ht dt translated">PejmanNik/redux-call-API-sample</h2><div class="lh l"><h3 class="bd b fv z el lf eo ep lg er et ek translated">react/redux for my medium post 中调用 API 的示例项目…</h3></div><div class="li l"><p class="bd b gc z el lf eo ep lg er et ek translated">github.com</p></div></div><div class="lj l"><div class="nq l ll lm ln lj lo jt la"/></div></div></a></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nr"><img src="../Images/c73a344ef928baf223afe739f80466b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjxEouS3EaXpavvo6NxfBw.png"/></div></div></figure></div></div>    
</body>
</html>