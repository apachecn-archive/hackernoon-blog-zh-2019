<html>
<head>
<title>How To Add Draft Posts To A Gatsby Blog</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在盖茨比博客上添加帖子草稿</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-add-draft-posts-to-a-gatsby-blog-3f6c64ec0c06?source=collection_archive---------5-----------------------#2019-05-26">https://medium.com/hackernoon/how-to-add-draft-posts-to-a-gatsby-blog-3f6c64ec0c06?source=collection_archive---------5-----------------------#2019-05-26</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/6edd11de214bdf415ffb6b4b5bf375fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oKvI-o7xk54eChsO.png"/></div></div></figure><div class=""/><p id="a083" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我需要在我用Gatsby构建的博客中从生产中排除特定的帖子，并在开发期间将它们标记为草稿。我将描述如何实现这个目标，这样你也可以在不到5分钟的时间内完成。</p><p id="24c4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这篇文章是《10比盖茨比更好》系列文章的一部分，在这里我分享了我个人调整盖茨比的经验。</p><h1 id="677c" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">最终结果</h1><p id="5f9b" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">正在开发的职位列表:</p><figure class="lf lg lh li fq hw fe ff paragraph-image"><div class="fe ff le"><img src="../Images/e71de2ee0f30a51d444fea8f084c917c.png" data-original-src="https://miro.medium.com/v2/resize:fit:976/format:webp/0*J2fjCxnyYCe5ncxr.png"/></div></figure><p id="efc4" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">生产岗位列表:</p><figure class="lf lg lh li fq hw fe ff paragraph-image"><div class="fe ff lj"><img src="../Images/6e315eedbdaea03ab7a8370b08b3a0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/0*gS_Ikonu0m41fQA7.png"/></div></figure><h1 id="4b7f" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">要求</h1><ul class=""><li id="6809" class="lk ll if je b jf kz jj la jn lm jr ln jv lo jz lp lq lr ls dt translated">显示开发中的所有帖子</li><li id="8b1f" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">在制作中隐藏草稿文章</li><li id="6414" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">在开发中以不同方式呈现已发布和草稿帖子</li><li id="e3bc" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">如果post的<code class="eh ly lz ma mb b">date</code>在构建时间之后，则将post标记为自动发布</li><li id="6ce1" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">在<code class="eh ly lz ma mb b">md</code>文件中手工标记发布。</li></ul><p id="979c" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我找到了一个<a class="ae ka" href="https://www.gatsbyjs.org/packages/gatsby-plugin-draft/" rel="noopener ugc nofollow" target="_blank">插件</a>，但无法实现我需要的一切。我的开源解决方案可以在这里找到:</p><p id="758a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><a class="ae ka" href="https://github.com/rg4real/gatsby-plugin-released" rel="noopener ugc nofollow" target="_blank">盖茨比外挂发布</a></p><p id="5ecb" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">它允许您通过config添加发布功能，并跳过本文的部分内容。此外，您还可以使用其他选项。请访问插件自述文件了解更多信息。</p><h1 id="5c71" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">概观</h1><p id="bb83" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated"><strong class="je ig">第一步。向GraphQL添加新字段</strong></p><p id="8136" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将添加一个名为<code class="eh ly lz ma mb b">released</code>的字段，基于:</p><ul class=""><li id="ac8d" class="lk ll if je b jf jg jj jk jn mc jr md jv me jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">date</code>减价文件中的字段</li><li id="4935" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">released</code>来自markdown文件的字段</li><li id="891f" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">process.env.NODE_ENV</code></li><li id="a587" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">timezone</code></li><li id="b31c" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated">构建时间(构建发生的时刻)</li></ul><p id="dad0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">此外，我们将添加一个名为<code class="eh ly lz ma mb b">releasedNotForced.</code>的字段，类似于<code class="eh ly lz ma mb b">released</code>，但忽略了<code class="eh ly lz ma mb b">process.env.NODE_ENV</code>。</p><p id="a4e3" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这一步被抽象成<a class="ae ka" href="https://github.com/rg4real/gatsby-plugin-released" rel="noopener ugc nofollow" target="_blank"> gatsby-plugin-released </a></p><p id="6cb0" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">第二步。更新GraphQL查询以尊重 <code class="eh ly lz ma mb b"><strong class="je ig">released</strong></code> <strong class="je ig">值</strong></p><p id="82dd" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们应该将草稿排除在构建和显示之外。</p><p id="7ce8" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">第三步。更新组件以不同方式呈现草稿。</p><p id="4e22" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有一个很好的视觉区别并且感觉良好。:)</p><h1 id="3eb5" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">执行</h1><h1 id="f698" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">第一步。向GraphQL添加新字段</h1><p id="44f5" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这一步的目标是通过GraphQL向<code class="eh ly lz ma mb b">node.frontmatter.fields</code>添加要使用的字段。Gatsby为此提供了一个特殊的API。我们需要的是修改<code class="eh ly lz ma mb b">gatsby-node.js</code>文件。</p><p id="0a5d" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们将添加两个字段:</p><ul class=""><li id="8b70" class="lk ll if je b jf jg jj jk jn mc jr md jv me jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">released</code>字段</li><li id="6143" class="lk ll if je b jf lt jj lu jn lv jr lw jv lx jz lp lq lr ls dt translated"><code class="eh ly lz ma mb b">releasedNotForced</code>字段，其行为与<code class="eh ly lz ma mb b">released</code>相似，但忽略了<code class="eh ly lz ma mb b">process.env.NODE_ENV</code>变量。</li></ul><h1 id="3083" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">为什么添加两个字段？</h1><p id="ebc7" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">以防你想知道。</p><p id="94fc" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在开发模式下，我们可能希望在不编辑任何GraphQL查询的情况下强制呈现帖子。是在<code class="eh ly lz ma mb b">process.env.NODE_ENV</code>的基础上强制<code class="eh ly lz ma mb b">released</code>为<code class="eh ly lz ma mb b">true</code>来完成的。因此，在开发模式中，我们失去了我们可能希望在组件代码中使用的原始值，以便在草稿和发布的帖子之间有一个直观的区别。</p><p id="b89a" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">保持这一点的方法是总是在markdown文件中设置<code class="eh ly lz ma mb b">released</code>字段。但是让这个值基于<code class="eh ly lz ma mb b">date</code>自动计算出来真是太好了。</p><p id="fda7" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这就是为什么我添加了一个<code class="eh ly lz ma mb b">releasedNotForced</code>属性——在强制<code class="eh ly lz ma mb b">released</code>为真的同时保留该值。</p><p id="b456" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">记住，如果你不想弄乱你的配置，就使用<a class="ae ka" href="https://github.com/rg4real/gatsby-plugin-released" rel="noopener ugc nofollow" target="_blank">这个插件</a>。</p><p id="1cbf" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下面是我们用来计算<code class="eh ly lz ma mb b">releasedNotForced</code>值的函数。</p><pre class="lf lg lh li fq mf mb mg mh aw mi dt"><span id="a052" class="mj kc if mb b fv mk ml l mm mn">// gatsby-node.js<br/>const moment = require('moment-timezone')<br/>const getValue = ({ node, options }) =&gt; {<br/>  const { fieldName, timezone } = options<br/>  if (!node.frontmatter) {<br/>    return false<br/>  }</span><span id="c354" class="mj kc if mb b fv mo ml l mm mn">  if (node.frontmatter.hasOwnProperty(fieldName)) {<br/>    return node.frontmatter[fieldName]<br/>  }</span><span id="cc42" class="mj kc if mb b fv mo ml l mm mn">  if (!node.frontmatter.date) {<br/>    return false<br/>  }</span><span id="7737" class="mj kc if mb b fv mo ml l mm mn">  const dateNode = moment.tz(node.frontmatter.date, timezone)<br/>  const dateNow = moment().tz(timezone)<br/>  const value = dateNow.isSameOrAfter(dateNode)</span><span id="007c" class="mj kc if mb b fv mo ml l mm mn">  return value<br/>}</span></pre><p id="106f" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后我们给<code class="eh ly lz ma mb b">node.frontmatter.fields</code>添加<code class="eh ly lz ma mb b">released</code>和<code class="eh ly lz ma mb b">releasedNotForced</code>字段。我们需要的是使用<code class="eh ly lz ma mb b">onCreateNode</code>功能。</p><pre class="lf lg lh li fq mf mb mg mh aw mi dt"><span id="e244" class="mj kc if mb b fv mk ml l mm mn">// gatsby-node.js<br/>const onCreateNode = ({ node, actions }) =&gt; {<br/>  const MD_TYPE = 'MarkdownRemark'<br/>  const options = {<br/>    fieldName: 'released',<br/>    fieldNameNotForced: 'releasedNotForced',<br/>    timezone: 'UTC',<br/>    force: process.env.NODE_ENV === 'development',<br/>  }<br/>  const { createNodeField } = actions<br/>  const { fieldName, fieldNameNotForced } = options</span><span id="c2c8" class="mj kc if mb b fv mo ml l mm mn">  // Skip modifications for non-markdown files<br/>  if (node.internal.type !== MD_TYPE) {<br/>    return<br/>  }</span><span id="cdc9" class="mj kc if mb b fv mo ml l mm mn">  const value = getValue({ node, options })</span><span id="274b" class="mj kc if mb b fv mo ml l mm mn">  createNodeField({<br/>    node,<br/>    name: fieldName,<br/>    value: options.force === true ? true : value,<br/>  })<br/>  createNodeField({<br/>    node,<br/>    name: fieldNameNotForced,<br/>    value,<br/>  })<br/>}</span></pre><h1 id="a287" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">第二步。更新GraphQL查询以考虑<code class="eh ly lz ma mb b">released</code>值</h1><p id="0a61" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们需要从文件<code class="eh ly lz ma mb b">gatsby-node.js</code>的构建步骤中排除草稿，并考虑来自博客页面(如<code class="eh ly lz ma mb b">index.js.</code>)的<code class="eh ly lz ma mb b">released</code>值</p><p id="e211" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这两种情况下，查询看起来都像这样。注意一个过滤器属性。</p><pre class="lf lg lh li fq mf mb mg mh aw mi dt"><span id="8247" class="mj kc if mb b fv mk ml l mm mn">const query = graphql(<br/>  `<br/>    {<br/>      allMarkdownRemark(<br/>        sort: { fields: [frontmatter___date], order: DESC }<br/>        filter: { fields: { released: { eq: true } } }<br/>      ) {<br/>        edges {<br/>          node {<br/>            id<br/>          }<br/>        }<br/>      }<br/>    }<br/>  `<br/>)</span></pre><h1 id="356f" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">第三步。更新组件以不同方式呈现草稿</h1><p id="dddc" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">这一步完全取决于您的组件树。关键是通过GraphQL查询请求必要的字段。</p><pre class="lf lg lh li fq mf mb mg mh aw mi dt"><span id="f1f6" class="mj kc if mb b fv mk ml l mm mn">const query = graphql`<br/>  query {<br/>    allMarkdownRemark(<br/>      sort: { fields: [frontmatter___date], order: DESC }<br/>      filter: { fields: { released: { eq: true } } }<br/>    ) {<br/>      edges {<br/>        node {<br/>          id<br/>          fields {<br/>            slug<br/>            released<br/>            releasedNotForced<br/>          }<br/>        }<br/>      }<br/>    }<br/>  }<br/>`</span></pre><h1 id="3b65" class="kb kc if bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">结论</h1><p id="8489" class="pw-post-body-paragraph jc jd if je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">因此，我们有一个用于生产和开发的单一GraphQL查询，<code class="eh ly lz ma mb b">released</code>字段是自动计算的，草稿帖子可以不同地呈现。酷！</p><p id="d007" class="pw-post-body-paragraph jc jd if je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">注意了！我的<a class="ae ka" href="https://blog.swingpulse.com/10x-better-gatsby" rel="noopener ugc nofollow" target="_blank"> 10x better Gatsby </a>系列有草稿！:)所以去看看吧，敬请期待！</p><h2 id="e6c2" class="mj kc if bd kd mp mq mr kh ms mt mu kl jn mv mw kp jr mx my kt jv mz na kx nb dt translated">P.S .需要更多价值？厉害！</h2><figure class="lf lg lh li fq hw"><div class="bz el l di"><div class="nc nd l"/></div></figure></div></div>    
</body>
</html>