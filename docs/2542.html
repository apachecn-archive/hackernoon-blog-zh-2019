<html>
<head>
<title>JavaScript Array.reduce()</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript Array.reduce()</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/javascript-array-reduce-50403c421968#2019-04-21">https://medium.com/hackernoon/javascript-array-reduce-50403c421968#2019-04-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><p id="6bf2" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">我有多讨厌你？让我来数一数……</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="fe ff jq"><img src="../Images/7be4823320c5d1cf2d8f62c70fde43fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0Dqvmi5ib4OtO8gA24MTxQ.jpeg"/></div></div></figure><p id="60f1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce" rel="noopener ugc nofollow" target="_blank"> Array.reduce() </a>方法已经存在一段时间了。像<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank"> map() </a>，<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter" rel="noopener ugc nofollow" target="_blank"> filter() </a>和<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find" rel="noopener ugc nofollow" target="_blank"> find() </a>一样，它通过调用回调函数对一组值进行操作。</p><p id="bd6b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">这里有一个来自<a class="ae kc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/reduce" rel="noopener ugc nofollow" target="_blank">developer.mozilla.org 站点</a>的例子:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="0889" class="ki kj hu ke b fv kk kl l km kn">const array1 = [1, 2, 3, 4];<br/>const reducer = (accumulator, currentValue) =&gt; accumulator + currentValue;</span><span id="4049" class="ki kj hu ke b fv ko kl l km kn">// 1 + 2 + 3 + 4<br/>console.log(array1.reduce(reducer));<br/>// expected output: 10</span><span id="752a" class="ki kj hu ke b fv ko kl l km kn">// 5 + 1 + 2 + 3 + 4<br/>console.log(array1.reduce(reducer, 5));<br/>// expected output: 15</span></pre><p id="6d27" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">看起来很简单，对吧？继续抱怨:</p><h1 id="830b" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">0.它不会做你所期望的事情</h1><p id="8138" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">让我们再来看看这个:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="2359" class="ki kj hu ke b fv kk kl l km kn">const array1 = [1, 2, 3, 4];<br/>const reducer = (accumulator, currentValue) =&gt; accumulator + currentValue;</span><span id="0faf" class="ki kj hu ke b fv ko kl l km kn">// expected: 1 + 2 + 3 + 4 === 10</span></pre><p id="8ba4" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">现在我将修改 reducer 函数，为数组的每个值加 1，然后将其与前一个值相加。因为我将 1 加到 4 个数组元素上，所以我希望得到 14 的和。</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="2036" class="ki kj hu ke b fv kk kl l km kn">const array1 = [1, 2, 3, 4];<br/>const reducer = (accumulator, currentValue) =&gt; accumulator + currentValue + 1;</span><span id="6768" class="ki kj hu ke b fv ko kl l km kn">// (1+1) + (2+1) + (3+1) + (4+1) = 2+3+4+5 = 14<br/>console.log(array1.reduce(reducer));</span><span id="3481" class="ki kj hu ke b fv ko kl l km kn">// unexpected output: <strong class="ke hv">13</strong></span></pre><p id="311e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">等等…什么？</p><p id="ec3e" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">原来数组的第一个元素是初始累加器值。所以，代替</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="1187" class="ki kj hu ke b fv kk kl l km kn">(1+1) + (2+1) + (3+1) + (4+1) = 2+3+4+5 = 14</span></pre><p id="1d32" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它实际上是:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="8308" class="ki kj hu ke b fv kk kl l km kn">1 + (2+1) + (3+1) + (4+1) = 2+3+4+5 = 13</span></pre><p id="e719" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">所有<a class="ae kc" href="https://www.airpair.com/javascript/javascript-array-reduce" rel="noopener ugc nofollow" target="_blank">那些</a> <strong class="it hv">减少</strong> <a class="ae kc" href="https://www.w3schools.com/jsref/jsref_reduce.asp" rel="noopener ugc nofollow" target="_blank">的例子</a> <a class="ae kc" href="https://medium.freecodecamp.org/reduce-f47a7da511a9" rel="noopener ugc nofollow" target="_blank">在线</a>那些使用<a class="ae kc" href="https://appdividend.com/2018/10/16/javascript-reduce-example-tutorial/" rel="noopener ugc nofollow" target="_blank">求和</a>函数作为<a class="ae kc" href="https://codeburst.io/learn-understand-javascripts-reduce-function-b2b0406efbdc" rel="noopener" target="_blank">插图</a>的<a class="ae kc" href="https://www.codingame.com/playgrounds/5474/a-look-at-the-array-reduce-function" rel="noopener ugc nofollow" target="_blank">会误导</a>你。当然，您可以得到正确的答案:只需添加一个累加器初始值作为 reduce 方法的第二个参数:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="dcb1" class="ki kj hu ke b fv kk kl l km kn">console.log(array1.reduce(reducer, <strong class="ke hv">0</strong>));<br/>// desired output: 14</span></pre><h1 id="c55e" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">1.它被错误地命名</h1><p id="57d4" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">名字<em class="jp"> reduce </em>会让人认为它将一个元素数组简化为这些元素的子集。这不是它真正做的。事实上，它可以做与减少相反的事情:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="d695" class="ki kj hu ke b fv kk kl l km kn">const array1 = [1, 2, 3, 4];  // four elements<br/>const increaser = (accumulator, currentValue) =&gt; {<br/>  accumulator.push(currentValue);<br/>  accumulator.push(currentValue*currentValue);<br/>  return accumulator;<br/>};</span><span id="f503" class="ki kj hu ke b fv ko kl l km kn">console.log(array1.reduce(increaser, []));</span><span id="751f" class="ki kj hu ke b fv ko kl l km kn">// output: Array [1, 1, 2, 4, 3, 9, 4, 16] (8 elements)</span></pre><p id="53f9" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">它甚至不需要返回一个数组:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="35e7" class="ki kj hu ke b fv kk kl l km kn">const array1 = [1, 2, 3, 4];<br/>const transformer = (accumulator, currentValue) =&gt; {<br/>  accumulator[currentValue] = currentValue*currentValue;<br/>  return accumulator;<br/>};</span><span id="40a5" class="ki kj hu ke b fv ko kl l km kn">console.log(array1.reduce(transformer, {}));<br/>// output: Object { 1: 1, 2: 4, 3: 9, 4: 16 }</span></pre><h1 id="eb98" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">2.回调参数的顺序很奇怪</h1><p id="85bf" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">我们来比较一下 map()、filter()、find()和 reduce()的回调:</p><p id="db17" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">映射</strong>:(当前值，索引，数组，this) = &gt; {}</p><p id="6381" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">过滤器</strong>:(当前值，索引，数组，this) = &gt; {}</p><p id="e848" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv">找到</strong>:(当前值，索引，数组，this) = &gt; {}</p><p id="f87f" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated"><strong class="it hv"> reduce: </strong>(累加器，当前值，索引，数组)= &gt; {}</p><p id="f6b1" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您的回调将获得累加器作为第一个<strong class="it hv">参数，而不是当前值；此外，也没有采用<strong class="it hv">这个</strong>参数的参数。</strong></p><h1 id="ac13" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">3.错误:myVar.reduce 不是函数</h1><p id="00ae" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">我已经被<a class="ae kc" href="https://lodash.com/docs/4.17.11#reduce" rel="noopener ugc nofollow" target="_blank"> lodash </a>惯坏了，它把数组和对象都当做集合，集合有 map、find、filter、reduce 方法。JavaScript 不会这样简化:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="b509" class="ki kj hu ke b fv kk kl l km kn">var obj1 = {my:"dog", has: "fleas"};<br/>            <br/>const values = (accumulator, currentValue) =&gt; accumulator.push(currentValue);<br/>            <br/>console.log(obj1.reduce(values, []));</span><span id="2fc8" class="ki kj hu ke b fv ko kl l km kn">// &gt; <strong class="ke hv">Error: obj1.reduce is not a function</strong></span></pre><p id="a37c" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">正如达纳·卡维常说的，“不，不要这样做。这是不明智的。”(没错，我就是那么老。)</p><p id="2a00" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您仍然可以使用 Object.values 或 Object.entries 做类似的事情:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="2237" class="ki kj hu ke b fv kk kl l km kn">var obj1 = {my:"dog", has: "fleas"};<br/>            <br/>const values = (acc, [key, value]) =&gt; {acc.push(value); return acc}</span><span id="ddfd" class="ki kj hu ke b fv ko kl l km kn">console.log(Object.entries(obj1).reduce(values, []));</span><span id="df0c" class="ki kj hu ke b fv ko kl l km kn">// &gt; Array ["dog", "fleas"]</span></pre><h1 id="d7f7" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">4.累加器有时是可选的；结果有时是随机的</h1><p id="4cc2" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">很容易忘记累加器的初始值，即使你需要一个。让我们以上面例子为例，做一个修改:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="0cec" class="ki kj hu ke b fv kk kl l km kn">var obj1 = {my:"dog", has: "fleas"};<br/>            <br/>const values = (acc, [key, value]) =&gt; {acc.push(value); return acc}</span><span id="b577" class="ki kj hu ke b fv ko kl l km kn">console.log(Object.entries(obj1).reduce(values));</span><span id="bf5f" class="ki kj hu ke b fv ko kl l km kn">// <strong class="ke hv">&gt; Array ["my", "dog", "fleas"]</strong></span></pre><p id="153a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">你注意到代码的不同了吗？很难发现。更糟糕的是，除了第一个值无效之外，您还获得了一个值数组。还好我有一天要考试！</p><h1 id="d425" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">5.未定义？啊？</h1><p id="14b8" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">哦，你忘记归还蓄电池了。你真傻。我从不犯这种错误:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="cd72" class="ki kj hu ke b fv kk kl l km kn">var obj1 = {my:"dog", has: "fleas"};<br/>            <br/>const dog = (acc, [key, value]) =&gt; {<br/>  if (key === 'my') {<br/>    acc.push(value);<br/>    return acc;<br/>  }<br/>}</span><span id="e3da" class="ki kj hu ke b fv ko kl l km kn">console.log(Object.entries(obj1).reduce(dog, []));</span><span id="fbe9" class="ki kj hu ke b fv ko kl l km kn">// &gt; undefined</span></pre><p id="f58b" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">您必须始终归还累加器:</p><pre class="jr js jt ju fq kd ke kf kg aw kh dt"><span id="12f7" class="ki kj hu ke b fv kk kl l km kn">var obj1 = {my:"dog", has: "fleas"};<br/>            <br/>const dog = (acc, [key, value]) =&gt; {<br/>  if (key === 'my') {<br/>    acc.push(value);<br/>  }<br/>  return acc;<br/>}</span><span id="31ce" class="ki kj hu ke b fv ko kl l km kn">console.log(Object.entries(obj1).reduce(dog, []));</span></pre><h1 id="2a7a" class="kp kj hu bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll dt translated">所以我推荐什么来代替 reduce()？</h1><p id="aff8" class="pw-post-body-paragraph ir is hu it b iu lm iw ix iy ln ja jb jc lo je jf jg lp ji jj jk lq jm jn jo hn dt translated">我<em class="jp">总是</em>使用 Array.reduce()，你也应该这样。只知道它的怪癖。这就像一只小吉娃娃咬你的脚后跟，如果你不注意，它有时会咬你，但它大多是无害的(比吉娃娃有用得多)。</p><figure class="jr js jt ju fq jv fe ff paragraph-image"><div class="fe ff lr"><img src="../Images/89c353912c79a327f37f711873ef8060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*4SPngcEHWnuoRppNPYvIIg.jpeg"/></div></figure><p id="081a" class="pw-post-body-paragraph ir is hu it b iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo hn dt translated">快乐减！</p><figure class="jr js jt ju fq jv"><div class="bz el l di"><div class="ls lt l"/></div></figure></div></div>    
</body>
</html>