<html>
<head>
<title>How I coded my way to Early Tickets for Avengers Endgame</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我是如何提前买到复仇者联盟决赛门票的</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-i-coded-my-way-to-early-tickets-for-avengers-endgame-f2efa3a128a8#2019-07-05">https://medium.com/hackernoon/how-i-coded-my-way-to-early-tickets-for-avengers-endgame-f2efa3a128a8#2019-07-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/0fb85282c20f4910debbfa8de306d461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ztSIM39EhIvWCdN7NBv1nA.jpeg"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek"><a class="ae jg" href="https://www.marvel.com/movies/avengers-endgame" rel="noopener ugc nofollow" target="_blank">https://www.marvel.com/movies/avengers-endgame</a></figcaption></figure><p id="718f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">2019 年 4 月 26 日，我们这一代人最受炒作和最受期待的电影《复仇者联盟》上映了，我在班加罗尔的 IMAX 首映日抢了大厅里最好的座位。</p><p id="06ec" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当这部电影的上映日期公布时，我发现我已经预订了三个月前同一天晚上回家的机票。我住在班加罗尔，离机场差不多有 3 个小时的路程，我知道如果我不能买到早间演出的票，我等了将近一年的电影很可能会被毁掉&amp;我将无法在 IMAX 上观看我渴望已久的电影。</p><p id="169a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的处境很艰难，在这个城市，你需要至少提前 3-4 天预订周末的门票，而且随着《复仇者联盟》的大肆宣传，必须采取一些措施。我和我的朋友会定期更新<a class="ae jg" href="https://in.bookmyshow.com" rel="noopener ugc nofollow" target="_blank"> bookmyshow </a>，这是一个流行的活动门票预订门户网站，这样我们就不会错过门票，但我知道这种策略永远不会奏效。</p><p id="a535" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">唯一的解决方案是以某种方式自动化，编写一个脚本，定期刷新网站，当门票可用时，以某种方式提醒我们不要错过它。</p><h2 id="fb0b" class="kg kh hu bd ki kj kk kl km kn ko kp kq js kr ks kt jw ku kv kw ka kx ky kz la dt translated">找出什么时候票卖完了</h2><p id="90e6" class="pw-post-body-paragraph jh ji hu jj b jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka lf kc kd ke hn dt translated">因此，每部即将在 bookmyshow 上上映的<strong class="jj hv">电影都有自己的一页，每个城市都不一样。对于《复仇者联盟》在班加罗尔的结局，是这样的<a class="ae jg" href="https://in.bookmyshow.com/bengaluru/movies/avengers-endgame/ET00090482" rel="noopener ugc nofollow" target="_blank">https://in . bookmyshow . com/Bengal uru/movies/Avengers-Endgame/et 00090482</a></strong></p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lg"><img src="../Images/5e2de14a056fc2c462b49024d641b587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A2f2WvDYWjBeC1zkBaYu8Q.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Screenshot from bookmyshow.com portal</figcaption></figure><p id="cf33" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">唯一的区别是它还在【T10 即将推出】阶段的时候没有<strong class="jj hv">订票</strong>按钮。因此，我需要做的就是定期加载页面，并检查它何时最终获得按钮元素。它的 shell 脚本非常简单。</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="6611" class="kg kh hu lm b fv lq lr l ls lt"># curl the bookmyshow website</span><span id="0f0a" class="kg kh hu lm b fv lu lr l ls lt">output=`curl -s <a class="ae jg" href="https://in.bookmyshow.com/bengaluru/movies/avengers-endgame/ET00090482" rel="noopener ugc nofollow" target="_blank">https://in.bookmyshow.com/bengaluru/movies/avengers-endgame/ET00090482</a> | grep -c 'Book Tickets'`</span><span id="3c55" class="kg kh hu lm b fv lu lr l ls lt">if [ $output -gt 0 ]<br/>then<br/>  # Alert somehow, will come to that later<br/>fi</span></pre><p id="3481" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">为了定期运行它，我必须将脚本作为<a class="ae jg" href="https://en.wikipedia.org/wiki/Cron" rel="noopener ugc nofollow" target="_blank"> cron 作业</a>运行。但是把它加到我自己的机器上意味着我必须一直开着它，这是不可行的。我需要在某个远程服务器上添加这个 cron 作业，无论发生什么，它都将继续运行。因此，我将它添加到我为测试准备的远程 AWS 服务器中。如果您需要为自己提供 ec2 AWS 实例，您可以参考我的另一篇<a class="ae jg" rel="noopener" href="/@noel.varghese.22/setting-up-a-production-environment-using-our-local-development-server-and-aws-f5eea3b5be60">中型文章</a>的第一部分。我添加了下面的 crontab 条目</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="b2fa" class="kg kh hu lm b fv lq lr l ls lt"># Run the check_ticket script every minute as a scheduled cron<br/>*/1 * * * * sh /home/ec2-user/check_ticket.sh</span></pre><h2 id="1e39" class="kg kh hu bd ki kj kk kl km kn ko kp kq js kr ks kt jw ku kv kw ka kx ky kz la dt translated">有票时提醒</h2><p id="6589" class="pw-post-body-paragraph jh ji hu jj b jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka lf kc kd ke hn dt translated">现在我需要某种方式，让脚本能够在票到手后提醒我们。我唯一随身携带的东西就是我的手机，所以发送短信或触发自动呼叫似乎是我的最佳选择。我发现我可以使用<a class="ae jg" href="https://www.twilio.com/" rel="noopener ugc nofollow" target="_blank">Twilio</a>API 来免费实现同样的功能，因为它们在开始时提供了足够的信用来生成相当多的调用&amp;消息。</p><p id="76bb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">第一部分是获得一个 Twilio 号码，并注册几个手机号码，这些号码将使用这里的<a class="ae jg" href="https://www.twilio.com/docs/usage/tutorials/how-to-use-your-free-trial-account" rel="noopener ugc nofollow" target="_blank">提供的</a>文档获取电话和消息。<a class="ae jg" href="https://www.twilio.com/docs/sms/quickstart/python" rel="noopener ugc nofollow" target="_blank">短信</a>和<a class="ae jg" href="https://www.twilio.com/docs/voice/quickstart/python" rel="noopener ugc nofollow" target="_blank">语音</a>的快速入门指南简单易懂。最后，我写了一个脚本，它会通过给不同的号码发送消息来提醒两个人，以确保我的组中至少有人会被提醒。</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="9378" class="kg kh hu lm b fv lq lr l ls lt">#!/usr/bin/python</span><span id="96dd" class="kg kh hu lm b fv lu lr l ls lt">from twilio.rest import Client</span><span id="1c9d" class="kg kh hu lm b fv lu lr l ls lt"># Your Account SID from twilio.com/console<br/>account_sid = "xxxx"<br/># Your Auth Token from twilio.com/console<br/>auth_token  = "xxxx"</span><span id="aaa3" class="kg kh hu lm b fv lu lr l ls lt">client = Client(account_sid, auth_token)</span><span id="9e9f" class="kg kh hu lm b fv lu lr l ls lt">message = client.messages.create(<br/>    to="+xxxxxxxxxxxx",<br/>    from_="+zzzzzzzzzzzz",<br/>    body="Book Tickets for avengers endgame")</span><span id="5711" class="kg kh hu lm b fv lu lr l ls lt">call = client.calls.create(<br/>    to="+yyyyyyyyyyyy",<br/>    from_="+zzzzzzzzzzzz",<br/>    url="https://handler.twilio.com/twiml/xxxx")</span><span id="cd9a" class="kg kh hu lm b fv lu lr l ls lt"># Send message<br/>print(message.sid)</span><span id="0fdc" class="kg kh hu lm b fv lu lr l ls lt"># Trigger a call<br/>print(call.sid)</span></pre><p id="d60c" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">我的<strong class="jj hv"> check_ticket.sh </strong>脚本在计算出车票可用时调用上面的脚本。</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="5882" class="kg kh hu lm b fv lq lr l ls lt"># Curl the bookmyshow website</span><span id="fd79" class="kg kh hu lm b fv lu lr l ls lt">output=`curl -s <a class="ae jg" href="https://in.bookmyshow.com/bengaluru/movies/avengers-endgame/ET00090482" rel="noopener ugc nofollow" target="_blank">https://in.bookmyshow.com/bengaluru/movies/avengers-endgame/ET00090482</a> | grep -c 'Book Tickets'`</span><span id="68c1" class="kg kh hu lm b fv lu lr l ls lt">if [ $output -gt 0 ]<br/>then<br/>  /usr/bin/python /home/ec2-user/alert_by_twilio.sh<br/>fi</span></pre><h2 id="732f" class="kg kh hu bd ki kj kk kl km kn ko kp kq js kr ks kt jw ku kv kw ka kx ky kz la dt translated">结论</h2><p id="a5c1" class="pw-post-body-paragraph jh ji hu jj b jk lb jm jn jo lc jq jr js ld ju jv jw le jy jz ka lf kc kd ke hn dt translated">这就是全部——远程服务器上的两个小脚本就可以完成所有设置。当我为《复仇者联盟》建立网站时，我和我的朋友分别接到电话和信息，我们立即前往网站。门户网站花了一些时间来上传不同地点的各个大厅的门票。在多次付款失败后，我们终于得到了大厅里最好的座位，并有了一个惊人的免费剧透，第一次，IMAX 的电影体验。</p></div></div>    
</body>
</html>