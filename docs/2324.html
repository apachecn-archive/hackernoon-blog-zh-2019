<html>
<head>
<title>Creating A Photo Gallery in Swift Using Firebase &amp; INSPhotoGallery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Firebase &amp; INSPhotoGallery在Swift中创建照片库</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/creating-a-photo-gallery-in-swift-using-firebase-insphotogallery-2a39196bcf1?source=collection_archive---------14-----------------------#2019-04-11">https://medium.com/hackernoon/creating-a-photo-gallery-in-swift-using-firebase-insphotogallery-2a39196bcf1?source=collection_archive---------14-----------------------#2019-04-11</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/07327968681b8e1a59af76096d731822.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cvJZ8jZgXx0e5z-51COCEg.jpeg"/></div></div></figure></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><p id="ecdc" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">我目前正在开发一款名为i-Travel Journal的旅行应用程序，其中一个我想添加的功能是允许用户上传和删除T2图库中的照片。我在互联网上搜索一篇博文，这篇博文不仅在后端使用了<a class="ae kh" href="https://hackernoon.com/tagged/firebase" rel="noopener ugc nofollow" target="_blank"> Firebase </a>，还使用了令人敬畏的INSPhotoGallery Pods框架来完成工作，但令我沮丧的是，我找不到一篇展示所有复杂细节的博文。因此，为了帮助我的程序员同事，我决定发布一个帖子来帮助某人建立并运行他们的照片库。</p><p id="3d4d" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">为了使这篇博文简短，我将提供Firebase文档的链接来帮助您开始，如果您还没有将它集成到您的应用程序中的话。</p><p id="03b9" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated"><a class="ae kh" href="https://firebase.google.com/docs/ios/setup" rel="noopener ugc nofollow" target="_blank"> Firebase SDK iOS入门</a></p><p id="b0aa" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated"><a class="ae kh" href="https://firebase.google.com/docs/database/ios/start" rel="noopener ugc nofollow" target="_blank"> Firebase实时数据库入门</a></p></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><h1 id="6b73" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated"><strong class="ak"> 1。首先初始化一个新的视图控制器&amp;初始化UICollectionView的委托</strong></h1><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lg"><img src="../Images/3e554f70199fcf0df58e53314d1eb783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ba4UMi8jTbN1RdIMmbvImQ.png"/></div></div></figure></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="04b9" class="lq kj hu lm b fv lr ls l lt lu">import UIKit<br/>import Firebase<br/>import FirebaseDatabase<br/>import FirebaseFirestore</span><span id="ae9c" class="lq kj hu lm b fv lv ls l lt lu">class ViewController: UIViewController, UICollectionViewDataSource, UICollectionViewDelegate, UIImagePickerControllerDelegate{<br/>var ref: DatabaseReference!<br/>@IBOutlet weak var collectionView: UICollectionView?<br/> var URLs = []()<br/> lazy var gallery: [INSPhotoViewable] = []</span><span id="9131" class="lq kj hu lm b fv lv ls l lt lu">    override func viewDidLoad() {<br/>       collectionView!.delegate = self<br/>       collectionView!.dataSource = self<br/>    }<br/>}</span></pre><p id="761d" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">当你第一次初始化类<strong class="jl hv"><em class="lw">view controller</em></strong>时，你会得到一个空白的UIViewController类，我们想使用一个<strong class="jl hv"><em class="lw">UICollectionView</em></strong>来显示我们的图库，所以我们使用适当的委托方法<strong class="jl hv"><em class="lw">UICollectionView delegate</em></strong>以及<strong class="jl hv"><em class="lw">UICollectionView data source</em></strong>来在我们的视图控制器中覆盖某些功能。我们还将使用<strong class="jl hv"><em class="lw">ui image picker</em></strong>从用户图库中选择一个图像，因此我们使用<strong class="jl hv"><em class="lw">ui image picker controller delegate。</em> </strong></p><p id="5f22" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">我还初始化了一些变量，我们稍后会用到。</p><p id="cde3" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">下面的方法是我们将用来实现画廊以及一些助手方法，我也将创建:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="8f95" class="lq kj hu lm b fv lr ls l lt lu">func collectionView(_ collectionView: UICollectionView, numberOfItemsInSection section: Int) -&gt; Int {</span><span id="46a8" class="lq kj hu lm b fv lv ls l lt lu">return gallery.count + 1</span><span id="7a77" class="lq kj hu lm b fv lv ls l lt lu">//Add the additional 1 to use it as the placeholder for the gallery selector image</span><span id="b719" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><pre class="ll lm ln lo aw lp dt"><span id="c9cd" class="lq kj hu lm b fv lx ly lz ma mb ls l lt lu">func numberOfSections(in collectionView: UICollectionView) -&gt; Int {</span><span id="06a6" class="lq kj hu lm b fv lv ls l lt lu">return 1<br/>//We are only using one section of collections views for this example<br/>//If you want to add filters to your gallery you could increase the section count</span><span id="8cdc" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><pre class="ll lm ln lo aw lp dt"><span id="211c" class="lq kj hu lm b fv lx ly lz ma mb ls l lt lu">func collectionView(_ collectionView: UICollectionView, cellForItemAt indexPath: IndexPath) -&gt; UICollectionViewCell {</span><span id="5244" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><pre class="ll lm ln lo aw lp dt"><span id="04fa" class="lq kj hu lm b fv lx ly lz ma mb ls l lt lu">func collectionView(_ collectionView: UICollectionView, didSelectItemAt indexPath: IndexPath) {</span><span id="dc06" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><pre class="ll lm ln lo aw lp dt"><span id="a3c0" class="lq kj hu lm b fv lx ly lz ma mb ls l lt lu">func collectionView(_ collectionView: UICollectionView,</span><span id="b85f" class="lq kj hu lm b fv lv ls l lt lu">layout collectionViewLayout: UICollectionViewLayout,</span><span id="ea32" class="lq kj hu lm b fv lv ls l lt lu">sizeForItemAt indexPath: IndexPath) -&gt; CGSize {<br/>return CGSize.init(width: 150, height: 150)<br/>//This is the default size, you can change it to fit your needs</span><span id="0c21" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre><h1 id="2224" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak"> 2。跳进主通道。故事板并用我们的组件初始化我们的UIViewController】</strong></h1><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mh"><img src="../Images/491680de820bb2eedfdaadb767deeeab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VSM2LpCT5iuVG4Mt7ErY9Q.png"/></div></div></figure><p id="14ec" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">既然我们已经找到了方法，我们现在就进入正题。故事板和设置我们的组件。首先，我们从空白故事板的组件列表中拖动一个ViewController。在侧菜单上，我们使用自定义类选项卡，并选择我们刚刚创建的自定义视图控制器的名称，您可以随意命名，但要确保它在整个应用程序中保持一致。</p><p id="181a" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">接下来，我们在ViewController上拖动一个UICollectionView，这将自动在它下面创建一个UICollectionViewCell组件，我们将使用它来显示CollectionView的每一行所需的内容。</p><p id="fdc1" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">对于UICollectionView中的一个单元格，我们希望一个UIImageView显示一个图像以及一个删除图像的删除按钮。因此，在出现的单元格中，我拖动了一个UIImageView和一个button组件。我利用自动布局约束来定位按钮，你可以把按钮放在图像的任何角落，你可以使用你的判断力。对于删除按钮的图标，我从这里的<a class="ae kh" href="http://icons8.com" rel="noopener ugc nofollow" target="_blank">获得图标</a>，并将其拖动到Assets.xcassets文件中。我还为图库图片的单元格使用了一个占位符缩略图，您可以通过点击UIImageView并在右侧菜单中选择它来使用您选择的任何图片，只要确保它在Assets文件夹中即可。</p><h1 id="cacb" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak"> 3。创建自定义UICollectionViewCell </strong></h1><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mi"><img src="../Images/a768f8795c935d074ab538eaf98c2c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fC9q9IVHsrceQSXFTLhYfg.png"/></div></div></figure><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="b243" class="lq kj hu lm b fv lr ls l lt lu">import UIKit</span><span id="6ce9" class="lq kj hu lm b fv lv ls l lt lu">class CustomUICollectionViewCell: UICollectionViewCell {</span><span id="99d2" class="lq kj hu lm b fv lv ls l lt lu">@IBOutlet weak var image: UIImageView!</span><span id="c4ba" class="lq kj hu lm b fv lv ls l lt lu">@IBOutlet weak var delete: UIButton!</span><span id="3ffd" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre><p id="5d35" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">现在我们有了我们想要的UICollectionViewCell的结构，我们需要创建一个定制类来模拟它的结构。所以我们所做的就是创造我们自己的。</p></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><p id="244f" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">现在我们已经创建了这个类，我们回到我们的Main。Storyboard类，并开始将我们刚刚创建的自定义类连接到我们刚刚拖放的UICollectionViewCell组件，方法是转到右侧面板并选择它。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/c18aa00711bd61588dc82dbd4040d6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*Ab4nZn7GfU6Jb3SrdJrRbA.png"/></div></figure><p id="ef71" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">接下来，我们开始连接刚刚在自定义类中创建的UIImage和按钮。我们还想给UICollectionViewCell一个惟一的名称，这样我们以后就可以在代码中使用它，所以在下面的菜单中将其设置为。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div class="fe ff mk"><img src="../Images/c5571bc7f1b3b87a2ff000518bda3ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*J_VZLZOYhlRYhnUuxtI_NQ.png"/></div></figure></div><div class="ab cl jc jd hc je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="hn ho hp hq hr"><h1 id="9c96" class="ki kj hu bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dt translated"><strong class="ak"> 4。我们返回到我们的助手方法&amp;委托方法</strong></h1><p id="462b" class="pw-post-body-paragraph jj jk hu jl b jm ml jo jp jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg hn dt translated">既然我们已经通过定制类完成了故事板和代码中需要做的所有连接工作，现在我们可以开始操作我们之前创建的方法了。</p><p id="0295" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">首先也是最重要的，看一下下面的文档，并在照片图库中安装<a class="ae kh" href="https://github.com/inspace-io/INSPhotoGallery/" rel="noopener ugc nofollow" target="_blank">的可可豆荚。这就是我们将用来实际显示点击时的画廊。</a></p><h1 id="dfc7" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">助手方法(一大堆)</strong></h1><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="96d2" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">这三种辅助方法是肉🍖和土豆🥔的应用程序。Firebase是dope应用程序，它允许我们定义想要保存的记录的结构，以便轻松自由地操作和检索。为了不在每次添加新图像时覆盖所有图像，我们必须尝试以一种易于检索的方式构建图像，如下所示:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="4e7a" class="lq kj hu lm b fv lr ls l lt lu">-Gallery<br/>   ID -&gt; URL</span><span id="daf1" class="lq kj hu lm b fv lv ls l lt lu">Gallery-<br/><a class="ae kh" href="https://console.firebase.google.com/u/0/project/mytravelapp-e365b/database/mytravelapp-e365b/data/users/DTObuv266HZYF0TjHvG6cXzcxyk1/entries/-LbjHVLUJ9ZeJnQ5g3Nz/gallery/5C3E4F78-FC18-46C7-8545-26D229861465" rel="noopener ugc nofollow" target="_blank"><strong class="lm hv">5C3E4F78-FC18-46C7-8545-26D229861465</strong></a><strong class="lm hv">:</strong>"<a class="ae kh" href="https://firebasestorage.googleapis.com/v0/b/mytravelapp-e365b.appspot.com/o/gallery%2F6CE2EAA7-14B8-4820-9737-466FD95AA11E.jpg?alt=media&amp;token=b621d365-aaee-4666-9817-d8dee0022afc" rel="noopener ugc nofollow" target="_blank">https://firebasestorage.googleapis.com/v0/b/mytravelapp-e365b.appspot.com/o/gallery%2F6CE2EAA7-14B8-4820-9737-466FD95AA11E.jpg?alt=media&amp;token=b621d365-aaee-4666-9817-d8dee0022afc</a>"</span></pre><p id="50b9" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">每个图像都在gallery子对象下，每个子对象都有一个惟一的id，指向Firebase存储中的一个URL位置</p><h1 id="67f0" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">提取图库</strong></h1><p id="5412" class="pw-post-body-paragraph jj jk hu jl b jm ml jo jp jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg hn dt translated">fetch gallery方法检查Firebase中是否有属于子属性gallery的元素。它遍历并尝试填充我们之前创建的gallery数组，但是在我们完成操作之前，我们希望在调用imageToURL方法之前防止Gallery显示重复的记录。<a class="ae kh" href="https://firebase.google.com/docs/database/admin/retrieve-data" rel="noopener ugc nofollow" target="_blank"> <strong class="jl hv">可以参考Firebase文档了解如何查询数据的语法。</strong> </a></p><p id="d4a1" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">因此，它使用contains方法扫描图库，查看辅助功能引用在图库中是否有任何重复。虽然可访问性引用通常用作图像的描述性文本，但是我们在这个实例中使用它来惟一地跟踪Firebase中使用的ID。</p><h1 id="2de7" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">图像浏览</strong></h1><p id="3af4" class="pw-post-body-paragraph jj jk hu jl b jm ml jo jp jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg hn dt translated">正如在INSPhotoGallery文档中看到的，他们使用INSPhoto对象来初始化他们的图库。为了显示UICollectionCell的每个元素缩略图，我们必须点击Firebase提供的URL，以便下载图像并在应用程序中显示它。因此，每次向视图添加元素时，我们都刷新CollectionView，以便用最新的图像更新UI，这就是为什么使用DispatchQueue.main.async，以便它在主线程上激活。</p><h1 id="1310" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">上传图像至防火墙库</strong></h1><p id="cebe" class="pw-post-body-paragraph jj jk hu jl b jm ml jo jp jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg hn dt translated">这个方法实际上处理上传到Firebase的数据。目标是当用户从UIImagePicker中选择一个图像时，他们能够立即将数据上传到Firebase。实时数据库中的数据在很大程度上依赖于成功上传到Firebase存储的图像。当图像成功上传后，完成处理程序将返回一个下载url，其中包含到实际图像的链接，该链接被附加到现有的图库数组中。如果上传过程有任何问题，将会触发一个警报，使用以下代码通知用户:</p><pre class="lh li lj lk fq ll lm ln lo aw lp dt"><span id="587f" class="lq kj hu lm b fv lr ls l lt lu">func displayAlert( title: String, message: String){</span><span id="2ba9" class="lq kj hu lm b fv lv ls l lt lu">let alert = UIAlertController.init(title: title , message: message</span><span id="c907" class="lq kj hu lm b fv lv ls l lt lu">, preferredStyle: .alert)</span><span id="4d42" class="lq kj hu lm b fv lv ls l lt lu">let dismiss = UIAlertAction.init(title: "dismiss", style: .default, handler: nil)</span><span id="6bc3" class="lq kj hu lm b fv lv ls l lt lu">alert.addAction(dismiss)</span><span id="45ca" class="lq kj hu lm b fv lv ls l lt lu">present(alert, animated: true, completion: nil)</span><span id="804d" class="lq kj hu lm b fv lv ls l lt lu">}</span></pre><h1 id="e67d" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak"> CellForRowAt </strong></h1><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="029e" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">在这个方法中，我们为我们看到的每个单元格设置视图。IndexPath是跟踪索引号的工具，用于遍历我们拥有的单元格数组。还记得我们之前创建的自定义单元格名称吗？我们用它来标识我们创建的单元定制组件的结构。</p><p id="6dfe" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">因此，对于第一个单元格行，我希望显示图库图像，允许用户与单元格交互，并隐藏删除按钮。</p><p id="6c11" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">对于所有其他单元格，我希望显示删除按钮。我添加了一个名为handle click的方法，我将在后面详细讨论这个方法，它实际上处理单击时记录的删除。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ms"><img src="../Images/44a770bd3c8a38385dfb87613a31206b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g4mt_N6idxx4vdBWmqne9Q.png"/></div></div></figure><h1 id="5375" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated">手柄点击</h1><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="7060" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">此方法适用于每个附加了删除按钮的按钮。为了防止用户轻易删除元素，我使用了一个<strong class="jl hv"><em class="lw">ui alert controller</em></strong>作为用户的安全卫士。如果选择了<strong class="jl hv"><em class="lw">‘是’</em></strong>，使用通过<strong class="jl hv"> CellForItemAt </strong>方法中的<strong class="jl hv"> IndexPath.row </strong>应用的sender.tag，则使用通过可访问性标识符传递的唯一id来标识元素，它在Firebase中找到记录并将其设置为Nil。当从Firebase中删除一个元素时，会调用FetchGallery来更新UI以删除该元素。Fetch Gallery使用一个观察处理程序，该处理程序一旦设置好，就会监听对记录的任何更新，如删除、添加或更新现有记录。</p><h1 id="2670" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated">DidSelectItemAt</h1><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="eebf" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated"><strong class="jl hv"> didSelectItemAt </strong>处理用户点击图片时发生的事情。如果索引为0，将显示图像拾取器。我将在下面详细讨论这个问题。INSPhotoGallery的魔力还没有真正展现出来，但这就是它现在大放异彩的地方。因为我为图库图像创建了一个占位符，indexPath的偏移量为1，所以为了准确显示数组的实际大小，我将数组的总计数减1。</p><p id="8872" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">这实际上是从INSPhotoGallery文档中复制和粘贴的。在坚果壳中，他们的代码所做的是遍历图库数组的索引，并检查其中是否真的有图像。如果有图像，它会使用他们设置的特殊视图控制器以全尺寸显示。</p><h1 id="4ff6" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">图像拾取控制器</strong></h1><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mq mr l"/></div></figure><p id="ae6e" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">这是最后也是最后一部分，为了上传图片，你需要一张图片！为了获得该图像，我们使用UIImagePicker，并允许用户有机会从他们选择的图库中挑选一个图像。</p><p id="6a08" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">如果用户成功地选择了一个图像，我们同时做两件事，我们将图像添加到Gallery数组，然后我们使用存储引用调用上面定义的uploadImageToFirebase方法。之后，我们重新加载集合视图，以便新的更改可以生效。</p><h1 id="a9d8" class="ki kj hu bd kk kl mc kn ko kp md kr ks kt me kv kw kx mf kz la lb mg ld le lf dt translated"><strong class="ak">结论</strong></h1><p id="5e18" class="pw-post-body-paragraph jj jk hu jl b jm ml jo jp jq mm js jt ju mn jw jx jy mo ka kb kc mp ke kf kg hn dt translated">今天，我们使用Firebase实时数据库以及Firebase存储和PhotoGallery中流行的图片库框架创建了一个图片库。虽然这可能看起来很复杂，但您可以通过查看一个简单的应用程序来了解Firebase集成到应用程序中的速度有多快。</p><figure class="lh li lj lk fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mt"><img src="../Images/c9a7448f9d2d89b126f5390a4d943adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PhSJ8S5dYpdh0ocgJTrfeA.png"/></div></div></figure><p id="363a" class="pw-post-body-paragraph jj jk hu jl b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg hn dt translated">我也邀请您试用我的应用程序<a class="ae kh" href="https://testflight.apple.com/join/KCqNit2x" rel="noopener ugc nofollow" target="_blank"> I-Travel Journal </a>的测试版。如果你愿意帮忙，测试一下，并在下面的<a class="ae kh" href="https://docs.google.com/forms/d/e/1FAIpQLScu3QYn-tV5l1np8vw5y9urBJ3Br5X18_i4AIvONOnAybzIUw/viewform?usp=sf_link" rel="noopener ugc nofollow" target="_blank">链接</a>留下反馈。感谢您阅读我的帖子，查看我以前的帖子以获取有用的信息。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="mu mr l"/></div></figure></div></div>    
</body>
</html>