<html>
<head>
<title>How to build Authentication using Cosmic JS, Vue, and Lambda</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用 Cosmic JS、Vue 和 Lambda 构建认证</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/how-to-build-authentication-using-cosmic-js-vue-and-lambda-e0e243d9b90b#2019-06-03">https://medium.com/hackernoon/how-to-build-authentication-using-cosmic-js-vue-and-lambda-e0e243d9b90b#2019-06-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/06a886c78de40473cbadd5000885bc1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWVhUr9B3T2dggZLAPrWdw.jpeg"/></div></div></figure><p id="ef19" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将向您展示在部署到 Netlify 之前，我如何使用 Cosmic JS 和 AWS Lambda 构建一个带有身份验证的 Vue.js 应用程序。让我们开始吧。</p><h1 id="9e61" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">TL；速度三角形定位法(dead reckoning)</h1><p id="dc2b" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><a class="ae ld" href="https://cosmicjs.com/apps/vue-cosmic-auth" rel="noopener ugc nofollow" target="_blank">演示链接</a> <br/> <a class="ae ld" href="https://github.com/cosmicjs/vue-authentication" rel="noopener ugc nofollow" target="_blank">在 Github 上查看代码</a></p><h1 id="4c9d" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">特征</h1><ul class=""><li id="13d6" class="le lf hu je b jf ky jj kz jn lg jr lh jv li jz lj lk ll lm dt translated">网络虚拟主机(加上 CDN、预渲染、缩小等..)</li><li id="b11f" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">验证接口的组件</li><li id="b061" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">AWS Lambda 通过网络功能</li><li id="962b" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">用于数据库 API 的 Cosmic JS</li><li id="4616" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">使用 PBKDF2 和 Salt 进行密码哈希</li><li id="ad29" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">通过 SendinBlue 使用 Nodemailer 进行电子邮件验证</li></ul><h1 id="215a" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">需要改进</h1><ul class=""><li id="ef64" class="le lf hu je b jf ky jj kz jn lg jr lh jv li jz lj lk ll lm dt translated">密码重置功能</li><li id="9109" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">用户头像支持</li></ul><h1 id="9ae9" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">先决条件</h1><p id="4550" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">在启动之前，您需要拥有节点 JS 和 npm。确保您已经安装了它们。如果没有，你可以在这里找到他们:<a class="ae ld" href="https://nodejs.org/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org</a></p><p id="08d2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了进行部署，您需要一个 Netlify 帐户。</p><p id="5099" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">另外，对于 SMTP 服务器发送电子邮件验证链接，我使用的是<a class="ae ld" href="https://www.sendinblue.com/" rel="noopener ugc nofollow" target="_blank"> SendInBlue </a>，因为他们每天给你 300 封免费邮件。</p><h1 id="10a3" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">项目结构</h1><p id="e827" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated"><strong class="je hv">重要注意事项:</strong></p><p id="5a4b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">~/public/_ redirects</strong><br/>这个文件很重要，因为它将所有流量指向 index.html 文件，以便 vue-router 处理请求。要了解更多关于网络重定向的信息<a class="ae ld" href="https://www.netlify.com/docs/redirects/" rel="noopener ugc nofollow" target="_blank">请访问他们的文档</a>。</p><p id="0161" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> ~/cosmic.js </strong></p><p id="c1f7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">~/functions</strong><br/>functions 目录保存了我们所有的 lambda 函数，一旦我们部署到 netlify，这些函数将自动在 AWS 上运行。我们将使用这些函数来处理 Cosmic JS 所需的散列和数据库逻辑。</p><h1 id="ff8d" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">分叉和克隆</h1><p id="91c0" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">首先，我们将分叉 GitHub 上的存储库。然后，打开命令行或终端，用以下命令将其克隆到本地机器上的项目文件夹中:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="0c07" class="mb kb hu lx b fv mc md l me mf">git clone <a class="ae ld" href="https://github.com/cosmicjs/vue-authentication" rel="noopener ugc nofollow" target="_blank">https://github.com/cosmicjs/vue-authentication</a></span></pre><p id="b455" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">用 BitBucket 还是 Gitlab 代替？</p><p id="d26e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您喜欢使用不同的 git 提供程序，您可以克隆存储库并将其上传到您想要的远程。</p><h1 id="1d34" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">安装</h1><p id="8283" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">在您的命令行 cd 中，进入您刚才克隆的项目根目录，并运行 npm install 来下载并安装所有必需的依赖项。</p><h1 id="f8ec" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">集成宇宙 JS 桶</h1><p id="430f" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">在你的宇宙 JS 帐户中创建一个新的桶，你想叫它什么都行。</p><p id="dc67" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">下载这个 bucket.json 文件，在你的 cosmic JS bucket 的设置中进入导入/导出数据页面，选择并上传下载的文件。这将导入所有对象类型和占位符数据。</p><p id="5425" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，您需要修改项目目录中的 cosmic.js 文件，以连接到您刚刚创建的 bucket。</p><p id="4597" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是你需要的:</p><ul class=""><li id="f22b" class="le lf hu je b jf jg jj jk jn mg jr mh jv mi jz lj lk ll lm dt translated">铲斗废料浆</li><li id="bf09" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">API 读取访问键</li><li id="e185" class="le lf hu je b jf ln jj lo jn lp jr lq jv lr jz lj lk ll lm dt translated">API 写访问键</li></ul><p id="aed2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> ~/cosmic.js </strong></p><figure class="ls lt lu lv fq iv"><div class="bz el l di"><div class="mj mk l"/></div></figure><h1 id="c0b0" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">集成 SendInBlue SMTP</h1><p id="767c" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">为了进行电子邮件验证，您需要一个 SMTP 服务器。为了简化本教程，我将使用<a class="ae ld" href="https://www.sendinblue.com/" rel="noopener ugc nofollow" target="_blank"> SendInBlue </a>，因为他们为您提供了 300 封免费电子邮件，并使用 Nodemailer npm 包来集成。</p><p id="3ca5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在你创建了一个账户后，进入你的 SMTP &amp; API 设置来生成一个 SMTP 密钥用于<strong class="je hv"> CreateNewUser.js </strong> Lambda 函数，你可以在“SMTP”标签下找到它。</p><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/249e350944b6a7f1400fb60071700fcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MPYpKryoDSZMkCEC.png"/></div></div></figure><p id="d9d5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后输入以下 transporter 对象的电子邮件和 SMTP 密码。</p><p id="6090" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">~/functions/create new user . js</strong></p><figure class="ls lt lu lv fq iv"><div class="bz el l di"><div class="mj mk l"/></div></figure><h1 id="d858" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">在本地运行您的应用</h1><p id="714a" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">为了让 AWS Lambda 函数在本地正常运行，您需要运行以下命令:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="27db" class="mb kb hu lx b fv mc md l me mf">npm run start:lambda</span></pre><p id="d0f9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这将使用网络函数库启动本地函数服务器。</p><p id="bbcd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，你需要确保你的根项目目录中有一个. env 文件来改变 VUE _ 应用程序 _ 应用程序接口 _ 主机变量，以指向你刚刚开始运行的 lambda 服务器。不然你的 app 就不行了。默认情况下，我的启动端口是 9000。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="cef9" class="mb kb hu lx b fv mc md l me mf">VUE_APP_API_HOST=http://localhost:9000/</span></pre><p id="3dcf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">之后，您可以打开另一个控制台，最后使用以下命令启动 Vue JS 应用程序:</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="b527" class="mb kb hu lx b fv mc md l me mf">npm run serve</span></pre><p id="c2c4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了在本地测试 API，你可能需要在禁用 CORS 的情况下运行 Chrome，你可以根据你的操作系统使用以下有用的列表找到如何做:</p><p id="0407" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">视窗:</strong></p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="c09f" class="mb kb hu lx b fv mc md l me mf">"C:\Program Files (x86)\Google\Chrome\Application\chrome.exe" --disable-web-security --disable-gpu --user-data-dir=~/chromeTemp</span></pre><p id="cac6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> OSX: </strong></p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="ca9e" class="mb kb hu lx b fv mc md l me mf">open -n -a /Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome --args --user-data-dir="/tmp/chrome_dev_test" --disable-web-security</span></pre><p id="f2ea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Linux: </strong></p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="e6e1" class="mb kb hu lx b fv mc md l me mf">google-chrome --disable-web-security</span></pre><p id="8edf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在您可以导航到<a class="ae ld" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>来打开应用程序。</p><h1 id="6c35" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">使用网络部署</h1><p id="e507" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">转到您的 Netlify 仪表板，然后单击“<a class="ae ld" href="https://app.netlify.com/start" rel="noopener ugc nofollow" target="_blank">来自 Git 的新站点</a>”。选择你的 git 提供者(我用 GitHub)。</p><p id="0d56" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">认证后，您可以看到您的存储库列表。选择您为之前创建的项目创建的文件，并将构建命令设置为“npm run build ”,将发布目录设置为“dist”。</p><figure class="ls lt lu lv fq iv fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/fc8a75c8b675fcbff2436a40aea036fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/0*se61eEsloNS9SZq1.png"/></div></figure><p id="73fe" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，您需要确保您已经设置了环境变量，并且让 VUE _ 应用程序 _ 应用程序接口 _ 主机变量指向您刚刚在 Netlify 中创建的新站点。否则你的应用程序将无法工作。</p><pre class="ls lt lu lv fq lw lx ly lz aw ma dt"><span id="c3d0" class="mb kb hu lx b fv mc md l me mf">VUE_APP_API_HOST=https://yourNewSite.netlify.com/</span></pre><p id="2ba1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，您想要设置您的函数目录以使用“lambda ”,它将是<strong class="je hv"> /functions </strong>文件夹的编译版本。</p><h1 id="4d4c" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">结论</h1><p id="bf8e" class="pw-post-body-paragraph jc jd hu je b jf ky jh ji jj kz jl jm jn la jp jq jr lb jt ju jv lc jx jy jz hn dt translated">我在麻省理工学院的许可下为开源开发了这个应用程序，所以你可以随意升级、破解或破坏它。</p><p id="06b3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是使用 Cosmic JS 为用户数据库构建的..和用于哈希的密码哈希加盐库。哦，不要忘记 Vuetify，由 John Leider 和 200 多个开源贡献者开发的令人惊叹的 Vue JS 组件库。</p><p id="2283" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">电子邮件验证是使用 SMTP 服务器与 SendinBlue 托管，他们给你 300 个免费的跨国电子邮件。然后当然是 Vuex 的状态管理。</p><p id="aaf6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你有困难或者它对你不起作用，请在评论中告诉我，我会尽力帮助你的！或者通过 twitter <a class="ae ld" href="https://www.twitter.com/aaron_vail" rel="noopener ugc nofollow" target="_blank"> @Aaron_Vail </a></p></div></div>    
</body>
</html>