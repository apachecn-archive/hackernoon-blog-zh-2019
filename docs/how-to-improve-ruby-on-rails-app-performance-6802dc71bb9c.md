# 如何提高 Ruby on Rails 应用程序的性能

> 原文：<https://medium.com/hackernoon/how-to-improve-ruby-on-rails-app-performance-6802dc71bb9c>

![](img/cffd7730319b3a78f10f22f2b28caee7.png)

应用程序的速度和性能对于项目的成功至关重要。用户期望应用程序尽可能快地加载，我们的主要任务就是满足他们的期望。

经验丰富的 IT 专业人员和初级开发人员都试图解决 Ruby on Rails 优化的问题。幸运的是，我们知道这是怎么回事。根据我们关于如何提高 Ruby on Rails 应用程序性能的建议，您的项目一定会取得成功。

# 开始优化应用程序之前，请记住 3 件事

为了达到预期的效果，你需要了解更多的主题。因此，在我们详细描述要采取的步骤之前，先看一下以下因素:

## 性能测定

早在 2011 年，几乎一半的互联网用户希望应用程序页面在 3 秒或更短时间内加载。随着时间的推移，互联网连接有所改善，页面加载速度也有所提高。如今，用户希望一个应用程序在眨眼之间就能加载。这是你需要准备好的。

有各种工具可用于监控网站性能。我们已经使用 Ruby 应用很多年了，以下是一些建议:

## 网页测试

[网页测试](https://www.webpagetest.org/)基于众多指标提供关于应用性能的一般信息。绩效评估会议的结果清晰、准确且易于获取。这个工具很容易使用。

## PageSpeed 洞察

你用过速度分数表现指标吗？这是 [PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights/) 使用的谷歌工具。该解决方案提供了有关 web 和桌面性能的信息。因此，您对应用程序在不同环境下的工作方式有了一个完整的了解。最重要的是，Google 在对网页进行排名时，考虑了 PageSpeed 性能测量结果。您的 web 应用程序显示的性能越好。在搜索结果页面上的排名越高。

## 新遗迹 APM

新遗迹 APM 将满足你的所有需求。它不仅是 Ruby 应用程序的绝佳选择，也是 Java、Node.js、Python 和许多其他解决方案的绝佳选择。这是一个基于云的系统，具有清晰直观的界面，它为您提供有关任何应用环境的所有重要细节。在这里，您可以找到关键指标，并确保您的应用运行良好。此外，新遗迹 APM 可以帮助您解决其他问题。它会实时分析这些问题，并显示修复它们的方法。

# 对实际需要优化的元素进行优化

最近，我们的一个合伙人给我们带来了一个特别有趣的案例。他无法优化 Ruby 应用程序，他尝试的每一次改进都导致了比最初版本更差的性能。

我们分析了形势，衡量了重要指标，并比较了结果。结论很有趣:当处理 Ruby 应用程序性能时，您只需要对那些真正需要的元素进行必要的修改。所以，花更多的时间来找出弱点，并集中精力去克服它们。没有必要从头开始重写应用程序或尝试优化整个解决方案。

# 了解有用的宝石和插件

Ruby 性能优化需要代码清理和繁琐的手工重构。但是许多第三方工具可以帮助您快速完成这项日常工作。

特定的 Ruby gems 和插件为代码优化提供了巨大的帮助。例如:

*   [Bullet gem](https://rubygems.org/gems/bullet/versions/5.7.5) 有助于无缝解决稍后将讨论的 N+1 问题。这种宝石在 Ruby 社区中非常流行，并且开箱即用；
*   [Yslow gem](https://rubygems.org/gems/yslow/versions/0.0.2) 使用雅虎！绩效衡量的规则，并帮助您识别问题。

# 如何提高 Ruby on Rails 应用程序的性能

介绍完之后，是时候为你的应用的成功迈出真正的步伐了。Rails 应用程序优化是一项由多个部分组成的任务。以下是我们对每个组件改进的建议。

## 服务器优化

从内存容量和 web 托管服务到您交付的代码质量，一切都会影响您的 web 应用程序的性能。在本节中，我们将讨论服务器优化的方法:

**增加 RAM 容量**

如果您的应用程序用户数量增加，并且您注意到轻微或相当大的性能下降，您需要做的第一件事就是检查您的服务器功能。很有可能你需要增加 RAM 容量来让你的应用回到最佳性能。另一个类似的建议是选择一个比你现有的更强大的 CPU。

**用固态硬盘替换硬盘**

升级到 SSD 正是您所需要的，让用户对该解决方案的性能感到惊讶。固态硬盘比老一代的硬盘要快得多。

**使用负载均衡方法**

现代高流量应用程序每秒处理数十万个请求。处理的请求越多，就越难立即得到响应。负载平衡是一种将请求适当地路由到服务器的方法。它可以让你获得最大的速度和飞涨的应用程序性能。

## 后端优化

在你检查了可能降低应用程序速度的基本东西之后，是时候继续编写你的 Ruby 代码了。

**保持你的代码整洁**

我们不想通过说干净的代码是你必须拥有的来重新发明轮子。这是每个软件工程师都应该牢记的原则。要成功使用干净代码技术，需要记住以下一些规则:

*   事前创建 app 逻辑；
*   坚持定义良好的清晰代码结构；
*   用评论解释你的行为；
*   保持功能简短；
*   遵循标准命名原则。

花点时间学习干净代码原则，并实现它们，让应用快速无缝。

**解决查询问题**

所以，你计划和你的朋友一起喝杯咖啡。你拿一个杯子，放在桌子上。然后你回去拿勺子。然后你记得你的朋友也想喝点咖啡，所以你一遍又一遍地重复同样的动作。很可笑，不是吗？嗯，你的代码有时会以完全相同的方式运行。每个查询都带来一个结果，所以您一次又一次地发送新的结果，直到得到您需要的所有结果。优化就是让一个查询带来数百个需要的结果。

基于查询的问题相当复杂。你需要对你的代码细心周到，以确保查询简短、清晰、高效。

**添加指标**

服务器响应延迟的原因之一是缺少索引。表格越多，应用程序越慢。每次出现请求时，数据库引擎都必须检查每个单元格，直到找到所需的信息。你所需要做的就是添加索引并加速这个过程。

请记住，索引加快了搜索速度，但减慢了更新速度。此外，不要低估向联合表和外键以及表示多态关系的模型添加索引的必要性。

**使用后台作业处理器**

后台进程也可能影响您的性能。统计计算，报告生成，视频处理和类似的任务可能属于这里。他们的自动化是你需要采取的另一个步骤来获得更好的性能。有许多专门为 RoR 开发的工具在这里可能会有用。我们倾向于以下解决方案:

***Sidekiq***

我们可以自信地说 [Sidekiq](https://sidekiq.org/) 是用于此目的的最流行的开源 gem 之一。它有一个方便的仪表板，您可以在其中找到关于所有队列和响应细节的信息。

***营救***

[Rescue](https://ruby-doc.org/docs/ruby-doc-bundle/UsersGuide/rg/rescue.html) 是 Sidekiq 的替代品。它用于处理 Ruby 异常。

***主动工单***

活动作业框架也有助于处理队列中的作业。它支持并行处理小型的、组织良好的后台任务单元。

**尽可能缓存一切**

更好的速度意味着更少的无意义的行动。这就是缓存可以帮助你的地方。它允许在服务器每次响应新请求时存储内容。缓存有几种类型，每种类型都有自己的特点和用途。你可以在官方的 Ruby 文档中查看它们。

为了最大限度地利用这个解决方案，您需要测量 web 应用程序的哪个部分损害了性能，并对其应用缓存技术。

**使用 Ruby GC 调优**

垃圾收集是优化 Ruby on Rails 应用程序需要熟悉的另一个概念。这是一种管理应用程序内存的方法。通过更改 Ruby GC 设置，您可以加速单元测试，甚至整个应用程序。它的算法很迷人，需要一些额外的研究才能理解。

## 前端优化

你的应用不仅仅是由你自己编写的出色的 Ruby 代码组成的。为了让它快速无缝地运行，您还需要关注它的前端。

**熟悉 CDN**

另一个可能阻碍你提高 Ruby on Rails 应用程序性能的因素是距离。服务器可能离最终用户有一千英里远。查询响应时间可能需要一分钟。你如何处理这个？

内容交付网络(CDN)是您优化和改进内容交付的工具。CDN 不仅对 Ruby 应用程序至关重要，对任何类型的 web 应用程序也是如此。它有助于网站内容快速加载，无论最终用户位于何处。

**共享静态文件**

通常，您不需要在旅途中生成文件。在 CSS 文件和图像的情况下，你根本不需要这样做。使用静态文件，你可以节省时间做更重要的事情，提高应用程序的响应速度。

**压缩文件**

有了吸引人的图片，你可以让越来越多的用户访问你的网站或网络应用。这些图像是惊人的，可爱的和真实的，但…它们增加了网页的加载时间。压缩您设计的文件，以吸引具有出色图像和闪电般页面加载速度的用户。

**与 AJAX 交朋友**

受最流行的编程语言的影响，AJAX 技术被创建来在各种领域中寻找应用。实际上，它是异步解决方案开发的一整套技术。它使网页内容动态变化。没有必要每次想要检查更新时都重新加载页面；这都是自动化的。AJAX 最大限度地减少了查询次数，因此有助于提高性能。

# 最后

成为一名 RoR 开发者并不容易。推出优秀的解决方案不像骑自行车。创建一个传奇的应用程序需要你的全力以赴和最大努力，你别无选择，只能尽最大努力加快项目进度。我们已经讨论了如何提高 Ruby on Rails 的应用性能，您的成功之路包括:

*服务器优化:*

*   增加 RAM 容量
*   用固态硬盘取代硬盘
*   使用负载平衡方法

*后端优化:*

*   保持代码整洁
*   处理查询问题
*   添加索引
*   使用后台作业处理器
*   贮藏
*   使用 Ruby GC 调优

*前端优化:*

*   使用 CDN
*   共享静态文件
*   压缩文件
*   使用 AJAX

我们希望我们的技巧能够帮助您将应用程序的速度和性能提升到一个新的水平。如果您的项目需要帮助，请随时联系我们的团队获得专业咨询。

*原载于 2019 年 1 月 19 日*[*sloboda-studio.com*](https://sloboda-studio.com/blog/how-to-improve-ruby-on-rails-app-performance/)*。*