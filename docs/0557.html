<html>
<head>
<title>JavaScript V8 Engine Explained</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">JavaScript V8引擎解释</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/javascript-v8-engine-explained-3f940148d4ef?source=collection_archive---------0-----------------------#2019-01-23">https://medium.com/hackernoon/javascript-v8-engine-explained-3f940148d4ef?source=collection_archive---------0-----------------------#2019-01-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div class="fe ff ir"><img src="../Images/dc16a4d4e4b6180562f2f94cc7df71b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/format:webp/1*cgtV-fGVhUsNKsSYbT84Qg.png"/></div></figure><p id="6cd6" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我想我听过V8这个名字无数次了。它第一次出现是在2008年，当时我团队中的一名工程师向我解释了为什么一些代码的性能会很好——他说:“V8会解决它的！”——我点点头。虽然我不知道他在说什么，但我仍然想跟上这些天充斥我们的技术前沿术语。然后，当我回到电脑前，我谷歌了一下，心想chrome使用的很酷的新JavaScript引擎，我猜很棒。</p><p id="8e09" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">维基百科上的第一行是我们大多数人所知道的V8，以及许多其他东西。在这里，我将尝试提供一个V8实际上做什么的简单解释。至于其他的事情，下一次，只需要阅读维基百科的第一段，什么是黑客，你只能活一次，潜入第二段。</p><p id="6fa3" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">所以没错，“V8是Google开源的高性能JavaScript和WebAssembly引擎，用C++写的”(<a class="ae jw" href="https://v8.dev/" rel="noopener ugc nofollow" target="_blank"> V8文档</a>)但是这实际上是什么意思呢？嗯，实际上这意味着，V8是一个C++程序，它接收JavaScript代码，编译并执行它。</p><h2 id="9a1d" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">V8确实:</h2><ol class=""><li id="50dd" class="ks kt hu ja b jb ku jf kv jj kw jn kx jr ky jv kz la lb lc dt translated">编译并执行JS代码</li><li id="246a" class="ks kt hu ja b jb ld jf le jj lf jn lg jr lh jv kz la lb lc dt translated">处理调用堆栈——以某种顺序运行JS函数</li><li id="09cb" class="ks kt hu ja b jb ld jf le jj lf jn lg jr lh jv kz la lb lc dt translated">管理对象的内存分配—内存堆</li><li id="32cc" class="ks kt hu ja b jb ld jf le jj lf jn lg jr lh jv kz la lb lc dt translated">垃圾收集—不再使用的对象的垃圾收集</li><li id="a0e2" class="ks kt hu ja b jb ld jf le jj lf jn lg jr lh jv kz la lb lc dt translated">提供所有数据类型、运算符、对象和函数</li></ol><h2 id="0316" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">V8可以:</h2><ol class=""><li id="38d9" class="ks kt hu ja b jb ku jf kv jj kw jn kx jr ky jv kz la lb lc dt translated">提供事件循环，但这有时也由浏览器实现</li></ol><h2 id="747b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">V8没有:</h2><ol class=""><li id="a33b" class="ks kt hu ja b jb ku jf kv jj kw jn kx jr ky jv kz la lb lc dt translated">了解文档对象模型(DOM)吗——它是由浏览器提供的，例如，显然与Node.js无关</li></ol><p id="eb5c" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">V8是一个单线程执行引擎。它被构建为在每个JavaScript执行上下文中运行一个线程。你实际上可以在同一个进程中运行两个V8引擎——例如web-workers，但是它们不会像真正的线程一样共享任何变量或上下文。这并不意味着V8运行在单线程上，而是意味着它提供了单线程的JavaScript流。</p><p id="f43e" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在运行时，V8主要管理堆内存分配和单线程调用堆栈。调用栈主要是一个按调用顺序执行函数列表。每个调用另一个函数的函数都将被直接一个接一个地插入，回调将被发送到最后。这实际上就是为什么调用setTimeout为零毫秒的函数会将它发送到当前行的末尾，而不是直接调用它(0毫秒)。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff li"><img src="../Images/adb41f5a2655ff63bd9310bbef938325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*wFUeusABqCHWJHoIKyrMyg.png"/></div></figure><h1 id="d914" class="ln jy hu bd jz lo lp lq kd lr ls lt kh lu lv lw kk lx ly lz kn ma mb mc kq md dt translated">其他关键组件:</h1><h2 id="d99b" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">JS解释器—点火和优化编译器—涡轮风扇和曲轴</h2><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff me"><img src="../Images/c61a7d30340324f8d38411c589e4de0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*kMAVJy8cgPd1kMq5M26Y_Q.png"/></div></figure><p id="bf60" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">就在执行之前，V8从JavaScript到本机代码的实时(JIT)编译中获得速度。首先，代码是由基线编译器编译的，它会快速生成非优化的机器码。在运行时，编译后的代码将被分析，并可以重新编译以获得最佳性能。点火提供第一个，而TruboFan &amp;曲轴提供第二个。</p><p id="52f0" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">JIT编译结果机器码可能会占用大量内存，尽管它可能只执行一次。这可以通过点火来解决，点火以更少的内存开销执行代码。</p><p id="bb76" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">涡扇项目始于2013年，旨在改善曲轴的弱点，曲轴没有针对JavaScript功能的某些部分进行优化，例如错误处理。它旨在优化现有的和未来的规划功能。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff li"><img src="../Images/a461f2418fcab23d088613b3586dd4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/0*qAm73-SdFjB2AcuX.png"/></div><figcaption class="mf mg fg fe ff mh mi bd b be z ek">V8 Dev Blog — <a class="ae jw" href="https://v8.dev/blog/ignition-interpreter" rel="noopener ugc nofollow" target="_blank">https://v8.dev/blog/ignition-interpreter</a></figcaption></figure><h2 id="168e" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">网络组件—起飞</h2><p id="0832" class="pw-post-body-paragraph iy iz hu ja b jb ku jd je jf kv jh ji jj mj jl jm jn mk jp jq jr ml jt ju jv hn dt translated">实现卓越的性能也是浏览器的关键，这就是Liftoff的任务——生成机器代码。Liftoff不使用复杂的多层编译，而是一个更简单的代码生成器，它一次为每个操作码(机器代码的一个部分，指定要执行的操作)生成代码。起飞生成代码的速度比涡扇快得多(约10倍)，显然涡扇的性能较低(约50%)。要了解更多信息，请参见V8开发博客。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/196ae28278772014cbd12c280b5d090b.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/0*2V0EF3IBk_Y6mmN2"/></div></figure><h2 id="3bac" class="jx jy hu bd jz ka kb kc kd ke kf kg kh jj ki kj kk jn kl km kn jr ko kp kq kr dt translated">垃圾收集—奥里诺科河</h2><p id="65cc" class="pw-post-body-paragraph iy iz hu ja b jb ku jd je jf kv jh ji jj mj jl jm jn mk jp jq jr ml jt ju jv hn dt translated">在内存堆上运行，寻找断开的内存分配是Orinoco。实现分代垃圾收集器，在年轻代内部、从年轻代到老代以及在老代内部移动对象。这些移动留下了漏洞，Orinoco执行了疏散和压缩来为更多的对象释放空间。</p><p id="3adf" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">Orinoco执行的另一个优化是在堆中搜索，寻找包含被移动对象的旧位置的所有指针，并用新位置更新它们。这是使用一种叫做<em class="mn">记忆集的数据结构实现的。</em></p><p id="7827" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">在这些之上，增加了<em class="mn">黑色分配</em>，这基本上意味着垃圾收集过程自动用黑色标记活的对象，以便加速迭代标记过程。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff mm"><img src="../Images/aea377ca29ba5e8e22b3bf041c0d8166.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/0*j1S-hO3SHgYsLmFK"/></div></figure><h1 id="ac8a" class="ln jy hu bd jz lo lp lq kd lr ls lt kh lu lv lw kk lx ly lz kn ma mb mc kq md dt translated">结论</h1><p id="84f7" class="pw-post-body-paragraph iy iz hu ja b jb ku jd je jf kv jh ji jj mj jl jm jn mk jp jq jr ml jt ju jv hn dt translated">JavaScript的目标并不是成为针对高可伸缩性和高吞吐量而优化的服务器端语言。然而，自从V8的引入和上面的架构改进以来，web开发人员可以使用的工具集完全改变了，实现了巨大的改进和新特性。</p><figure class="lj lk ll lm fq iv fe ff paragraph-image"><div class="fe ff mo"><img src="../Images/0d76dae1f6fe35d7187e173ed03c0758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*QG6GNe2ag-4puxpjc5Y2iw.png"/></div></figure><p id="dcfe" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">我希望这个V8的快速体验能帮助你获得一些简化的V8引擎的基本理解，它在客户机和服务器上运行JavaScript代码。</p><p id="1a39" class="pw-post-body-paragraph iy iz hu ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv hn dt translated">以上是在创建我的<a class="ae jw" href="https://www.resty.co.il/?locale=en" rel="noopener ugc nofollow" target="_blank">特拉维夫顶级餐厅</a>网站时调查和实现的。</p></div></div>    
</body>
</html>