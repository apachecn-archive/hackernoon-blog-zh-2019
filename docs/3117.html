<html>
<head>
<title>Building a Multi Streaming Alexa Skill with the Alexa Skills Kit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立一个多流Alexa技能与Alexa技能包</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/building-radio-stations-alexa-skill-with-the-alexa-skills-kit-376fc9537047?source=collection_archive---------4-----------------------#2019-05-17">https://medium.com/hackernoon/building-radio-stations-alexa-skill-with-the-alexa-skills-kit-376fc9537047?source=collection_archive---------4-----------------------#2019-05-17</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/b75a3a62270efdd12e5fd6f6e2bfd188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CGOKKowZS508r3KMkjfbCA.jpeg"/></div></div></figure><p id="714e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我上周得到了我的Echo设备，我认为开发一个定制的Alexa技能会很酷。因此，我花了整个周六来发展电台技能，当我编程时，让Alexa播放我最喜欢的电台是令人兴奋的🙂。</p><p id="3b8c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在这篇文章中，我展示了一个使用Alexa Skills Kit(ASK)v2+for Nodejs为Echo构建自定义技能的示例。该项目由<a class="ae ka" href="https://github.com/alexa/skill-sample-nodejs-audio-player" rel="noopener ugc nofollow" target="_blank">技能样本NodeJS音频播放器</a>派生修改而来。</p><h1 id="f0d4" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">用例</h1><p id="350c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我的无线电技能是收听您的多个电台的方式，您可以说“Alexa，播放<radio station="" name="">”，Alexa将开始播放电台。您可以添加或删除电台，电台存储在DynamoDB中。因此，您将拥有完全个性化的音乐播放体验。</radio></p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff le"><img src="../Images/3d3a78970540680fe855a608cb0722c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f5Zi8unjjO9zdaHIDLiJkA.png"/></div></div></figure><h1 id="32e6" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">先决条件</h1><p id="99fb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们需要一个<a class="ae ka" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS账户</a>和一个<a class="ae ka" href="https://developer.amazon.com/" rel="noopener ugc nofollow" target="_blank">亚马逊开发者账户</a>来创建一个Alexa技能。</p><ol class=""><li id="ee92" class="lj lk hu je b jf jg jj jk jn ll jr lm jv ln jz lo lp lq lr dt translated">我们需要安装带有<code class="eh ls lt lu lv b">npm install -g ask-cli.</code>的<a class="ae ka" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a></li><li id="36cb" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz lo lp lq lr dt translated">用<code class="eh ls lt lu lv b">$ ask init</code>配置<a class="ae ka" href="https://aws.amazon.com/cli/" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>。</li><li id="d5c1" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz lo lp lq lr dt translated">我们需要安装并初始化<a class="ae ka" href="https://developer.amazon.com/docs/smapi/quick-start-alexa-skills-kit-command-line-interface.html" rel="noopener ugc nofollow" target="_blank"> ASK CLI </a>。</li></ol><p id="45cf" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是一个Alexa技能包命令行界面<a class="ae ka" href="https://developer.amazon.com/docs/smapi/quick-start-alexa-skills-kit-command-line-interface.html" rel="noopener ugc nofollow" target="_blank">快速入门</a>。</p><h1 id="5f29" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建DynamoDb表</h1><p id="a7eb" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们需要2个DynamoDB表，<strong class="je hv"> MyRadiosSession </strong>存储用户会话，<strong class="je hv"> MyRadios </strong>存储电台流URL。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="508b" class="mf kc hu lv b fv mg mh l mi mj"><strong class="lv hv">$</strong>aws dynamodb create-table --table-name MyRadios --attribute-definitions AttributeName=id,AttributeType=S  --key-schema AttributeName=id,KeyType=HASH --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5</span><span id="c692" class="mf kc hu lv b fv mk mh l mi mj"><strong class="lv hv">$</strong>aws dynamodb create-table --table-name MyRadiosSession --attribute-definitions AttributeName=id,AttributeType=S  --key-schema AttributeName=id,KeyType=HASH --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5</span></pre><p id="2579" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，我们需要将电台流URL插入到MyRadio表中。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="b58c" class="mf kc hu lv b fv mg mh l mi mj">aws dynamodb batch-write-item --request-items file://./request-stations.json</span></pre><p id="1ae8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这里是<code class="eh ls lt lu lv b">request-stations.json</code>的内容。</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="ml mm l"/></div></figure><h1 id="9fc5" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建策略</h1><p id="e07d" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">我们需要一个具有DynamoDb和Cloud watch权限的策略。让我们创造它。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="ba0b" class="mf kc hu lv b fv mg mh l mi mj"><strong class="lv hv">$</strong>aws iam create-policy --policy-name my-radio-skill-policy --policy-document file://./policy.json</span></pre><p id="7a9a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">文件<strong class="je hv">策略</strong>是当前文件夹中的一个JSON文档，授予Dynamodb表和Cloudwatch日志记录的权限:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="6319" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><em class="mn">注意，你要把ACCOUNT_ID替换成</em> <a class="ae ka" href="https://console.aws.amazon.com/billing/home?#/account" rel="noopener ugc nofollow" target="_blank"> <em class="mn">你的AWS账户id </em> </a> <em class="mn">。</em></p><p id="0117" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建策略后，我们从输出中获得策略ARN，复制ARN，在最后一步部署技能后，我们需要将其附加到我们的lambda函数。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/8b3168a2bc8e8b58ab289649a3e05e4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k1TdQZ4wA3Vao9ga0YIojQ.png"/></div></div></figure><h1 id="f689" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创造新技能</h1><p id="9952" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">随着您的帐户设置，我们现在要建立我们的自定义Alexa技能。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="5725" class="mf kc hu lv b fv mg mh l mi mj"><strong class="lv hv">$</strong>ask new -n myradios --lambda-name ask-custom-mradio-default</span></pre><p id="a487" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择Node.js V8作为运行时，hello world作为模板。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mp"><img src="../Images/2d7610ad0aef951710de0f9c429cf069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrR8FMXckNGHLJJgkc1SBw.png"/></div></div></figure><p id="73a1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">该命令创建一个包含所有必需文件的项目目录“myradios”。我们还将lambda函数的名称配置为“ask-custom-mradio-default”。</p><p id="4c66" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><code class="eh ls lt lu lv b">myradios</code>目录包含以下文件:</p><ul class=""><li id="3e23" class="lj lk hu je b jf jg jj jk jn ll jr lm jv ln jz mq lp lq lr dt translated"><code class="eh ls lt lu lv b">skill.json</code> -技能的配置</li><li id="b04b" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz mq lp lq lr dt translated"><code class="eh ls lt lu lv b">models/en-US.json</code> -英美现场技能的交互模型。</li><li id="971e" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz mq lp lq lr dt translated"><code class="eh ls lt lu lv b">lambda/custom/index.js</code> -技能的λ函数</li><li id="0dcf" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz mq lp lq lr dt translated"><code class="eh ls lt lu lv b">lambda/custom/package.json</code>-NPM包文件</li><li id="f330" class="lj lk hu je b jf lw jj lx jn ly jr lz jv ma jz mq lp lq lr dt translated"><code class="eh ls lt lu lv b">.ask/config</code> -部署设置配置文件</li></ul><h1 id="01e2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">配置技能清单</h1><p id="e81c" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">技能清单是你的技能的JSON表示，为Alexa提供所有需要的元数据。让我们开始编辑<strong class="je hv"> skill.json </strong>，将<strong class="je hv">示例短语</strong>更改为:</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="4b2a" class="mf kc hu lv b fv mg mh l mi mj">“examplePhrases”: [<br/> “Alexa, open My Radios”,<br/> “Alexa, ask My Radios to play ABC NEWS”,<br/> “Alexa, tell My Radios to play Fox FM”<br/> ],</span></pre><p id="84e4" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我们还需要更改查看技能列表时显示的摘要和描述。</p><p id="0a85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">接下来，让我们转到<a class="ae ka" href="https://developer.amazon.com/docs/custom-skills/create-the-interaction-model-for-your-skill.html" rel="noopener ugc nofollow" target="_blank">交互模型</a> <code class="eh ls lt lu lv b">models/en-US.json</code>，示例模型应该如下所示:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="90d6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">请注意，“电台”是自定义插槽，您可以将任意多的电台名称添加到插槽值中，句子结构的示例话语应该是这样的</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="a845" class="mf kc hu lv b fv mg mh l mi mj">"begin the {STATION}",            <br/>"begin playing the {STATION}",                   <br/>"start the {STATION}",            <br/>"start playing the {STATION}"</span></pre><blockquote class="mr ms mt"><p id="dddf" class="jc jd mn je b jf jg jh ji jj jk jl jm mu jo jp jq mv js jt ju mw jw jx jy jz hn dt translated">插槽是构建自定义Alexa技能的一个非常强大的附件。例如，语句“告诉我关于{玩家}”意味着用户可以向老虎机玩家询问我们关于任何国际象棋玩家的技能。此外，多个插槽提供了使用对话框的可能性，其中Alexa技能提示用户填充所有插槽值，以实现意图。</p></blockquote><h1 id="ab74" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">创建AWS Lambda函数</h1><p id="e1ce" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">一旦交互模型被创建，我们需要创建和配置AWS lambda函数<code class="eh ls lt lu lv b">lambda/custom/index.js</code>。</p><p id="1f82" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在文件的顶部，我们正在导入SDK，并为其分配<code class="eh ls lt lu lv b">Alexa</code>常量以备后用:</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="82e4" class="mf kc hu lv b fv mg mh l mi mj"><strong class="lv hv">const</strong> Alexa <strong class="lv hv">=</strong> require('ask-sdk');</span></pre><p id="411b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后移动到文件的底部，我们可以看到下面的代码:</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="04bb" class="mf kc hu lv b fv mg mh l mi mj">const skillBuilder = Alexa.SkillBuilders.standard();<br/>exports.handler = skillBuilder<br/>  .addRequestHandlers(<br/>    CheckAudioInterfaceHandler,<br/>    LaunchRequestHandler,<br/>    HelpHandler,<br/>    SystemExceptionHandler,<br/>    SessionEndedRequestHandler,<br/>    YesHandler,<br/>    NoHandler,<br/>    StationListHandler,<br/>    LoadMoreStationsHandler,<br/>    StartPlaybackHandler,<br/>    NextPlaybackHandler,<br/>    PreviousPlaybackHandler,<br/>    PausePlaybackHandler,<br/>    ExitHandler,<br/>    AudioPlayerEventHandler,<br/>    CanFulfillIntentRequestHandler<br/>  )<br/>  .addRequestInterceptors(LoadPersistentAttributesRequestInterceptor) .addResponseInterceptors(SavePersistentAttributesResponseInterceptor).addErrorHandlers(ErrorHandler)<br/> .withAutoCreateTable(false)<br/> .withTableName(constants.skill.dynamoDBTableName)<br/> .lambda();</span></pre><p id="876c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是我们注册拦截器的地方，通过使用<code class="eh ls lt lu lv b">.addRequestInterceptors</code>将requestHandler添加到skillBuilder。<code class="eh ls lt lu lv b">.lambda()</code>方法将对象序列化为JSON，准备好供Alexa技能读取。</p><p id="991e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在，让我们转到意图处理程序，Alexa Skill的请求和响应拦截器在被调用时被传递一个HandlerInput实例，让我们看一下<code class="eh ls lt lu lv b">LaunchRequestHandler</code>和一个例子:</p><figure class="lf lg lh li fq iv"><div class="bz el l di"><div class="ml mm l"/></div></figure><p id="5a92" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">当客户通过说“Alexa，打开我的收音机”来启动skill时，我们的skill会收到一个“LaunchRequest”类型的请求。<code class="eh ls lt lu lv b">handlerInput.requestEnvelope.request.type === “LaunchRequest”</code>在“canHandle”函数中确保它将只处理启动请求。</p><p id="cc2a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">所有其他意图处理程序都非常相似，有些意图使用<code class="eh ls lt lu lv b">reprompt(speechText)</code>。这给了Alexa等待用户响应的命令，如果麦克风已经打开八秒钟而没有用户输入，Alexa就会发出重新提示。</p><p id="d415" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">既然你已经看到了关于Alexa技能发展的所有细节，我们已经准备好部署和测试这项技能了。</p><h1 id="4cf2" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">运用技能</h1><p id="26f3" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">要部署技能，请运行以下命令。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="7f27" class="mf kc hu lv b fv mg mh l mi mj">$ask deploy</span></pre><p id="50fc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">ask deploy命令自动启用您部署技能，它创建lambda函数、IAM角色并将它们链接在一起。</p><h1 id="08b1" class="kb kc hu bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky dt translated">将策略附加到IAM角色</h1><p id="d9b4" class="pw-post-body-paragraph jc jd hu je b jf kz jh ji jj la jl jm jn lb jp jq jr lc jt ju jv ld jx jy jz hn dt translated">Alexa技能工具包将在技能部署后为我们的lambda函数创建一个默认的IAM角色“ask-lambda-myradio”。现在，我们可以将上一步中创建的策略附加到lambda函数的IAM角色。</p><pre class="lf lg lh li fq mb lv mc md aw me dt"><span id="911e" class="mf kc hu lv b fv mg mh l mi mj"><strong class="lv hv">$</strong>aws iam attach-role-policy --role-name ask-lambda-myradio --policy-arn "arn:aws:iam::ACCOUNT_ID:policy/my-radio-skill-policys"</span></pre><p id="c083" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">差不多就是这样！我们现在可以从你的设备或模拟器上使用我们的技能。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mx"><img src="../Images/0bc610401748f513b264d114b866706c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNU_Pu3gI3xuiFPbw-15iA.png"/></div></div></figure><p id="bd6b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">希望这篇文章对你有用，你可以在我的<a class="ae ka" href="https://github.com/yai333/AlexaRadiosSkill" rel="noopener ugc nofollow" target="_blank"> <strong class="je hv"> GitHub repo </strong> </a> <strong class="je hv">中找到完整的项目。</strong></p></div></div>    
</body>
</html>