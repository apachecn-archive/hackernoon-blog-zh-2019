<html>
<head>
<title>React Native Chat with Chuck Norris</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Chuck Norris进行本地聊天</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/react-native-chat-with-chuck-norris-dd5721523742?source=collection_archive---------6-----------------------#2019-04-29">https://medium.com/hackernoon/react-native-chat-with-chuck-norris-dd5721523742?source=collection_archive---------6-----------------------#2019-04-29</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/31fba775caa671d2e93c87ae5492f9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HqsQJgBL6MPoJJLxZ2GjoA.png"/></div></div></figure><p id="e607" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">我是<a class="ae ka" href="https://getstream.io" rel="noopener ugc nofollow" target="_blank"> Stream </a>和<a class="ae ka" href="https://getstream.io/activity-feeds/" rel="noopener ugc nofollow" target="_blank"> Feeds </a>和<a class="ae ka" href="https://getstream.io/chat/" rel="noopener ugc nofollow" target="_blank"> Chat </a>的API的开发者传道者，我有机会体验我们的各种工具、令人惊叹的UI套件和新产品！多年来，Stream一直是feeds即服务的领先提供商，为超过5亿的最终用户提供feeds。在过去的几个月里，该团队一直在努力开发一款新产品——<a class="ae ka" href="https://getstream.io/chat/" rel="noopener ugc nofollow" target="_blank">Chat</a>。</p><p id="6a67" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">在本教程中，我将带您了解如何使用React Native、<a class="ae ka" href="https://github.com/FaridSafi/react-native-gifted-chat" rel="noopener ugc nofollow" target="_blank">天赋聊天</a>(React Native Chat Components by Stream目前正在开发中)、<a class="ae ka" href="https://serverless.com/" rel="noopener ugc nofollow" target="_blank">无服务器聊天</a>，当然还有<a class="ae ka" href="https://getstream.io/chat/" rel="noopener ugc nofollow" target="_blank">按流聊天</a>，构建一个简单的messenger风格的应用程序。为了增加混合，我将引入一个后端Lambda函数，它将自动响应由第三方API提供的Chuck Norris笑话和事实。</p><p id="6336" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">对于繁重的工作，我们将使用<a class="ae ka" href="https://www.npmjs.com/package/stream-chat" rel="noopener ugc nofollow" target="_blank"> Stream Chat JS </a>，一个直接与Stream API通信的JavaScript SDK。如果你有兴趣查看一个关于流聊天的很棒的教程，看看这里的<a class="ae ka" href="https://getstream.io/chat/react-native-chat/tutorial/" rel="noopener ugc nofollow" target="_blank"/>。</p><blockquote class="kb kc kd"><p id="7bf9" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">我还应该指出，我将使用macOS和iOS，所以如果您使用Windows或Linux，本教程可能会稍有偏离。</p></blockquote><p id="fc65" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要跟进这篇文章，请确保您已经安装和/或设置了以下内容:</p><ul class=""><li id="5225" class="ki kj hu je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated"><a class="ae ka" href="https://expo.io" rel="noopener ugc nofollow" target="_blank">世博会</a></li><li id="5d57" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><a class="ae ka" href="https://serverless.com/framework/docs/getting-started/" rel="noopener ugc nofollow" target="_blank">无服务器</a></li><li id="9a86" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><a class="ae ka" href="https://aws.amazon.com/" rel="noopener ugc nofollow" target="_blank"> AWS </a></li></ul><blockquote class="kb kc kd"><p id="ef5a" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">寻找代码库？你可以在这里找到开源代码<a class="ae ka" href="https://github.com/GetStream/react-native-chat-chucky" rel="noopener ugc nofollow" target="_blank">。来个快速演示怎么样？我也有！看看</a><a class="ae ka" href="https://appetize.io/app/crhnp4qabpmznx6bzvfz6ad708" rel="noopener ugc nofollow" target="_blank">开胃</a>上的演示。</p></blockquote><p id="6120" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">让我们找点乐子！🏂</p><h1 id="d5ed" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">1.按流配置聊天</h1><p id="eb6c" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">前往<a class="ae ka" href="https://getstream.io" rel="noopener ugc nofollow" target="_blank"> https://getstream.io </a>，点击网站右上角的“注册”按钮。按照提示进行操作。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/f05499ef0261e76e3ec8a7b4c228caae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jvPGm6W52Fd-Gd10dtLvnw.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek"><a class="ae ka" href="https://getstream.io" rel="noopener ugc nofollow" target="_blank">https://getstream.io</a></figcaption></figure><p id="2aec" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦你被重定向，前往<a class="ae ka" href="https://getstream.io/chat/#pricing" rel="noopener ugc nofollow" target="_blank">https://getstream.io/chat/#pricing</a>并点击“开始试用”按钮——这将为你的帐户启用试用聊天(14天)。一旦审判开始，你就快成功了！</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mi"><img src="../Images/6aa086c5fa2226acfb4548d3266baa50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JnXHPShj9PmdX9jRLv2x6Q.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek"><a class="ae ka" href="https://getstream.io/chat/#pricing" rel="noopener ugc nofollow" target="_blank">https://getstream.io/chat/#pricing</a></figcaption></figure><p id="366a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">回到<a class="ae ka" href="https://getstream.io/dashboard" rel="noopener ugc nofollow" target="_blank">仪表板</a>并点击您的应用程序。仪表盘默认为“Feeds”，所以请点击顶部的“Chat”按钮。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mj"><img src="../Images/626c8f0660ae65f7383bc23fd6ba7f8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-KwTJtRLketm3oFBCYdUA.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Stream Dashboard</figcaption></figure><p id="afe9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">从这里，如果你向下滚动，你会看到你新启用的聊天应用程序的各种设置。确保在一个新的标签页中打开它——您将需要这个页面中的<strong class="je hv">密钥</strong>、<strong class="je hv">秘密</strong>(底部)和<strong class="je hv">应用ID </strong>(顶部)。</p><p id="82c5" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你对流聊天的定价和产品比较感兴趣，可以看看这个。</p><h1 id="3ae5" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">2.设置无服务器</h1><p id="8657" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">当您只有几个必需的端点时，类似于这个构建，无服务器通常是最有意义的。启动服务器可能需要相当长的时间，而且可能相当昂贵。我并不是说无服务器环境适用于所有人和所有事物，但是，我是说如果你正在构建一个很小的API，无服务器环境绝对是一个不错的选择。</p><p id="09fb" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">前往<a class="ae ka" href="https://dashboard.serverless.com" rel="noopener ugc nofollow" target="_blank">https://dashboard.serverless.com</a>创建一个新账户。遵循入职流程(电子邮件验证、用户名选择、应用创建等。).创建应用程序后，保存租户名称(例如，<em class="ke">尼克-查克</em>用户名= <em class="ke">尼克-查克</em>租户)，并保存应用程序名称——在接下来的几个步骤中，我们将需要这两个名称。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mk"><img src="../Images/05571a7312d34aa765ff7f3b165baa66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxzDvvxKnyEA6OK7_1Eovg.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Serverless Dashboard</figcaption></figure><h1 id="fe44" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">3.使用Expo创建一个React本机应用程序</h1><p id="e9b4" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">Expo通过使用Expo APIs简化了构建React本地应用程序的过程。从技术上讲，我们根本不需要它；然而，如果你想快速地将一些东西组合在一起，并有可能为iOS或Android开发一个版本，Expo将是最快的方式。毕竟，你可以随时退出你的世博项目。</p><p id="e53c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要创建您的应用程序，请打开您的终端，前往您选择的目录(我将位于<strong class="je hv"> ~/Code </strong>)。一旦一切就绪，运行下面的命令来搭建项目。</p><p id="7130" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">$ Expo init react-native-chat-chucky</strong></p><p id="55e9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">按照Expo CLI的提示，在选项卡和空白问题中选择“空白”。一旦你回答完问题，Expo会生成目录并使用yarn或npm安装必要的依赖项。您的终端应该如下所示:</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/88f9056302017bfe76461f610cae33b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0OMY7M-tLNlYm9GRDoaFsQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">iTerm 2</figcaption></figure><p id="635d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一切就绪！👏</p><h1 id="924b" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">4.添加聊天SDK以反应本地聊天</h1><p id="8a2f" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">接下来，让我们使用下面的命令安装所有需要的依赖项。我将为此使用yarn，但是如果您在初始设置时选择了npm，请使用它来避免混合锁文件。</p><p id="d6cc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">$ yarn add axios MD5 react-native-gifted-chat react-native-iphone-x-helper react-native-parsed-text react-router-native stream-chat</strong></p><h1 id="5f7d" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">5.添加默认消息</h1><p id="f794" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">为了显示聊天界面，我们使用了<a class="ae ka" href="https://www.npmjs.com/package/react-native-gifted-chat" rel="noopener ugc nofollow" target="_blank"> react-native-gifted-chat </a>，这是一个非常棒的UI库，专门用于处理聊天应用程序。有了天才聊天，我们可以把UI放在一边，快速启动并运行！</p><p id="fcf6" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">为了开始一个初始消息，我们需要创建一个新目录和一个消息文件。UI已经被连接起来需要这个文件，所以只需要创建它并放入一个自定义消息。</p><p id="5ee0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">$ mkdir data&amp;&amp;touch messages . js</strong></p><p id="cb3f" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成这一步后，将下面的代码片段粘贴到文件中并保存。</p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">data/messages.js</figcaption></figure><p id="74c0" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">可以走了！🚀</p><h1 id="0c09" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">6.添加路由和屏幕以反应本地</h1><p id="9e62" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">我们已经有了所有必要的依赖项，所以让我们继续前进，把所有的东西都绑在一起！</p><p id="8d7c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">修改您的<strong class="je hv"> App.js </strong>文件，使其包含以下代码片段。</p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div></figure><p id="8445" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">创建名为screens的目录，并在其中创建两个文件——chat . js和Login.js。</p><p id="5a04" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ mkdir屏幕&amp; &amp; cd屏幕&amp; &amp;触摸Chat.js &amp; &amp;触摸Login.js </strong></p><p id="143b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">一旦这两个文件就位，我们将需要填充它们！将下面显示的代码放到适当的文件中。</p><p id="feea" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Chat.js </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Chat.js</figcaption></figure><p id="8396" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> Login.js </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Login.js</figcaption></figure><blockquote class="kb kc kd"><p id="a262" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">在第22行，从您的Stream Dashboard中拖放Stream应用程序ID。在第53行，您需要添加由AWS API Gateway提供的Lambda端点——不要担心，您现在还没有，我们将在下一节中介绍它。</p></blockquote><p id="f5c3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">呜！快到了！👨‍🚀</p><h1 id="0e15" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">7.添加无服务器目录和文件</h1><p id="6312" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">现在，您已经使用Expo成功搭建了一个React本机应用程序，接下来进入目录(例如react-native-chat-chucky)。</p><p id="429c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">$ CD react-native-chat-chucky</strong></p><p id="1d6d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">首先，让我们继续创建一个名为serverless的新目录，然后进入该目录，这样我们就可以安装一些依赖项。</p><p id="0e71" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ mkdir无服务器&amp; &amp; cd无服务器</strong></p><p id="08d1" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">新建一个<strong class="je hv"> package.json </strong>文件。</p><p id="9e3a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ touch package.json </strong></p><p id="4ce8" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">然后，将下面示例片段的内容复制到package.json文件中。</p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div></figure><blockquote class="kb kc kd"><p id="89c4" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">添加package.json文件后，确保在无服务器目录下运行yarn以正确安装模块。</p></blockquote><p id="e10a" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">完成上述步骤后，您需要将以下文件内容复制/粘贴到您的无服务器目录中。</p><p id="9206" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> .eslintrc.json </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">.eslintrc.json</figcaption></figure><p id="3726" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">。prettierrc </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">.prettierrc</figcaption></figure><p id="b2a3" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> webpack.config.js </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">webpack.config.js</figcaption></figure><p id="1355" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> serverless.yml </strong></p><figure class="ma mb mc md fq iv"><div class="bz el l di"><div class="mm mn l"/></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">serverless.yml</figcaption></figure><blockquote class="kb kc kd"><p id="cbcf" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">在serverless.yml文件的顶部，您将定义从serverless仪表盘保存的租户名称和应用程序名称。在我的例子中，我使用<strong class="je hv"> nickchuck </strong>作为我的租户名称，使用<strong class="je hv"> chuck-norris </strong>作为我的应用程序名称。</p></blockquote><p id="3ed2" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">干得好！👊</p><h1 id="e1f9" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">8.设置AWS</h1><p id="165a" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">网上有大量支持如何做到这一点的信息。我将提供必要的步骤，但这绝对是我推荐您阅读的内容！</p><blockquote class="kb kc kd"><p id="d043" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">需要注意的一个关键点是，无服务器需要几种不同的AWS IAM权限。S3、CloudFormation、API Gateway和Lambda等等。有一些方法可以将IAM权限限制在满足必要要求的范围内，这些方法可以在<a class="ae ka" href="https://serverless.com/framework/docs/providers/aws/guide/iam/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。我发现虽然这是最安全的方法，但肯定不是最快的。我的建议是，如果这是一个个人AWS帐户，请节省一些时间，并从IAM授予您的帐户“AdministratorAccess”权限。</p></blockquote><p id="824e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">设置好AWS帐户和IAM权限后，使用<a class="ae ka" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank"> aws-cli </a>在命令行中指定您的凭证(凭证可以在IAM下找到)。</p><p id="e0c7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ aws配置</strong></p><p id="fa84" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">aws-cli将询问您的访问密钥ID和秘密访问密钥。它还会问您几个(可选)问题，以便AWS CLI可以正确地提供您的配置文件。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/d7fa90f0dd5b328de9af2aec825e523d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F4b3epKgBqZkaxraNjUyRg.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">aws-cli</figcaption></figure><blockquote class="kb kc kd"><p id="377d" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">第一次需要安装aws-cli吗？在macOS上超级简单。只需运行brew install aws-cli和<a class="ae ka" href="https://brew.sh/" rel="noopener ugc nofollow" target="_blank"> Homebrew </a>就会为您完成剩下的工作！</p></blockquote><p id="3544" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">干得好！🕺</p><h1 id="a094" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">9.部署无服务器版本</h1><p id="9214" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">配置好AWS并将您的AWS凭证安全地存储在您的机器上之后，是时候将无服务器构建部署到Lambda了！导航到React本机代码库中的无服务器目录，然后运行以下命令！</p><blockquote class="kb kc kd"><p id="2a0c" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">如果您尚未安装无服务器CLI，可以使用npm install -g无服务器进行安装。</p></blockquote><p id="d267" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ sls部署</strong></p><p id="8337" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">构建将开始，您应该开始看到实时的日志记录！</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ml"><img src="../Images/7e6e8af01d07a07cace1d77722889a20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5w2jEL2TVUye2caC_Ho7jQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">$ sls deploy</figcaption></figure><blockquote class="kb kc kd"><p id="fca7" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">遇到问题了？请在文章末尾的评论中留下详细信息，我会帮你解决的！</p></blockquote><p id="b50c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">嘣！💥</p><h1 id="837a" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">10.启用API网关以开始服务请求</h1><p id="bb14" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">Serverless已经为您完成了一些繁重的工作，自动化了大部分构建。在无服务器出现之前，我们只有Lambda可以使用，有时事情确实有点不稳定和麻烦。对于一个只有Lambda的工作流，我们过去常常被要求压缩我们的代码库(节点模块等等),然后手动将压缩文件上传到AWS。呸！😫</p><p id="951e" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">要验证您的Lambda是否与API Gateway一起提供，请登录AWS并搜索API Gateway。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/34fb2a32fee1d7c1d41e564e37340e15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ai4UDf_V5pf3liN-FNKEIg.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">AWS Dashboard — API Gateway</figcaption></figure><p id="312b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">单击“API Gateway”，您将被重定向到带有API列表的仪表板。我的帐户下有一些，所以它可能会显示一些不同的东西。理想情况下，您正在寻找一个名为<strong class="je hv">prod-&lt;YOUR _ APP _ NAME&gt;</strong>的东西。在我的例子中，它是prod-react-native-app。点击正确的API查看您的资源。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/30ce9bee9166886118a88f654d6ca984.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSXkC7wn4E30tM_f7pcRrQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">API Gateway — Resources</figcaption></figure><p id="9598" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">选择顶部根资源后，单击“Actions”下拉菜单并选择“Deploy API”。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/61b9ae52253fb19b8f0c5d7e6b9c6e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7mzaCMUZKThgEC0pabBkg.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">API Gateway — Deploy</figcaption></figure><p id="dbcd" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">将显示一个模式，供您指定您的“阶段”。如果你在下拉列表中还没有一个“stage ”,创建一个新的，你可以随意命名。我选择了“prod”这个名字，因为当我推送到Lambda时，它通常已经使用<a class="ae ka" href="https://www.npmjs.com/package/serverless-offline" rel="noopener ugc nofollow" target="_blank">无服务器离线</a>进行了测试，并且已经可以生产了。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/6c216d6ae867c0bc1c311b854a8ce65f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rLQd2c6ceKNG7PE4g_q86A.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">API Gateway — Deploy API</figcaption></figure><p id="30e7" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">点击“部署”，您的API将被部署到API Gateway！现在，只需捕获调用URL并保存它以供下一步使用！</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mo"><img src="../Images/e7ae727a12f9e25fa0ccc48a6c5f2d26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yDjG2pJL552bNOetYqNnOg.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">API Gateway — Stage Editor</figcaption></figure><p id="7787" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">快到了！🏎</p><h1 id="f3d3" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">11.在Chat.js中指定Init端点</h1><p id="c1c1" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">保存您的调用URL后，将调用init处理程序，方法是将<strong class="je hv"> /init </strong>附加到它的末尾。转到Chat.js，第53行，从AWS API Gateway放入您的调用URL。这将处理流聊天所需的服务器端令牌的获取和生成。</p><p id="9f34" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有了正确的URL之后，代码将在用户登录后向/init发送用户信息<em class="ke">(又名you！).POST将返回一个带有用户信息和生成的用户令牌的序列化对象。</em></p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mp"><img src="../Images/f3faa285ee121b4af55a7d7da6ee218d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c7SK1d_hqnVJ5jcuhbAObw.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Chat.js</figcaption></figure><blockquote class="kb kc kd"><p id="0abd" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">您的端点当前没有受到API密钥的保护。如果您想要启用API密钥，可以在API网关内逐个路由地完成。</p></blockquote><p id="2d0c" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">答对了。🎲</p><h1 id="726a" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">12.设置Webhook回复URL</h1><p id="b7c8" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">类似于上面的步骤，URL将是您的调用URL，并在末尾附加了<strong class="je hv"> /reply </strong>。在Stream Chat仪表盘中，向下滚动到“Chat Events”部分，通过滑动切换按钮直到它变为绿色来启用webhook。然后将您的URL放入输入中，并单击“保存”。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mj"><img src="../Images/24c4b5f1a90d302954ce58b993867ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y2G5CXB9e-G54QqALRzwYw.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Stream Dashboard — Webhooks</figcaption></figure><p id="0239" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">有了合适的URL和激活的webhook，任何通过UI发送的聊天事件都会通过POST转发到Lambda。正文包含许多有用的信息，包括聊天标识符(CID)、发出请求的用户、消息正文等等。</p><p id="ffcc" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果您查看serverless/handler.js中的回复处理程序，您会注意到，只有当事件来自“chuck”以外的用户(Chuck Norris的预设用户)时，我们才会发回聊天消息。这是相当简单的逻辑，不应该太混乱。</p><blockquote class="kb kc kd"><p id="2724" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">Stream CLI还提供了设置Webhook URL的功能——你可以在这里下载Stream CLI <a class="ae ka" href="https://github.com/getstream/stream-cli" rel="noopener ugc nofollow" target="_blank">。请在这里</a>参考文档<a class="ae ka" href="https://github.com/GetStream/stream-cli/blob/master/docs/chat.md#stream-chatpushwebhook" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><p id="399d" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">再走一步！🚶</p><h1 id="284f" class="kw kx hu bd ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt dt translated">13.火本地聊起来！</h1><p id="ff64" class="pw-post-body-paragraph jc jd hu je b jf lu jh ji jj lv jl jm jn lw jp jq jr lx jt ju jv ly jx jy jz hn dt translated">你已经走了很长一段路。到目前为止，我们已经用Expo和Gifted Chat构建了一个定制的React原生聊天UI，绑定到Stream，用Serverless设置了一个AWS Lambda，并在Stream Chat仪表板上配置了一个webhook。哇，太多了。</p><p id="d244" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">现在是时候和查克·诺里斯一起娱乐一下了，听听他生活中所有激动人心的故事。</p><p id="4856" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">使用命令行启动iOS模拟器(从您的项目目录中)。</p><p id="54be" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv"> $ expo start — ios </strong></p><p id="4b85" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated"><strong class="je hv">或</strong></p><p id="ac75" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">进入React Native的根目录，运行命令<strong class="je hv"> yarn start </strong>。Expo将为您打开一个新的调试器窗口。接下来，按照下面的步骤。</p><ul class=""><li id="011e" class="ki kj hu je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated">打开Xcode</li><li id="56df" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">导航到Xcode菜单栏，直到它下拉</li><li id="5105" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated">找到“打开开发者工具”，然后点击“模拟器”</li></ul><p id="b3ce" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">iOS模拟器将启动并挂在你窗口的右上角。接下来，关注Expo打开的调试器窗口。在左下角，点击“在iOS模拟器上运行”。</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mq"><img src="../Images/d1fbed2d9cd76621c9c2a0752fea559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCqMBjgt1IUh_3JaVuAggQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">Expo Debugger</figcaption></figure><p id="3dee" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">应用程序应该加载到iOS模拟器中，您应该会看到登录屏幕！</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/a2f28e57ead7a2cf3206b3156563b392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RXxooFL8cUmN7Re9ZtlmsQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">iOS — Welcome</figcaption></figure><p id="61d9" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">键入您的姓名和电子邮件，然后单击底部的“与Chuck聊天”按钮。该应用程序将向服务器发出请求，并在流中检索您的应用程序提供的有效用户令牌。从这里开始，一切都是为了开心！</p><figure class="ma mb mc md fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mr"><img src="../Images/74f3bb9b8f135565097875c909a99b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v4Ehkdaud6mY_AaX8QLVYQ.png"/></div></div><figcaption class="me mf fg fe ff mg mh bd b be z ek">iOS — Chat</figcaption></figure><blockquote class="kb kc kd"><p id="78f3" class="jc jd ke je b jf jg jh ji jj jk jl jm kf jo jp jq kg js jt ju kh jw jx jy jz hn dt translated">停滞在构建阶段？在下面的评论中留下一些细节，我很乐意帮助你！</p></blockquote><p id="714b" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">如果你想进一步定制这款应用，或者把它变成APK (Android)或IPA (iOS)，我建议你查看以下链接:</p><ul class=""><li id="701c" class="ki kj hu je b jf jg jj jk jn kk jr kl jv km jz kn ko kp kq dt translated"><a class="ae ka" href="https://docs.expo.io/versions/latest/distribution/building-standalone-apps/" rel="noopener ugc nofollow" target="_blank">借助Expo构建独立应用</a></li><li id="ab2b" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><a class="ae ka" href="https://github.com/FaridSafi/react-native-gifted-chat" rel="noopener ugc nofollow" target="_blank">天才聊天——GitHub</a></li><li id="5c65" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><a class="ae ka" href="https://getstream.io/chat/docs/" rel="noopener ugc nofollow" target="_blank">流聊天文档</a></li><li id="f6a4" class="ki kj hu je b jf kr jj ks jn kt jr ku jv kv jz kn ko kp kq dt translated"><a class="ae ka" href="https://getstream.io/chat/react-native-chat/tutorial/" rel="noopener ugc nofollow" target="_blank">流聊天教程</a></li></ul><p id="8798" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">这是一个总结！<a class="ae ka" href="https://getstream.io/chat/" rel="noopener ugc nofollow" target="_blank">按流聊天</a>提供了必要的后端基础设施来从头开始构建聊天产品，只让前端由您决定！看看这些基于Stream Chat 构建的<a class="ae ka" href="https://getstream.io/chat/react-chat/tutorial/" rel="noopener ugc nofollow" target="_blank"> React powered教程。</a></p><p id="28aa" class="pw-post-body-paragraph jc jd hu je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz hn dt translated">喜欢这个教程？来点掌声怎么样？🙂👏</p></div></div>    
</body>
</html>