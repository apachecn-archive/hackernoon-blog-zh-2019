<html>
<head>
<title>DIY Redux with RxJS: Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用RxJS的DIY Redux:第2部分</h1>
<blockquote>原文：<a href="https://medium.com/hackernoon/diy-redux-with-rxjs-part-2-f9d4c53fa230?source=collection_archive---------19-----------------------#2019-01-07">https://medium.com/hackernoon/diy-redux-with-rxjs-part-2-f9d4c53fa230?source=collection_archive---------19-----------------------#2019-01-07</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/8404a87ec09016c896904ead515ef2e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rBO29FpCIE8eeZ_hhBhVSA.png"/></div></div><figcaption class="jc jd fg fe ff je jf bd b be z ek">Photo by <a class="ae jg" href="https://unsplash.com/photos/iVGevPcaJzk?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Steve Halama</a> on <a class="ae jg" href="https://unsplash.com/search/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="f53b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">万一你没有读第一部分，我建议你读一读。第一部分介绍如何实现Redux的核心功能。</p><div class="kg kh fm fo ki kj"><a href="https://hackernoon.com/diy-redux-with-rxjs-rxdx-23163a87ade1" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab ej"><div class="kl ab km cl cj kn"><h2 class="bd hv fv z el ko eo ep kp er et ht dt translated">带RxJS的DIY Redux with RxJS</h2><div class="kq l"><h3 class="bd b fv z el ko eo ep kp er et ek translated">一个结合RxJS和所有Redux helper库的实验，以创建一个“具有相似反应的状态管理…</h3></div><div class="kr l"><p class="bd b gc z el ko eo ep kp er et ek translated">hackernoon.com</p></div></div><div class="ks l"><div class="kt l ku kv kw ks kx ja kj"/></div></div></a></div><p id="d996" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在DIY Redux with RxJS =&gt; RxDx Part 2上，我将揭示一些最流行和广泛使用的<strong class="jj hv"> Redux </strong>中间件的内部。正如我在文章的第一部分提到的——你可以在上面找到——我的目标是做一个实验，将RxJS和所有广泛使用的Redux中间件组合成一个库，可以在这里找到<a class="ae jg" href="https://github.com/onerzafer/rxdx" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="ca6b" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">在进入主题之前，回顾一下redux中间件所需的签名总是有好处的。</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="697b" class="lh li hu ld b fv lj lk l ll lm">(storeAPI) =&gt; (next) =&gt; (action) =&gt; state</span></pre><p id="1ba9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="kf">在我开始之前，我需要承认，当我完成createStore函数时，我满怀信心地认为redux的所有可用中间件</em>  <em class="kf">都将适用于我的版本。实际上，它工作了，但不是对大多数来说，不是对广泛使用的来说:(所以我必须通过重新实现它们或者至少实现类似的来提供这些库/中间件。我们走吧。</em></p><h1 id="f19e" class="ln li hu bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj dt translated">降低可观测性的另一种方法</h1><p id="c747" class="pw-post-body-paragraph jh ji hu jj b jk mk jm jn jo ml jq jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated">正常情况下，<strong class="jj hv"> Redux </strong>不实现/无意实现<a class="ae jg" href="https://github.com/tc39/proposal-observable" rel="noopener ugc nofollow" target="_blank"> TC39 Observable </a>，因此默认不兼容RxJS。</p><p id="b9b9" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><em class="kf">这里不得不提一下可观测量的用例；如果您需要对事件流进行操作，那么使用可观察值可能更好。我说的是哪种手术？将两个流合并为一个流，过滤、映射或重定向一个流。更多技术细节请查看</em> <a class="ae jg" href="https://rxjs-dev.firebaseapp.com/guide/observable" rel="noopener ugc nofollow" target="_blank"> <em class="kf">此处</em> </a> <em class="kf">。</em></p><p id="0140" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当实现一个<strong class="jj hv"> Redux </strong> store时，你肯定会注意到你必须创建许多动作。我不得不承认，动作和事件非常相似，在运行时，它们会被触发数百次。所以这一定是<strong class="jj hv"> redux-observable </strong>捕捉<strong class="jj hv"> Redux </strong>作为流事件源的点。通过这样做，它为那些愿意在每个选择的动作上创建一些异步副作用的开发人员创造了一个好机会。关于<strong class="jj hv"> redux-observable </strong>的详细文档，你可以在这里查看<a class="ae jg" href="https://redux-observable.js.org/" rel="noopener ugc nofollow" target="_blank">。TL；神奇的事情发生在一个名为<strong class="jj hv"> createEppicsMiddleware </strong>的函数中，它的签名如下:</a></p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="5689" class="lh li hu ld b fv lj lk l ll lm">const createEpicsMiddleware = (rootEpic) =&gt; (storeAPI) =&gt; (next) =&gt; (action) =&gt; state</span></pre><p id="fe20" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">老实说，当我查看文档时，我不喜欢我们使用这个库的方式。对我来说，NgRx的<a class="ae jg" href="https://ngrx.io/guide/effects" rel="noopener ugc nofollow" target="_blank"> <strong class="jj hv"> Effect </strong> </a>的用法更经典:)所以我决定不模仿redux-observable的API，但功能应该在那里。所以我最后做了如下的事情。</p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="c380" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">正如我之前提到的，我非常喜欢NgRx风格的用法，我借用了<strong class="jj hv"> Effect </strong> decorator和<strong class="jj hv">type</strong>tap table函数。</p><p id="c6bb" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">效果装饰器就像在原始变量上添加一个类型一样简单。如果您的环境支持实验性装饰器，用法如下:</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="a46f" class="lh li hu ld b fv lj lk l ll lm">@Effect()<br/>const someCoolAsyncSideEffect = action$<br/>   .pipe(ofType('SomeCoolAction', 'OrEvenCoolerAction'))<br/>   .pipe(map(() =&gt; {type: 'SomeOtherCoolAction'}));</span></pre><p id="91fa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">不幸的是，如果您的环境不支持实验性装饰，这段代码看起来就不会那么漂亮。</p><h1 id="4b48" class="ln li hu bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj dt translated">重新选</h1><p id="b853" class="pw-post-body-paragraph jh ji hu jj b jk mk jm jn jo ml jq jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated"><em class="kf">当我在这个故事的</em> <a class="ae jg" href="https://hackernoon.com/diy-redux-with-rxjs-rxdx-23163a87ade1" rel="noopener ugc nofollow" target="_blank"> <em class="kf">第一部分</em> </a> <em class="kf">中实现createStore函数时，我相信自己的直觉，在暴露的商店对象中实现了select函数。这一决定显示出它在实现</em> <strong class="jj hv"> <em class="kf">重选</em><strong class="jj hv"><em class="kf">RxDx</em></strong><em class="kf">的</em> </strong> <em class="kf">库时非常有用。坦率地说，</em><strong class="jj hv"><em class="kf">reselect</em></strong><em class="kf">与</em><strong class="jj hv"><em class="kf">RxDx</em></strong><em class="kf">完全兼容，然而我正在试验，我需要挑战自己将所有的库合并到其中</em> <strong class="jj hv"> <em class="kf">。</em>T57】</strong></p></div><div class="ab cl mr ms hc mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hn ho hp hq hr"><p id="39c5" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv">重选</strong>是做什么的？它接受状态或状态部分，并返回它的一部分。那交易是什么？没有它，我们也能实现同样的功能，如下例所示:</p><pre class="ky kz la lb fq lc ld le lf aw lg dt"><span id="1012" class="lh li hu ld b fv lj lk l ll lm">const reselect = (state, key) =&gt; state[key];</span></pre><p id="70d8" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">上面的例子完全破坏了这个简单却非常有用的库的功能。交易是，<strong class="jj hv">重新选择</strong>提供了一个简单的可重复的函数，其内部有<strong class="jj hv">记忆</strong>来加速我们对状态的过滤——可能很复杂。</p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure><p id="452d" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">当我们使用react组件中的<strong class="jj hv"> RxDx </strong>商店时，该函数将具有关键功能。选择器的用法简单如下:</p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure><h1 id="e937" class="ln li hu bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj dt translated">Redux开发工具中间件</h1><p id="9b10" class="pw-post-body-paragraph jh ji hu jj b jk mk jm jn jo ml jq jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated">我认为缺少对redux开发工具的集成将是<strong class="jj hv"> RxDx </strong>的一大缺失。然后开始看dev tools的API文档，找到了我需要的__REDUX_DEVTOOLS_EXTENSION__。连接</p><p id="8f87" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">从这一点来看，将所有东西组合成一个中间件是非常容易的:</p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure></div><div class="ab cl mr ms hc mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hn ho hp hq hr"><p id="3c2e" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated"><strong class="jj hv">最后，我可以创建一个商店，添加一些reducers，应用内置的可选中间件，并选择一个特定的带记忆的子状态:</strong></p><figure class="ky kz la lb fq iv"><div class="bz el l di"><div class="mp mq l"/></div></figure><h1 id="5ca6" class="ln li hu bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj dt translated">最后的话，下次再说</h1><p id="d20b" class="pw-post-body-paragraph jh ji hu jj b jk mk jm jn jo ml jq jr js mm ju jv jw mn jy jz ka mo kc kd ke hn dt translated">我强烈建议那些想了解更多关于任何库或任何类型的设计模式或编码风格的人做这样的实验。这将导致你质疑你在日常编码工作中所做的许多事情。</p></div><div class="ab cl mr ms hc mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="hn ho hp hq hr"><p id="ce91" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">下一次我将继续我的实验，如何将一个类似redux的库与react组件结合起来，它将包含许多关于<strong class="jj hv"> HOCs </strong>和<strong class="jj hv">decorator</strong>的信息。</p><p id="6c19" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你也像我一样是一个自学者，并且对它有点不耐烦，那么在我发布RxDx文章的第三部分和最后一部分之前，让我们自己尝试一下。</p><p id="d8fa" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">这是我的回购开始你自己的实验:</p><div class="kg kh fm fo ki kj"><a href="https://github.com/onerzafer/rxdx" rel="noopener  ugc nofollow" target="_blank"><div class="kk ab ej"><div class="kl ab km cl cj kn"><h2 class="bd hv fv z el ko eo ep kp er et ht dt translated">onerzafer/rxdx</h2><div class="kq l"><h3 class="bd b fv z el ko eo ep kp er et ek translated">基于rxjs的react类redux库。在GitHub上创建帐户，为onerzafer/rxdx开发做出贡献。</h3></div><div class="kr l"><p class="bd b gc z el ko eo ep kp er et ek translated">github.com</p></div></div><div class="ks l"><div class="my l ku kv kw ks kx ja kj"/></div></div></a></div><p id="462a" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">如果你对RxDx感兴趣，并且喜欢到目前为止的文章，请不要忘记点击拍手(你最多可以拍手50次)。如果你在下面分享你的想法和反馈，我会很高兴的！</p><p id="b10f" class="pw-post-body-paragraph jh ji hu jj b jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke hn dt translated">感谢阅读！</p><h1 id="ea11" class="ln li hu bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj dt translated">第三部分:</h1><div class="kg kh fm fo ki kj"><a href="https://link.medium.com/o15qrM8VuT" rel="noopener follow" target="_blank"><div class="kk ab ej"><div class="kl ab km cl cj kn"><h2 class="bd hv fv z el ko eo ep kp er et ht dt translated">使用RxJS的DIY Redux:第3部分</h2><div class="kq l"><h3 class="bd b fv z el ko eo ep kp er et ek translated">在一个真实的例子中解释了高阶组件和Javascript装饰器。</h3></div><div class="kr l"><p class="bd b gc z el ko eo ep kp er et ek translated">link.medium.com</p></div></div><div class="ks l"><div class="mz l ku kv kw ks kx ja kj"/></div></div></a></div></div></div>    
</body>
</html>